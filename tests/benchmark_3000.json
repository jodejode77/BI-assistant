[
  {
    "question": "Проанализируйте средний размер одобренного кредита по семейным статусам для сегмента клиентов с высшим образованием для оптимизации кредитных предложений.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(pa.AMT_CREDIT) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE at.NAME_EDUCATION_TYPE = 'Higher education' AND pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY at.NAME_FAMILY_STATUS ORDER BY AVG(pa.AMT_CREDIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравнительный анализ среднего совокупного дохода для групп клиентов, обладающих автомобилем и не имеющих его.",
    "sql": "SELECT FLAG_OWN_CAR, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов с DPD > 0 в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для повторных клиентов (pa.NAME_CLIENT_TYPE = 'Repeater') сгруппирует данные по признаку просрочки платежа (delay_days > 0) и рассчитает средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Когда к нам чаще всего обращаются за кредитами в течение дня?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без текущего остатка (AMT_BALANCE = 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "В среднем, насколько сильно люди используют свои кредитные лимиты по картам?",
    "sql": "SELECT AVG(AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL) * 100 FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какой день недели демонстрирует наибольшую/наименьшую частоту одобрения или отказа по кредитным заявкам?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS approved_count, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS refused_count FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY approved_count DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова разница в среднем уровне дохода (AMT_INCOME_TOTAL) между клиентами, склонными к дефолту, и теми, кто таковым не является?",
    "sql": "SELECT TARGET, AVG(AMT_INCOME_TOTAL) FROM application_train_test GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) в разрезе по типу продукта (NAME_PRODUCT_TYPE).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для предыдущих заявок примерно за последний год между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте анализ распределения активных и закрытых кредитов из БКИ в разрезе гендерного состава заемщиков.",
    "sql": "SELECT at.CODE_GENDER, b.CREDIT_ACTIVE, COUNT(b.SK_BUREAU_ID) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.CODE_GENDER, b.CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется накопленный объём платежей по клиенту для рассрочек, относящихся к последнему году между различными сегментами между разными версиями графиков платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определить ключевые факторы, ведущие к негативным решениям по предыдущим обращениям.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(*) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(*) DESC LIMIT 10;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова доля клиентских обращений, поступивших в течение рабочего дня (с 9 утра до 6 вечера), от общего числа всех поданных заявлений?",
    "sql": "SELECT (SUM(CASE WHEN HOUR_APPR_PROCESS_START BETWEEN 9 AND 18 THEN 1 ELSE 0 END) * 100.0) / COUNT(*) FROM application_train_test;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова общая сумма задолженности, которая была зафиксирована по кредитам, ныне классифицированным как 'закрытые' в БКИ?",
    "sql": "SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Closed';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем просили те, кому мы отказали в прошлый раз?",
    "sql": "SELECT AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с заполненным аннуитетом (AMT_ANNUITY IS NOT NULL) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Есть ли зависимость между количеством детей у человека и тем, как он платит по кредитам?",
    "sql": "SELECT CNT_CHILDREN, AVG(TARGET) * 100 FROM application_train_test GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько денег мы всего выдали в качестве кредитов?",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train_test;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Визуализируйте распределение активных и закрытых кредитов по данным БКИ.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с давними обновлениями (DAYS_CREDIT_UPDATE <= -30) и по каждому значению группировки (CREDIT_TYPE) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для кредитов с недавно обновлёнными данными для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE > -30 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните кредитный лимит по картам для старой активности по картам в разрезе признака «клиент» по кредитным картам клиентов.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Проанализируйте распределение типов кредитных контрактов по всем поданным заявкам.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Отобразите динамику среднего чека кредита по годам.",
    "sql": "SELECT CAST(ABS(DAYS_DECISION) / 365 AS INT) AS decision_year, AVG(AMT_CREDIT) FROM previous_application GROUP BY decision_year ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каков показатель дефолта среди клиентов, у которых в кредитной истории (БКИ) зафиксированы дни просрочки?",
    "sql": "SELECT AVG(t1.TARGET) FROM application_train t1 JOIN bureau t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR WHERE t2.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для кредитов, по которым данные давно не обновлялись в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для карт без тяжёлых просрочек для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как изменяется частота дефолтов в зависимости от типа предыдущего кредитного соглашения?",
    "sql": "SELECT pa.NAME_CONTRACT_TYPE, AVG(at.TARGET) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR GROUP BY pa.NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих платежей по картам для активности по картам от полугода до года назад в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков суммарный объем кредитного портфеля по различным возрастным сегментам?",
    "sql": "SELECT CASE WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 25 THEN 'До 25' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 35 THEN '26-35' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 45 THEN '36-45' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 55 THEN '46-55' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 65 THEN '56-65' ELSE 'Старше 65' END AS AgeGroup, SUM(pa.AMT_CREDIT) AS TotalApprovedCredit FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY AgeGroup ORDER BY AgeGroup;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните кредитный лимит по картам для карт, по которым есть просрочка в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова вероятность дефолта в зависимости от того, есть ли у клиента собственная недвижимость?",
    "sql": "SELECT FLAG_OWN_REALTY, AVG(TARGET) AS default_rate FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднюю разницу между фактическим и плановым платежом (payment_diff) для случаев отсутствия фактического платежа (AMT_PAYMENT = 0) в разрезе по версии графика платежей (NUM_INSTALMENT_VERSION).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT = 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Визуализируйте сегментацию клиентской базы по возрастным когортам с указанием среднего значения кредитного лимита для каждой группы.",
    "sql": "SELECT CASE WHEN ABS(DAYS_BIRTH) / 365.25 < 30 THEN '20-29' WHEN ABS(DAYS_BIRTH) / 365.25 < 40 THEN '30-39' WHEN ABS(DAYS_BIRTH) / 365.25 < 50 THEN '40-49' WHEN ABS(DAYS_BIRTH) / 365.25 < 60 THEN '50-59' ELSE '60+' END AS age_group, AVG(AMT_CREDIT) FROM application_train GROUP BY age_group ORDER BY age_group;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для предыдущих заявок примерно за последний год между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте распределение используемых типов платежей для ранее одобренных кредитных заявок.",
    "sql": "SELECT NAME_PAYMENT_TYPE, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_PAYMENT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для предыдущих заявок примерно за последний год между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова средняя сумма выданного кредита для возрастной группы 60+?",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train WHERE FLOOR(ABS(DAYS_BIRTH) / 365) >= 60;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с DPD_DEF > 0 и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Провести сравнительный анализ среднего размера кредита для одобренных и отклоненных прошлых кредитных заявок.",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused') GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова метрика отказа в кредитовании по предыдущим заявкам?",
    "sql": "SELECT (CAST(SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*)) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведите агрегированное количество кредитных договоров в текущем портфеле для оценки масштаба операций.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте средний накопленный объём платежей по клиенту (cum_payment) для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) по по версии графика платежей (NUM_INSTALMENT_VERSION).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова зависимость среднего кредитного лимита по картам от уровня образования держателя?",
    "sql": "SELECT a.NAME_EDUCATION_TYPE, AVG(ccb.AMT_CREDIT_LIMIT_ACTUAL) FROM application_train a JOIN credit_card_balance ccb ON a.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY a.NAME_EDUCATION_TYPE ORDER BY AVG(ccb.AMT_CREDIT_LIMIT_ACTUAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите максимальное значение аннуитетного платежа в текущем портфеле.",
    "sql": "SELECT MAX(AMT_ANNUITY) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова тенденция изменения среднего ежемесячного платежа по кредитным картам на протяжении периода баланса?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Определите среднее арифметическое значение общего дохода среди всех заявителей.",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) FROM application_train_test;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Визуализируйте годовой тренд числа уникальных заявителей на основе дат принятия решений по их предыдущим заявкам.",
    "sql": "SELECT CAST(2023 + DAYS_DECISION / 365 AS INT) AS decision_year, COUNT(DISTINCT SK_ID_CURR) FROM previous_application GROUP BY decision_year ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какова средняя вероятность дефолта по всем полученным кредитным заявкам?",
    "sql": "SELECT AVG(TARGET) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для прошлых кредитов на сумму выше 50 000 между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково соотношение между суммой кредита и ценой товара, выраженное в среднем, для каждого типа контрактного соглашения?",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_CREDIT / AMT_GOODS_PRICE) AS credit_to_goods_ratio FROM application_train WHERE AMT_GOODS_PRICE IS NOT NULL AND AMT_GOODS_PRICE > 0 GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оцените долевое распределение различных типов договорных отношений среди клиентского портфеля.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(*) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по часу принятия решения (HOUR_APPR_PROCESS_START).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Визуализируйте распределение заемщиков по возрастным когортам для сегментации и целевого маркетинга.",
    "sql": "SELECT CASE WHEN ABS(DAYS_BIRTH)/365 < 25 THEN '18-24' WHEN ABS(DAYS_BIRTH)/365 < 35 THEN '25-34' WHEN ABS(DAYS_BIRTH)/365 < 45 THEN '35-44' WHEN ABS(DAYS_BIRTH)/365 < 55 THEN '45-54' WHEN ABS(DAYS_BIRTH)/365 < 65 THEN '55-64' ELSE '65+' END AS age_group, COUNT(SK_ID_CURR) FROM application_train GROUP BY age_group ORDER BY age_group;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какие профессии чаще всего встречаются у тех, кто делал больше трех запросов в кредитное бюро за последний год?",
    "sql": "SELECT OCCUPATION_TYPE, COUNT(SK_ID_CURR) FROM application_train WHERE AMT_REQ_CREDIT_BUREAU_YEAR > 3 GROUP BY OCCUPATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для отказанных предыдущих кредитов между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как различается средний размер долга у клиентов в зависимости от их типа жилья?",
    "sql": "SELECT t1.NAME_HOUSING_TYPE, AVG(t2.AMT_CREDIT_SUM_DEBT) AS AverageDebt FROM application_train t1 JOIN bureau t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR GROUP BY t1.NAME_HOUSING_TYPE ORDER BY AverageDebt DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита от 10 000 до 50 000 и по каждому значению поля NAME_CONTRACT_TYPE показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какова текущая общая доля дефолтных обязательств среди всех поданных заявок?",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как меняется средний доход клиентов в зависимости от числа их детей?",
    "sql": "SELECT CNT_CHILDREN, AVG(AMT_INCOME_TOTAL) AS AverageIncome FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните долю просроченных платежей по рассрочке для платежей, которые клиент внёс по признаку «клиент», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT SK_ID_CURR AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с серьёзной просрочкой по DPD_DEF (SK_DPD_DEF > 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD_DEF > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какова взаимосвязь между типом занятости и показателем дефолта?",
    "sql": "SELECT NAME_INCOME_TYPE, AVG(TARGET) FROM application_train GROUP BY NAME_INCOME_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выведите метрику: количество клиентов с повышенной кредитной нагрузкой (более двух активных кредитов).",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_credits FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING active_credits > 2);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для пролонгированных кредитов (CNT_CREDIT_PROLONG > 0) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для небольших кредитов (до 100 000) в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов с историей просрочек в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Визуализируйте корреляцию между количеством иждивенцев (членов семьи) у заемщика и интенсивностью его запросов в кредитное бюро.",
    "sql": "SELECT CNT_FAM_MEMBERS, AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по каналу продаж (CHANNEL_TYPE).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CHANNEL_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните значение DAYS_ENTRY_PAYMENT для второй половины клиентов по нечётности ID для разных значений признака «тип платёжной дисциплины» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите топ-5 кодов причин отказа по прескоринговым заявкам.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(*) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(*) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько в среднем дней осталось до погашения по активным кредитам в бюро?",
    "sql": "SELECT AVG(ABS(DAYS_CREDIT)) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND DAYS_CREDIT < 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каково распределение клиентской базы по группам просроченной задолженности в БКИ (0, 1-30, 30-60, 60-90, >90 дней)?",
    "sql": "SELECT CASE WHEN STATUS = '0' THEN 'No Overdue' WHEN STATUS = '1' THEN '1-30 Days' WHEN STATUS = '2' THEN '30-60 Days' WHEN STATUS = '3' THEN '60-90 Days' ELSE '>90 Days' END AS OverdueGroup, COUNT(DISTINCT SK_BUREAU_ID) FROM bureau_balance WHERE STATUS IN ('0', '1', '2', '3', '4', '5') GROUP BY OverdueGroup ORDER BY OverdueGroup;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для решений, принятых за последний год (DAYS_DECISION > -365) в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте анализ уровня дефолтности в разрезе видов кредитных договоров.",
    "sql": "SELECT NAME_CONTRACT_TYPE, CAST(SUM(CASE WHEN TARGET = 1 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(TARGET) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов с формально истёкшим сроком погашения в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE <= 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова структура контрактов по их типам среди всех заявок?",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(*) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сколько заявок мы одобряем или отклоняем в каждый день недели?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused') GROUP BY WEEKDAY_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По объединению bureau и bureau_balance рассчитайте среднюю долю месяцев с просрочкой по кредитам (bad_month_share) для месяцев без просрочки (bb.STATUS = '0') в разрезе по размеру кредита (крупный/остальные) на основе AMT_CREDIT_SUM, используя предварительную агрегацию по кредиту.",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS = '0' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(bad_month_share) AS metric_value FROM bb_agg GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте распределение количества входящих заявок по часам суток, чтобы выявить часы максимальной нагрузки.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «час принятия решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Проанализируйте средний размер кредита, сегментированный по гендерному признаку и виду кредитного договора (наличные/товары).",
    "sql": "SELECT CODE_GENDER, NAME_CONTRACT_TYPE, AVG(AMT_CREDIT) AS avg_credit FROM application_train GROUP BY CODE_GENDER, NAME_CONTRACT_TYPE ORDER BY CODE_GENDER, NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте рейтинг профессий по среднему размеру выданного кредита, ограничившись первыми десятью.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_CREDIT) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY AVG(AMT_CREDIT) DESC LIMIT 10;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Интересно, владельцы недвижимости реже дефолтят по кредитам или чаще?",
    "sql": "SELECT FLAG_OWN_REALTY, AVG(TARGET) * 100 FROM application_train_test GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выявление трех профессиональных групп, демонстрирующих максимальный уровень дефолта.",
    "sql": "SELECT OCCUPATION_TYPE, CAST(SUM(CASE WHEN TARGET = 1 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) AS default_rate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL AND OCCUPATION_TYPE != 'XNA' GROUP BY OCCUPATION_TYPE ORDER BY default_rate DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитов с давними обновлениями (DAYS_CREDIT_UPDATE <= -30) в разрезе по размеру кредита (AMT_CREDIT_SUM) с бинингом на крупные и остальные.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каковы топ-5 наиболее востребованных целей кредитования среди предыдущих заявок?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(SK_ID_PREV) AS ApplicationCount FROM previous_application WHERE NAME_CASH_LOAN_PURPOSE IS NOT NULL AND NAME_CASH_LOAN_PURPOSE != 'XNA' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY ApplicationCount DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт без текущего остатка (AMT_BALANCE = 0) в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отобразите динамику усредненного остатка на кредитных картах за последние шесть отчетных периодов.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) FROM credit_card_balance WHERE MONTHS_BALANCE >= -6 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для кредитов, где хотя бы раз была просрочка по сумме в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова структура статусов кредитов, отраженных в Бюро Кредитных Историй?",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер первоначального взноса по предыдущим кредитам для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково количество текущих и завершенных кредитов, зафиксированных в бюро?",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднюю долю месяцев с просрочкой по картам (SK_DPD > 0) для карт с заданным кредитным лимитом (AMT_CREDIT_LIMIT_ACTUAL > 0) по по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CASE WHEN SK_DPD > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер фактического платежа по рассрочке для более поздних платежей по рассрочке между разными группами между своевременными и просроченными платежами?",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте список клиентов, чьи демографические данные показывают равенство между числом иждивенцев и общим размером семьи, для дальнейшего анализа социального профиля.",
    "sql": "SELECT SK_ID_CURR, CNT_CHILDREN, CNT_FAM_MEMBERS FROM application_train WHERE CNT_CHILDREN = CNT_FAM_MEMBERS;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя загрузку кредитных карт (utilization) для карт, по которым клиент сейчас тратит средства для разных сегментов между разными месяцами наблюдения по картам с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 ) SELECT MONTHS_BALANCE AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков средний размер просроченной задолженности по кредитным продуктам, зафиксированным в БКИ?",
    "sql": "SELECT AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для платежей по рассрочке за последний год (DAYS_INSTALMENT BETWEEN -365 AND 0) сгруппирует данные по типу клиента (pa.NAME_CLIENT_TYPE) и рассчитает среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих платежей по картам для карт с нулевым остатком задолженности в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для решений, принятых за последний год (DAYS_DECISION > -365) в разрезе по каналу продаж (CHANNEL_TYPE).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY CHANNEL_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой в среднем был первый взнос у тех, кому одобрили кредит?",
    "sql": "SELECT AVG(AMT_DOWN_PAYMENT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND AMT_DOWN_PAYMENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оцените среднюю скорость обработки заявок (time-to-decision) в днях.",
    "sql": "SELECT AVG(-DAYS_DECISION) FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте список клиентов и соответствующее число их прошлых кредитов.",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_ID_PREV) AS NumberOfPreviousLoans FROM previous_application GROUP BY SK_ID_CURR ORDER BY NumberOfPreviousLoans DESC",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните стоимость товара по предыдущим кредитам для клиентов, которые уже брали кредит ранее для разных категорий по признаку «день недели решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Оцените возрастную структуру портфеля клиентов, сгруппировав заемщиков по стандартным возрастным интервалам для анализа кредитного скоринга.",
    "sql": "SELECT CASE WHEN ABS(DAYS_BIRTH)/365 < 25 THEN '18-24' WHEN ABS(DAYS_BIRTH)/365 < 35 THEN '25-34' WHEN ABS(DAYS_BIRTH)/365 < 45 THEN '35-44' WHEN ABS(DAYS_BIRTH)/365 < 55 THEN '45-54' WHEN ABS(DAYS_BIRTH)/365 < 65 THEN '55-64' ELSE '65+' END AS age_group, COUNT(SK_ID_CURR) FROM application_train GROUP BY age_group ORDER BY age_group;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите число клиентов с избыточной кредитной нагрузкой, имеющих более трех активных займов в БКИ.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS num_credits FROM bureau GROUP BY SK_ID_CURR HAVING num_credits > 3) AS subquery;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Идентифицируйте клиентов, демонстрирующих высокий коэффициент использования кредитного лимита (utilization rate) при значительном общем лимите по кредитной карте.",
    "sql": "SELECT SK_ID_CURR, MAX(AMT_CREDIT_LIMIT_ACTUAL) AS max_limit, MAX(AMT_BALANCE) AS max_balance FROM credit_card_balance GROUP BY SK_ID_CURR HAVING max_balance > (0.8 * max_limit) AND max_limit > 100000 ORDER BY max_balance DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова динамика показателя дефолта в разрезе количества детей у заемщиков?",
    "sql": "SELECT CNT_CHILDREN, AVG(TARGET) AS default_rate FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для небольших кредитов (до 100 000) в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте перечень клиентов, чья кредитная история отсутствует в Бюро кредитных историй.",
    "sql": "SELECT a.SK_ID_CURR, a.AMT_INCOME_TOTAL, a.AMT_CREDIT FROM application_train a LEFT JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.SK_ID_CURR IS NULL LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте сумму всех выданных кредитных средств по активным договорам.",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train WHERE TARGET = 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 для разных категорий по признаку «группа доходности продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер планового платежа по рассрочке для платежей, которые были действительно внесены между разными группами между своевременными и просроченными платежами?",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите совокупный объем задолженности по всем закрытым кредитным обязательствам, зафиксированным в бюро кредитных историй.",
    "sql": "SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Closed';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова зависимость среднего аннуитетного платежа от возрастной категории клиента?",
    "sql": "SELECT FLOOR(ABS(DAYS_BIRTH) / 365) AS Age, AVG(AMT_ANNUITY) AS AverageAnnuity FROM application_train GROUP BY Age ORDER BY Age;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Кто у нас самый многодетный и сколько эти люди зарабатывают?",
    "sql": "SELECT SK_ID_CURR, CNT_CHILDREN, AMT_INCOME_TOTAL FROM application ORDER BY CNT_CHILDREN DESC, AMT_INCOME_TOTAL DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова динамика количества предыдущих кредитных заявок в зависимости от числа иждивенцев (детей) у клиента?",
    "sql": "SELECT at.CNT_CHILDREN, COUNT(pa.SK_ID_PREV) AS num_previous_applications FROM application_train at LEFT JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR GROUP BY at.CNT_CHILDREN ORDER BY at.CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какая общая сумма платежей по кредиткам была в прошлом месяце?",
    "sql": "SELECT SUM(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE = (SELECT MAX(MONTHS_BALANCE) FROM credit_card_balance);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей от полугода до года назад, покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки SK_BUREAU_ID.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для кредитов в основной валюте 'currency 1' в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Прошу предоставить средний размер аннуитетного платежа для одобренных заявок по POS-кредитам.",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM previous_application WHERE NAME_CONTRACT_TYPE = 'POS cash' AND NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведите средний аннуитетный платеж для одобренных кредитов.",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND AMT_ANNUITY IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте список из топ-5 самых частых занятий клиентов.",
    "sql": "SELECT OCCUPATION_TYPE, COUNT(SK_ID_CURR) AS count FROM application_train GROUP BY OCCUPATION_TYPE ORDER BY count DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по типу продукта (NAME_PRODUCT_TYPE).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Есть ли заметная разница в показателях дефолта между заемщиками, владеющими недвижимостью, и теми, кто ею не владеет?",
    "sql": "SELECT FLAG_OWN_REALTY, AVG(TARGET) AS default_rate FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для предыдущих кредитов свыше 50 000 с ненулевым плановым платежом сгруппирует данные по каналу продаж (pa.CHANNEL_TYPE) и рассчитает среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.AMT_CREDIT > 50000 AND ip.AMT_INSTALMENT > 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с непогашенной задолженностью (AMT_CREDIT_SUM_DEBT > 0) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте круговую диаграмму, отражающую долю активных и закрытых кредитов по данным БКИ.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Отобразите средний возраст целевой аудитории для понимания демографического профиля.",
    "sql": "SELECT AVG(ABS(DAYS_BIRTH) / 365) FROM application_train_test;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подскажи, в какое время суток клиенты чаще всего отправляют заявки?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для клиентов, которые уже брали кредит ранее между клиентами между отраслями продавцов, через которых оформлялись кредиты?",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) для карт с просрочкой по DPD (SK_DPD > 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) для карточных записей за последние 6 месяцев (MONTHS_BALANCE > -6) в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') и по каждому значению поля NAME_YIELD_GROUP показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Оцените риск дефолта для одиноких клиентов, разделив их по признаку владения автомобилем, для корректировки скоринговых моделей.",
    "sql": "SELECT FLAG_OWN_CAR, AVG(TARGET) AS default_rate FROM application_train WHERE NAME_FAMILY_STATUS = 'Single / not married' GROUP BY FLAG_OWN_CAR ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Можем ли мы получить данные о заемщиках с тремя и более детьми, чей доход ниже порогового значения в 100 000?",
    "sql": "SELECT SK_ID_CURR, CNT_CHILDREN, AMT_INCOME_TOTAL FROM application_train WHERE CNT_CHILDREN >= 3 AND AMT_INCOME_TOTAL < 100000 ORDER BY CNT_CHILDREN DESC, AMT_INCOME_TOTAL ASC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните максимальный месяц наблюдения по кредиту для месяцев с просрочками по кредитам в разрезе признака «тип кредита в бюро», если учитывать помесячную историю статусов кредитов из бюро.",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1','2','3','4','5') GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_TYPE AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CREDIT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько у нас клиентов, у которых есть и машина, и квартира?",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE FLAG_OWN_CAR = 'Y' AND FLAG_OWN_REALTY = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Кто из клиентов имеет активные просроченные кредиты согласно данным БКИ?",
    "sql": "SELECT DISTINCT SK_ID_CURR FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) для карт, по которым были выборки в текущем периоде (AMT_DRAWINGS_CURRENT > 0) в разрезе по типу поведения клиента: платёж превышает выборки или нет.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какой процент наших клиентов имеет просрочки по внешним займам, если посмотреть на БКИ?",
    "sql": "SELECT (SUM(CASE WHEN T2.CREDIT_DAY_OVERDUE > 0 THEN 1 ELSE 0 END) * 100.0) / COUNT(DISTINCT T1.SK_ID_CURR) FROM application_train AS T1 JOIN bureau AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с платежами в текущем периоде (AMT_PAYMENT_CURRENT > 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднюю разницу между фактическим и плановым платежом (payment_diff) для первых 12 платежей в графике в разрезе по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT SK_ID_CURR AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните запрошенный размер кредита по заявке для кредитов на дорогие товары дороже 100 000 для разных категорий по признаку «статус прошлой заявки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните показатель DPD по POS-кредитам для POS-кредитов с просрочкой для разных значений признака «активность POS-кредита» по POS-кредитам.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте метрику - процент отказов по кредитным заявкам, чтобы оценить эффективность кредитного конвейера.",
    "sql": "SELECT CAST(SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_ENTRY_PAYMENT для начальных платежей по рассрочке между разными группами между разными кредитами клиента?",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY SK_ID_PREV ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте средний накопленный объём платежей по клиенту (cum_payment) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по сегментам номера платежа (early/middle/late).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Можешь показать, как образование и семейное положение влияют на риск невозврата кредита?",
    "sql": "SELECT NAME_EDUCATION_TYPE, NAME_FAMILY_STATUS, AVG(TARGET) AS default_rate, COUNT(SK_ID_CURR) AS client_count FROM application_train GROUP BY NAME_EDUCATION_TYPE, NAME_FAMILY_STATUS ORDER BY default_rate DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Общее число клиентов, имевших случаи просроченной задолженности по кредитам, зарегистрированным в БКИ.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Визуализируйте процент дефолта отдельно для клиентов, имеющих собственность, и для тех, у кого ее нет.",
    "sql": "SELECT FLAG_OWN_REALTY, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте статистику одобренных ранее кредитных заявок с детализацией по дням недели их обработки.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько предыдущих заявок было одобрено, а сколько отклонено?",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Какие просроченные задолженности числятся за клиентом с SK_ID_CURR = 100003 в его кредитной истории?",
    "sql": "SELECT SK_BUREAU_ID, CREDIT_DAY_OVERDUE, AMT_CREDIT_SUM_DEBT FROM bureau WHERE SK_ID_CURR = 100003 AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с лимитом до 50 000, покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните показатель DPD_DEF по POS-кредитам для второй условной половины клиентов (по нечётности ID) для разных значений признака «активность POS-кредита» по POS-кредитам.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Предоставьте отчет, содержащий идентификаторы клиентов, их совокупный доход и общий объем задолженности по всем обязательствам в кредитном бюро.",
    "sql": "SELECT at.SK_ID_CURR, at.AMT_INCOME_TOTAL, SUM(b.AMT_CREDIT_SUM_DEBT) AS total_bureau_debt FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.SK_ID_CURR, at.AMT_INCOME_TOTAL ORDER BY total_bureau_debt DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество пролонгаций по кредитам из бюро для кредитов в основной валюте 'currency 1' для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как там наши клиенты распределяются по валютам кредитов в БКИ?",
    "sql": "SELECT CREDIT_CURRENCY, COUNT(DISTINCT SK_ID_CURR) FROM bureau GROUP BY CREDIT_CURRENCY;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как распределяется задержку платежа по рассрочкам для пропущенных платежей между различными сегментами между клиентами по их платёжной истории по рассрочке в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT = 0 ) SELECT SK_ID_CURR AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для записей с максимальной просрочкой (STATUS = '5') в разрезе по идентификатору кредита в бюро (SK_BUREAU_ID).",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS = '5' GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для предыдущих заявок с суммой кредита от 10 000 до 50 000 в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите процентное соотношение семейного положения среди клиентской базы, не имеющей активных кредитных обязательств в БКИ.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, COUNT(DISTINCT at.SK_ID_CURR) * 100.0 / (SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train WHERE SK_ID_CURR NOT IN (SELECT SK_ID_CURR FROM bureau WHERE CREDIT_ACTIVE = 'Active')) AS percentage FROM application_train at WHERE at.SK_ID_CURR NOT IN (SELECT SK_ID_CURR FROM bureau WHERE CREDIT_ACTIVE = 'Active') GROUP BY at.NAME_FAMILY_STATUS ORDER BY percentage DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте график изменения среднего значения AMT_CREDIT по годам.",
    "sql": "SELECT CAST(ABS(DAYS_DECISION)/365) AS years_ago, AVG(AMT_CREDIT) FROM previous_application GROUP BY years_ago ORDER BY years_ago DESC",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "А какой у нас средний доход у тех, кто подает заявки?",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) FROM application_train_test;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для прошлых заявок, принятых более года назад между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте хронологическую динамику количества поданных заявок за последний 365-дневный период.",
    "sql": "SELECT ABS(DAYS_DECISION) AS days_ago, COUNT(*) AS application_count FROM previous_application WHERE DAYS_DECISION > -366 GROUP BY days_ago ORDER BY days_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Кто чаще всего подавал заявки на кредиты? Покажи топ-10.",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_ID_PREV) AS prev_app_count FROM previous_application GROUP BY SK_ID_CURR ORDER BY prev_app_count DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с давними обновлениями (DAYS_CREDIT_UPDATE <= -30) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для пролонгированных кредитов (CNT_CREDIT_PROLONG > 0) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково распределение показателей дефолта среди различных образовательных сегментов клиентов?",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с количеством платежей более 6 (CNT_INSTALMENT > 6) и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднюю разницу между фактическим и плановым платежом (payment_diff) для платежей по рассрочкам за последний год в разрезе по версии графика платежей (NUM_INSTALMENT_VERSION).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие цели кредита чаще всего одобряются? Покажите мне топ-5.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND NAME_CASH_LOAN_PURPOSE != 'XNA' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер первоначального взноса по предыдущим кредитам для предыдущих заявок с суммой кредита более 50 000 в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Исследуйте корреляцию между исходом предыдущей заявки и уровнем PD (Probability of Default) для заемщиков.",
    "sql": "SELECT pa.NAME_CONTRACT_STATUS, AVG(at.TARGET) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR GROUP BY pa.NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) в разрезе по типу продукта (NAME_PRODUCT_TYPE).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте список заемщиков с критически высоким Debt-to-Income (DTI) ratio для детального анализа кредитоспособности.",
    "sql": "SELECT SK_ID_CURR, AMT_CREDIT, AMT_INCOME_TOTAL, AMT_CREDIT * 1.0 / AMT_INCOME_TOTAL AS credit_to_income_ratio FROM application_train WHERE AMT_INCOME_TOTAL > 0 ORDER BY credit_to_income_ratio DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется задержку платежа по рассрочкам для рассрочек, относящихся к последнему году между различными сегментами между клиентами по их платёжной истории по рассрочке в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT SK_ID_CURR AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для более старых записей (MONTHS_BALANCE < -12) в разрезе по давности записи (MONTHS_BALANCE, recent/old).",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Анализ структуры образовательного уровня клиентской базы.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество пролонгаций по кредитам из бюро для кредитных карт с установленным лимитом для разных групп клиентов между типами кредитов, отражённых в бюро?",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) для карточных записей от полугода до года назад в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие 5 профессий приносят нашим клиентам самый большой доход?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_INCOME_TOTAL) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY AVG(AMT_INCOME_TOTAL) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сгенерируйте диаграмму, показывающую средний аннуитетный платеж (AMT_ANNUITY) в зависимости от статуса предыдущей заявки (одобрено/отклонено).",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(AMT_ANNUITY) FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused') GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по статусу договора (NAME_CONTRACT_STATUS) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов, по которым ещё не наступил конец срока в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выявите пять профессиональных категорий с наиболее высоким коэффициентом дефолта.",
    "sql": "SELECT OCCUPATION_TYPE, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY DefaultRate DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните значение DAYS_INSTALMENT для начальных платежей по рассрочке для разных значений признака «своевременность платежей» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сопоставьте средний объем текущего кредита для сегментов клиентов, имевших и не имевших кредитную задолженность в бюро кредитных историй.",
    "sql": "SELECT CASE WHEN EXISTS (SELECT 1 FROM bureau b WHERE b.SK_ID_CURR = at.SK_ID_CURR AND b.AMT_CREDIT_SUM_DEBT > 0) THEN 'Has Bureau Debt' ELSE 'No Bureau Debt' END AS bureau_debt_status, AVG(at.AMT_CREDIT) FROM application_train at GROUP BY bureau_debt_status;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Давай посмотрим, какая средняя сумма покупки была у клиентов, чьи прошлые заявки были одобрены, и у тех, кому отказали?",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(AMT_GOODS_PRICE) FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused') GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для отказанных предыдущих кредитов между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какова структура кредитного портфеля по типам продуктов в разрезе объемов за последний финансовый год?",
    "sql": "SELECT NAME_CONTRACT_TYPE, SUM(AMT_CREDIT) FROM previous_application WHERE DAYS_DECISION >= -365 AND NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какие пять статусов просроченной задолженности наиболее часто регистрируются в бюро баланса?",
    "sql": "SELECT STATUS, COUNT(SK_BUREAU_ID) FROM bureau_balance WHERE STATUS IN ('1', '2', '3', '4', '5') GROUP BY STATUS ORDER BY COUNT(SK_BUREAU_ID) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите процент дефолтов по группам клиентов: с автомобилем и без него.",
    "sql": "SELECT FLAG_OWN_CAR, AVG(TARGET) * 100 FROM application_train_test GROUP BY FLAG_OWN_CAR",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выявите ТОП-10 профессиональных групп, которым одобряется наибольший средний размер кредита.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_CREDIT) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY AVG(AMT_CREDIT) DESC LIMIT 10;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым известна фактическая дата завершения (DAYS_ENDDATE_FACT IS NOT NULL) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Оцените гендерное распределение числа поступающих кредитных заявок.",
    "sql": "SELECT CODE_GENDER, COUNT(SK_ID_CURR) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Отобразите помесячный тренд среднего значения AMT_PAYMENT_CURRENT и AMT_INST_MIN_REGULARITY для кредитных карт.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_PAYMENT_CURRENT), AVG(AMT_INST_MIN_REGULARITY) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC LIMIT 12;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каково среднее количество действующих кредитов в кредитном бюро для заемщиков 'TARGET=0' и 'TARGET=1'?",
    "sql": "SELECT at.TARGET, AVG(b.ActiveCredits) FROM application_train at JOIN (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS ActiveCredits FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR) b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как дефолтность меняется в зависимости от того, кем работает человек?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) AS default_rate FROM application_train GROUP BY OCCUPATION_TYPE ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите среднюю сумму текущего платежа и среднюю общую сумму текущего платежа по всем кредитным картам.",
    "sql": "SELECT AVG(AMT_PAYMENT_CURRENT), AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажи нам количество заявок, получивших статус \"отказано\".",
    "sql": "SELECT COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитов, по которым недавно обновлялась информация (DAYS_CREDIT_UPDATE > -30) в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE > -30 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какие клиенты имеют открытые просрочки в БКИ длительностью более 30 дней, и каковы детали этих кредитов?",
    "sql": "SELECT app.SK_ID_CURR, app.AMT_CREDIT, bureau.CREDIT_DAY_OVERDUE FROM application_train app JOIN bureau ON app.SK_ID_CURR = bureau.SK_ID_CURR WHERE bureau.CREDIT_DAY_OVERDUE > 30 ORDER BY bureau.CREDIT_DAY_OVERDUE DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Мне нужен барчарт, отображающий долю дефолтов среди мужчин и женщин.",
    "sql": "SELECT CODE_GENDER, AVG(TARGET) * 100 FROM application_train_test GROUP BY CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте распределение целей кредитования по предыдущим заявкам клиентов.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CASH_LOAN_PURPOSE != 'XNA' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю долю просроченных платежей (delay_days > 0) для фактических оплат по рассрочке (ip.AMT_PAYMENT > 0) в разрезе по признаку просрочки платежа (delay_days > 0) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните величина DAYS_DECISION по предыдущим кредитам для одобренных предыдущих кредитов для разных категорий по признаку «час принятия решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите средний возраст клиентов в кредитном портфеле.",
    "sql": "SELECT AVG(ABS(DAYS_BIRTH) / 365.25) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведите список заемщиков, не имеющих кредитной истории в БКИ.",
    "sql": "SELECT DISTINCT SK_ID_CURR FROM application_train WHERE SK_ID_CURR NOT IN (SELECT DISTINCT SK_ID_CURR FROM bureau);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков процент невозврата кредитов среди автовладельцев в сравнении с остальными?",
    "sql": "SELECT FLAG_OWN_CAR, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля NAME_PRODUCT_TYPE показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Вычислите метрику 'общий кредитный портфель' по всем записям.",
    "sql": "SELECT SUM(AMT_CREDIT) AS total_credit_issued FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Кто из наших клиентов имеет несколько дефолтов по своим предыдущим кредитам в БКИ?",
    "sql": "SELECT T1.SK_ID_CURR, COUNT(T2.SK_BUREAU_ID) AS OverdueCreditsCount FROM application_train_test T1 JOIN bureau T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T2.CREDIT_DAY_OVERDUE > 0 GROUP BY T1.SK_ID_CURR HAVING COUNT(T2.SK_BUREAU_ID) > 1 ORDER BY OverdueCreditsCount DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков ежемесячный тренд изменения среднего значения фактического кредитного лимита по портфелю кредитных карт?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какова тенденция изменения среднего баланса по кредитным картам в течение последних двенадцати месяцев?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) AS avg_monthly_balance FROM credit_card_balance WHERE MONTHS_BALANCE >= -12 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) для платежей без просрочки (DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT) в разрезе по клиенту (SK_ID_CURR) с агрегацией по его рассрочкам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY SK_ID_CURR ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова взаимосвязь между количеством наблюдений в социальном круге за последние 30 дней и уровнем дефолта?",
    "sql": "SELECT OBS_30_CNT_SOCIAL_CIRCLE, AVG(TARGET) * 100 AS Default_Rate FROM application_train GROUP BY OBS_30_CNT_SOCIAL_CIRCLE ORDER BY OBS_30_CNT_SOCIAL_CIRCLE ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю разницу между фактическим и плановым платежом (payment_diff) для первых 12 платежей в графике по по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT SK_ID_CURR AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какую сумму в среднем платили по кредиткам те, кто потом не смог расплатиться?",
    "sql": "SELECT AVG(ccb.AMT_PAYMENT_CURRENT) FROM credit_card_balance ccb JOIN application_train at ON ccb.SK_ID_CURR = at.SK_ID_CURR WHERE at.TARGET = 1 AND ccb.AMT_PAYMENT_CURRENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для записей с активным статусом договора (NAME_CONTRACT_STATUS = 'Active') и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для крупных кредитов (свыше 100 000) в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько в среднем просили денег те, чьи кредиты не одобрили?",
    "sql": "SELECT AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните разницу между фактическим и плановым платежом для случаев, когда клиент не внёс очередной платёж между сегментами по признаку «доходность продукта» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT = 0 ) SELECT NAME_YIELD_GROUP AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для карт без просрочек для разных групп между разными статусами договоров по кредитным картам?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_PORTFOLIO ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Предоставьте данные о среднем размере семьи для клиентов с жилищными кредитами.",
    "sql": "SELECT AVG(CNT_FAM_MEMBERS) FROM application_train WHERE NAME_HOUSING_TYPE = 'House / apartment' AND NAME_CONTRACT_TYPE = 'Cash loans';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оцените объем клиентов с показателем \"DOD > 30\" (Days Overdue > 30) в кредитных бюро для оценки портфельного риска.",
    "sql": "SELECT COUNT(DISTINCT at.SK_ID_CURR) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE > 30;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов в основной валюте 'currency 1' в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY CHANNEL_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте распределение поданных кредитных заявок по дням недели начала процесса.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для предыдущих заявок примерно за последний год для разных категорий по признаку «тип портфеля» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT) для платежей по рассрочке за последний год (DAYS_INSTALMENT BETWEEN -365 AND 0) в разрезе по типу клиента (pa.NAME_CLIENT_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте структуру клиентской базы по уровню полученного образования.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Отобразите динамику количества заявок за прошлые периоды по дням с момента вынесения решения.",
    "sql": "SELECT DAYS_DECISION, COUNT(SK_ID_PREV) FROM previous_application GROUP BY DAYS_DECISION ORDER BY DAYS_DECISION;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита более 50 000 и по каждому значению поля NAME_PORTFOLIO показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выведите таблицу клиентов, которые не соблюдают условие минимального регулярного платежа по кредитным картам.",
    "sql": "SELECT SK_ID_CURR, SK_ID_PREV, AMT_PAYMENT_CURRENT, AMT_INST_MIN_REGULARITY FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT < AMT_INST_MIN_REGULARITY AND AMT_PAYMENT_CURRENT IS NOT NULL AND AMT_INST_MIN_REGULARITY IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните показатель DPD_DEF по POS-кредитам для текущих, ещё не погашенных POS-кредитов для разных значений признака «клиент» по POS-кредитам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля NAME_PORTFOLIO показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PORTFOLIO ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для POS-записей от 6 до 12 месяцев назад в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите совокупную сумму выданных кредитов для каждого типа контракта.",
    "sql": "SELECT NAME_CONTRACT_TYPE, SUM(AMT_CREDIT) FROM application_train GROUP BY NAME_CONTRACT_TYPE ORDER BY SUM(AMT_CREDIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих выборок по картам для карт, по которым есть просрочка в разрезе признака «статус договора по карте» по кредитным картам клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется разницу между фактическим и плановым платёжом по рассрочке для платежей, которые клиент внёс между различными сегментами между разными версиями графиков платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карточных записей от полугода до года назад в разрезе по клиенту (SK_ID_CURR) с агрегацией по картам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково процентное соотношение причин отказа в ранее поданных заявках?",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для POS-кредитов без тяжёлых просрочек между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с высоким лимитом (AMT_CREDIT_LIMIT_ACTUAL > 50 000), покажите средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 50000 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова доля клиентов каждого пола в нашем портфеле?",
    "sql": "SELECT CODE_GENDER, COUNT(*) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Определите текущий уровень дефолта (PD) по всему портфелю активных кредитов.",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train_test WHERE TARGET IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество оставшихся платежей по POS-кредитам для действующих POS-договоров для разных значений признака «клиент» по POS-кредитам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих платежей по картам для условной половины клиентов по чётности ID в разрезе признака «статус договора по карте» по кредитным картам клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отобразите сегментацию клиентской базы по типу образования.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS Number_of_Clients FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY Number_of_Clients DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Покажи мне всех клиентов, у кого сейчас активный кредит и кто просрочил платежи по данным из бюро.",
    "sql": "SELECT DISTINCT app.SK_ID_CURR, app.AMT_CREDIT FROM application_train app JOIN bureau b ON app.SK_ID_CURR = b.SK_ID_CURR JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Active' AND bb.STATUS IN ('1', '2', '3', '4', '5');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как выглядит загрузку кредитных карт (отношение задолженности к лимиту) для карт, по которым клиент сейчас пользуется кредитным лимитом для разных сегментов клиентов между новыми и повторными клиентами, если объединить историю прошлых кредитов и поведение по кредитным картам?",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.AMT_DRAWINGS_CURRENT > 0 GROUP BY cc.SK_ID_CURR ) SELECT pa.NAME_CLIENT_TYPE AS group_key, AVG(utilization) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков показатель доли клиентов с текущими проблемными (просроченными) кредитными обязательствами в бюро балансов за последний месяц?",
    "sql": "SELECT (COUNT(DISTINCT t1.SK_ID_CURR) * 100.0 / (SELECT COUNT(DISTINCT SK_ID_CURR) FROM application)) FROM bureau AS t1 JOIN bureau_balance AS t2 ON t1.SK_BUREAU_ID = t2.SK_BUREAU_ID WHERE t2.MONTHS_BALANCE = -1 AND (t2.STATUS = '1' OR t2.STATUS = 'X');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для уже погашенных POS-кредитов для разных значений признака «активность POS-кредита» по POS-кредитам.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0), покажите среднее количество дней до фактической даты платежа (DAYS_ENTRY_PAYMENT) по каждому значению поля SK_ID_PREV.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_PREV ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний плановый платёж по рассрочке (AMT_INSTALMENT) для платежей без просрочки (DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT) в разрезе по факту платёжной дисциплины (переплата/недоплата).",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков средний доход клиентов, если разделить их по семейному статусу?",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY AVG(AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Хочу посмотреть, как наши клиенты распределены по разным типам пакетов услуг.",
    "sql": "SELECT NAME_TYPE_SUITE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_TYPE_SUITE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните загрузку кредитных карт (отношение задолженности к лимиту) для недавней активности по кредитным картам по признаку «тип продукта по прошлым кредитам» на уровне клиентов, используя как данные по прошлым кредитам, так и агрегированную статистику по картам.",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.MONTHS_BALANCE > -6 GROUP BY cc.SK_ID_CURR ) SELECT pa.NAME_CONTRACT_TYPE AS group_key, AVG(utilization) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте средний размер кредита по статусам решения для оценки аппетита к риску.",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(AMT_CREDIT) AS avg_credit_amount FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт, по которым были выборки в текущем периоде (AMT_DRAWINGS_CURRENT > 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-записей от 6 до 12 месяцев назад и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Предоставьте список клиентов с активными просроченными кредитными обязательствами, согласно данным БКИ.",
    "sql": "SELECT at.SK_ID_CURR, at.AMT_CREDIT, at.AMT_INCOME_TOTAL, b.CREDIT_ACTIVE, b.CREDIT_DAY_OVERDUE FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков средний временной лаг между подачей и утверждением предыдущих кредитных запросов?",
    "sql": "SELECT AVG(ABS(DAYS_DECISION)) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните разницу между фактическим и плановым платежом для платежей по рассрочкам примерно за последний год между сегментами по признаку «канал оформления кредита» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте столбчатую диаграмму, показывающую средний размер текущего кредита для клиентов с активными и закрытыми прошлыми займами в БКИ.",
    "sql": "SELECT b.CREDIT_ACTIVE, AVG(at.AMT_CREDIT) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY b.CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднее значение задержки платежа в днях (delay_days) по рассрочкам для первых 12 платежей в графике в разрезе по сегментам номера платежа (early/middle/late).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для первых трёх платежей в графике (NUM_INSTALMENT_NUMBER <= 3), покажите среднее количество дней до фактической даты платежа (DAYS_ENTRY_PAYMENT) по каждому значению поля CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитных карт с лимитом (AMT_CREDIT_SUM_LIMIT > 0) в разрезе по валюте кредита (CREDIT_CURRENCY).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажи, сколько клиентов в каждой из групп по социальному кругу.",
    "sql": "SELECT OBS_30_CNT_SOCIAL_CIRCLE, COUNT(SK_ID_CURR) FROM application_train GROUP BY OBS_30_CNT_SOCIAL_CIRCLE ORDER BY OBS_30_CNT_SOCIAL_CIRCLE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для отказанных предыдущих кредитов между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для клиентов, обращающихся впервые для разных категорий по признаку «канал продаж» в прошлых заявках клиентов.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY CHANNEL_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Вычислите среднее значение возраста для клиентов, имеющих метку дефолта.",
    "sql": "SELECT AVG(-DAYS_BIRTH / 365.25) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько денег мы всего выдали по кредитам?",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте таблицу, отображающую SK_ID_CURR, CNT_CHILDREN и TARGET для клиентов, где CNT_CHILDREN > 2, ограничившись 50 записями.",
    "sql": "SELECT SK_ID_CURR, CNT_CHILDREN, TARGET FROM application_train WHERE CNT_CHILDREN > 2 LIMIT 50;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля HOUR_APPR_PROCESS_START показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Хочу сравнить, сколько в среднем зарабатывают клиенты с просрочками в кредитной истории и те, у кого их не было.",
    "sql": "SELECT CASE WHEN b.SK_ID_CURR IS NOT NULL THEN 'Had Overdue in Bureau' ELSE 'No Overdue in Bureau' END AS overdue_status, AVG(app.AMT_INCOME_TOTAL) FROM application_train app LEFT JOIN (SELECT DISTINCT SK_ID_CURR FROM bureau WHERE CREDIT_DAY_OVERDUE > 0) b ON app.SK_ID_CURR = b.SK_ID_CURR GROUP BY overdue_status;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя загрузку кредитных карт (utilization) для карт с тяжёлыми просрочками для разных сегментов между разными месяцами наблюдения по картам с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD_DEF > 0 ) SELECT MONTHS_BALANCE AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитов в условной валюте 'currency 2' в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 2' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0), покажите средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Оцените средние лимиты кредитования по данным БКИ для сегментов клиентов \"Вдова\" и \"Женат/Замужем\", чтобы выявить возможные различия в кредитном поведении.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(b.AMT_CREDIT_SUM_LIMIT) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE at.NAME_FAMILY_STATUS IN ('Widow', 'Married') GROUP BY at.NAME_FAMILY_STATUS ORDER BY AVG(b.AMT_CREDIT_SUM_LIMIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каково среднее значение аннуитетного платежа для каждого типа дохода клиентов?",
    "sql": "SELECT NAME_INCOME_TYPE, AVG(AMT_ANNUITY) FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY AVG(AMT_ANNUITY) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по каналу продаж (CHANNEL_TYPE).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для кредитов с недавно обновлёнными данными для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE > -30 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для более старых POS-записей (MONTHS_BALANCE < -12) в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля NAME_YIELD_GROUP показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для решений, принятых за последний год (DAYS_DECISION > -365) в разрезе по дню недели принятия решения (WEEKDAY_APPR_PROCESS_START).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте матрицу дефолтности по комбинациям пола и владения автомобилем для выявления высокорисковых сегментов.",
    "sql": "SELECT CODE_GENDER, FLAG_OWN_CAR, AVG(TARGET) * 100 AS Default_Rate FROM application_train WHERE CODE_GENDER != 'XNA' GROUP BY CODE_GENDER, FLAG_OWN_CAR ORDER BY CODE_GENDER, FLAG_OWN_CAR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выявите среднее число активных кредитных обязательств в БКИ для каждой категории семейного положения клиентов.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, COUNT(b.SK_BUREAU_ID) AS num_bureau_loans FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY num_bureau_loans DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какой уровень одобрения мы наблюдаем по ранее поданным заявкам?",
    "sql": "SELECT CAST(COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN SK_ID_PREV END) AS REAL) * 100 / COUNT(SK_ID_PREV) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как менялся общий кредитный лимит по картам от месяца к месяцу?",
    "sql": "SELECT MONTHS_BALANCE, SUM(AMT_CREDIT_LIMIT_ACTUAL) AS TotalCreditLimit FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с лимитом до 50 000, покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для второй условной половины клиентов (по нечётности ID) между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните значение DAYS_ENTRY_PAYMENT для платежей, которые были действительно внесены для разных значений признака «предыдущий кредит» в платёжной истории клиентов.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY SK_ID_PREV ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя долю просроченных платежей для тех платежей, которые действительно были внесены для разных групп клиентов между каналами оформления (отделения, партнёры, онлайн), если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю разницу между фактическим и плановым платежом (payment_diff) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) по по факту просрочки платежа (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') и по каждому значению поля NAME_PRODUCT_TYPE показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для старой активности по картам для разных групп между картами с высоким лимитом и остальными?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Проанализируйте корреляцию между семейным положением заемщика и показателем дефолта.",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для предыдущих заявок с суммой кредита более 50 000 в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя долю месяцев с просрочкой по картам для карточной истории за последний год для разных сегментов между картами с высоким и более низким лимитом с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE > -12 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(CASE WHEN SK_DPD > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков уровень дефолтности среди заемщиков, указавших тип дохода 'Unemployed'?",
    "sql": "SELECT CAST(SUM(CASE WHEN TARGET = 1 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train WHERE NAME_INCOME_TYPE = 'Unemployed';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите среднюю сумму кредита для всех активных заявок.",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова корреляция между числом запросов в БКИ (AMT_REQ_CREDIT_BUREAU_YEAR) и целевым статусом заемщика (TARGET)?",
    "sql": "SELECT TARGET, AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля CHANNEL_TYPE показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY CHANNEL_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Построить график среднего фактического кредитного лимита кредитных карт за каждый месяц.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Мне нужна средняя сумма выданного кредита для заемщиков, допустивших дефолт.",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train_test WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните показатель DPD_DEF по POS-кредитам для POS-кредитов с просрочкой для разных значений признака «активность POS-кредита» по POS-кредитам.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для POS-кредитов с коротким графиком между разными категориями между клиентами по их POS-истории?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните накопленный остаток по карте для карт, по которым клиент сейчас вносит платежи по признаку «статус договора по карте», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте столбчатую диаграмму, показывающую, сколько клиентов начали процесс заявки в каждый час.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Рассчитать совокупный объем кредитного портфеля.",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как изменялось количество отклоненных заявок в зависимости от типа кредитного договора?",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CONTRACT_TYPE ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей от года до двух лет назад, покажите долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро по каждому значению поля группировки SK_BUREAU_ID.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -24 AND -13 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Кто эти 20 клиентов, у которых самый высокий общий долг по всем их активным кредитам, зарегистрированным в БКИ?",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_CREDIT_SUM_DEBT) AS TotalDebt FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR ORDER BY TotalDebt DESC LIMIT 20;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Хочу посмотреть, сколько людей дефолтнуло, в зависимости от статуса их кредита в БКИ.",
    "sql": "SELECT b.CREDIT_ACTIVE, COUNT(DISTINCT a.SK_ID_CURR) AS Defaulter_Count FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE a.TARGET = 1 GROUP BY b.CREDIT_ACTIVE ORDER BY Defaulter_Count DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для истории кредитов от полугода до года назад между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов в условной валюте 'currency 2' в разрезе по статусу кредита (CREDIT_ACTIVE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 2' GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для небольших кредитов (до 100 000) для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "А если посмотреть, сколько в среднем висят открытые кредиты и сколько уже закрытые, в чем разница?",
    "sql": "SELECT CREDIT_ACTIVE, AVG(ABS(DAYS_CREDIT)) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Визуализируйте количество отказов по предыдущим заявкам, сгруппированное по дням недели, когда они были поданы.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется накопленный объём платежей по клиенту для условной половины клиентов по чётности ID между различными сегментами между клиентами с низким, средним и высоким совокупным объёмом платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько заявок мы зарубили в прошлом, если выражать это в процентах?",
    "sql": "SELECT (COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 END) * 100.0) / COUNT(*) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните стоимость товара по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков процентный расклад клиентской базы по признаку владения движимым или недвижимым имуществом?",
    "sql": "SELECT CASE WHEN FLAG_OWN_CAR = 'Y' OR FLAG_OWN_REALTY = 'Y' THEN 'Has Property' ELSE 'No Property' END AS PropertyStatus, COUNT(SK_ID_CURR) FROM application_train GROUP BY PropertyStatus;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита более 50 000 и по каждому значению поля NAME_CLIENT_TYPE показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Общее количество поданных кредитных заявок.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для действующих кредитов клиента для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите среднюю сумму текущих кредитов, выданных клиентам, которым ранее было отказано в займах.",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train WHERE SK_ID_CURR IN (SELECT SK_ID_CURR FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте показатель дефолтности для сегмента клиентов с типом занятости 'Laborers'.",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train WHERE OCCUPATION_TYPE = 'Laborers';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для уже погашенных POS-кредитов между разными категориями между клиентами по их POS-истории?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE = 0 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Анализ среднего размера кредитных обязательств в зависимости от категории дохода заемщика.",
    "sql": "SELECT NAME_INCOME_TYPE, AVG(AMT_CREDIT) FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY AVG(AMT_CREDIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита от 10 000 до 50 000 и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте динамику средней суммы задолженности по кредитным картам за последние двенадцать месяцев.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) FROM credit_card_balance WHERE MONTHS_BALANCE >= -12 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какова временная динамика среднего баланса по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Рассчитайте риск дефолта (PD) для группы клиентов, имеющих собственный автомобиль.",
    "sql": "SELECT AVG(TARGET) FROM application_train WHERE FLAG_OWN_CAR = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какой средний TARGET (вероятность дефолта) у заемщиков с историей просрочек 60-90 дней по данным БКИ?",
    "sql": "SELECT AVG(t1.TARGET) FROM application_train t1 JOIN bureau t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR JOIN bureau_balance t3 ON t2.SK_BUREAU_ID = t3.SK_BUREAU_ID WHERE t3.STATUS = '3';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля NAME_PORTFOLIO показывается среднюю стоимость товара по предыдущим кредитам.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какой процент дефолтов мы видим для разных видов занятости? Покажи это.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) AS default_rate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для POS-кредитов с DPD > 0 в разрезе по статусу договора POS-кредита (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой процент дефолтных клиентов имеет критическую просрочку (более 60 дней) по своим обязательствам, зафиксированным в БКИ?",
    "sql": "SELECT CAST(COUNT(DISTINCT app.SK_ID_CURR) AS REAL) * 100 / (SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train WHERE TARGET = 1) FROM application_train app JOIN bureau b ON app.SK_ID_CURR = b.SK_ID_CURR WHERE app.TARGET = 1 AND b.CREDIT_DAY_OVERDUE > 60;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для клиентов, которые уже брали кредит ранее для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY CHANNEL_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте распределение клиентов по группам рабочего стажа в годах.",
    "sql": "SELECT CASE WHEN DAYS_EMPLOYED >= 0 THEN 'Не трудоустроен/Неизвестно' WHEN ABS(DAYS_EMPLOYED)/365.25 < 1 THEN '< 1 года' WHEN ABS(DAYS_EMPLOYED)/365.25 >= 1 AND ABS(DAYS_EMPLOYED)/365.25 < 5 THEN '1-5 лет' WHEN ABS(DAYS_EMPLOYED)/365.25 >= 5 AND ABS(DAYS_EMPLOYED)/365.25 < 10 THEN '5-10 лет' WHEN ABS(DAYS_EMPLOYED)/365.25 >= 10 THEN '> 10 лет' END AS employment_years, COUNT(SK_ID_CURR) FROM application_train GROUP BY employment_years ORDER BY employment_years;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Можешь показать, какой процент заявок одобряется для разных видов кредитов?",
    "sql": "SELECT NAME_CONTRACT_TYPE, CAST(SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_PREV) AS ApprovalRate FROM previous_application GROUP BY NAME_CONTRACT_TYPE ORDER BY ApprovalRate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю долю просроченных платежей (delay_days > 0) для отсутствующих платежей (ip.AMT_PAYMENT = 0) в разрезе по доходности продукта (pa.NAME_YIELD_GROUP) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT = 0 ) SELECT NAME_YIELD_GROUP AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карточных записей за последние 6 месяцев (MONTHS_BALANCE > -6) в разрезе по месяцу отчётности по карте (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяются клиенты по количеству месяцев, прошедших с момента последнего изменения статуса их кредитов в БКИ?",
    "sql": "SELECT MONTHS_BALANCE, COUNT(SK_BUREAU_ID) FROM bureau_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для закрытых кредитов (CREDIT_ACTIVE = 'Closed') и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите долю заемщиков, находящихся в дефолте, среди возрастной группы до 25 лет.",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train_test WHERE -DAYS_BIRTH / 365 < 25",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оцените средний уровень дохода заемщиков в разрезе типов занятости.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_INCOME_TOTAL) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY AVG(AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с платежами в текущем периоде (AMT_PAYMENT_CURRENT > 0), покажите средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Можете ли вы отобразить средний совокупный доход по каждому типу занятости?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_INCOME_TOTAL) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY AVG(AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и агрегированных данных credit_card_balance по клиенту рассчитайте среднее отношение платежей к выборкам по картам (AMT_PAYMENT_CURRENT / NULLIF(AMT_DRAWINGS_CURRENT, 0)) для карт с установленным кредитным лимитом (cc.AMT_CREDIT_LIMIT_ACTUAL > 0) в разрезе по типу предыдущего кредитного продукта (pa.NAME_CONTRACT_TYPE).",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.AMT_CREDIT_LIMIT_ACTUAL > 0 GROUP BY cc.SK_ID_CURR ) SELECT pa.NAME_CONTRACT_TYPE AS group_key, AVG(pay_vs_spend_ratio) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажите доли различных типов кредитных продуктов среди обработанных ранее заявок.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(*) FROM previous_application GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Определить количество активных кредитных обязательств в БКИ для клиента с идентификатором SK_ID_CURR = 100002.",
    "sql": "SELECT COUNT(SK_BUREAU_ID) FROM bureau WHERE SK_ID_CURR = 100002 AND CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков усредненный показатель возраста клиентов, классифицированных как дефолтные?",
    "sql": "SELECT AVG(CAST(DAYS_BIRTH AS REAL) / -365) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, открытых за последний год (DAYS_CREDIT > -365) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проанализируйте и выявите 5 ключевых сегментов занятости среди наших аппликантов для оценки профиля риска.",
    "sql": "SELECT OCCUPATION_TYPE, COUNT(SK_ID_CURR) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков общий объем выданных кредитных средств по каждой из заявленных целей из предыдущих одобренных заявок?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, SUM(AMT_CREDIT) AS total_credit_amount FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY total_credit_amount DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам в бюро для истории кредитов от года до двух лет назад в разрезе признака «давность записи» по истории кредитов из бюро.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -24 AND -13 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднее значение накопленного остатка по карте (cum_balance) для карт с ненулевым остатком (AMT_BALANCE > 0) по по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_BALANCE > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитов с заполненным аннуитетом (AMT_ANNUITY IS NOT NULL) в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Что насчет среднего платежа по кредитке, он меняется с изменением остатка на ней?",
    "sql": "SELECT CASE WHEN AMT_BALANCE <= 0 THEN '0' WHEN AMT_BALANCE > 0 AND AMT_BALANCE <= 10000 THEN '0-10k' WHEN AMT_BALANCE > 10000 AND AMT_BALANCE <= 50000 THEN '10k-50k' WHEN AMT_BALANCE > 50000 THEN '>50k' ELSE 'Unknown' END AS balance_range, AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance GROUP BY balance_range ORDER BY balance_range;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как сильно влияет образование на вероятность дефолта? Давайте посмотрим по категориям.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(TARGET) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей старше трёх лет (MONTHS_BALANCE <= -36), покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки SK_BUREAU_ID.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE <= -36 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт с лимитом до 50 000 в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какие валюты самые популярные для кредитов, которые наши клиенты брали в других банках?",
    "sql": "SELECT CREDIT_CURRENCY, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_CURRENCY ORDER BY COUNT(SK_BUREAU_ID) DESC",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково число клиентов, у которых фиксируется просроченная задолженность в БКИ?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю долю просроченных платежей по рассрочкам для записей с ненулевым плановым платежом по по версии графика платежей (NUM_INSTALMENT_VERSION).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой процент заявок, имеющих высокий первоначальный взнос (более половины стоимости), наблюдается в каждой возрастной группе?",
    "sql": "SELECT AgeGroup, CAST(SUM(CASE WHEN pa.RATE_DOWN_PAYMENT > 0.5 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(pa.SK_ID_PREV) AS PercentageHighDownPayment FROM (SELECT at.SK_ID_CURR, CASE WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 25 THEN 'До 25' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 35 THEN '26-35' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 45 THEN '36-45' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 55 THEN '46-55' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 65 THEN '56-65' ELSE 'Старше 65' END AS AgeGroup FROM application_train at) AS AgeGroupedClients JOIN previous_application pa ON AgeGroupedClients.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.RATE_DOWN_PAYMENT IS NOT NULL GROUP BY AgeGroup ORDER BY AgeGroup;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите среднюю динамику погашения задолженности по кредитным картам.",
    "sql": "SELECT AVG(AMT_PAYMENT_TOTAL_CURRENT / AMT_BALANCE) FROM credit_card_balance WHERE AMT_BALANCE > 0 AND AMT_PAYMENT_TOTAL_CURRENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Расскажите, какие пять профессий чаще всего встречаются у наших клиентов по кредитам?",
    "sql": "SELECT OCCUPATION_TYPE, COUNT(SK_ID_CURR) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какие пять комбинаций типа дохода и образования наиболее часто ассоциируются с дефолтом клиента?",
    "sql": "SELECT NAME_INCOME_TYPE, NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS client_count FROM application_train WHERE TARGET = 1 GROUP BY NAME_INCOME_TYPE, NAME_EDUCATION_TYPE ORDER BY client_count DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте медиану по суммам кредитов для дефолтных заемщиков.",
    "sql": "SELECT PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY AMT_CREDIT) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с CTE, где сначала по каждому SK_BUREAU_ID считается bad_month_share, а затем в разрезе по размеру кредита (крупный/остальные) на основе AMT_CREDIT_SUM агрегируется среднее значение максимального месяца наблюдения (max_month) для месяцев с любым уровнем просрочки (bb.STATUS в ['1'..'5']).",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1','2','3','4','5') GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_YIELD_GROUP ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для POS-кредитов с серьёзной просрочкой между разными категориями между активными и погашенными POS-кредитами?",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажи, сколько в среднем берут в кредит люди с разным образованием.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(AMT_CREDIT) FROM application_train GROUP BY NAME_EDUCATION_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Рассчитайте средний трудовой стаж (в днях) для дефолтных заемщиков.",
    "sql": "SELECT AVG(DAYS_EMPLOYED) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля NAME_PORTFOLIO показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PORTFOLIO ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова численность держателей кредитных карт (SK_ID_CURR) в нашей клиентской базе?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля NAME_YIELD_GROUP показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_YIELD_GROUP ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Интересно, как меняется средний платеж по кредиту, если смотреть по разным возрастам?",
    "sql": "SELECT FLOOR(ABS(DAYS_BIRTH) / 365) AS Age, AVG(AMT_ANNUITY) AS AverageAnnuity FROM application_train GROUP BY Age ORDER BY Age;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Проанализируйте тренд объемов ранее выданных кредитов, агрегированных по году активации кредитного продукта.",
    "sql": "SELECT CAST(2023 + DAYS_CREDIT / 365 AS INT) AS credit_year, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY credit_year ORDER BY credit_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Рассчитайте число уникальных идентификаторов клиентов (SK_ID_CURR), имевших статусы просрочки от '1' до '5' в реестре бюро кредитных историй.",
    "sql": "SELECT COUNT(DISTINCT b.SK_ID_CURR) FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1', '2', '3', '4', '5');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитов с суммой более 100 000 (AMT_CREDIT_SUM > 100000) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте коэффициент отклонения к одобрению по ранее обработанным кредитным заявкам.",
    "sql": "SELECT CAST(SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS REAL) * 100 / SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите численность заемщиков, обладающих одновременно автомобилем и объектом недвижимости.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE FLAG_OWN_CAR = 'Y' AND FLAG_OWN_REALTY = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте средний объем текущих платежей по кредитным картам за самый последний отчетный период.",
    "sql": "SELECT AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE = (SELECT MAX(MONTHS_BALANCE) FROM credit_card_balance);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какая в среднем сумма кредита была запрошена по прошлым заявкам для каждого типа контракта?",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_APPLICATION) FROM previous_application GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «тип кредитного продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каковы показатели неисполнения обязательств для каждого пола внутри каждой группы семейного положения?",
    "sql": "SELECT NAME_FAMILY_STATUS, CODE_GENDER, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_FAMILY_STATUS, CODE_GENDER ORDER BY NAME_FAMILY_STATUS, default_rate DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для кредитов в основной валюте 'currency 1' в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните величина DAYS_DECISION по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 для разных категорий по признаку «статус прошлой заявки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните показатель DPD по POS-кредитам для POS-кредитов с длительным графиком платежей для разных значений признака «наличие просрочки по POS» по POS-кредитам.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client) для фактических оплат по рассрочке (ip.AMT_PAYMENT > 0) в разрезе по каналу продаж (pa.CHANNEL_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для POS-операций, которые были от полугода до года назад для разных значений признака «статус POS-договора» по POS-кредитам.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «группа доходности продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для более старых кредитов (DAYS_CREDIT <= -365) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте график изменения среднего количества ATM-транзакций по кредитным картам за каждый месяц.",
    "sql": "SELECT MONTHS_BALANCE, AVG(CNT_DRAWINGS_ATM_CURRENT) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по статусу договора (NAME_CONTRACT_STATUS) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита более 50 000 и по каждому значению поля NAME_SELLER_INDUSTRY показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется накопленный объём платежей по клиенту для рассрочек с реальным графиком платежей между различными сегментами между разными версиями графиков платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите средний размер кредита, выданного по всем заявкам.",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Среднее арифметическое запрашиваемых сумм кредитов, сегментированное по типу договора в прошлых заявках.",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_APPLICATION) FROM previous_application GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Можете вывести список клиентов, которые, скорее всего, дефолтнут, и их важные данные?",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT, NAME_EDUCATION_TYPE, DAYS_BIRTH FROM application_train WHERE TARGET = 1 LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля NAME_PORTFOLIO показывается среднюю стоимость товара по предыдущим кредитам.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте ежемесячную динамику притока уникальных клиентских заявок, основываясь на дате принятия решения.",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(JULIANDAY('now') + DAYS_DECISION)) AS decision_month, COUNT(DISTINCT SK_ID_CURR) FROM previous_application GROUP BY decision_month ORDER BY decision_month;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих платежей по картам для карт с серьёзными просрочками для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD_DEF > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по статусу договора (NAME_CONTRACT_STATUS) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для клиентов, которые уже брали кредит ранее для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте запрос с CTE, где сначала по каждому SK_BUREAU_ID считается bad_month_share, а затем в разрезе по размеру кредита (крупный/остальные) на основе AMT_CREDIT_SUM агрегируется среднее значение максимального месяца наблюдения (max_month) для активных кредитов из бюро (b.CREDIT_ACTIVE = 'Active').",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подсчитайте количество заемщиков с активной кредитной нагрузкой, отраженной в БКИ.",
    "sql": "SELECT COUNT(DISTINCT T1.SK_ID_CURR) FROM application_train AS T1 JOIN bureau AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T2.CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие типы дохода и образования чаще всего встречаются у клиентов, которые в итоге не возвращают долги? Покажи топ-5.",
    "sql": "SELECT NAME_INCOME_TYPE, NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS client_count FROM application_train WHERE TARGET = 1 GROUP BY NAME_INCOME_TYPE, NAME_EDUCATION_TYPE ORDER BY client_count DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется накопленный объём платежей по клиенту для пропущенных платежей между различными сегментами между клиентами с низким, средним и высоким совокупным объёмом платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT = 0 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните задержка платежа в днях для клиентов, которые впервые обращаются за кредитом между сегментами по признаку «доходность продукта» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT NAME_YIELD_GROUP AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просрочку платежа по POS-кредитам в днях для недавней POS-активности между различными сегментами между активными и полностью погашенными POS-кредитами по POS-кредитам клиентов?",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE pos.MONTHS_BALANCE > -12 ) SELECT CASE WHEN pos.CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(days_late) AS metric_value FROM pos_inst GROUP BY CASE WHEN pos.CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитов, открытых за последний год (DAYS_CREDIT > -365) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажи, как сейчас выглядят кредиты по статусам: сколько активных, закрытых и плохих долгов в бюро?",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(*) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для POS-кредитов с DPD > 0 в разрезе по месяцу отчётности (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для кредитов с формально истёкшим сроком погашения для разных групп клиентов между типами кредитов, отражённых в бюро?",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE <= 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для уже погашенных POS-кредитов между разными категориями по разным месяцам наблюдения POS-кредитов?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний фактический платёж по рассрочке (AMT_PAYMENT) для записей с ненулевым плановым платежом (AMT_INSTALMENT > 0) в разрезе по факту платёжной дисциплины (переплата/недоплата).",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для POS-кредитов без серьёзной просрочки (SK_DPD_DEF = 0) в разрезе по признаку активный/закрытый POS-кредит (по CNT_INSTALMENT_FUTURE).",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Предоставьте перечень причин отказа по прошлым кредитным заявкам с указанием частоты каждой.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) AS refusal_count FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY refusal_count DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднее значение задержки платежа в днях (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) для первых шести платежей по рассрочке (NUM_INSTALMENT_NUMBER <= 6) в разрезе по признаку просрочки платежа (delay_days > 0) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте диаграмму распределения количества клиентов по заданным возрастным группам.",
    "sql": "SELECT CASE WHEN ABS(DAYS_BIRTH)/365 < 25 THEN '18-24' WHEN ABS(DAYS_BIRTH)/365 < 35 THEN '25-34' WHEN ABS(DAYS_BIRTH)/365 < 45 THEN '35-44' WHEN ABS(DAYS_BIRTH)/365 < 55 THEN '45-54' WHEN ABS(DAYS_BIRTH)/365 < 65 THEN '55-64' ELSE '65+' END AS age_group, COUNT(SK_ID_CURR) FROM application_train GROUP BY age_group ORDER BY age_group;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите интегральный риск дефолта по всему кредитному портфелю.",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для условной половины клиентов по чётности ID для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните кредитный лимит по картам для карт с нулевым остатком задолженности в разрезе признака «статус договора по карте» по кредитным картам клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните задержку платежа по рассрочкам для первого года рассрочки при ежемесячных платежах по признаку «факт просрочки», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова динамика среднего кредитного лимита по кредитным картам за отчетные периоды?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_credit_limit FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для уже погашенных кредитов для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково процентное соотношение клиентов по типам их пакетов услуг?",
    "sql": "SELECT NAME_TYPE_SUITE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_TYPE_SUITE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Определить агрегированный объем одобренных кредитных заявок из предыдущих операций по дням недели.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, SUM(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY CASE WHEN WEEKDAY_APPR_PROCESS_START = 'MONDAY' THEN 1 WHEN WEEKDAY_APPR_PROCESS_START = 'TUESDAY' THEN 2 WHEN WEEKDAY_APPR_PROCESS_START = 'WEDNESDAY' THEN 3 WHEN WEEKDAY_APPR_PROCESS_START = 'THURSDAY' THEN 4 WHEN WEEKDAY_APPR_PROCESS_START = 'FRIDAY' THEN 5 WHEN WEEKDAY_APPR_PROCESS_START = 'SATURDAY' THEN 6 ELSE 7 END;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Из-за чего чаще всего отказывают в кредитах? Покажи это.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(*) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(*) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте метрику \"количество повторных аппликантов после отказа\" для оценки лояльности или настойчивости клиентской базы.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM previous_application WHERE SK_ID_CURR IN (SELECT SK_ID_CURR FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY SK_ID_CURR HAVING COUNT(*) > 1);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для платежей без просрочки (DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT), покажите средний плановый платёж по рассрочке (AMT_INSTALMENT) по каждому значению поля SK_ID_PREV.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY SK_ID_PREV ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Мне нужен список тех, кто сейчас дефолтит и у кого при этом висят активные просроченные кредиты в БКИ.",
    "sql": "SELECT DISTINCT a.SK_ID_CURR, a.AMT_CREDIT, a.AMT_INCOME_TOTAL FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE a.TARGET = 1 AND b.CREDIT_ACTIVE = 'Active' AND b.CREDIT_DAY_OVERDUE > 0 LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для карт без тяжёлых просрочек для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите ключевой показатель доли клиентов с историей просрочек по их кредитам в БКИ.",
    "sql": "SELECT (SUM(CASE WHEN T2.CREDIT_DAY_OVERDUE > 0 THEN 1 ELSE 0 END) * 100.0) / COUNT(DISTINCT T1.SK_ID_CURR) FROM application_train AS T1 JOIN bureau AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для клиентов, обращающихся впервые между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков суммарный кредитный портфель в зависимости от типа владения жильем заемщиков?",
    "sql": "SELECT NAME_HOUSING_TYPE, SUM(AMT_CREDIT) FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY SUM(AMT_CREDIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков усредненный возраст аппликантов по категориям семейного положения?",
    "sql": "SELECT NAME_FAMILY_STATUS, ABS(AVG(DAYS_BIRTH) / 365.25) AS avg_age FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY avg_age DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей без фактического платежа (AMT_PAYMENT = 0), покажите средний плановый платёж по рассрочке (AMT_INSTALMENT) по каждому значению поля CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT = 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите топ-10 клиентов, которые находятся в дефолте, несмотря на высокий уровень дохода.",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT FROM application_train WHERE TARGET = 1 AND AMT_INCOME_TOTAL > (SELECT AVG(AMT_INCOME_TOTAL) FROM application_train) ORDER BY AMT_INCOME_TOTAL DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите общее число уникальных клиентов, имеющих активную просроченную задолженность в кредитной истории.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите коэффициент просрочки (дефолта) для портфеля клиентов, имеющих положительный баланс по своим кредитным картам.",
    "sql": "SELECT AVG(at.TARGET) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE ccb.AMT_BALANCE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажи, как отличается процент невозврата у тех, кто косячил в БКИ, и тех, у кого всё чисто.",
    "sql": "SELECT CASE WHEN EXISTS (SELECT 1 FROM bureau AS b JOIN bureau_balance AS bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.SK_ID_CURR = a.SK_ID_CURR AND bb.STATUS IN ('1', '2', '3', '4', '5')) THEN 'With Overdue' ELSE 'Without Overdue' END AS OverdueStatus, AVG(a.TARGET) FROM application_train AS a GROUP BY OverdueStatus;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "В какой день недели мы в среднем выдавали больше всего денег по старым кредитам?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, AVG(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY CASE WHEN WEEKDAY_APPR_PROCESS_START = 'MONDAY' THEN 1 WHEN WEEKDAY_APPR_PROCESS_START = 'TUESDAY' THEN 2 WHEN WEEKDAY_APPR_PROCESS_START = 'WEDNESDAY' THEN 3 WHEN WEEKDAY_APPR_PROCESS_START = 'THURSDAY' THEN 4 WHEN WEEKDAY_APPR_PROCESS_START = 'FRIDAY' THEN 5 WHEN WEEKDAY_APPR_PROCESS_START = 'SATURDAY' THEN 6 WHEN WEEKDAY_APPR_PROCESS_START = 'SUNDAY' THEN 7 END;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова вероятность дефолта для заемщиц, выраженная в процентах?",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train WHERE CODE_GENDER = 'F';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя разницу между фактическим и плановым платежом для клиентов, которые впервые обращаются за кредитом для разных групп клиентов между новыми, повторными и лояльными клиентами, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково общее количество клиентов, демонстрирующих более пяти наблюдений в своем социальном окружении?",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE > 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните кредитный лимит по картам для карт с нулевым остатком задолженности в разрезе признака «клиент» по кредитным картам клиентов.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Выполните сравнительный анализ средней суммы выданного кредита для двух групп клиентов: имевших и не имевших задолженность в БКИ.",
    "sql": "SELECT CASE WHEN EXISTS (SELECT 1 FROM bureau b WHERE b.SK_ID_CURR = at.SK_ID_CURR AND b.AMT_CREDIT_SUM_DEBT > 0) THEN 'Has Bureau Debt' ELSE 'No Bureau Debt' END AS bureau_debt_status, AVG(at.AMT_CREDIT) FROM application_train at GROUP BY bureau_debt_status;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Есть ли разница в проценте невозврата кредитов между теми, у кого есть машина, и у кого её нет?",
    "sql": "SELECT FLAG_OWN_CAR, AVG(TARGET) * 100 FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько наших клиентов уже косячили с кредитами в БКИ больше месяца?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_DAY_OVERDUE > 30",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для второй половины клиентов по нечётности ID в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднее годовое число запросов в бюро кредитных историй для сегмента клиентов, демонстрирующих дефолтный профиль.",
    "sql": "SELECT AVG(app.AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train_test app WHERE app.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Можешь сказать, сколько наших клиентов сейчас имеют активные кредиты где-то еще, по данным БКИ?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для месяцев с серьёзными просрочками в разрезе признака «давность записи» по истории кредитов из бюро.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS IN ('2','3','4','5') GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажи, сколько у наших клиентов обычно членов семьи.",
    "sql": "SELECT CNT_FAM_MEMBERS, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Оцените частотность статуса 'Active' по кредитам в БКИ для клиентов с различными семейными статусами.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, COUNT(CASE WHEN b.CREDIT_ACTIVE = 'Active' THEN 1 END) AS active_credits_count FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY active_credits_count DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для записей с серьёзной просрочкой (STATUS в ['2'..'5']) в разрезе по статусу STATUS в bureau_balance.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS IN ('2','3','4','5') GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для кредитов, которые пролонгировались в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Можешь показать, почему мы чаще всего отказывали в кредитах раньше? Распредели по причинам.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля CHANNEL_TYPE показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей с серьёзной просрочкой (STATUS в ['2'..'5']), покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки STATUS.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS IN ('2','3','4','5') GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите среднее количество иждивенцев у потенциальных заемщиков.",
    "sql": "SELECT AVG(CNT_CHILDREN) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько всего денег выдано по текущим кредитам?",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько всего стоили товары, которые мы одобрили в предыдущих заявках?",
    "sql": "SELECT SUM(AMT_GOODS_PRICE) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов в условной валюте 'currency 1' и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните запрошенный размер кредита по заявке для отказанных предыдущих кредитов для разных категорий по признаку «группа доходности продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте диаграмму распределения числа заемщиков по количеству иждивенцев.",
    "sql": "SELECT CNT_FAM_MEMBERS, COUNT(*) FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для прошлых заявок, принятых более года назад между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю разницу между фактическим и плановым платежом (payment_diff) для случаев отсутствия фактического платежа (AMT_PAYMENT = 0) по по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT = 0 ) SELECT SK_ID_CURR AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как менялось число отказов по кредитам по годам, покажите мне.",
    "sql": "SELECT CAST(ABS(DAYS_DECISION)/365.25 AS INTEGER) AS years_ago, COUNT(SK_ID_PREV) AS refused_count FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY years_ago ORDER BY years_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Проследите ежемесячную динамику объемов операций по снятию наличных с кредитных карт.",
    "sql": "SELECT MONTHS_BALANCE, SUM(CNT_DRAWINGS_CURRENT) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какова корреляция между числом иждивенцев (детей) и средним доходом заемщиков?",
    "sql": "SELECT CNT_CHILDREN, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для карт без тяжёлых просрочек для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Анализ объема одобренных кредитов в разрезе целей предыдущих заявок.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, SUM(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY SUM(AMT_APPLICATION) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова средняя величина аннуитета для кредитов, получивших одобрение, с учетом дня недели их инициации?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, AVG(AMT_ANNUITY) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY CASE WHEN WEEKDAY_APPR_PROCESS_START = 'MONDAY' THEN 1 WHEN WEEKDAY_APPR_PROCESS_START = 'TUESDAY' THEN 2 WHEN WEEKDAY_APPR_PROCESS_START = 'WEDNESDAY' THEN 3 WHEN WEEKDAY_APPR_PROCESS_START = 'THURSDAY' THEN 4 WHEN WEEKDAY_APPR_PROCESS_START = 'FRIDAY' THEN 5 WHEN WEEKDAY_APPR_PROCESS_START = 'SATURDAY' THEN 6 WHEN WEEKDAY_APPR_PROCESS_START = 'SUNDAY' THEN 7 END;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте график зависимости среднего коэффициента долговой нагрузки (DTI) от длительности трудоустройства.",
    "sql": "SELECT CASE WHEN DAYS_EMPLOYED < -3650 THEN '10+ years' WHEN DAYS_EMPLOYED < -1825 THEN '5-10 years' WHEN DAYS_EMPLOYED < -365 THEN '1-5 years' ELSE '<1 year' END AS employment_years, AVG(AMT_CREDIT * 1.0 / AMT_INCOME_TOTAL) AS avg_debt_to_income FROM application WHERE AMT_INCOME_TOTAL > 0 GROUP BY employment_years ORDER BY employment_years DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов, открытых более года назад в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните кредитный лимит по картам для карт без просрочек в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте таблицу с данными по одобренным и отклоненным заявкам, сгруппированным по целям кредитования.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused') GROUP BY NAME_CASH_LOAN_PURPOSE, NAME_CONTRACT_STATUS ORDER BY NAME_CASH_LOAN_PURPOSE, NAME_CONTRACT_STATUS;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя разницу между фактическим и плановым платежом для платежей по рассрочкам примерно за последний год для разных групп клиентов между сегментами доходности кредитных продуктов, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT NAME_YIELD_GROUP AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт с платежами в текущем периоде (AMT_PAYMENT_CURRENT > 0) в разрезе по типу поведения клиента: платёж превышает выборки или нет.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите круговую диаграмму, показывающую долю клиентов по каждой валюте кредита в БКИ.",
    "sql": "SELECT CREDIT_CURRENCY, COUNT(DISTINCT SK_ID_CURR) FROM bureau GROUP BY CREDIT_CURRENCY;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для POS-кредитов с длительным графиком платежей между разными категориями по разным месяцам наблюдения POS-кредитов?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Можем ли мы определить средний уровень задолженности клиентов, чья кредитная история в БКИ отмечена как проблемная (статусы '2', '3', '4', '5')?",
    "sql": "SELECT AVG(b.AMT_CREDIT_SUM_DEBT) FROM bureau AS b JOIN bureau_balance AS bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('2', '3', '4', '5');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «день недели решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните величина DAYS_DECISION по предыдущим кредитам для одобренных предыдущих кредитов для разных категорий по признаку «канал продаж» в прошлых заявках клиентов.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY CHANNEL_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов, где хотя бы раз была просрочка по сумме в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните размер планового платежа по рассрочке для платежей, которые были действительно внесены для разных значений признака «своевременность платежей» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для предыдущих заявок с суммой кредита от 10 000 до 50 000 в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, у которых срок уже должен был закончиться (DAYS_CREDIT_ENDDATE <= 0) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE <= 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднюю долю месяцев с просрочкой по картам (SK_DPD > 0) для карт с ненулевым остатком (AMT_BALANCE > 0) в разрезе по уровню загрузки лимита utilization (high/medium/low).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_BALANCE > 0 ) SELECT CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END AS group_key, AVG(CASE WHEN SK_DPD > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM cc GROUP BY CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Предоставьте полный перечень заявок, получивших отказ, с указанием сумм и кодов причин отклонения.",
    "sql": "SELECT SK_ID_PREV, SK_ID_CURR, AMT_APPLICATION, CODE_REJECT_REASON FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Представьте анализ уровня дефолтности в разрезе семейного положения заемщиков.",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как меняется средний доход у людей с разным количеством детей?",
    "sql": "SELECT CNT_CHILDREN, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выведи среднюю сумму долга по БКИ, сгруппированную по статусу кредита.",
    "sql": "SELECT CREDIT_ACTIVE, AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE AMT_CREDIT_SUM_DEBT IS NOT NULL GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-записей за последние 6 месяцев (MONTHS_BALANCE > -6) в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с оставшимся сроком погашения (DAYS_CREDIT_ENDDATE > 0) и по каждому значению группировки (CREDIT_TYPE) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните среднюю сумму кредита для клиентов, имеющих автомобиль, и не имеющих его.",
    "sql": "SELECT FLAG_OWN_CAR, AVG(AMT_CREDIT) FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каково распределение категорий жилья (NAME_HOUSING_TYPE) для клиентов, признанных дефолтными (TARGET = 1)?",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train WHERE TARGET = 1 GROUP BY NAME_HOUSING_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для POS-кредитов с длительным графиком платежей между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Выведи список всех клиентов, чья задолженность в БКИ превышает 90 дней.",
    "sql": "SELECT DISTINCT SK_ID_CURR FROM bureau WHERE CREDIT_DAY_OVERDUE > 90;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оцените демографическую структуру клиентов по полу для сегментации.",
    "sql": "SELECT CODE_GENDER, COUNT(*) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для активных POS-кредитов (CNT_INSTALMENT_FUTURE > 0) в разрезе по статусу договора POS-кредита (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите распределение займов по их текущему статусу в БКИ.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Существует ли корреляция между часом подачи заявки и последующим уровнем дефолта?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, AVG(TARGET) AS default_rate FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Расскажите, для чего чаще всего брали кредиты те, кто потом не смог их вернуть? Назовите три самые частые причины.",
    "sql": "SELECT pa.NAME_CASH_LOAN_PURPOSE, COUNT(DISTINCT at.SK_ID_CURR) AS DefaulterCount FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE at.TARGET = 1 GROUP BY pa.NAME_CASH_LOAN_PURPOSE ORDER BY DefaulterCount DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выведите рейтинг Топ-5 целей для кэш-кредитов из данных по прошлым заявкам для оценки рисков.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(*) FROM previous_application WHERE NAME_CASH_LOAN_PURPOSE IS NOT NULL GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(*) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Идентифицируйте ключевые демографические профили (топ-5 комбинаций 'Тип дохода' и 'Образование') для клиентов, относящихся к категории 'Дефолт'.",
    "sql": "SELECT NAME_INCOME_TYPE, NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS client_count FROM application_train WHERE TARGET = 1 GROUP BY NAME_INCOME_TYPE, NAME_EDUCATION_TYPE ORDER BY client_count DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без серьёзной просрочки по DPD_DEF (SK_DPD_DEF = 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для первых трёх платежей в графике (NUM_INSTALMENT_NUMBER <= 3), покажите средний плановый платёж по рассрочке (AMT_INSTALMENT) по каждому значению поля NUM_INSTALMENT_NUMBER.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов, которые пролонгировались для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните размер фактического платежа по рассрочке для случаев переплаты по рассрочке для разных значений признака «тип платёжной дисциплины» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_PAYMENT > AMT_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для одобренных предыдущих кредитов для разных категорий по признаку «отрасль продавца» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Отобразите перечень активных кредитных инструментов в кредитной истории заемщика с SK_ID_CURR 100002.",
    "sql": "SELECT SK_BUREAU_ID, CREDIT_ACTIVE, AMT_CREDIT_SUM_DEBT FROM bureau WHERE SK_ID_CURR = 100002 AND CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Визуализируйте количество отказов, разбив их по соответствующим причинам.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих платежей по картам для карт с серьёзными просрочками для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD_DEF > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте средний уровень дохода у заемщиков с дефолтными обязательствами в БКИ.",
    "sql": "SELECT AVG(t1.AMT_INCOME_TOTAL) FROM application AS t1 JOIN bureau AS t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR WHERE t2.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для кредитов на дорогие товары дороже 100 000 между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по каналу продаж (CHANNEL_TYPE).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CHANNEL_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер фактического платежа по рассрочке для рассрочек, по которым есть плановый платёж между разными группами между разными номерами платежей в графике рассрочки?",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково общее число уникальных субъектов кредитной истории, присутствующих в регистре бюро?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля NAME_SELLER_INDUSTRY показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какой средний доход имеют клиенты-дефолтеры, в зависимости от того, где они живут (тип жилья)?",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(AMT_INCOME_TOTAL) AS Average_Income FROM application_train WHERE TARGET = 1 GROUP BY NAME_HOUSING_TYPE ORDER BY Average_Income DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется разницу между фактическим и плановым платёжом по рассрочке для рассрочек, относящихся к последнему году между различными сегментами между клиентами по их платёжной истории по рассрочке в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT SK_ID_CURR AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Проанализируйте распределение количества кредитных заявок по различным типам контрактных соглашений.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте распределение кредитных целей (NAME_CASH_LOAN_PURPOSE) среди клиентов, имеющих семейный статус 'Divorced'.",
    "sql": "SELECT pa.NAME_CASH_LOAN_PURPOSE, COUNT(pa.SK_ID_PREV) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE at.NAME_FAMILY_STATUS = 'Divorced' GROUP BY pa.NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(pa.SK_ID_PREV) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Каков у нас средний лимит по кредиткам?",
    "sql": "SELECT AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведи таблицу клиентов с активными проблемными кредитами в БКИ.",
    "sql": "SELECT DISTINCT a.SK_ID_CURR, a.AMT_CREDIT, b.CREDIT_ACTIVE, b.CREDIT_DAY_OVERDUE FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active' AND b.CREDIT_DAY_OVERDUE > 0 LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер фактического платежа по рассрочке для условной половины клиентов по чётности ID между разными группами между клиентами по их платёжной дисциплине?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково общее количество предыдущих кредитов, оформленных каждым конкретным клиентом?",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_ID_PREV) AS NumberOfPreviousLoans FROM previous_application GROUP BY SK_ID_CURR ORDER BY NumberOfPreviousLoans DESC",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите средний размер основного долга (AMT_CREDIT) по всем одобренным кредитным продуктам.",
    "sql": "SELECT AVG(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова численность заёмщиков, демонстрирующих индикаторы дефолта в бюро балансов, а именно статус просрочки свыше 90 календарных дней?",
    "sql": "SELECT COUNT(DISTINCT b.SK_ID_CURR) FROM bureau_balance bb JOIN bureau b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID WHERE bb.STATUS IN ('4', '5');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие предыдущие заявки были аннулированы, и какие у них были тип контракта и дата решения?",
    "sql": "SELECT SK_ID_PREV, SK_ID_CURR, NAME_CONTRACT_TYPE, DAYS_DECISION FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Canceled' ORDER BY DAYS_DECISION DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для завершённых POS-договоров (NAME_CONTRACT_STATUS = 'Completed') и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Completed' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите разбивку клиентов по их жилищному статусу для оценки потенциальных рисков.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_HOUSING_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "А сколько всего наличных снимали с кредиток в прошлый раз, если разбить по мужчинам и женщинам, которые сейчас подают заявку?",
    "sql": "SELECT at.CODE_GENDER, SUM(ccb.AMT_DRAWINGS_ATM_CURRENT) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY at.CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля NAME_YIELD_GROUP показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите общее число уникальных субъектов в клиентской базе данных.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для кредитов в основной валюте 'currency 1' для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сколько лет нашим клиентам в среднем?",
    "sql": "SELECT AVG(ABS(DAYS_BIRTH) / 365) FROM application_train",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для кредитов, по которым данные давно не обновлялись в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сегментация клиентской базы по типу жилищных условий.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_HOUSING_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам в бюро для месяцев, по которым статус кредита известен в разрезе признака «статус кредита по месяцам» по истории кредитов из бюро.",
    "sql": "SELECT STATUS AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS <> 'X' GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Мне интересно, кто из наших клиентов, живущих в доме или квартире, относится к 20% самых высокодоходных?",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT FROM application_train WHERE NAME_HOUSING_TYPE = 'House / apartment' ORDER BY AMT_INCOME_TOTAL DESC LIMIT (SELECT CAST(COUNT(*)*0.2 AS INTEGER) FROM application_train WHERE NAME_HOUSING_TYPE = 'House / apartment');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте запрос с подзапросом по credit_card_balance (агрегация по SK_ID_CURR), а затем объедините его с previous_application и получите среднее отношение платежей к выборкам по картам (AMT_PAYMENT_CURRENT / NULLIF(AMT_DRAWINGS_CURRENT, 0)) для карт с текущими выборками средств (cc.AMT_DRAWINGS_CURRENT > 0) по по типу клиента (pa.NAME_CLIENT_TYPE).",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.AMT_DRAWINGS_CURRENT > 0 GROUP BY cc.SK_ID_CURR ) SELECT pa.NAME_CLIENT_TYPE AS group_key, AVG(pay_vs_spend_ratio) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для месяцев, по которым нет детальной информации между разными категориями между разными статусами состояния кредита в разрезе месяцев?",
    "sql": "SELECT STATUS AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS = 'X' GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE) для пролонгированных кредитов (CNT_CREDIT_PROLONG > 0) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите долевое соотношение типов операций снятия средств с кредитных карт (банкоматы, POS-терминалы, другие методы).",
    "sql": "SELECT 'ATM' AS type, SUM(AMT_DRAWINGS_ATM_CURRENT) AS total_amount FROM credit_card_balance UNION ALL SELECT 'POS' AS type, SUM(AMT_DRAWINGS_POS_CURRENT) AS total_amount FROM credit_card_balance UNION ALL SELECT 'Other' AS type, SUM(AMT_DRAWINGS_OTHER_CURRENT) AS total_amount FROM credit_card_balance;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Представьте временной ряд средней задолженности по кредитным обязательствам из БКИ за предшествующий год относительно даты подачи заявки.",
    "sql": "SELECT DAYS_CREDIT, AVG(AMT_CREDIT_SUM_DEBT) FROM bureau GROUP BY DAYS_CREDIT ORDER BY DAYS_CREDIT DESC LIMIT 365;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Оцените почасовую динамику количества обработанных заявок по предшествующим кредитным продуктам.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_PREV) AS application_count FROM previous_application GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каково количество уникальных заемщиков, чьи кредитные истории в БКИ содержат индикаторы 'Bad debt'?",
    "sql": "SELECT COUNT(DISTINCT b.SK_ID_CURR) FROM bureau_balance bb JOIN bureau b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID WHERE bb.STATUS IN ('C', 'X');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализируйте статусы активности кредитов в кредитном бюро.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выведи топ-10 клиентов с самым высоким общим долгом, используя данные БКИ.",
    "sql": "SELECT at.SK_ID_CURR, at.AMT_INCOME_TOTAL, SUM(b.AMT_CREDIT_SUM_DEBT) AS total_bureau_debt FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.SK_ID_CURR, at.AMT_INCOME_TOTAL ORDER BY total_bureau_debt DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю разницу между фактическим и плановым платежом (payment_diff) для записей с ненулевым плановым платежом по по уровню накопленных платежей cum_payment (low/medium/high).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для завершённых POS-договоров (NAME_CONTRACT_STATUS = 'Completed') и показан среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Completed' GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте столбчатую диаграмму, показывающую средний стаж работы в днях для каждого типа контракта.",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(ABS(DAYS_EMPLOYED)) FROM application_train WHERE DAYS_EMPLOYED < 0 GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько у нас клиентов, которые 'забывали' платить по кредитам больше месяца, согласно БКИ?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_DAY_OVERDUE > 30;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте график, показывающий общую сумму текущих платежей по кредитным картам за каждый месяц.",
    "sql": "SELECT MONTHS_BALANCE, SUM(AMT_PAYMENT_CURRENT) FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT IS NOT NULL GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково среднее число действующих кредитных записей в кредитной истории клиента?",
    "sql": "SELECT AVG(num_active_credits) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS num_active_credits FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR) AS subquery;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт с высоким лимитом (AMT_CREDIT_LIMIT_ACTUAL > 50 000) в разрезе по месяцу отчётности по карте (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 50000 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте список из 10 клиентов с высокими показателями OBS_30_CNT_SOCIAL_CIRCLE (более 5) и подтвержденным дефолтом (TARGET = 1) для анализа их профиля.",
    "sql": "SELECT SK_ID_CURR, OBS_30_CNT_SOCIAL_CIRCLE, TARGET FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE > 5 AND TARGET = 1 LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите долю клиентов, имеющих в собственности транспортное средство.",
    "sql": "SELECT CAST(SUM(CASE WHEN FLAG_OWN_CAR = 'Y' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для POS-кредитов с просрочкой для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для предыдущих заявок примерно за последний год между клиентами между отраслями продавцов, через которых оформлялись кредиты?",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для очень старой истории кредитов (старше трёх лет) между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE <= -36 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих платежей по картам для кредитных карт с небольшим лимитом в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для самых свежих месяцев кредитной истории между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE > -3 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова средняя сумма снятий наличных по кредитным картам через ATM для каждой группы семейного положения?",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(cc.AMT_DRAWINGS_ATM_CURRENT) FROM application_train at JOIN credit_card_balance cc ON at.SK_ID_CURR = cc.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY AVG(cc.AMT_DRAWINGS_ATM_CURRENT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для более старых POS-записей (MONTHS_BALANCE < -12) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля NAME_CONTRACT_STATUS показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт с высоким лимитом (AMT_CREDIT_LIMIT_ACTUAL > 50 000) в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 50000 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каковы текущие показатели по кредитным картам у клиентов с негативной кредитной историей (просрочки в БКИ)?",
    "sql": "SELECT ccb.SK_ID_CURR, ccb.AMT_BALANCE, ccb.AMT_CREDIT_LIMIT_ACTUAL, ccb.AMT_PAYMENT_TOTAL_CURRENT FROM credit_card_balance ccb JOIN (SELECT DISTINCT SK_ID_CURR FROM bureau WHERE CREDIT_DAY_OVERDUE > 0) b ON ccb.SK_ID_CURR = b.SK_ID_CURR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков уровень дефолта для заемщиков, которые обращались в кредитные бюро в течение последнего года, по сравнению с теми, кто не обращался?",
    "sql": "SELECT CASE WHEN AMT_REQ_CREDIT_BUREAU_YEAR > 0 THEN 'Requested Bureau' ELSE 'No Bureau Request' END AS BureauRequest, AVG(TARGET) AS default_rate FROM application_train GROUP BY BureauRequest;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте демографический срез клиентов по параметру 'семейное положение' (NAME_FAMILY_STATUS).",
    "sql": "SELECT NAME_FAMILY_STATUS, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_FAMILY_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как распределяется долю просроченных платежей по рассрочке для рассрочек с реальным графиком платежей между различными сегментами между ранними, средними и поздними платежами в графике в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Показать круговую диаграмму, иллюстрирующую распределение кредитных валют в БКИ.",
    "sql": "SELECT CREDIT_CURRENCY, COUNT(*) FROM bureau GROUP BY CREDIT_CURRENCY;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Рассчитайте среднее значение ежегодного платежа для недобросовестных заемщиков.",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов, которые пролонгировались в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково среднее количество 'рисунков' (операций) по POS-терминалу, зафиксированное в последнем доступном месяце?",
    "sql": "SELECT AVG(CNT_DRAWINGS_POS_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE = (SELECT MAX(MONTHS_BALANCE) FROM credit_card_balance);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведите данные по клиентам, у которых есть просрочки по займам в БКИ.",
    "sql": "SELECT at.SK_ID_CURR, at.AMT_CREDIT, at.AMT_INCOME_TOTAL, b.CREDIT_ACTIVE, b.CREDIT_DAY_OVERDUE FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для карт с серьёзными просрочками для разных групп между клиентами по их карточной активности?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD_DEF > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднюю загрузку кредитных карт (utilization) по сегментам для карт с текущими выборками средств (AMT_DRAWINGS_CURRENT > 0) в разрезе по месяцу истории по карте (MONTHS_BALANCE).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 ) SELECT MONTHS_BALANCE AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Интересно, в какие дни недели чаще всего отказывают в займах? Покажи мне это.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько у нас было заявок на каждый вид кредита, например, на обычные или револьверные?",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих выборок по картам для карт с нулевым остатком задолженности в разрезе признака «тип поведения по карте» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит объём текущих платежей по картам для карт, по которым вносились платежи для разных групп между разными статусами договоров по кредитным картам?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для более старых карточных записей (MONTHS_BALANCE < -12), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните максимальный месяц наблюдения по кредиту для действующих кредитов по данным бюро в разрезе признака «размер кредита», если учитывать помесячную историю статусов кредитов из бюро.",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните размер одобренного кредита по предыдущим заявкам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «канал продаж» в прошлых заявках клиентов.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY CHANNEL_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «тип портфеля» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для карт, по которым есть просрочка в разрезе признака «статус договора по карте» по кредитным картам клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля NAME_CONTRACT_TYPE показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как различается максимальный месяц наблюдения по кредиту для действующих кредитов по данным бюро между различными сегментами между типами кредитов по данным бюро по данным бюро кредитных историй?",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_TYPE AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CREDIT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каковы ключевые целевые назначения кредитов, доминирующие в портфеле одобренных ранее заявок (топ-5)?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND NAME_CASH_LOAN_PURPOSE IS NOT NULL GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Кто из заемщиков имеет больше членов семьи, чем детей?",
    "sql": "SELECT SK_ID_CURR, CNT_FAM_MEMBERS, CNT_CHILDREN FROM application_train WHERE CNT_FAM_MEMBERS > CNT_CHILDREN LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие валюты преобладают среди кредитных обязательств, отраженных в бюро кредитных историй?",
    "sql": "SELECT CREDIT_CURRENCY, COUNT(*) FROM bureau GROUP BY CREDIT_CURRENCY;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Проанализируйте средний размер платежа по кредитной карте в разрезе типов текущих кредитных контрактов.",
    "sql": "SELECT at.NAME_CONTRACT_TYPE, AVG(ccb.AMT_PAYMENT_TOTAL_CURRENT) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE ccb.AMT_PAYMENT_TOTAL_CURRENT IS NOT NULL GROUP BY at.NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков средний объем непогашенных обязательств по кредитным картам среди наших высокообразованных клиентов?",
    "sql": "SELECT AVG(t2.AMT_TOTAL_RECEIVABLE) FROM application_train t1 JOIN credit_card_balance t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR WHERE t1.NAME_EDUCATION_TYPE = 'Higher education';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) в разрезе по признаку активный/закрытый POS-кредит (по CNT_INSTALMENT_FUTURE).",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой процент дефолтов наблюдается в зависимости от часа подачи заявления на кредит (HOUR_APPR_PROCESS_START)?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих платежей по картам для кредитных карт с небольшим лимитом для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') и по каждому значению поля CHANNEL_TYPE показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CHANNEL_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется значение MONTHS_BALANCE по кредитам в бюро для второй половины кредитов по нечётности ID между разными категориями между свежими и старыми записями по кредитам?",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE SK_BUREAU_ID % 2 = 1 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой у нас процент одобрения кредитов по всем заявкам?",
    "sql": "SELECT CAST(COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 END) AS REAL) * 100 / COUNT(SK_ID_PREV) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт с просрочкой по DPD (SK_DPD > 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова временная тенденция количества просроченных счетов в БКИ за последние месяцы?",
    "sql": "SELECT MONTHS_BALANCE, COUNT(CASE WHEN STATUS IN ('1', '2', '3', '4', '5') THEN 1 ELSE NULL END) AS overdue_accounts FROM bureau_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как ведёт себя просрочку платежа по POS-кредитам в днях для платежей с известной датой внесения между различными сегментами между разными статусами POS-договоров по POS-кредитам клиентов?",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_ENTRY_PAYMENT IS NOT NULL ) SELECT pos.NAME_CONTRACT_STATUS AS group_key, AVG(days_late) AS metric_value FROM pos_inst GROUP BY pos.NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Проанализируйте распределение кредитных обязательств в БКИ в разрезе различных валют.",
    "sql": "SELECT CREDIT_CURRENCY, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_CURRENCY;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сколько дефолтов у нас по каждому типу договора?",
    "sql": "SELECT NAME_CONTRACT_TYPE, SUM(TARGET) AS DefaultCount FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Оцените динамику суммарного объема выданных кредитов по дням недели на основе предыдущих одобренных заявок.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, SUM(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY SUM(AMT_CREDIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих выборок по картам для карт с текущей задолженностью в разрезе признака «статус договора по карте» по кредитным картам клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_BALANCE > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как менялся средний долг по кредиткам за последние полгода?",
    "sql": "SELECT STRFTIME('%Y-%m', DATE('now', MONTHS_BALANCE || ' months')) AS month_year, AVG(AMT_BALANCE) FROM credit_card_balance WHERE MONTHS_BALANCE >= -6 GROUP BY month_year ORDER BY month_year ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Мужчины, которые не смогли выплатить кредит, сколько они в среднем зарабатывали?",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) AS avg_income FROM application_train WHERE CODE_GENDER = 'M' AND TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднее значение задержки платежа в днях (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) для новых клиентов (pa.NAME_CLIENT_TYPE = 'New') в разрезе по доходности продукта (pa.NAME_YIELD_GROUP) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT NAME_YIELD_GROUP AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажи среднее количество запросов в БКИ за последние 12 месяцев.",
    "sql": "SELECT AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE) для активных кредитов (CREDIT_ACTIVE = 'Active') в разрезе по размеру кредита (AMT_CREDIT_SUM) с бинингом на крупные и остальные.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните загрузку кредитных карт (utilization) для карт, по которым клиент сейчас вносит платежи по признаку «уровень использования лимита», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 ) SELECT CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Анализ уровня одобрения кредитных заявок в зависимости от указанной цели получения наличного займа.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, CAST(COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 END) AS REAL) * 100 / COUNT(*) AS ApprovalRate FROM previous_application GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY ApprovalRate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите общее количество просроченных займов, где срок просрочки превышает 30 дней, по данным БКИ.",
    "sql": "SELECT COUNT(*) FROM bureau WHERE CREDIT_DAY_OVERDUE > 30;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Представьте аналитику по среднему Approval Rate для различных продуктовых сегментов (целей займа).",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, AVG(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) * 100 FROM previous_application GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY AVG(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова суммарная задолженность по кредитным бюро, сгруппированная по типу занятости?",
    "sql": "SELECT at.OCCUPATION_TYPE, SUM(b.AMT_CREDIT_SUM_DEBT) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.OCCUPATION_TYPE ORDER BY SUM(b.AMT_CREDIT_SUM_DEBT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков уровень невозврата кредитов среди клиентов, не достигших 25-летнего возраста?",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train_test WHERE -DAYS_BIRTH / 365 < 25",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите общее число уникальных кредитных заявок, зарегистрированных в системе.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Предоставьте перечень заемщиков с суммой кредита, превышающей 1,000,000, и общим доходом ниже 150,000.",
    "sql": "SELECT SK_ID_CURR, AMT_CREDIT, AMT_INCOME_TOTAL FROM application_train_test WHERE AMT_CREDIT > 1000000 AND AMT_INCOME_TOTAL < 150000",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Можем посмотреть, как распределялись старые заявки по времени с момента их рассмотрения?",
    "sql": "SELECT CASE WHEN ABS(DAYS_DECISION) <= 30 THEN '0-30 days' WHEN ABS(DAYS_DECISION) <= 90 THEN '31-90 days' WHEN ABS(DAYS_DECISION) <= 180 THEN '91-180 days' WHEN ABS(DAYS_DECISION) <= 365 THEN '181-365 days' ELSE '>365 days' END AS time_interval, COUNT(*) FROM previous_application GROUP BY time_interval ORDER BY MIN(ABS(DAYS_DECISION));",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какие топ-5 целей кредитования демонстрируют наибольшую частоту обращений?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(SK_ID_PREV) AS application_count FROM previous_application GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY application_count DESC LIMIT 5;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Каков усредненный размер выданного кредита?",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите среднюю продолжительность трудового стажа для каждого типа источника дохода.",
    "sql": "SELECT NAME_INCOME_TYPE, ABS(AVG(DAYS_EMPLOYED)) AS avg_days_employed FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY avg_days_employed DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Гендерное распределение клиентского контингента.",
    "sql": "SELECT CODE_GENDER, COUNT(SK_ID_CURR) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с платежами в текущем периоде (AMT_PAYMENT_CURRENT > 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и агрегированных данных credit_card_balance по клиенту рассчитайте среднюю загрузку кредитных карт (AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL) среди клиентов для карт с текущими выборками средств (cc.AMT_DRAWINGS_CURRENT > 0) в разрезе по каналу оформления предыдущего кредита (pa.CHANNEL_TYPE).",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.AMT_DRAWINGS_CURRENT > 0 GROUP BY cc.SK_ID_CURR ) SELECT pa.CHANNEL_TYPE AS group_key, AVG(utilization) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для кредитов, по которым ещё не наступил конец срока для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля NAME_YIELD_GROUP показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с суммой до 100 000 и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Визуализируйте сравнение среднего чека по 'Cash loans' и 'Revolving loans' для оценки продуктового портфеля.",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_CREDIT) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите, сколько кредитов в БКИ сейчас активны, закрыты или просрочены.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) AS count FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните размер кредита по данным бюро для уже погашенных кредитов в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Мне нужен список дефолтных клиентов, у которых было много контактов в их соцкруге за последний месяц.",
    "sql": "SELECT SK_ID_CURR, AMT_CREDIT, OBS_30_CNT_SOCIAL_CIRCLE FROM application_train WHERE TARGET = 1 AND OBS_30_CNT_SOCIAL_CIRCLE > 2 ORDER BY OBS_30_CNT_SOCIAL_CIRCLE DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя долю просроченных платежей для клиентов, которые уже ранее брали кредит для разных групп клиентов между просроченными и своевременными платежами, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих платежей по картам для активности по картам за последние полгода в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднее значение задержки платежа в днях (delay_days) по рассрочкам для поздних платежей (NUM_INSTALMENT_NUMBER > 12) в разрезе по сегментам номера платежа (early/middle/late).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 12 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сколько в среднем работают те, кто не платит, и те, кто платит?",
    "sql": "SELECT TARGET, AVG(DAYS_EMPLOYED) FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проанализируйте распределение статусов по ранее поданным кредитным заявкам (одобрения, отказы, аннулирования).",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков бенчмарк по среднему возрасту клиентской базы?",
    "sql": "SELECT AVG(ABS(DAYS_BIRTH) / 365.25) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова общая сумма снятий наличных с кредитных карт через ATM?",
    "sql": "SELECT SUM(AMT_DRAWINGS_ATM_CURRENT) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для POS-кредитов без серьёзной просрочки (SK_DPD_DEF = 0) в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков текущий суммарный размер выданных кредитов (AMT_CREDIT)?",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для отказанных предыдущих кредитов между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой тип жилья демонстрирует самый высокий процент просрочек по кредитам?",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(TARGET) * 100 FROM application_train_test GROUP BY NAME_HOUSING_TYPE ORDER BY AVG(TARGET) DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проанализируйте средний размер одобренного кредита в зависимости от возраста заемщика.",
    "sql": "SELECT FLOOR(ABS(DAYS_BIRTH) / 365) AS Age, AVG(AMT_CREDIT) AS AverageCreditAmount FROM application_train GROUP BY Age ORDER BY Age;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните долю просроченных платежей для прошлых крупных кредитов с реальными платежами по графику между сегментами по признаку «тип клиента» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.AMT_CREDIT > 50000 AND ip.AMT_INSTALMENT > 0 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какие клиенты характеризуются максимальным совокупным объемом задолженности согласно информации БКИ?",
    "sql": "SELECT at.SK_ID_CURR, at.AMT_INCOME_TOTAL, SUM(b.AMT_CREDIT_SUM_DEBT) AS total_bureau_debt FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.SK_ID_CURR, at.AMT_INCOME_TOTAL ORDER BY total_bureau_debt DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для карт с нулевым остатком задолженности для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте тренд изменения среднего объема одобренных кредитов в разбивке по месяцам, прошедшим с даты принятия решения.",
    "sql": "SELECT CAST(ABS(DAYS_DECISION) / 30 AS INT) AS months_ago, AVG(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY months_ago ORDER BY months_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каковы различия в проценте дефолта между клиентами, владеющими автомобилем, и не владеющими им?",
    "sql": "SELECT FLAG_OWN_CAR, AVG(TARGET) * 100 FROM application_train_test GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как изменяется дефолт рейт в зависимости от семейного положения клиента?",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните размер одобренного кредита по предыдущим заявкам для прошлых кредитов на сумму выше 50 000 для разных категорий по признаку «тип кредитного продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните размер фактического платежа по рассрочке для второй половины клиентов по нечётности ID для разных значений признака «клиент» в платёжной истории клиентов.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Интересно, как со временем меняется средний размер выданных кредитов, если смотреть по тому, сколько дней прошло с момента решения?",
    "sql": "SELECT ABS(DAYS_DECISION) AS days_since_decision, AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY ABS(DAYS_DECISION) ORDER BY ABS(DAYS_DECISION) ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «канал продаж» в прошлых заявках клиентов.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для платежей по рассрочке за последний год (DAYS_INSTALMENT BETWEEN -365 AND 0) сгруппирует данные по признаку просрочки платежа (delay_days > 0) и рассчитает среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитов, по которым известна фактическая дата завершения (DAYS_ENDDATE_FACT IS NOT NULL) в разрезе по размеру кредита (AMT_CREDIT_SUM) с бинингом на крупные и остальные.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте совокупный процент дефолтов по всей нашей клиентской базе.",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Отобразите распределение целевого показателя (TARGET) в зависимости от семейного положения клиентов.",
    "sql": "SELECT NAME_FAMILY_STATUS, TARGET, COUNT(SK_ID_CURR) AS count FROM application_train GROUP BY NAME_FAMILY_STATUS, TARGET ORDER BY NAME_FAMILY_STATUS, TARGET;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как выглядит загрузку кредитных карт (отношение задолженности к лимиту) для карт, по которым задан лимит для разных сегментов клиентов между каналами, через которые клиент оформлял предыдущий кредит, если объединить историю прошлых кредитов и поведение по кредитным картам?",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.AMT_CREDIT_LIMIT_ACTUAL > 0 GROUP BY cc.SK_ID_CURR ) SELECT pa.CHANNEL_TYPE AS group_key, AVG(utilization) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Построй круговую диаграмму, показывающую доли различных типов сопровождающих лиц.",
    "sql": "SELECT NAME_TYPE_SUITE, COUNT(SK_ID_CURR) FROM application_train_test GROUP BY NAME_TYPE_SUITE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Какие пять типов занятости демонстрируют наиболее высокие показатели дефолта?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY AVG(TARGET) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для кредитов, по которым данные давно не обновлялись для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните показатель DPD_DEF по POS-кредитам для POS-кредитов с длительным графиком платежей для разных значений признака «активность POS-кредита» по POS-кредитам.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний остаток по кредитным картам (AMT_BALANCE) для более старых карточных записей (MONTHS_BALANCE < -12) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажите распределение среднего дохода клиентов по типам их занятости, чтобы оценить платежеспособность сегментов.",
    "sql": "SELECT NAME_INCOME_TYPE, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY AVG(AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как владение автомобилем влияет на средний уровень дохода наших заемщиков, для построения скоринговой модели?",
    "sql": "SELECT FLAG_OWN_CAR, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) для карт с высоким лимитом (AMT_CREDIT_LIMIT_ACTUAL > 50 000) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 50000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «тип клиента» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднее значение задержки платежа в днях (delay_days) по рассрочкам для записей с ненулевым плановым платежом по по версии графика платежей (NUM_INSTALMENT_VERSION).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита от 10 000 до 50 000 и по каждому значению поля HOUR_APPR_PROCESS_START показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите SK_ID_CURR заемщиков, имеющих просрочку по платежам кредитных карт.",
    "sql": "SELECT DISTINCT a.SK_ID_CURR FROM application_train a JOIN credit_card_balance ccb ON a.SK_ID_CURR = ccb.SK_ID_CURR WHERE ccb.AMT_INST_MIN_REGULARITY > 0 AND ccb.AMT_PAYMENT_TOTAL_CURRENT < ccb.AMT_INST_MIN_REGULARITY;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний плановый платёж по рассрочке (AMT_INSTALMENT) для последующих платежей (NUM_INSTALMENT_NUMBER > 3) в разрезе по факту платёжной дисциплины (переплата/недоплата).",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с суммой более 100 000 (AMT_CREDIT_SUM > 100000) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите помесячную динамику среднего размера одобренных кредитов за последний 12-месячный период.",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(JULIANDAY('now'), DAYS_DECISION || ' days')) AS decision_month, AVG(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND DAYS_DECISION BETWEEN -365 AND 0 GROUP BY decision_month ORDER BY decision_month;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Расчет среднего размера первоначального взноса по заявкам, получившим одобрение.",
    "sql": "SELECT AVG(AMT_DOWN_PAYMENT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND AMT_DOWN_PAYMENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Можете показать клиентов, которым когда-то отказали, но текущий кредит одобрили, и они не в дефолте?",
    "sql": "SELECT DISTINCT a.SK_ID_CURR, a.TARGET, p.NAME_CONTRACT_STATUS AS prev_status FROM application_train a JOIN previous_application p ON a.SK_ID_CURR = p.SK_ID_CURR WHERE p.NAME_CONTRACT_STATUS = 'Refused' AND a.TARGET = 0 LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для кредитов во второй типовой валюте в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 2' GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для отказанных предыдущих кредитов между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для записей с активным статусом договора (NAME_CONTRACT_STATUS = 'Active') и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Анализ образовательного ценза клиентов, чьи кредитные заявки были отклонены.",
    "sql": "SELECT at.NAME_EDUCATION_TYPE, COUNT(DISTINCT at.SK_ID_CURR) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Refused' GROUP BY at.NAME_EDUCATION_TYPE ORDER BY COUNT(DISTINCT at.SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для уже погашенных POS-кредитов между разными категориями между клиентами по их POS-истории?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE = 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните загрузку кредитных карт (utilization) для карт, по которым клиент сейчас тратит средства по признаку «клиент», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 ) SELECT SK_ID_CURR AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите среднюю сумму запрашиваемых кредитов (по БКИ) для дефолтных клиентов с выраженным социальным риском.",
    "sql": "SELECT AVG(b.AMT_CREDIT_SUM) AS avg_bureau_credit FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE a.OBS_30_CNT_SOCIAL_CIRCLE > 5 AND a.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по статусу договора (NAME_CONTRACT_STATUS) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов, по которым задан аннуитетный платёж для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как клиенты распределены по числу действующих займов в БКИ, и каков средний размер их совокупного долга?",
    "sql": "SELECT b_count.credit_count, AVG(b.AMT_CREDIT_SUM_DEBT) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS credit_count FROM bureau GROUP BY SK_ID_CURR) AS b_count JOIN bureau b ON b_count.SK_ID_CURR = b.SK_ID_CURR GROUP BY b_count.credit_count ORDER BY b_count.credit_count;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем снимали с кредиток через банкоматы за последние полгода?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_DRAWINGS_ATM_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE >= -5 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY CHANNEL_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля NAME_PORTFOLIO показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с DPD > 0 и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите ключевую метрику: общую сумму остатков по кредитным картам для всех клиентов, у которых количество детей (CNT_CHILDREN) больше нуля.",
    "sql": "SELECT SUM(ccb.AMT_BALANCE) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE at.CNT_CHILDREN > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля NAME_CONTRACT_TYPE показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отобразите количество текущих заявок для каждого типа контракта (Cash loans, Revolving loans).",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков процент заявок, которые наши сотрудники обрабатывают в часы, не являющиеся стандартными рабочими (т.е. с 18:00 до 9:00)?",
    "sql": "SELECT (SUM(CASE WHEN HOUR_APPR_PROCESS_START < 9 OR HOUR_APPR_PROCESS_START >= 18 THEN 1 ELSE 0 END) * 100.0) / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько процентов наших клиентов предпочитают возобновляемые кредиты?",
    "sql": "SELECT CAST(COUNT(CASE WHEN NAME_CONTRACT_TYPE = 'Revolving loans' THEN SK_ID_CURR END) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Анализ структуры клиентской базы по виду жилья.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) AS client_count FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY client_count DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Выведи всю инфу по кредиткам для клиента 100005, ну там, балансы и все такое.",
    "sql": "SELECT SK_ID_PREV, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_PAYMENT_TOTAL_CURRENT FROM credit_card_balance WHERE SK_ID_CURR = 100005 ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов, по которым ещё не наступил конец срока в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните размер планового платежа по рассрочке для начальных платежей по рассрочке для разных значений признака «номер платежа» в платёжной истории клиентов.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какой вид контракта чаще всего выбирают те, кому раньше отказывали в кредите?",
    "sql": "SELECT at.NAME_CONTRACT_TYPE, COUNT(DISTINCT at.SK_ID_CURR) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Refused' GROUP BY at.NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Отобразите среднее количество детей у клиентов, допустивших дефолт, в разбивке по возрастным когортам.",
    "sql": "SELECT CASE WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 25 THEN 'До 25' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 35 THEN '26-35' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 45 THEN '36-45' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 55 THEN '46-55' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 65 THEN '56-65' ELSE 'Старше 65' END AS AgeGroup, AVG(CNT_CHILDREN) AS AverageChildren FROM application_train WHERE TARGET = 1 GROUP BY AgeGroup ORDER BY AgeGroup;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, открытых за последний год (DAYS_CREDIT > -365) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов, по которым уже была просрочка (CREDIT_DAY_OVERDUE > 0) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте таблицу с идентификаторами клиентов и общим числом их предыдущих кредитных обращений.",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_ID_PREV) FROM previous_application GROUP BY SK_ID_CURR ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько детей в среднем у тех, кто не смог вернуть кредит?",
    "sql": "SELECT AVG(CNT_CHILDREN) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется задержку платежа по рассрочкам для рассрочек, относящихся к последнему году между различными сегментами между просроченными и своевременными платежами в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните загрузку кредитных карт (utilization) для карточной истории за последний год по признаку «месяц истории по карте», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE > -12 ) SELECT MONTHS_BALANCE AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Кто является нашими клиентами с максимальным числом детей, и каков их доход? (Топ-10)",
    "sql": "SELECT SK_ID_CURR, CNT_CHILDREN, AMT_INCOME_TOTAL FROM application ORDER BY CNT_CHILDREN DESC, AMT_INCOME_TOTAL DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова средняя цена того, что люди закладывают по ипотеке?",
    "sql": "SELECT AVG(AMT_GOODS_PRICE) FROM previous_application WHERE NAME_CASH_LOAN_PURPOSE = 'Housing' OR (NAME_CONTRACT_TYPE = 'Consumer loans' AND AMT_GOODS_PRICE IS NOT NULL AND AMT_GOODS_PRICE > 0)",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Интересно, сколько у нас клиентов, которые активно пользуются кредитами, но ни разу не задерживали платежи?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE = 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оцените процент клиентов, не владеющих недвижимостью, которые допустили дефолт.",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train WHERE FLAG_OWN_REALTY = 'N'",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "А сколько у нас клиентов с разным числом детей?",
    "sql": "SELECT CNT_CHILDREN, COUNT(*) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Оцените распределение клиентского портфеля по виду кредитного продукта (типу контракта).",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(*) FROM application_train_test GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_YIELD_GROUP ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажи, как число детей влияет на вероятность того, что клиент не вернет кредит.",
    "sql": "SELECT CNT_CHILDREN, AVG(TARGET) AS default_rate FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажи загрузку обработки заявок по часам дня.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните показатель DPD_DEF по POS-кредитам для действующих POS-договоров для разных значений признака «активность POS-кредита» по POS-кредитам.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите пять наиболее распространенных профессиональных групп среди нашей клиентской базы.",
    "sql": "SELECT OCCUPATION_TYPE, COUNT(SK_ID_CURR) AS count FROM application_train GROUP BY OCCUPATION_TYPE ORDER BY count DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для небольших кредитов (до 100 000) для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков уровень дефолтности для каждого типа занятости?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) AS default_rate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для уже погашенных кредитов в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой риск дефолта у работающих и пенсионеров в зависимости от их семейного положения? Можно это сравнить?",
    "sql": "SELECT NAME_FAMILY_STATUS, NAME_INCOME_TYPE, AVG(TARGET) AS default_rate FROM application_train WHERE NAME_INCOME_TYPE IN ('Working', 'Pensioner') GROUP BY NAME_FAMILY_STATUS, NAME_INCOME_TYPE ORDER BY NAME_FAMILY_STATUS, default_rate DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как тип текущей заявки связан со средним платежом по кредитной карте?",
    "sql": "SELECT at.NAME_CONTRACT_TYPE, AVG(ccb.AMT_PAYMENT_TOTAL_CURRENT) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE ccb.AMT_PAYMENT_TOTAL_CURRENT IS NOT NULL GROUP BY at.NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните показатель DPD по POS-кредитам для POS-кредитов без тяжёлых просрочек для разных значений признака «активность POS-кредита» по POS-кредитам.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте средний накопленный объём платежей по клиенту (cum_payment) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по факту просрочки платежа (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте ставку дефолта в разрезе по гендеру.",
    "sql": "SELECT CODE_GENDER, AVG(TARGET) * 100 FROM application_train_test GROUP BY CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с суммой до 100 000 и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний плановый платёж по рассрочке (AMT_INSTALMENT) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по факту платёжной дисциплины (переплата/недоплата).",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднее значение накопленного остатка по карте (cum_balance) для карт с текущими платежами (AMT_PAYMENT_CURRENT > 0) по по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) и показан среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Визуализируйте уровень просрочки (default rate) по сегментам клиентов, исходя из их семейного положения и количества детей.",
    "sql": "SELECT CNT_CHILDREN, AVG(TARGET) AS default_rate FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проведите сравнительный анализ уровня дефолтов в разрезе различных категорий источников дохода.",
    "sql": "SELECT NAME_INCOME_TYPE, AVG(TARGET) * 100 FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY AVG(TARGET) * 100 DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для второй половины клиентов по нечётности ID для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для предыдущих заявок с суммой кредита от 10 000 до 50 000 в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Выявите топ-10 заемщиков с наибольшим числом кредитных запросов за отчетный год, что может указывать на агрессивное кредитное поведение.",
    "sql": "SELECT SK_ID_CURR, AMT_REQ_CREDIT_BUREAU_YEAR FROM application_train ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова разбивка статусов одобрения поданных заявок, которые были классифицированы как микрозаймы (NFLAG_MICRO_CASH = 1)?",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application WHERE NFLAG_MICRO_CASH = 1 GROUP BY NAME_CONTRACT_STATUS",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сколько микрозаймов было среди всех прошлых заявок?",
    "sql": "SELECT COUNT(SK_ID_PREV) FROM previous_application WHERE NFLAG_MICRO_CASH = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько лет в среднем работают наши клиенты?",
    "sql": "SELECT AVG(ABS(DAYS_EMPLOYED) / 365) FROM application_train WHERE DAYS_EMPLOYED < 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество пролонгаций по кредитам из бюро для кредитных карт с установленным лимитом для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Визуализируйте долю каждого типа сопровождающих лиц в портфеле заемщиков.",
    "sql": "SELECT NAME_TYPE_SUITE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_TYPE_SUITE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте график зависимости показателя невозврата кредита от статуса владения собственностью.",
    "sql": "SELECT FLAG_OWN_REALTY, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Можем посмотреть, как менялся процент просроченных кредитов в бюро каждый месяц за последний год?",
    "sql": "SELECT MONTHS_BALANCE, CAST(SUM(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) AS overdue_percentage FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -11 AND 0 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните загрузку кредитных карт (utilization) для карт с тяжёлыми просрочками по признаку «уровень кредитного лимита», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD_DEF > 0 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Кто из наших клиентов имеет большой, но практически нетронутый кредитный лимит (свыше 500 тысяч, при балансе меньше 50 тысяч)?",
    "sql": "SELECT SK_ID_CURR, SK_ID_PREV, AMT_CREDIT_LIMIT_ACTUAL, AMT_BALANCE FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 500000 AND AMT_BALANCE < 50000 ORDER BY AMT_CREDIT_LIMIT_ACTUAL DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сопоставление среднего совокупного дохода между группами заемщиков с различным статусом погашения (дефолт/своевременная оплата).",
    "sql": "SELECT TARGET, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте график динамики среднего значения кредитного лимита, запрашиваемого в прошлых обращениях, в разрезе года принятия решения.",
    "sql": "SELECT CAST(2023 + DAYS_DECISION / 365 AS INT) AS decision_year, AVG(AMT_CREDIT) FROM previous_application GROUP BY decision_year ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Проанализируйте структуру образовательного уровня среди сегмента заемщиков, демонстрирующих кредитный дефолт (TARGET = 1).",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train WHERE TARGET = 1 GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Вычислите коэффициент дефолтности в зависимости от семейного положения для заемщиков, имеющих иждивенцев.",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(TARGET) AS DefaultRate FROM application_train WHERE CNT_CHILDREN > 0 GROUP BY NAME_FAMILY_STATUS ORDER BY DefaultRate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер первоначального взноса по предыдущим кредитам для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для одобренных предыдущих кредитов между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для клиентов, обращающихся впервые для разных категорий по признаку «тип кредитного продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажите суммарный баланс по кредитным картам для всех клиентов, у которых есть дети.",
    "sql": "SELECT SUM(ccb.AMT_BALANCE) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE at.CNT_CHILDREN > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Укажите наибольший зарегистрированный период просрочки платежей (в днях) по кредитной истории клиентов в БКИ.",
    "sql": "SELECT MAX(CREDIT_DAY_OVERDUE) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для отказанных предыдущих кредитов для разных категорий по признаку «канал продаж» в прошлых заявках клиентов.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CHANNEL_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднюю загрузку кредитных карт (utilization) по сегментам для карт с заданным кредитным лимитом (AMT_CREDIT_LIMIT_ACTUAL > 0) в разрезе по уровню кредитного лимита (high_limit/low_or_medium_limit).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Предоставьте агрегированный список по каждому клиенту с указанием общего количества его предыдущих кредитов, зарегистрированных в кредитном бюро.",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS past_credit_count FROM bureau GROUP BY SK_ID_CURR ORDER BY past_credit_count DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для карт с тратами в текущем месяце для разных групп между картами с высоким лимитом и остальными?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Существует ли возможность получить список клиентов с активными заявками, у которых также числятся активные кредиты в БКИ?",
    "sql": "SELECT DISTINCT at.SK_ID_CURR, at.AMT_CREDIT, b.CREDIT_ACTIVE, b.AMT_CREDIT_SUM_DEBT FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active' LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите общее число клиентов, обладающих более чем одним действующим кредитным обязательством, зарегистрированным в БКИ.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_loans FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING COUNT(SK_BUREAU_ID) > 1);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE) для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) в разрезе по валюте кредита (CREDIT_CURRENCY).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите долю отклоненных кредитных заявок от общего числа.",
    "sql": "SELECT CAST(SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей с просрочкой 1 месяц (STATUS = '1'), покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS = '1' GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для кредитных карт с установленным лимитом для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для POS-кредитов с количеством платежей до 6 (CNT_INSTALMENT <= 6) в разрезе по признаку активный/закрытый POS-кредит (по CNT_INSTALMENT_FUTURE).",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажите число предыдущих заявок, сгруппированное по количеству детей у клиента, для выявления потенциальных корреляций.",
    "sql": "SELECT at.CNT_CHILDREN, COUNT(pa.SK_ID_PREV) AS num_previous_applications FROM application_train at LEFT JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR GROUP BY at.CNT_CHILDREN ORDER BY at.CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для истории кредитов от года до двух лет назад между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -24 AND -13 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните величина DAYS_DECISION по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карточных записей за последние 6 месяцев (MONTHS_BALANCE > -6), покажите средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для платежей без просрочки (DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT), покажите средний фактический платёж по рассрочке (AMT_PAYMENT) по каждому значению поля CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Предоставьте перечень клиентов, чей стаж трудоустройства не превышает одного года.",
    "sql": "SELECT SK_ID_CURR, ABS(DAYS_EMPLOYED) AS Days_Employed FROM application_train WHERE DAYS_EMPLOYED > -365 AND DAYS_EMPLOYED < 0 LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для кредитов, по которым задан аннуитетный платёж для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов с известной датой закрытия для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице installments_payments рассчитайте среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) для первых трёх платежей в графике (NUM_INSTALMENT_NUMBER <= 3) в разрезе по факту платёжной дисциплины (переплата/недоплата).",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте график динамики среднего значения AMT_ANNUITY для кредитов со статусом 'Approved' за трехлетний период.",
    "sql": "SELECT CAST(ABS(DAYS_DECISION) / 365 AS INT) AS decision_year, AVG(AMT_ANNUITY) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND DAYS_DECISION >= -1095 GROUP BY decision_year ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Определите среднюю сумму авансового платежа для акцептованных кредитов из исторического портфеля.",
    "sql": "SELECT AVG(AMT_DOWN_PAYMENT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND AMT_DOWN_PAYMENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте таблицу со сведениями о заемщиках с высоким кредитным риском (TARGET=1), включая их доход, сумму кредита, образование и возраст.",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT, NAME_EDUCATION_TYPE, DAYS_BIRTH FROM application_train WHERE TARGET = 1 LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Прошу предоставить статистику одобрений и отказов по дням недели для предыдущих кредитных заявок.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS approved_count, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS refused_count FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY approved_count DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для прошлых заявок, принятых более года назад между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково процентное соотношение одобрений, отказов и отмен по всем поданным заявкам?",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для действующих POS-договоров между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для клиентов, которые уже брали кредит ранее между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «канал продаж» в прошлых заявках клиентов.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY CHANNEL_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Предоставьте перечень десяти клиентов с наивысшим совокупным доходом.",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL FROM application_train ORDER BY AMT_INCOME_TOTAL DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните значение DAYS_ENTRY_PAYMENT для платежей, внесённых вовремя или раньше срока для разных значений признака «своевременность платежей» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Предоставьте метрику, отражающую общее число уникальных держателей кредитных карт, имеющих записи о балансе.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите суммарный объем одобренных кредитов, сгруппированный по виду договора.",
    "sql": "SELECT NAME_CONTRACT_TYPE, SUM(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) и по каждому значению группировки (CREDIT_TYPE) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите средний уровень общего дохода для заемщиков, допустивших дефолт.",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество одобренных заявок по гендерному признаку.",
    "sql": "SELECT CODE_GENDER, COUNT(SK_ID_CURR) FROM application_train_test WHERE CODE_GENDER IN ('M', 'F') GROUP BY CODE_GENDER",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "На джойне POS_CASH_balance и installments_payments рассчитайте среднюю долю просроченных платежей по POS-кредитам (late_flag) для POS-записей за последний год (pos.MONTHS_BALANCE > -12) в разрезе по типу платежного поведения клиента по POS-кредиту.",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE pos.MONTHS_BALANCE > -12 ) SELECT CASE WHEN ip.AMT_PAYMENT >= ip.AMT_INSTALMENT THEN 'on_time_or_overpay' ELSE 'underpay_or_missing' END AS group_key, AVG(late_flag) AS metric_value FROM pos_inst GROUP BY CASE WHEN ip.AMT_PAYMENT >= ip.AMT_INSTALMENT THEN 'on_time_or_overpay' ELSE 'underpay_or_missing' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова средняя сумма поданных заявок для кредитов с разным статусом (одобрено/отклонено)?",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(AMT_APPLICATION) AS avg_application_amount FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните задержка платежа в днях для клиентов, которые уже ранее брали кредит между сегментами по признаку «канал оформления кредита» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT CHANNEL_TYPE AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с DPD > 0 и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков средний возраст дефолтных заемщиков?",
    "sql": "SELECT AVG(-DAYS_BIRTH / 365.25) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для кредитов, по которым задан аннуитетный платёж для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для небольших кредитов (до 100 000) для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие 10 причин люди чаще всего указывали для получения кредита раньше?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(*) FROM previous_application WHERE NAME_CASH_LOAN_PURPOSE != 'XNA' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(*) DESC LIMIT 10;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какие самые крупные заявки были отклонены, и какие были указаны причины отказа по этим кейсам?",
    "sql": "SELECT SK_ID_CURR, AMT_APPLICATION, CODE_REJECT_REASON, NAME_CASH_LOAN_PURPOSE FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' ORDER BY AMT_APPLICATION DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для предыдущих заявок примерно за последний год для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер первоначального взноса по предыдущим кредитам для решений, принятых за последний год (DAYS_DECISION > -365) в разрезе по каналу продаж (CHANNEL_TYPE).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для завершённых POS-договоров (NAME_CONTRACT_STATUS = 'Completed') и показан среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) по каждому значению NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Completed' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Посчитайте уникальные идентификаторы клиентов из таблицы credit_card_balance.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте график среднего количества дней от подачи до решения по предыдущим заявкам (DAYS_DECISION) для каждого семейного статуса.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(ABS(pa.DAYS_DECISION)) AS avg_days_decision FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) и показан среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Выведи топ-10 клиентов с максимальным числом запросов в БКИ за прошедший год.",
    "sql": "SELECT SK_ID_CURR, AMT_REQ_CREDIT_BUREAU_YEAR FROM application_train WHERE AMT_REQ_CREDIT_BUREAU_YEAR IS NOT NULL ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для одобренных предыдущих кредитов для разных категорий по признаку «тип кредитного продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для предыдущих заявок с суммой кредита более 50 000 в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните разницу между фактическим и плановым платёжом по рассрочке для первого года рассрочки при ежемесячных платежах по признаку «факт просрочки», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте среднее значение текущих снятий наличных через банкоматы (AMT_DRAWINGS_ATM_CURRENT) по категориям семейного положения.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(cc.AMT_DRAWINGS_ATM_CURRENT) FROM application_train at JOIN credit_card_balance cc ON at.SK_ID_CURR = cc.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY AVG(cc.AMT_DRAWINGS_ATM_CURRENT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по статусу договора (NAME_CONTRACT_STATUS) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер первоначального взноса по предыдущим кредитам для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сколько наших клиентов сейчас имеют действующие кредиты, по данным БКИ?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как менялось среднее число дней просрочки по кредитам из бюро за последние 12 месяцев?",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(JULIANDAY('now'), '-' || MONTHS_BALANCE || ' months')) AS balance_month, AVG(CREDIT_DAY_OVERDUE) FROM bureau AS b JOIN bureau_balance AS bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.MONTHS_BALANCE BETWEEN -12 AND 0 GROUP BY balance_month ORDER BY balance_month DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Идентифицируйте пятерку клиентов с максимальным совокупным объемом текущей задолженности по кредитным картам.",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_TOTAL_RECEIVABLE) AS total_receivable FROM credit_card_balance GROUP BY SK_ID_CURR ORDER BY total_receivable DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднее значение задержки платежа в днях (delay_days) по рассрочкам для фактически оплаченных записей (AMT_PAYMENT > 0) по по версии графика платежей (NUM_INSTALMENT_VERSION).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте диаграмму дефолтов по возрастным группам: до 30, 30-50, 50+ лет.",
    "sql": "SELECT CASE WHEN ABS(DAYS_BIRTH)/365.25 < 30 THEN 'до 30' WHEN ABS(DAYS_BIRTH)/365.25 BETWEEN 30 AND 50 THEN '30-50' ELSE '50+' END AS age_group, AVG(TARGET) AS default_rate FROM application_train GROUP BY age_group ORDER BY age_group;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите общее число уникальных клиентов, владеющих кредитными картами.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем платят по кредиткам те, кто всегда вовремя погашает долги?",
    "sql": "SELECT AVG(c.AMT_PAYMENT_TOTAL_CURRENT) AS avg_payment FROM application_train a JOIN credit_card_balance c ON a.SK_ID_CURR = c.SK_ID_CURR WHERE a.TARGET = 0 AND c.AMT_PAYMENT_TOTAL_CURRENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте график динамики количества предыдущих кредитных заявок в разрезе лет с момента принятия решения.",
    "sql": "SELECT CAST(ABS(DAYS_DECISION)/365.25 AS INTEGER) AS years_ago, COUNT(SK_ID_PREV) AS application_count FROM previous_application GROUP BY years_ago ORDER BY years_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какова средняя сумма кредита у тех, кто дефолтит, и у тех, кто не дефолтит?",
    "sql": "SELECT TARGET, AVG(AMT_CREDIT) FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с DPD > 0 и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте сегментацию предыдущих заявок по категории продукта (NAME_CONTRACT_TYPE).",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для старой активности по картам в разрезе признака «тип поведения по карте» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для активности по картам за последние полгода для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков процент дефолта в разрезе пола заемщиков?",
    "sql": "SELECT CODE_GENDER, AVG(TARGET) * 100 FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков текущий уровень дефолтов в нашем кредитном портфеле в целом?",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов, по которым задан аннуитетный платёж в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для последующих платежей (NUM_INSTALMENT_NUMBER > 3), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля SK_ID_PREV.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY SK_ID_PREV ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте список клиентов с наивысшим совокупным уровнем задолженности, зафиксированным в БКИ.",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_CREDIT_SUM_DEBT) AS total_debt FROM bureau GROUP BY SK_ID_CURR ORDER BY total_debt DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с лимитом до 50 000, покажите средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Вычислите метрику, показывающую общий объем долга по данным БКИ для всех дефолтных клиентов.",
    "sql": "SELECT SUM(T2.AMT_CREDIT_SUM_DEBT) FROM application_train AS T1 JOIN bureau AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T1.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется показатель DPD_DEF по POS-кредитам для действующих POS-договоров между разными категориями по разным месяцам наблюдения POS-кредитов?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Оцените уровень дефолтности в зависимости от статуса активных кредитов в БКИ.",
    "sql": "SELECT b.CREDIT_ACTIVE, AVG(a.TARGET) AS default_rate FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR GROUP BY b.CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Отобразите среднюю сумму непогашенной задолженности по предыдущим займам из БКИ для клиентов-дефолтеров.",
    "sql": "SELECT AVG(b.AMT_CREDIT_SUM_DEBT) FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE a.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализируйте и визуализируйте средний уровень дефолта (TARGET) по каждому типу занятости (OCCUPATION_TYPE), чтобы выявить группы повышенного риска для кредитного скоринга.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) FROM application_train GROUP BY OCCUPATION_TYPE ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков процент невозврата среди тех, кто брал прошлые кредиты на 'XNA' цель?",
    "sql": "SELECT AVG(a.TARGET) AS default_rate FROM application_train a JOIN previous_application p ON a.SK_ID_CURR = p.SK_ID_CURR WHERE p.NAME_CASH_LOAN_PURPOSE = 'XNA';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте график количества заявок в каждый час, разбив по статусу обработки (одобрено/отказано).",
    "sql": "SELECT HOUR_APPR_PROCESS_START, NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY HOUR_APPR_PROCESS_START, NAME_CONTRACT_STATUS ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для пролонгированных кредитов (CNT_CREDIT_PROLONG > 0) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для POS-операций примерно за последние полгода для разных значений признака «наличие просрочки по POS» по POS-кредитам.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 для разных категорий по признаку «группа доходности продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково процентное соотношение клиентов по типам кредитных контрактов?",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните значение DAYS_ENTRY_PAYMENT для платежей, внесённых вовремя или раньше срока для разных значений признака «предыдущий кредит» в платёжной истории клиентов.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY SK_ID_PREV ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам в бюро для месяцев без нарушений условий кредита в разрезе признака «давность записи» по истории кредитов из бюро.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS IN ('0','C') GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определи пять ключевых категорий целей кредитования с наибольшим числом поступивших запросов, чтобы оценить спрос на продукт.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(SK_ID_PREV) AS ApplicationCount FROM previous_application WHERE NAME_CASH_LOAN_PURPOSE IS NOT NULL AND NAME_CASH_LOAN_PURPOSE != 'XNA' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY ApplicationCount DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для кредитов с нечётным SK_BUREAU_ID в разрезе по идентификатору кредита в бюро (SK_BUREAU_ID).",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE SK_BUREAU_ID % 2 = 1 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите суммарное число зарегистрированных заявок.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с просрочкой по DPD (SK_DPD > 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с заполненным аннуитетом (AMT_ANNUITY IS NOT NULL) и по каждому значению группировки (CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, открытых за последний год (DAYS_CREDIT > -365) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каковы основные цели, на которые были одобрены предыдущие кредиты, и каков объем средств по каждой из них?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, SUM(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY SUM(AMT_APPLICATION) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните размер планового платежа по рассрочке для рассрочек, по которым есть плановый платёж для разных значений признака «клиент» в платёжной истории клиентов.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_INSTALMENT > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для более старых карточных записей (MONTHS_BALANCE < -12) в разрезе по клиенту (SK_ID_CURR) с агрегацией по картам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для кредитных карт с высоким лимитом для разных групп между клиентами по их карточной активности?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 50000 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Идентифицируйте и представьте топ-3 драйвера отказов в кредитовании.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) AS refusal_count FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY refusal_count DESC LIMIT 3;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как меняется средняя сумма кредита у клиентов в зависимости от того, активны у них старые кредиты или уже закрыты в БКИ?",
    "sql": "SELECT b.CREDIT_ACTIVE, AVG(at.AMT_CREDIT) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY b.CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для POS-кредитов с количеством платежей до 6 (CNT_INSTALMENT <= 6) в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для просроченных платежей (DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля NUM_INSTALMENT_NUMBER.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какие клиенты имеют действующие просроченные кредиты в БКИ, и каков их совокупный текущий долг (AMT_CREDIT_SUM_DEBT)?",
    "sql": "SELECT b.SK_ID_CURR, b.AMT_CREDIT_SUM_DEBT FROM bureau b WHERE b.CREDIT_DAY_OVERDUE > 0 AND b.AMT_CREDIT_SUM_DEBT > 0 ORDER BY b.AMT_CREDIT_SUM_DEBT DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Общий уровень дефолтов по всей клиентской базе.",
    "sql": "SELECT AVG(TARGET) FROM application_train_test;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Представьте детализацию статусов CREDIT_ACTIVE по сегментам TARGET для оценки кредитного риска.",
    "sql": "SELECT at.TARGET, b.CREDIT_ACTIVE, COUNT(DISTINCT at.SK_ID_CURR) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.TARGET, b.CREDIT_ACTIVE;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите средний уровень дохода для мужской когорты заемщиков, столкнувшихся с дефолтом.",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) AS avg_income FROM application_train WHERE CODE_GENDER = 'M' AND TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для прошлых заявок, принятых более года назад между клиентами между отраслями продавцов, через которых оформлялись кредиты?",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Идентифицируйте десятку ведущих клиентов по числу обращений в БКИ за отчетный годовой период.",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT, AMT_REQ_CREDIT_BUREAU_YEAR FROM application_train ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажи, как распределены типы жилья у наших клиентов.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество пролонгаций по кредитам из бюро для кредитов, которые пролонгировались для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Отобразите распределение клиентов в соответствии с текущим статусом их кредитов, зарегистрированных в БКИ.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_ID_CURR) AS client_count FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без просрочки по DPD (SK_DPD = 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните показатель DPD_DEF по POS-кредитам для POS-кредитов с просрочкой для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните накопленный остаток по карте для карт с тяжёлыми просрочками по признаку «клиент», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD_DEF > 0 ) SELECT SK_ID_CURR AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для повторных клиентов (pa.NAME_CLIENT_TYPE = 'Repeater') сгруппирует данные по типу кредитного продукта (pa.NAME_CONTRACT_TYPE) и рассчитает средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова общая сумма микрозаймов, которые были одобрены?",
    "sql": "SELECT SUM(AMT_APPLICATION) FROM previous_application WHERE NFLAG_MICRO_CASH = 1 AND NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для кредитов, по которым задан аннуитетный платёж в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Изучите статус предыдущих кредитных запросов.",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Выведите средний чек по товарам в кредитных договорах у клиентов с негативным платежным поведением.",
    "sql": "SELECT AVG(AMT_GOODS_PRICE) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажи, сколько кредитов мы выдавали каждый месяц, только те, что одобрили.",
    "sql": "SELECT DATE_FORMAT(DATE_ADD(CURRENT_DATE, INTERVAL DAYS_DECISION DAY), '%Y-%m') AS month_decision, SUM(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY month_decision ORDER BY month_decision;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Определите медианное значение кредитного лимита.",
    "sql": "SELECT PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем денег запрашивали в БКИ за год те клиенты, которые потом не вернули кредит?",
    "sql": "SELECT AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train WHERE TARGET = 1",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для POS-кредитов без просрочки (SK_DPD = 0) в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какие клиенты демонстрируют наивысшую агрегированную задолженность в кредитных бюро?",
    "sql": "SELECT a.SK_ID_CURR, SUM(b.AMT_CREDIT_SUM_DEBT) AS Total_Bureau_Debt FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.AMT_CREDIT_SUM_DEBT IS NOT NULL GROUP BY a.SK_ID_CURR ORDER BY Total_Bureau_Debt DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 между клиентами между отраслями продавцов, через которых оформлялись кредиты?",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для просроченных платежей (DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY SK_ID_CURR ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для платежей, превышающих плановый размер (AMT_PAYMENT > AMT_INSTALMENT), покажите среднее количество дней до фактической даты платежа (DAYS_ENTRY_PAYMENT) по каждому значению поля CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE AMT_PAYMENT > AMT_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Идентифицируйте клиентов, которые в настоящее время подали заявку и имеют активные кредитные обязательства в Бюро кредитных историй.",
    "sql": "SELECT DISTINCT at.SK_ID_CURR, at.AMT_CREDIT, b.CREDIT_ACTIVE, b.AMT_CREDIT_SUM_DEBT FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active' LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Вычислите уровень дефолта для заемщиков, у которых зафиксировано более пяти запросов в кредитное бюро за последний год, как индикатор потенциального риска.",
    "sql": "SELECT AVG(TARGET) FROM application_train WHERE AMT_REQ_CREDIT_BUREAU_YEAR > 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте показатели дефолтов, сегментированные по образованию и наличию недвижимости у заемщиков.",
    "sql": "SELECT NAME_EDUCATION_TYPE, FLAG_OWN_REALTY, AVG(TARGET) FROM application_train GROUP BY NAME_EDUCATION_TYPE, FLAG_OWN_REALTY ORDER BY NAME_EDUCATION_TYPE, FLAG_OWN_REALTY;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "А сколько в среднем лет нашим клиентам с разным образованием?",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(ABS(DAYS_BIRTH)/365) AS average_age FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY average_age DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько дней максимально кто-то просрочил платеж по кредиту в БКИ?",
    "sql": "SELECT MAX(CREDIT_DAY_OVERDUE) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для POS-кредитов без тяжёлых просрочек между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по дню недели принятия решения (WEEKDAY_APPR_PROCESS_START).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя накопленный остаток по карте для карт, по которым клиент сейчас тратит средства для разных сегментов между активными, закрытыми и другими статусами договоров по картам с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните размер одобренного кредита по предыдущим заявкам для отказанных предыдущих кредитов для разных категорий по признаку «группа доходности продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте распределение клиентской базы по семейному положению.",
    "sql": "SELECT NAME_FAMILY_STATUS, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для старой активности по картам в разрезе признака «статус договора по карте» по кредитным картам клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представь распределение прошлых заявок по их статусам.",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Какие временные интервалы в течение суток демонстрируют наибольшую активность в подаче кредитных запросов?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(*) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без текущего остатка (AMT_BALANCE = 0), покажите средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) по каждому значению поля CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с максимальной просрочкой больше нуля (AMT_CREDIT_MAX_OVERDUE > 0) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определить уровень просроченной задолженности в зависимости от типа владения жильем.",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(TARGET) * 100 AS Default_Rate FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY Default_Rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как семейное положение влияет на средний заработок наших заемщиков?",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(AMT_INCOME_TOTAL) AS AverageIncome FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY AverageIncome DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько процентов наших клиентов владеют своей недвижимостью?",
    "sql": "SELECT (COUNT(CASE WHEN FLAG_OWN_REALTY = 'Y' THEN 1 END) * 100.0 / COUNT(*)) FROM application;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для кредитов, открытых более года назад в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднее значение накопленного остатка по карте (cum_balance) для карт с ненулевым остатком (AMT_BALANCE > 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_BALANCE > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля HOUR_APPR_PROCESS_START показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните размер кредита по данным бюро для кредитов, по которым ещё не наступил конец срока в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите среднее значение действующего кредитного лимита по портфелю кредитных карт.",
    "sql": "SELECT AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по типу продукта (NAME_PRODUCT_TYPE).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Идентифицируйте десятку ведущих клиентов по совокупному объему одобренных кредитов, учитывая их предыдущие заявки.",
    "sql": "SELECT at.SK_ID_CURR, SUM(pa.AMT_CREDIT) as total_previous_credit FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY at.SK_ID_CURR ORDER BY total_previous_credit DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем дней уже висят активные кредиты по БКИ?",
    "sql": "SELECT AVG(ABS(DAYS_CREDIT)) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каково соотношение различных видов дохода среди наших клиентов?",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова средняя продолжительность занятости для заемщиков, допустивших дефолт, по сравнению с теми, кто его избежал?",
    "sql": "SELECT TARGET, AVG(ABS(DAYS_EMPLOYED)/365) AS avg_years_employed FROM application_train WHERE DAYS_EMPLOYED < 0 GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Отобразите помесячную динамику среднего баланса по кредитным картам для разных групп семейного положения за последний год.",
    "sql": "SELECT cc.MONTHS_BALANCE, at.NAME_FAMILY_STATUS, AVG(cc.AMT_BALANCE) AS avg_balance FROM credit_card_balance cc JOIN application_train at ON cc.SK_ID_CURR = at.SK_ID_CURR WHERE cc.MONTHS_BALANCE BETWEEN -12 AND 0 GROUP BY cc.MONTHS_BALANCE, at.NAME_FAMILY_STATUS ORDER BY cc.MONTHS_BALANCE, at.NAME_FAMILY_STATUS;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Покажи нам средний общий доход клиентов, у которых в собственности есть автомобиль.",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) FROM application_train WHERE FLAG_OWN_CAR = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оцените среднюю долговую нагрузку из БКИ (AMT_CREDIT_SUM_DEBT) для каждой группы занятости в рамках анализа кредитного портфеля.",
    "sql": "SELECT at.OCCUPATION_TYPE, AVG(b.AMT_CREDIT_SUM_DEBT) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.OCCUPATION_TYPE ORDER BY AVG(b.AMT_CREDIT_SUM_DEBT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните среднюю по клиенту задержку платежей для клиентов, которые уже ранее брали кредит между сегментами по признаку «тип клиента» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Перечень клиентов с множественными активными кредитными обязательствами в БКИ и их целевой индикатор.",
    "sql": "SELECT at.SK_ID_CURR, at.TARGET, COUNT(b.SK_BUREAU_ID) AS active_bureau_credits FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY at.SK_ID_CURR, at.TARGET HAVING COUNT(b.SK_BUREAU_ID) > 1",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как менялись статусы кредитов в БКИ месяц за месяцем в течение последнего года?",
    "sql": "SELECT STRFTIME('%Y-%m', DATE('now', MONTHS_BALANCE || ' months')) AS month_year, STATUS, COUNT(SK_BUREAU_ID) FROM bureau_balance WHERE MONTHS_BALANCE >= -12 GROUP BY month_year, STATUS ORDER BY month_year, STATUS;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как распределяется значение MONTHS_BALANCE по кредитам в бюро для месяцев с тяжёлыми просрочками между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS IN ('3','4','5') GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте пропорциональное распределение клиентов в зависимости от наличия в собственности недвижимости.",
    "sql": "SELECT FLAG_OWN_REALTY, COUNT(SK_ID_CURR) AS client_count FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте график тренда среднего показателя просрочки по кредитам из БКИ по месяцам.",
    "sql": "SELECT MONTHS_BALANCE, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS Overdue_Ratio FROM bureau_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какой процент клиентов не платят по кредитам в зависимости от того, где они работают?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) FROM application_train_test WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по каналу продаж (CHANNEL_TYPE).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY CHANNEL_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите общий объем доступных лимитов по текущим кредитам, отраженным в кредитных бюро.",
    "sql": "SELECT SUM(AMT_CREDIT_SUM) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова агрегированная величина доходов заемщиков, подтвердивших наличие собственной недвижимости?",
    "sql": "SELECT SUM(AMT_INCOME_TOTAL) FROM application_train WHERE FLAG_OWN_REALTY = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выявите пять профессиональных категорий с наибольшим суммарным доходом клиентов.",
    "sql": "SELECT OCCUPATION_TYPE, SUM(AMT_INCOME_TOTAL) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY SUM(AMT_INCOME_TOTAL) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проанализировать средний кредитный лимит в зависимости от наличия в собственности недвижимости.",
    "sql": "SELECT FLAG_OWN_REALTY, AVG(AMT_CREDIT) FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднюю загрузку кредитных карт (utilization) по сегментам для записей за последний год (MONTHS_BALANCE > -12) по по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE > -12 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для истории кредитов от полугода до года назад в разрезе признака «кредит из бюро» по истории кредитов из бюро.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для POS-кредитов с DPD_DEF > 0 в разрезе по месяцу отчётности (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сгруппируйте и отобразите численность клиентов для каждого типа образования, начиная с наибольшего.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Исследуйте помесячную динамику среднего фактического размера платежа по кредитным картам.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE AMT_PAYMENT_TOTAL_CURRENT IS NOT NULL GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с заполненным аннуитетом (AMT_ANNUITY IS NOT NULL) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется значение MONTHS_BALANCE по кредитам в бюро для месяцев с небольшими просрочками между разными категориями между разными статусами состояния кредита в разрезе месяцев?",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS IN ('1','2') GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как менялась средняя сумма кредитов, которые мы выдавали, месяц за месяцем?",
    "sql": "SELECT CAST(ABS(DAYS_DECISION) / 30 AS INT) AS months_ago, AVG(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY months_ago ORDER BY months_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для кредитов с заполненным аннуитетом (AMT_ANNUITY IS NOT NULL) в разрезе по валюте кредита (CREDIT_CURRENCY).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отобразите структуру типов контрактов по всем предыдущим кредитным заявкам.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(*) FROM previous_application GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Можем ли мы увидеть, кто из клиентов платит по кредитной карте меньше, чем требуется минимально?",
    "sql": "SELECT SK_ID_CURR, SK_ID_PREV, AMT_PAYMENT_CURRENT, AMT_INST_MIN_REGULARITY FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT < AMT_INST_MIN_REGULARITY AND AMT_PAYMENT_CURRENT IS NOT NULL AND AMT_INST_MIN_REGULARITY IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какой день недели наиболее активен по количеству поступающих предыдущих заявок?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер фактического платежа по рассрочке для случаев переплаты по рассрочке между разными группами между разными номерами платежей в графике рассрочки?",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_PAYMENT > AMT_INSTALMENT GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита более 50 000 и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите количество отклоненных заявок с кодом причины 'CLIENT' для оценки эффективности скоринговой модели.",
    "sql": "SELECT COUNT(*) FROM previous_application WHERE CODE_REJECT_REASON = 'CLIENT';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните размер кредита по данным бюро для кредитов, по которым ещё не наступил конец срока в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте гистограмму распределения клиентов по числу запросов в кредитное бюро за последний год.",
    "sql": "SELECT AMT_REQ_CREDIT_BUREAU_YEAR, COUNT(SK_ID_CURR) FROM application_train GROUP BY AMT_REQ_CREDIT_BUREAU_YEAR ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какие топ-5 профессий имеют наименьший показатель дефолтности?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) AS default_rate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY default_rate ASC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите распределение типов кредитных контрактов по ранее поданным заявкам.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Определите метрику, показывающую долю дефолтных заемщиков, демонстрирующих высокую просрочку (свыше 60 дней) по данным БКИ.",
    "sql": "SELECT CAST(COUNT(DISTINCT app.SK_ID_CURR) AS REAL) * 100 / (SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train WHERE TARGET = 1) FROM application_train app JOIN bureau b ON app.SK_ID_CURR = b.SK_ID_CURR WHERE app.TARGET = 1 AND b.CREDIT_DAY_OVERDUE > 60;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите, как изменяется процент дефолтов в зависимости от часа, когда была начата обработка заявки.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, CAST(SUM(CASE WHEN TARGET = 1 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Покажи, как распределены наши клиенты по тому, где они живут: квартира, дом, общежитие и так далее.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_HOUSING_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для завершённых POS-договоров (NAME_CONTRACT_STATUS = 'Completed') и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Completed' GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте гистограмму, показывающую распределение количества заявок по типам образования.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните накопленный объём платежей по клиенту для условной половины клиентов по чётности ID по признаку «факт просрочки», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте совокупную задолженность по всем бюро-кредитам для клиентов, у которых в данный момент есть активный кредит.",
    "sql": "SELECT SUM(b.AMT_CREDIT_SUM_DEBT) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализировать и представить долевое распределение клиентов по категории их источников дохода.",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_INCOME_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как клиенты распределяются по образованию? Можно посмотреть?",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS Number_of_Clients FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY Number_of_Clients DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как различается долю месяцев с просрочкой по кредитам для кредитов, которые уже погашены между различными сегментами между активными и закрытыми кредитами по данным бюро кредитных историй?",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Closed' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_ACTIVE AS group_key, AVG(bad_month_share) AS metric_value FROM bb_agg GROUP BY CREDIT_ACTIVE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как соотносятся различные статусы кредитов (например, \"Active\", \"Closed\") в базе БКИ?",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(*) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте средний накопленный объём платежей по клиенту (cum_payment) для фактически оплаченных записей (AMT_PAYMENT > 0) в разрезе по сегментам номера платежа (early/middle/late).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для закрытых кредитов (CREDIT_ACTIVE = 'Closed') и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для карт без просрочек в разрезе признака «уровень кредитного лимита» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов, по которым ещё не наступил конец срока в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для более старых карточных записей (MONTHS_BALANCE < -12), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой сейчас средний лимит по нашим кредитным картам?",
    "sql": "SELECT AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оцените средний коэффициент утилизации кредитного лимита по карточному портфелю.",
    "sql": "SELECT AVG(AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL) * 100 FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для новых клиентов (NAME_CLIENT_TYPE = 'New') и по каждому значению поля NAME_SELLER_INDUSTRY показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднюю загрузку кредитных карт (utilization) по сегментам для карт с тяжёлой просрочкой по DPD_DEF (SK_DPD_DEF > 0) в разрезе по месяцу истории по карте (MONTHS_BALANCE).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD_DEF > 0 ) SELECT MONTHS_BALANCE AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите количество заемщиков с дефолтными признаками в БКИ, характеризующимися просрочкой свыше 90 дней.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_DAY_OVERDUE > 90;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер фактического платежа по рассрочке для платежей, которые были действительно внесены между разными группами между разными кредитами клиента?",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY SK_ID_PREV ORDER BY avg_amt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Исследуйте уровень дефолтности для сегментов клиентов, осуществлявших запросы в БКИ в течение последнего года, и тех, кто их не делал.",
    "sql": "SELECT CASE WHEN AMT_REQ_CREDIT_BUREAU_YEAR > 0 THEN 'Requested Bureau' ELSE 'No Bureau Request' END AS BureauRequest, AVG(TARGET) AS default_rate FROM application_train GROUP BY BureauRequest;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Отобразите суммарную задолженность клиентов по всем активным кредитам из БКИ.",
    "sql": "SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проведите сравнительный анализ дефолтного поведения клиентов с собственностью и без.",
    "sql": "SELECT FLAG_OWN_REALTY, AVG(TARGET) FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Оцените уровень дефолтного риска (дефолт рейт) для сегмента клиентов с количеством членов семьи, превышающим двух.",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train WHERE CNT_FAM_MEMBERS > 2;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните долю просроченных платежей по рассрочке для рассрочек с реальным графиком платежей по признаку «клиент», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT SK_ID_CURR AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя долю просроченных платежей для начальных платежей по кредиту для разных групп клиентов между новыми, повторными и лояльными клиентами, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, открытых за последний год (DAYS_CREDIT > -365) и по каждому значению группировки (CREDIT_TYPE) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднюю годовую частоту запросов в кредитное бюро.",
    "sql": "SELECT AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажи доли различных типов образования среди всех клиентов.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как выглядят доли клиентов в зависимости от их типа пакета услуг?",
    "sql": "SELECT NAME_TYPE_SUITE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_TYPE_SUITE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих платежей по картам для карт, по которым есть просрочка в разрезе признака «уровень кредитного лимита» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте корреляцию между уровнем образования клиента и вероятностью дефолта.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выведите таблицу клиентов с активными долгами в БКИ, указав их ID и суммарный долг.",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_CREDIT_SUM_DEBT) AS total_debt FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND AMT_CREDIT_SUM_DEBT > 0 GROUP BY SK_ID_CURR HAVING SUM(AMT_CREDIT_SUM_DEBT) > 0 ORDER BY total_debt DESC",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для клиентов, обращающихся впервые между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков уровень невозврата кредитов среди клиентов, чей трудовой стаж не превышает пяти лет?",
    "sql": "SELECT CAST(SUM(CASE WHEN TARGET = 1 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train WHERE ABS(DAYS_EMPLOYED) / 365.25 < 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выявите заемщиков с повышенной кредитной нагрузкой, имеющих мультиактивные кредитные контракты в БКИ, и агрегируйте их общие долговые обязательства.",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_credits_count, SUM(AMT_CREDIT_SUM_DEBT) AS total_debt FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING COUNT(SK_BUREAU_ID) > 1 ORDER BY total_debt DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 для разных категорий по признаку «тип кредитного продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для второй условной половины клиентов (по нечётности ID) для разных значений признака «статус POS-договора» по POS-кредитам.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите средневзвешенную стоимость активов, финансированных через одобренные кредитные заявки.",
    "sql": "SELECT AVG(AMT_GOODS_PRICE) AS avg_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднюю долю месяцев с просрочкой по картам (SK_DPD > 0) для записей за последний год (MONTHS_BALANCE > -12) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE > -12 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CASE WHEN SK_DPD > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднее значение накопленного остатка по карте (cum_balance) для карт с ненулевым остатком (AMT_BALANCE > 0) в разрезе по уровню загрузки лимита utilization (high/medium/low).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_BALANCE > 0 ) SELECT CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для условной половины клиентов по чётности ID для разных групп между клиентами по их карточной активности?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для клиентов, обращающихся впервые для разных категорий по признаку «тип портфеля» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова тенденция изменения средней суммы одобренных заявок по мере увеличения дней, прошедших с даты принятия решения?",
    "sql": "SELECT ABS(DAYS_DECISION) AS days_since_decision, AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY ABS(DAYS_DECISION) ORDER BY ABS(DAYS_DECISION) ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Определите пиковые часы обработки клиентских заявок.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(*) FROM application_train_test GROUP BY HOUR_APPR_PROCESS_START ORDER BY COUNT(*) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей за предыдущий месяц (MONTHS_BALANCE = -1), покажите долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро по каждому значению поля группировки SK_BUREAU_ID.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE = -1 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите метрику по количеству выданных и одобренных займов за последний 30-дневный период.",
    "sql": "SELECT COUNT(SK_ID_PREV) FROM previous_application WHERE DAYS_DECISION >= -30 AND NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков средний демографический показатель по количеству детей у дефолтных заемщиков?",
    "sql": "SELECT AVG(CNT_CHILDREN) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Отобразите процент дефолтных случаев для каждого типа дохода заемщиков.",
    "sql": "SELECT NAME_INCOME_TYPE, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY DefaultRate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам в бюро для месяцев без просрочек в разрезе признака «кредит из бюро» по истории кредитов из бюро.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS = '0' GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется задержку платежа по рассрочкам для второй половины клиентов по чётности ID между различными сегментами между клиентами с низким, средним и высоким совокупным объёмом платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие 5 профессий чаще всего \"пролетают\" с платежами?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) * 100 AS Default_Rate, COUNT(SK_ID_CURR) AS Total_Applications FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL AND OCCUPATION_TYPE != 'XNA' GROUP BY OCCUPATION_TYPE HAVING COUNT(SK_ID_CURR) > 100 ORDER BY Default_Rate DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднее значение задержки платежа в днях (delay_days) по рассрочкам для первых 12 платежей в графике в разрезе по уровню накопленных платежей cum_payment (low/medium/high).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какой средний срок просрочки наблюдается по активным кредитам, имеющим задолженность в БКИ?",
    "sql": "SELECT AVG(CREDIT_DAY_OVERDUE) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем детей у тех, кто не смог выплатить кредит?",
    "sql": "SELECT AVG(CNT_CHILDREN) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для сравнительно новых кредитов для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Можете показать, сколько кредитов мы выдали в каждый из последних 30 дней перед тем, как приняли решение по этой заявке?",
    "sql": "SELECT ABS(DAYS_DECISION) AS days_before_decision, SUM(AMT_CREDIT) FROM previous_application WHERE DAYS_DECISION BETWEEN -30 AND -1 GROUP BY days_before_decision ORDER BY days_before_decision;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Анализ распределения количества обработанных кредитных заявок по дням недели.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(*) FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY COUNT(*) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Можете ли вы показать топ-10 клиентов с максимальной кредитной нагрузкой по данным БКИ?",
    "sql": "SELECT T1.SK_ID_CURR, SUM(T2.AMT_CREDIT_SUM_DEBT) AS total_debt FROM application_train T1 JOIN bureau T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR GROUP BY T1.SK_ID_CURR ORDER BY total_debt DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько заявок мы получаем в каждый конкретный час дня?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей без фактического платежа (AMT_PAYMENT = 0), покажите средний плановый платёж по рассрочке (AMT_INSTALMENT) по каждому значению поля CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT = 0 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) для карт с серьёзной просрочкой по DPD_DEF (SK_DPD_DEF > 0) в разрезе по месяцу отчётности по карте (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD_DEF > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю долю просроченных платежей (delay_days > 0) для новых клиентов (pa.NAME_CLIENT_TYPE = 'New') в разрезе по каналу продаж (pa.CHANNEL_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT CHANNEL_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов с просрочкой в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой процент клиентов с активным долгом по кредитке уходят в дефолт?",
    "sql": "SELECT AVG(at.TARGET) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE ccb.AMT_BALANCE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите текущий уровень дефолтности по кредитному портфелю.",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train_test",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните размер одобренного кредита по предыдущим заявкам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «тип клиента» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита более 50 000 и по каждому значению поля NAME_PORTFOLIO показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_PORTFOLIO ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитов, по которым уже была просрочка (CREDIT_DAY_OVERDUE > 0) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита от 10 000 до 50 000 и по каждому значению поля NAME_CONTRACT_TYPE показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для более старых POS-записей (MONTHS_BALANCE < -12) в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите общее число уникальных клиентов, у которых фиксировались просрочки по предыдущим кредитным обязательствам в кредитном бюро.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова тенденция изменения среднего баланса по кредитным картам в ежемесячном разрезе?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) AS avg_balance FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каково распределение выданных кредитных карт по категориям семейного положения заемщиков, представленное в виде гистограммы?",
    "sql": "SELECT at.NAME_FAMILY_STATUS, COUNT(DISTINCT ccb.SK_ID_PREV) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY COUNT(DISTINCT ccb.SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните долю просроченных платежей для клиентов, которые впервые обращаются за кредитом между сегментами по признаку «тип клиента» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Среднее время обработки отклоненных кредитных заявок.",
    "sql": "SELECT ABS(AVG(DAYS_DECISION)) AS avg_days_to_refusal FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для POS-кредитов с серьёзной просрочкой между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Составьте перечень (топ-10) заемщиков, демонстрирующих высокую вероятность дефолта, чья модель риска коррелирует с большим числом негативных контактов в их социальном круге.",
    "sql": "SELECT SK_ID_CURR, OBS_30_CNT_SOCIAL_CIRCLE, TARGET FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE > 5 AND TARGET = 1 LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каково общее число запросов на микрозаймы в истории заявок?",
    "sql": "SELECT SUM(NFLAG_MICRO_CASH) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каково общее количество уникальных заемщиков, демонстрировавших признаки просроченной задолженности (статусы '1'-'5') согласно данным bureau_balance?",
    "sql": "SELECT COUNT(DISTINCT b.SK_ID_CURR) FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1', '2', '3', '4', '5');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для закрытых кредитов (CREDIT_ACTIVE = 'Closed') и по каждому значению группировки (CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для действующих кредитов клиента для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с платежами в текущем периоде (AMT_PAYMENT_CURRENT > 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов без просрочки (SK_DPD = 0) и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для кредитов, открытых более года назад для разных групп клиентов между типами кредитов, отражённых в бюро?",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для предыдущих заявок примерно за последний год для разных категорий по признаку «отрасль продавца» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте средний показатель запросов в кредитное бюро за последний год.",
    "sql": "SELECT AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карточных записей за последние 6 месяцев (MONTHS_BALANCE > -6), покажите средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для активных кредитов (CREDIT_ACTIVE = 'Active') в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Показатель дефолтности для заемщиков, получивших отказ по предыдущим кредитным заявкам.",
    "sql": "SELECT AVG(a.TARGET) AS default_rate FROM application_train a JOIN previous_application p ON a.SK_ID_CURR = p.SK_ID_CURR WHERE p.NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте среднюю сумму кредита из БКИ для клиентов, совершивших дефолт.",
    "sql": "SELECT AVG(b.AMT_CREDIT_SUM) FROM application_train_test app JOIN bureau b ON app.SK_ID_CURR = b.SK_ID_CURR WHERE app.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) для платежей без просрочки (DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT) в разрезе по факту платёжной дисциплины (переплата/недоплата).",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для платежей без просрочки (DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитов, по которым недавно обновлялась информация (DAYS_CREDIT_UPDATE > -30) в разрезе по статусу кредита (CREDIT_ACTIVE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE > -30 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым уже была просрочка (CREDIT_DAY_OVERDUE > 0) и по каждому значению группировки (CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Прошу определить средневзвешенный размер кредитного портфеля на выданные суммы.",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова тенденция изменения средней суммы текущей задолженности по активным кредитам в БКИ за последние 365 дней?",
    "sql": "SELECT ABS(DAYS_CREDIT) AS DaysAgo, AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND ABS(DAYS_CREDIT) <= 365 GROUP BY ABS(DAYS_CREDIT) ORDER BY DaysAgo;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов без просрочки (SK_DPD = 0) в разрезе по месяцу отчётности (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с оставшимся сроком погашения (DAYS_CREDIT_ENDDATE > 0) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажи разбивку по статусам всех предыдущих кредитных заявок.",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) AS status_count FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита от 10 000 до 50 000 и по каждому значению поля CHANNEL_TYPE показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY CHANNEL_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для прошлых кредитов на сумму выше 50 000 между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Идентифицируйте три профессиональные группы с наиболее высоким уровнем дефолтов.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) AS DefaultRate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY DefaultRate DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков совокупный размер активного кредитного портфеля по данным БКИ?",
    "sql": "SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте среднюю сумму кредитной заявки в зависимости от её целевого назначения.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, AVG(AMT_APPLICATION) FROM previous_application GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY AVG(AMT_APPLICATION) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выведите средний аннуитетный платеж для клиентов с CNT_CHILDREN > 0.",
    "sql": "SELECT AVG(AMT_ANNUITY) AS avg_annuity FROM application_train WHERE CNT_CHILDREN > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните размер одобренного кредита по предыдущим заявкам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «час принятия решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Анализ распределения клиентских заявок по часам их первичной обработки.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) AS client_count FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представить демографическое распределение клиентской базы по половому признаку.",
    "sql": "SELECT CODE_GENDER, COUNT(SK_ID_CURR) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Проведите анализ распределения причин отказов по ранее поданным кредитным заявкам.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какой в среднем возраст у наших заемщиков?",
    "sql": "SELECT AVG(-DAYS_BIRTH / 365) FROM application_train_test",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с суммой более 100 000 (AMT_CREDIT_SUM > 100000) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по дню недели принятия решения (WEEKDAY_APPR_PROCESS_START).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте основные причины отклонения ранее поданных кредитных заявок.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя загрузку кредитных карт (utilization) для карт, по которым установлен лимит для разных сегментов между активными, закрытыми и другими статусами договоров по картам с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков текущий уровень дефолтного портфеля в общем объеме?",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100.0 / COUNT(*) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Насколько средний доход заявителей коррелирует с числом их детей?",
    "sql": "SELECT CNT_CHILDREN, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) для платежей, превышающих плановый размер (AMT_PAYMENT > AMT_INSTALMENT) в разрезе по признаку своевременности платежа (on_time/late).",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_PAYMENT > AMT_INSTALMENT GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте график изменения среднего показателя дней просрочки по данным БКИ за предыдущие 12 месяцев.",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(JULIANDAY('now'), '-' || MONTHS_BALANCE || ' months')) AS balance_month, AVG(CREDIT_DAY_OVERDUE) FROM bureau AS b JOIN bureau_balance AS bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.MONTHS_BALANCE BETWEEN -12 AND 0 GROUP BY balance_month ORDER BY balance_month DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните задержка платежа в днях для клиентов, которые впервые обращаются за кредитом между сегментами по признаку «канал оформления кредита» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT CHANNEL_TYPE AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для предыдущих заявок с суммой кредита более 50 000 в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите долю заемщиков с просроченной задолженностью (CREDIT_DAY_OVERDUE > 0) в разрезе семейного статуса.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, (COUNT(DISTINCT CASE WHEN b.CREDIT_DAY_OVERDUE > 0 THEN at.SK_ID_CURR END) * 100.0 / COUNT(DISTINCT at.SK_ID_CURR)) AS overdue_percentage FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY overdue_percentage DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя среднюю по клиенту задержку платежей для клиентов, которые уже ранее брали кредит для разных групп клиентов между просроченными и своевременными платежами, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Оцените влияние демографического фактора (семейный статус) на кредитный риск (коэффициент дефолта).",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(TARGET) * 100 AS default_rate FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каково число заемщиков, у которых в БКИ есть хотя бы один активный кредитный продукт?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какой средний ежегодный платеж фиксируется для одобренных кредитных заявок?",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сводка числа клиентов с задолженностью по БКИ, сгруппированная по текущему статусу кредита.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для предыдущих заявок примерно за последний год между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для активности по картам от полугода до года назад для разных групп между картами с высоким лимитом и остальными?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Нам нужен график, который покажет средний возраст для каждой группы образования. Отсортируй по возрасту.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(ABS(DAYS_BIRTH)/365) AS average_age FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY average_age DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как влияет факт наличия микрозаймов в прошлом на вероятность невозврата кредита?",
    "sql": "SELECT p.NFLAG_MICRO_CASH, AVG(a.TARGET) AS default_rate FROM application_train a JOIN previous_application p ON a.SK_ID_CURR = p.SK_ID_CURR GROUP BY p.NFLAG_MICRO_CASH;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова помесячная тенденция изменения среднего кредитного лимита по портфелю кредитных карт за последние 12 месяцев?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance WHERE MONTHS_BALANCE BETWEEN -11 AND 0 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какова тенденция изменения средней суммы текущей задолженности, отраженной в БКИ, за последние месяцы?",
    "sql": "SELECT bb.MONTHS_BALANCE, AVG(b.AMT_CREDIT_SUM_DEBT) AS avg_debt FROM bureau_balance bb JOIN bureau b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID GROUP BY bb.MONTHS_BALANCE ORDER BY bb.MONTHS_BALANCE ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_ENTRY_PAYMENT для условной половины клиентов по чётности ID между разными группами между клиентами по их платёжной дисциплине?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_CURR ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково среднее число дней просрочки по текущим кредитам, отраженным в кредитной истории?",
    "sql": "SELECT AVG(CREDIT_DAY_OVERDUE) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков уровень аппрува (approval rate) по всем прошлым заявкам?",
    "sql": "SELECT CAST(SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите количество уникальных кредитных карт, демонстрирующих просроченную задолженность в последнем отчетном периоде.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM credit_card_balance WHERE MONTHS_BALANCE = (SELECT MAX(MONTHS_BALANCE) FROM credit_card_balance) AND AMT_INST_MIN_REGULARITY > AMT_PAYMENT_TOTAL_CURRENT;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих платежей по картам для карт с тратами в текущем месяце в разрезе признака «клиент» по кредитным картам клиентов.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Насколько показатель дефолтности клиентов зависит от их трудового стажа?",
    "sql": "SELECT CASE WHEN DAYS_EMPLOYED < -3650 THEN '10+ years' WHEN DAYS_EMPLOYED < -1825 THEN '5-10 years' WHEN DAYS_EMPLOYED < -365 THEN '1-5 years' ELSE 'Less than 1 year' END AS employment_category, AVG(TARGET) FROM application_train WHERE DAYS_EMPLOYED < 0 GROUP BY employment_category ORDER BY employment_category;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита от 10 000 до 50 000 и по каждому значению поля HOUR_APPR_PROCESS_START показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Можешь показать мне, кто из клиентов за последний год больше пяти раз запрашивал информацию из БКИ?",
    "sql": "SELECT SK_ID_CURR, AMT_REQ_CREDIT_BUREAU_YEAR FROM application_train_test WHERE AMT_REQ_CREDIT_BUREAU_YEAR > 5 ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR DESC",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для сравнительно новых кредитов для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя загрузку кредитных карт (utilization) для истории по картам старше года для разных сегментов между клиентами по их карточной активности с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE <= -12 ) SELECT SK_ID_CURR AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите среднее значение снятых наличных денег с кредитных карт.",
    "sql": "SELECT AVG(AMT_DRAWINGS_ATM_CURRENT) FROM credit_card_balance WHERE AMT_DRAWINGS_ATM_CURRENT IS NOT NULL AND AMT_DRAWINGS_ATM_CURRENT > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется долю просроченных платежей по рассрочке для первого года рассрочки при ежемесячных платежах между различными сегментами между клиентами с низким, средним и высоким совокупным объёмом платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитных карт с установленным лимитом для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, открытых за последний год (DAYS_CREDIT > -365) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте список топ-5 заемщиков с наибольшим объемом просроченной или текущей задолженности по кредитным картам.",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_TOTAL_RECEIVABLE) AS total_receivable FROM credit_card_balance GROUP BY SK_ID_CURR ORDER BY total_receivable DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для завершённых POS-кредитов между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Completed' GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте средний показатель совокупного дохода для каждого статуса семейного положения в клиентской базе.",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY NAME_FAMILY_STATUS",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Рассчитайте пиковое количество дней просрочки, зафиксированное по кредитам в БКИ.",
    "sql": "SELECT MAX(CREDIT_DAY_OVERDUE) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Продемонстрируйте ежемесячную динамику процентного соотношения активных кредитов в кредитной истории.",
    "sql": "SELECT MONTHS_BALANCE, CAST(SUM(CASE WHEN STATUS = 'Active' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) FROM bureau_balance AS bb JOIN bureau AS b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Вычислите процент клиентов, обладающих автомобилем.",
    "sql": "SELECT CAST(SUM(CASE WHEN FLAG_OWN_CAR = 'Y' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по часу принятия решения (HOUR_APPR_PROCESS_START).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) в разрезе по статусу договора (NAME_CONTRACT_STATUS) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для активных POS-кредитов (CNT_INSTALMENT_FUTURE > 0) в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково распределение числа иждивенцев среди наших заемщиков?",
    "sql": "SELECT CNT_FAM_MEMBERS, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажи процент клиентов, у которых есть дети, и тех, у кого их нет.",
    "sql": "SELECT CASE WHEN CNT_CHILDREN > 0 THEN 'With Children' ELSE 'No Children' END AS Children_Status, COUNT(SK_ID_CURR) FROM application_train GROUP BY Children_Status;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте аналитический запрос по POS-рассрочкам с объединением POS_CASH_balance и installments_payments, чтобы для выборки для платежей, по которым известна дата фактической оплаты получить среднюю долю просроченных платежей по POS-кредитам (late_flag) по по статусу POS-договора (pos.NAME_CONTRACT_STATUS).",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_ENTRY_PAYMENT IS NOT NULL ) SELECT pos.NAME_CONTRACT_STATUS AS group_key, AVG(late_flag) AS metric_value FROM pos_inst GROUP BY pos.NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как у нас распределяются разные виды договоров по клиентам?",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(*) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым уже была просрочка (CREDIT_DAY_OVERDUE > 0) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для последующих платежей (NUM_INSTALMENT_NUMBER > 3), покажите средний плановый платёж по рассрочке (AMT_INSTALMENT) по каждому значению поля NUM_INSTALMENT_NUMBER.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой является средняя сумма кредита (AMT_CREDIT) в зависимости от типа жилья клиента?",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(AMT_CREDIT) FROM application_train_test GROUP BY NAME_HOUSING_TYPE ORDER BY AVG(AMT_CREDIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните величина DAYS_DECISION по предыдущим кредитам для прошлых заявок, принятых более года назад для разных категорий по признаку «час принятия решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для активности по картам за последние полгода для разных групп между картами с высоким лимитом и остальными?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карточных записей за последние 6 месяцев (MONTHS_BALANCE > -6) в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для действующих кредитов клиента для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отобразите динамику коэффициента дефолта по часам подачи заявок на кредит.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, AVG(TARGET) AS default_rate FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Исследуйте уровень дефолта в зависимости от числа иждивенцев (детей).",
    "sql": "SELECT CNT_CHILDREN, AVG(TARGET) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков средний размер займа по различным видам клиентского жилья?",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(AMT_CREDIT) FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY 2 DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для кредитной истории средней давности между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -18 AND -6 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Насколько сильно различается дефолтность между мужчинами и женщинами, владеющими или не владеющими автомобилем?",
    "sql": "SELECT CODE_GENDER, FLAG_OWN_CAR, AVG(TARGET) * 100 AS Default_Rate FROM application_train WHERE CODE_GENDER != 'XNA' GROUP BY CODE_GENDER, FLAG_OWN_CAR ORDER BY CODE_GENDER, FLAG_OWN_CAR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подсчитайте количество клиентов, у которых отсутствует кредитная активность по запросам в БКИ за истекший год, для сегментации \"новых\" заемщиков.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE AMT_REQ_CREDIT_BUREAU_YEAR = 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 для разных категорий по признаку «тип кредитного продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для кредитов с заполненным аннуитетом (AMT_ANNUITY IS NOT NULL) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Отличается ли средняя сумма снятия наличных через банкомат (AMT_DRAWINGS_ATM_CURRENT) для клиентов с хорошей и плохой кредитной историей?",
    "sql": "SELECT at.TARGET, AVG(ccb.AMT_DRAWINGS_ATM_CURRENT) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE ccb.AMT_DRAWINGS_ATM_CURRENT IS NOT NULL GROUP BY at.TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите метрику по отклоненным запросам на предыдущие кредиты.",
    "sql": "SELECT COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова структура распределения просроченных дней по текущим активным кредитам, зарегистрированным в БКИ?",
    "sql": "SELECT CREDIT_DAY_OVERDUE, COUNT(SK_BUREAU_ID) AS OverdueCount FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_DAY_OVERDUE ORDER BY CREDIT_DAY_OVERDUE DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте сравнительный анализ среднего лимита одобренного кредита между сегментами клиентов с собственной недвижимостью и без.",
    "sql": "SELECT FLAG_OWN_REALTY, AVG(AMT_CREDIT) FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю долю просроченных платежей по рассрочкам для фактически оплаченных записей (AMT_PAYMENT > 0) по по сегментам номера платежа (early/middle/late).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для одобренных предыдущих кредитов между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте запрос с подзапросом по credit_card_balance (агрегация по SK_ID_CURR), а затем объедините его с previous_application и получите среднюю загрузку кредитных карт (AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL) среди клиентов для карточной активности за последние 6 месяцев (cc.MONTHS_BALANCE > -6) по по каналу оформления предыдущего кредита (pa.CHANNEL_TYPE).",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.MONTHS_BALANCE > -6 GROUP BY cc.SK_ID_CURR ) SELECT pa.CHANNEL_TYPE AS group_key, AVG(utilization) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется разницу между фактическим и плановым платёжом по рассрочке для платежей, которые клиент внёс между различными сегментами между ранними, средними и поздними платежами в графике в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Оцените демографический параметр (среднее количество детей) для сегмента клиентов с целевым статусом \"дефолт\".",
    "sql": "SELECT AVG(CNT_CHILDREN) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для новых клиентов (NAME_CLIENT_TYPE = 'New') и по каждому значению поля NAME_PRODUCT_TYPE показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт с непогашенным остатком (AMT_BALANCE > 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_BALANCE > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с максимальной просрочкой больше нуля (AMT_CREDIT_MAX_OVERDUE > 0) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков коэффициент дефолта по клиентам в зависимости от их типа дохода, и как эти данные распределяются?",
    "sql": "SELECT NAME_INCOME_TYPE, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY DefaultRate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проанализируйте сегментацию текущего портфеля по типам контрактов для клиентов с негативным кредитным прошлым (отказанные заявки).",
    "sql": "SELECT at.NAME_CONTRACT_TYPE, COUNT(DISTINCT at.SK_ID_CURR) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Refused' GROUP BY at.NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для текущих, ещё не погашенных POS-кредитов для разных значений признака «активность POS-кредита» по POS-кредитам.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Предоставьте перечень идентификаторов клиентов, обладающих кредитными картами с текущим балансом, превышающим 100000 единиц.",
    "sql": "SELECT DISTINCT SK_ID_CURR FROM credit_card_balance WHERE AMT_BALANCE > 100000;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Интересно, как часто люди разных возрастов не возвращают кредиты? Покажи дефолты по группам: молодые, средний возраст, и те, кто постарше.",
    "sql": "SELECT CASE WHEN DAYS_BIRTH / -365 < 30 THEN 'До 30' WHEN DAYS_BIRTH / -365 BETWEEN 30 AND 45 THEN '30-45' ELSE 'Старше 45' END AS age_group, AVG(TARGET) FROM application_train GROUP BY age_group;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для записей с просрочкой 1 месяц (STATUS = '1') в разрезе по статусу STATUS в bureau_balance.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS = '1' GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей с фактической оплатой (AMT_PAYMENT > 0), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Интересно, сколько в среднем платят по кредиткам разные категории клиентов по их семейному статусу?",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(ccb.AMT_PAYMENT_TOTAL_CURRENT) AS avg_card_payment FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE ccb.AMT_PAYMENT_TOTAL_CURRENT IS NOT NULL GROUP BY at.NAME_FAMILY_STATUS ORDER BY avg_card_payment DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выведи список клиентов с историей просрочек (CREDIT_DAY_OVERDUE > 0) и их текущим статусом.",
    "sql": "SELECT at.SK_ID_CURR, at.TARGET, b.CREDIT_DAY_OVERDUE, at.OCCUPATION_TYPE FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для кредитов, по которым есть долг в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для уже погашенных кредитов в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для предыдущих заявок примерно за последний год между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Составь список всех причин, по которым отклонялись предыдущие заявки, и укажи их количество.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) AS refusal_count FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY refusal_count DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY CHANNEL_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для предыдущих заявок с суммой кредита более 50 000 в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_PORTFOLIO ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Интересно, какой средний заработок у наших клиентов с кредитками, если разделить их по жилью?",
    "sql": "SELECT a.NAME_HOUSING_TYPE, AVG(a.AMT_INCOME_TOTAL) FROM application_train a JOIN credit_card_balance ccb ON a.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY a.NAME_HOUSING_TYPE ORDER BY AVG(a.AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните значение DAYS_INSTALMENT для платежей, внесённых вовремя или раньше срока для разных значений признака «номер платежа» в платёжной истории клиентов.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для пролонгированных кредитов (CNT_CREDIT_PROLONG > 0) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отобразите среднее значение фактического кредитного лимита для кредитных карт.",
    "sql": "SELECT AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для месяцев, по которым статус кредита известен в разрезе признака «статус кредита по месяцам» по истории кредитов из бюро.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS <> 'X' GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для одобренных предыдущих кредитов между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для новых клиентов (NAME_CLIENT_TYPE = 'New') и по каждому значению поля CHANNEL_TYPE показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY CHANNEL_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_PORTFOLIO ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажите среднюю величину регулярного кредитного взноса.",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для новых клиентов (NAME_CLIENT_TYPE = 'New') в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните размер кредита по данным бюро для кредитов, по которым задан аннуитетный платёж в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова суммарная величина основного долга, подлежащего взысканию по кредитным картам?",
    "sql": "SELECT SUM(AMT_RECEIVABLE_PRINCIPAL) FROM credit_card_balance",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для решений, принятых за последний год (DAYS_DECISION > -365) в разрезе по часу принятия решения (HOUR_APPR_PROCESS_START).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните долю просроченных платежей по POS-кредитам для реальных графиков платежей по POS-кредитам по признаку «статус POS-договора» для POS-рассрочек на основе объединённых данных о графике и фактических платежах.",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_INSTALMENT > 0 ) SELECT pos.NAME_CONTRACT_STATUS AS group_key, AVG(late_flag) AS metric_value FROM pos_inst GROUP BY pos.NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите, кто из клиентов, у кого не было негативных социальных контактов за месяц, все равно ушел в дефолт.",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE = 0 AND TARGET = 1 LIMIT 50;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализируйте распределение оснований для отклонения ранее поданных кредитных заявок.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните среднюю сумму текущих платежей по кредитным картам для каждого уровня образования.",
    "sql": "SELECT at.NAME_EDUCATION_TYPE, AVG(ccb.AMT_PAYMENT_TOTAL_CURRENT) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY at.NAME_EDUCATION_TYPE ORDER BY AVG(ccb.AMT_PAYMENT_TOTAL_CURRENT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для отказанных предыдущих кредитов между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажите среднее количество дней просрочки только для активных кредитов, где была зафиксирована просрочка.",
    "sql": "SELECT AVG(CREDIT_DAY_OVERDUE) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие пять причин чаще всего приводят к отказу в выдаче кредита?",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(*) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(*) DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Насколько сильно количество членов семьи влияет на риск невозврата кредита?",
    "sql": "SELECT CNT_FAM_MEMBERS, AVG(TARGET) * 100 FROM application_train_test GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какой процент клиентов составляют мужчины, а какой - женщины?",
    "sql": "SELECT CODE_GENDER, COUNT(*) FROM application GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднюю загрузку кредитных карт (utilization) по сегментам для карт с текущими выборками средств (AMT_DRAWINGS_CURRENT > 0) в разрезе по уровню кредитного лимита (high_limit/low_or_medium_limit).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитов с давними обновлениями (DAYS_CREDIT_UPDATE <= -30) в разрезе по статусу кредита (CREDIT_ACTIVE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте структуру статусов кредитных обязательств клиентов, отраженных в БКИ.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для старых POS-операций (старше года) между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте график среднего кредитного лимита по месяцам за последние 6 отчетных периодов.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_credit_limit FROM credit_card_balance WHERE MONTHS_BALANCE >= -6 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сколько всего стоили товары, по которым мы одобрили кредиты в прошлом?",
    "sql": "SELECT SUM(AMT_GOODS_PRICE) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднее значение задержки платежа в днях (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) для платежей по рассрочке за последний год (DAYS_INSTALMENT BETWEEN -365 AND 0) в разрезе по признаку просрочки платежа (delay_days > 0) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков тренд среднего credit limit exposure по кредитным картам в помесячной разбивке?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карточных записей за последние 6 месяцев (MONTHS_BALANCE > -6), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните размер кредита по данным бюро для кредитов с известной датой закрытия в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отобразите динамику числа клиентов с активными кредитными записями в БКИ по срезу 'MONTHS_BALANCE'.",
    "sql": "SELECT bb.MONTHS_BALANCE, COUNT(DISTINCT b.SK_ID_CURR) FROM bureau_balance bb JOIN bureau b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID WHERE bb.STATUS IN ('0', 'C') GROUP BY bb.MONTHS_BALANCE ORDER BY bb.MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Идентифицируйте клиентские идентификаторы, связанные с более чем тремя предшествующими кредитными заявками.",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_ID_PREV) AS num_applications FROM previous_application GROUP BY SK_ID_CURR HAVING num_applications > 3 ORDER BY num_applications DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер планового платежа по рассрочке для начальных платежей по рассрочке между разными группами между клиентами по их платёжной дисциплине?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY SK_ID_CURR ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для завершённых POS-договоров (NAME_CONTRACT_STATUS = 'Completed') в разрезе по статусу договора POS-кредита (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Completed' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково число клиентов, имеющих свыше двух активных кредитов, согласно данным БКИ?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_credits FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING active_credits > 2);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') и по каждому значению поля NAME_PRODUCT_TYPE показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите итоговый процент невозврата кредитов (дефолтов) по всем заявкам.",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие клиенты имеют более двух активных кредитов, зарегистрированных в БКИ?",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_loans FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING COUNT(SK_BUREAU_ID) > 2 ORDER BY active_loans DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте среднее количество членов семьи для каждой категории семейного положения клиентов.",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(CNT_FAM_MEMBERS) AS avg_family_members FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY avg_family_members DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau_balance рассчитайте долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро для записей от 4 до 9 месяцев назад в разрезе по давности записи (MONTHS_BALANCE, recent/old).",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -9 AND -4 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какой процент заявок на кредит в прошлом был именно на машину?",
    "sql": "SELECT (COUNT(CASE WHEN NAME_CASH_LOAN_PURPOSE = 'Car' THEN 1 END) * 100.0 / COUNT(*)) FROM previous_application;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Какие три основные цели кредита коррелируют с наибольшим числом случаев дефолта?",
    "sql": "SELECT pa.NAME_CASH_LOAN_PURPOSE, COUNT(DISTINCT at.SK_ID_CURR) AS DefaulterCount FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE at.TARGET = 1 GROUP BY pa.NAME_CASH_LOAN_PURPOSE ORDER BY DefaulterCount DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова общая сумма задолженности по кредитам БКИ у заёмщиков, столкнувшихся с дефолтом, по сравнению с благонадёжными клиентами?",
    "sql": "SELECT at.TARGET, SUM(b.AMT_CREDIT_SUM) AS TotalCreditSumBureau FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.TARGET ORDER BY at.TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните задержку платежа по рассрочкам для условной половины клиентов по чётности ID по признаку «факт просрочки», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) и показан среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) по каждому значению NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для кредитов с оставшимся сроком погашения (DAYS_CREDIT_ENDDATE > 0) в разрезе по размеру кредита (AMT_CREDIT_SUM) с бинингом на крупные и остальные.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой общий портфель кредитов в денежном выражении по текущим клиентам?",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как часто встречаются кредиты с разным количеством дней просрочки в БКИ?",
    "sql": "SELECT CREDIT_DAY_OVERDUE, COUNT(SK_BUREAU_ID) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_DAY_OVERDUE ORDER BY CREDIT_DAY_OVERDUE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите структуру клиентской базы с учетом размера семьи.",
    "sql": "SELECT CNT_FAM_MEMBERS, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажи, сколько мужчин и сколько женщин подали заявления на кредит.",
    "sql": "SELECT CODE_GENDER, COUNT(SK_ID_CURR) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для карт с тратами в текущем месяце для разных групп между картами с высоким лимитом и остальными?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните размер кредита по данным бюро для действующих кредитов клиента в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_ENTRY_PAYMENT для начальных платежей по рассрочке между разными группами между разными номерами платежей в графике рассрочки?",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте таблицу показателей дефолтности клиентов, сгруппированных по уровню образования и семейному статусу.",
    "sql": "SELECT NAME_EDUCATION_TYPE, NAME_FAMILY_STATUS, AVG(TARGET) AS default_rate, COUNT(SK_ID_CURR) AS client_count FROM application_train GROUP BY NAME_EDUCATION_TYPE, NAME_FAMILY_STATUS ORDER BY default_rate DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для POS-кредитов с серьёзной просрочкой между разными категориями между активными и погашенными POS-кредитами?",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните стоимость товара по предыдущим кредитам для отказанных предыдущих кредитов для разных категорий по признаку «группа доходности продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов без просрочки (SK_DPD = 0) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний остаток по кредитным картам (AMT_BALANCE) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для предыдущих заявок примерно за последний год между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково общее количество прошлых кредитных обязательств для каждого уникального заемщика, согласно данным БКИ?",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS past_credit_count FROM bureau GROUP BY SK_ID_CURR ORDER BY past_credit_count DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднее значение задержки платежа в днях (delay_days) по рассрочкам для записей с ненулевым плановым платежом по по факту просрочки платежа (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов с недавно обновлёнными данными в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE > -30 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Идентификация трех наиболее распространенных статусов внешних кредитов по уникальным заемщикам.",
    "sql": "SELECT T1.STATUS, COUNT(DISTINCT T2.SK_ID_CURR) AS unique_clients FROM bureau_balance AS T1 JOIN bureau AS T2 ON T1.SK_BUREAU_ID = T2.SK_BUREAU_ID GROUP BY T1.STATUS ORDER BY unique_clients DESC LIMIT 3;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Покажите общий кредитный лимит одобренных заявок по дням недели.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, SUM(AMT_CREDIT) AS total_approved_credit FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY CASE WEEKDAY_APPR_PROCESS_START WHEN 'MONDAY' THEN 1 WHEN 'TUESDAY' THEN 2 WHEN 'WEDNESDAY' THEN 3 WHEN 'THURSDAY' THEN 4 WHEN 'FRIDAY' THEN 5 WHEN 'SATURDAY' THEN 6 WHEN 'SUNDAY' THEN 7 END;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выведите перечень всех ранее отклоненных кредитных заявок для клиента с идентификатором 100002.",
    "sql": "SELECT * FROM previous_application WHERE SK_ID_CURR = 100002 AND NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова структура типов дохода среди нашей клиентской базы?",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_INCOME_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните долю просроченных платежей по рассрочке для второй половины клиентов по чётности ID по признаку «клиент», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 ) SELECT SK_ID_CURR AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля CHANNEL_TYPE показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY CHANNEL_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите число заемщиков, имеющих множественные действующие кредитные обязательства согласно данным БКИ.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING COUNT(SK_BUREAU_ID) > 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Кто из клиентов больше всего снимал наличку с кредиток?",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_DRAWINGS_ATM_CURRENT) AS TotalATMDrawings FROM credit_card_balance GROUP BY SK_ID_CURR ORDER BY TotalATMDrawings DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какой процент дефолтов у клиентов с детьми по сравнению с теми, у кого их нет?",
    "sql": "SELECT CASE WHEN CNT_CHILDREN > 0 THEN 'С детьми' ELSE 'Без детей' END AS HasChildren, AVG(TARGET) FROM application_train GROUP BY HasChildren;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните размер планового платежа по рассрочке для случаев, когда платёж не был внесён для разных значений признака «номер платежа» в платёжной истории клиентов.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT = 0 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Пожалуйста, предоставьте среднюю эффективную процентную ставку по привилегированным займам, выданным одобренным клиентам.",
    "sql": "SELECT AVG(RATE_INTEREST_PRIVILEGED) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND RATE_INTEREST_PRIVILEGED IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client) для фактических оплат по рассрочке (ip.AMT_PAYMENT > 0) в разрезе по типу кредитного продукта (pa.NAME_CONTRACT_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт без просрочки по DPD (SK_DPD = 0) в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте анализ распределения клиентской базы по показателю наличия детей.",
    "sql": "SELECT CNT_CHILDREN, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Визуализируйте долевое распределение заявок на кредит, сгруппированных по категории контракта (например, \"Cash\" или \"Revolving\").",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Какова общая экспозиция по кредитному портфелю в части задолженностей, отраженных в кредитных бюро?",
    "sql": "SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля NAME_CONTRACT_TYPE показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя среднюю по клиенту задержку платежей для прошлых крупных кредитов с реальными платежами по графику для разных групп клиентов между новыми, повторными и лояльными клиентами, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.AMT_CREDIT > 50000 AND ip.AMT_INSTALMENT > 0 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите гендерное соотношение в клиентской базе.",
    "sql": "SELECT CODE_GENDER, COUNT(*) FROM application GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Интересно, насколько сильно отличается средний доход у наших клиентов в зависимости от наличия автомобиля?",
    "sql": "SELECT FLAG_OWN_CAR, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проследите динамику среднего остатка средств на кредитных картах по месяцам.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) AS avg_balance FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для клиентов, которые уже брали кредит ранее для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без серьёзной просрочки по DPD_DEF (SK_DPD_DEF = 0), покажите средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) по каждому значению поля NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните величина DAYS_DECISION по предыдущим кредитам для клиентов, которые уже брали кредит ранее для разных категорий по признаку «отрасль продавца» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Оцените уровень дефолтности для заявок, инициированных в выходные дни.",
    "sql": "SELECT AVG(a.TARGET) * 100 FROM application_train a JOIN previous_application pa ON a.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.WEEKDAY_APPR_PROCESS_START IN ('SATURDAY', 'SUNDAY');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните долю просроченных платежей для случаев, когда клиент не внёс очередной платёж между сегментами по признаку «доходность продукта» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT = 0 ) SELECT NAME_YIELD_GROUP AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний остаток по кредитным картам (AMT_BALANCE) для карт без текущего остатка (AMT_BALANCE = 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт с лимитом до 50 000 в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Средняя продолжительность трудового стажа у заемщиков, допустивших дефолт.",
    "sql": "SELECT ABS(AVG(DAYS_EMPLOYED)) AS avg_days_employed_defaulters FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как количество поданных заявок распределяется по дням недели?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(*) FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY CASE WEEKDAY_APPR_PROCESS_START WHEN 'MONDAY' THEN 1 WHEN 'TUESDAY' THEN 2 WHEN 'WEDNESDAY' THEN 3 WHEN 'THURSDAY' THEN 4 WHEN 'FRIDAY' THEN 5 WHEN 'SATURDAY' THEN 6 WHEN 'SUNDAY' THEN 7 END;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каковы идентификаторы и суммарные суммы к получению по кредитным картам для десяти клиентов с максимальными показателями?",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_TOTAL_RECEIVABLE) FROM credit_card_balance GROUP BY SK_ID_CURR ORDER BY SUM(AMT_TOTAL_RECEIVABLE) DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова доля дефолтов для каждого типа кредитного контракта?",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(TARGET) * 100 FROM application GROUP BY NAME_CONTRACT_TYPE ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какой является средняя величина ежемесячных платежей, осуществляемых по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для текущих, ещё не погашенных POS-кредитов между разными категориями между клиентами по их POS-истории?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт с просрочкой по DPD (SK_DPD > 0) в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер фактического платежа по рассрочке для более поздних платежей по рассрочке между разными группами между разными номерами платежей в графике рассрочки?",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните среднюю продолжительность активного состояния кредитов для клиентов с дефолтом и без него.",
    "sql": "SELECT at.TARGET, AVG(ABS(b.DAYS_CREDIT)) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните загрузку кредитных карт (utilization) для карт с текущей задолженностью по признаку «клиент», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_BALANCE > 0 ) SELECT SK_ID_CURR AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client) для первых шести платежей по рассрочке (NUM_INSTALMENT_NUMBER <= 6) в разрезе по типу клиента (pa.NAME_CLIENT_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для POS-кредитов без просрочки (SK_DPD = 0) в разрезе по признаку активный/закрытый POS-кредит (по CNT_INSTALMENT_FUTURE).",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните размер планового платежа по рассрочке для более поздних платежей по рассрочке для разных значений признака «предыдущий кредит» в платёжной истории клиентов.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY SK_ID_PREV ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для предыдущих заявок примерно за последний год между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для уже погашенных кредитов для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для клиентов, которые уже брали кредит ранее между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте корреляцию между уровнем просрочки и числом лиц с негативной кредитной историей в социальном круге заемщика.",
    "sql": "SELECT OBS_30_CNT_SOCIAL_CIRCLE, AVG(TARGET) AS default_rate FROM application_train GROUP BY OBS_30_CNT_SOCIAL_CIRCLE ORDER BY OBS_30_CNT_SOCIAL_CIRCLE ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какой у нас был самый большой кредит?",
    "sql": "SELECT MAX(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов с оставшимся сроком погашения (DAYS_CREDIT_ENDDATE > 0) в разрезе по валюте кредита (CREDIT_CURRENCY).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице installments_payments рассчитайте среднее количество дней до фактической даты платежа (DAYS_ENTRY_PAYMENT) для записей с фактической оплатой (AMT_PAYMENT > 0) в разрезе по признаку своевременности платежа (on_time/late).",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется значение MONTHS_BALANCE по кредитам в бюро для истории кредитов от года до двух лет назад между разными категориями между свежими и старыми записями по кредитам?",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -24 AND -13 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте консолидированный показатель объема дефолтной задолженности по данным БКИ.",
    "sql": "SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько всего у нас 'плохих' кредитов в БКИ?",
    "sql": "SELECT SUM(AMT_CREDIT_SUM) FROM bureau WHERE CREDIT_ACTIVE = 'Bad debt';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя загрузку кредитных карт (utilization) для карт, по которым клиент сейчас вносит платежи для разных сегментов между картами с высоким и более низким лимитом с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам для новых клиентов (NAME_CLIENT_TYPE = 'New') в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько процентов наших клиентов - родители? Покажите эту долю.",
    "sql": "SELECT (COUNT(CASE WHEN CNT_CHILDREN > 0 THEN 1 END) * 100.0 / COUNT(*)) FROM application;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Кто из клиентов использует свою кредитку более чем на 80% от лимита?",
    "sql": "SELECT SK_ID_CURR, SK_ID_PREV, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, (AMT_BALANCE * 100.0 / AMT_CREDIT_LIMIT_ACTUAL) AS Utilization_Rate FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0 AND (AMT_BALANCE * 100.0 / AMT_CREDIT_LIMIT_ACTUAL) > 80 ORDER BY Utilization_Rate DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Предоставьте список уникальных идентификаторов клиентов, чья кредитная история в БКИ содержит записи со статусом '5' (просроченная задолженность).",
    "sql": "SELECT DISTINCT T1.SK_ID_CURR FROM bureau T1 JOIN bureau_balance T2 ON T1.SK_BUREAU_ID = T2.SK_BUREAU_ID WHERE T2.STATUS = '5';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие идентификаторы клиентов соответствуют условиям наличия активных кредитов в БКИ и высокого баланса по кредитной карте (более 50 000)?",
    "sql": "SELECT at.SK_ID_CURR FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active' AND ccb.AMT_BALANCE > 50000 GROUP BY at.SK_ID_CURR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем дают кредитов разных типов?",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_CREDIT) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для отказанных предыдущих кредитов для разных категорий по признаку «день недели решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE) для кредитов в условной валюте 'currency 1' в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя долю месяцев с просрочкой по картам для истории по картам старше года для разных сегментов между картами с высоким и более низким лимитом с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE <= -12 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(CASE WHEN SK_DPD > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой в среднем доход у тех клиентов, что когда-то брали микрокредиты?",
    "sql": "SELECT AVG(at.AMT_INCOME_TOTAL) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NFLAG_MICRO_CASH = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Оцените среднюю частоту обращений в БКИ по клиенту в годовом выражении.",
    "sql": "SELECT AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train WHERE AMT_REQ_CREDIT_BUREAU_YEAR IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведите данные по клиентам, которые имеют кредитные карты с крупным лимитом и при этом высокий уровень задолженности.",
    "sql": "SELECT SK_ID_CURR, MAX(AMT_CREDIT_LIMIT_ACTUAL) AS max_limit, MAX(AMT_BALANCE) AS max_balance FROM credit_card_balance GROUP BY SK_ID_CURR HAVING max_balance > (0.8 * max_limit) AND max_limit > 100000 ORDER BY max_balance DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните значение DAYS_ENTRY_PAYMENT для случаев, когда платёж не был внесён для разных значений признака «тип платёжной дисциплины» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE AMT_PAYMENT = 0 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднюю долю просроченных платежей по рассрочкам для поздних платежей (NUM_INSTALMENT_NUMBER > 12) в разрезе по факту просрочки платежа (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 12 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажи, как там с дефолтами по образованию, кто чаще не платит?",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(TARGET) FROM application_train_test GROUP BY NAME_EDUCATION_TYPE ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова структура распределения предыдущих заявок по времени, затраченному на их рассмотрение?",
    "sql": "SELECT CASE WHEN ABS(DAYS_DECISION) < 30 THEN '< 30 days' WHEN ABS(DAYS_DECISION) BETWEEN 30 AND 90 THEN '30-90 days' ELSE '> 90 days' END AS decision_days_group, COUNT(SK_ID_PREV) FROM previous_application GROUP BY decision_days_group ORDER BY decision_days_group;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Какие пять видов занятости демонстрируют наивысший процент просроченной задолженности?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) * 100 AS Default_Rate, COUNT(SK_ID_CURR) AS Total_Applications FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL AND OCCUPATION_TYPE != 'XNA' GROUP BY OCCUPATION_TYPE HAVING COUNT(SK_ID_CURR) > 100 ORDER BY Default_Rate DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Рассчитайте средний размер обязательств заемщиков перед БКИ.",
    "sql": "SELECT AVG(b.AMT_CREDIT_SUM_DEBT) FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.AMT_CREDIT_SUM_DEBT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество одобренных кредитов для клиентов, имевших микрозаймы, с теми, у кого их не было.",
    "sql": "SELECT NFLAG_MICRO_CASH, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NFLAG_MICRO_CASH;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов, открытых за последний год (DAYS_CREDIT > -365) в разрезе по размеру кредита (AMT_CREDIT_SUM) с бинингом на крупные и остальные.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По объединению bureau и bureau_balance рассчитайте среднее значение максимального месяца наблюдения (max_month) для месяцев без просрочки (bb.STATUS = '0') в разрезе по статусу кредита (b.CREDIT_ACTIVE), используя предварительную агрегацию по кредиту.",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS = '0' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_ACTIVE AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CREDIT_ACTIVE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Отобразите сегментацию заемщиков по признаку владения автомобилем, представив процентное соотношение.",
    "sql": "SELECT FLAG_OWN_CAR, COUNT(SK_ID_CURR) FROM application_train GROUP BY FLAG_OWN_CAR",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сколько у нас клиентов, у которых есть хоть один \"плохой\" статус (5) по кредитам в БКИ?",
    "sql": "SELECT COUNT(DISTINCT b.SK_ID_CURR) FROM bureau_balance bb JOIN bureau b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID WHERE bb.STATUS = '5';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для месяцев без информации (STATUS = 'X'), покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS = 'X' GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с просрочкой по DPD (SK_DPD > 0), покажите средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) по каждому значению поля NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с платежами в текущем периоде (AMT_PAYMENT_CURRENT > 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какие виды договоров чаще всего встречаются в заявках на кредит, не подскажете?",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих платежей по картам для карт, по которым есть просрочка для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите средний доход клиентов, допустивших дефолт, в зависимости от их жилищных условий.",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(AMT_INCOME_TOTAL) AS Average_Income FROM application_train WHERE TARGET = 1 GROUP BY NAME_HOUSING_TYPE ORDER BY Average_Income DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните долю просроченных платежей по рассрочке для рассрочек, относящихся к последнему году по признаку «версия графика платежей», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для более старых POS-записей (MONTHS_BALANCE < -12) в разрезе по признаку активный/закрытый POS-кредит (по CNT_INSTALMENT_FUTURE).",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков средний дефолт-рейт среди клиентов с тремя и более активными кредитными обязательствами, согласно данным БКИ?",
    "sql": "SELECT AVG(at.TARGET) FROM application_train at JOIN (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) as active_credits FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING active_credits > 2) b_active ON at.SK_ID_CURR = b_active.SK_ID_CURR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каковы средние ежегодные аннуитетные платежи для сегментов дефолтных и недефолтных заемщиков?",
    "sql": "SELECT TARGET, AVG(AMT_ANNUITY) FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте круговую диаграмму, иллюстрирующую статусы активности кредитов в БКИ.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Рассчитайте коэффициент отклонения заявлений.",
    "sql": "SELECT (COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 END) * 100.0 / COUNT(SK_ID_PREV)) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков уровень одобрения заявок в разрезе различных типов кредитных продуктов?",
    "sql": "SELECT NAME_CONTRACT_TYPE, CAST(COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN SK_ID_PREV END) AS REAL) * 100 / COUNT(SK_ID_PREV) AS approval_rate FROM previous_application GROUP BY NAME_CONTRACT_TYPE ORDER BY approval_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте таблицу клиентов, чьи текущие платежи по кредитным картам ниже установленного минимального регулярного платежа.",
    "sql": "SELECT SK_ID_CURR, SK_ID_PREV, AMT_PAYMENT_CURRENT, AMT_INST_MIN_REGULARITY FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT < AMT_INST_MIN_REGULARITY AND AMT_PAYMENT_CURRENT IS NOT NULL AND AMT_INST_MIN_REGULARITY IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита более 50 000 и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково среднее количество дней, затрачиваемых на принятие решения по предыдущим обращениям?",
    "sql": "SELECT AVG(ABS(DAYS_DECISION)) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите коэффициент одобрения по историческим заявкам.",
    "sql": "SELECT CAST(SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_PREV) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для месяцев без просрочек между разными категориями между разными статусами состояния кредита в разрезе месяцев?",
    "sql": "SELECT STATUS AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS = '0' GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для POS-кредитов с количеством платежей более 6 (CNT_INSTALMENT > 6) в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните размер кредита по данным бюро для кредитов с просрочкой в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выведите средний показатель числа детей для заемщиков, находящихся в дефолте.",
    "sql": "SELECT AVG(CNT_CHILDREN) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по признаку активный/закрытый POS-кредит (по CNT_INSTALMENT_FUTURE).",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам в бюро для старой кредитной истории в разрезе признака «статус кредита по месяцам» по истории кредитов из бюро.",
    "sql": "SELECT STATUS AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE < -12 GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните показатель DPD по POS-кредитам для POS-кредитов с просрочкой для разных значений признака «статус POS-договора» по POS-кредитам.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Установите пиковое значение суммы задолженности по кредитным обязательствам, зафиксированное в бюро кредитных историй.",
    "sql": "SELECT MAX(AMT_CREDIT_SUM_DEBT) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для POS-кредитов с количеством платежей более 6 (CNT_INSTALMENT > 6) в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для небольших кредитов (до 100 000) для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний остаток по кредитным картам (AMT_BALANCE) для карт без серьёзной просрочки по DPD_DEF (SK_DPD_DEF = 0) в разрезе по клиенту (SK_ID_CURR) с агрегацией по картам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднее значение установленного кредитного лимита по выпущенным кредитным картам.",
    "sql": "SELECT AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведи ID клиентов, у которых есть наш кредит (без дефолта) и при этом нет записей в кредитном бюро?",
    "sql": "SELECT T1.SK_ID_CURR FROM application_train AS T1 LEFT JOIN bureau AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T1.TARGET = 0 AND T2.SK_ID_CURR IS NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие данные кредитного бюро доступны для заемщика с ID 100005?",
    "sql": "SELECT * FROM bureau WHERE SK_ID_CURR = 100005;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для активных POS-кредитов (CNT_INSTALMENT_FUTURE > 0) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте средний кредитный портфель, сегментированный по гендерному признаку.",
    "sql": "SELECT CODE_GENDER, AVG(AMT_CREDIT) AS average_credit FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с максимальной просрочкой больше нуля (AMT_CREDIT_MAX_OVERDUE > 0) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите топ-5 категорий по назначению потребительских займов (NAME_CASH_LOAN_PURPOSE) по количеству поданных заявок.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(*) AS applications_count FROM previous_application WHERE NAME_CASH_LOAN_PURPOSE NOT IN ('XNA', 'Other') GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY applications_count DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество пролонгаций по кредитам из бюро для кредитов в основной валюте 'currency 1' для разных групп клиентов между типами кредитов, отражённых в бюро?",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните размер фактического платежа по рассрочке для рассрочек, по которым есть плановый платёж для разных значений признака «своевременность платежей» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните задержка платежа в днях для платежей по рассрочкам примерно за последний год между сегментами по признаку «факт просрочки платежа» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отобразите гистограмму, показывающую количество случаев отказа в кредите по дням недели начала обработки заявки.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите, как распределяются типы кредитных договоров.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(*) FROM application_train_test GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Можем ли мы увидеть историю заявок каждого клиента, то есть сколько предыдущих запросов на кредит они подавали?",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_ID_PREV) FROM previous_application GROUP BY SK_ID_CURR ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Тренд среднего количества дней просрочки по кредитам из БКИ за двухлетний период.",
    "sql": "SELECT CAST(ABS(DAYS_CREDIT)/365) AS years_ago, AVG(CREDIT_DAY_OVERDUE) FROM bureau WHERE ABS(DAYS_CREDIT) < 2*365 GROUP BY years_ago ORDER BY years_ago DESC",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для более старых карточных записей (MONTHS_BALANCE < -12), покажите средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Проанализируйте соотношение между запрашиваемой суммой и фактическим одобренным лимитом кредитования для клиента с ID 100007 по всем его прошлым кредитным обращениям.",
    "sql": "SELECT SK_ID_PREV, AMT_APPLICATION, AMT_CREDIT, NAME_CONTRACT_STATUS FROM previous_application WHERE SK_ID_CURR = 100007;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для POS-кредитов с коротким графиком между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Исследуйте временной ряд средних транзакционных платежей по карточным кредитным продуктам.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_PAYMENT_CURRENT) AS avg_payment_current FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Оценка среднего уровня текущей задолженности по активным кредитным продуктам в Бюро кредитных историй.",
    "sql": "SELECT AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND AMT_CREDIT_SUM_DEBT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Мне нужно сравнить среднее количество дней от решения по одобренным и отклоненным заявкам.",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(ABS(DAYS_DECISION)) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Отобразите топ-3 кода причин отказа по ранее поданным заявкам.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 3;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля NAME_PORTFOLIO показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_PORTFOLIO ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с непогашенным остатком (AMT_BALANCE > 0), покажите средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) по каждому значению поля CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_BALANCE > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какие средние чеки товаров для одобренных кредитов наблюдаются в зависимости от метода платежа?",
    "sql": "SELECT NAME_PAYMENT_TYPE, AVG(AMT_GOODS_PRICE) AS avg_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_PAYMENT_TYPE ORDER BY avg_goods_price DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по типу продукта (NAME_PRODUCT_TYPE).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для клиентов, которые уже брали кредит ранее между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково распределение клиентской базы по продолжительности трудоустройства?",
    "sql": "SELECT CASE WHEN DAYS_EMPLOYED >= 0 THEN 'Не трудоустроен/Неизвестно' WHEN ABS(DAYS_EMPLOYED)/365.25 < 1 THEN '< 1 года' WHEN ABS(DAYS_EMPLOYED)/365.25 >= 1 AND ABS(DAYS_EMPLOYED)/365.25 < 5 THEN '1-5 лет' WHEN ABS(DAYS_EMPLOYED)/365.25 >= 5 AND ABS(DAYS_EMPLOYED)/365.25 < 10 THEN '5-10 лет' WHEN ABS(DAYS_EMPLOYED)/365.25 >= 10 THEN '> 10 лет' END AS employment_years, COUNT(SK_ID_CURR) FROM application_train GROUP BY employment_years ORDER BY employment_years;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Определите среднее значение коэффициента \"кредит/стоимость товара\" по всем активным заявкам.",
    "sql": "SELECT AVG(AMT_CREDIT / AMT_GOODS_PRICE) FROM application_train WHERE AMT_GOODS_PRICE IS NOT NULL AND AMT_GOODS_PRICE != 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для предыдущих кредитов свыше 50 000 с ненулевым плановым платежом сгруппирует данные по доходности продукта (pa.NAME_YIELD_GROUP) и рассчитает среднюю долю просроченных платежей (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.AMT_CREDIT > 50000 AND ip.AMT_INSTALMENT > 0 ) SELECT NAME_YIELD_GROUP AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с количеством платежей до 6 (CNT_INSTALMENT <= 6) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля NAME_CLIENT_TYPE показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер первоначального взноса по предыдущим кредитам для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для предыдущих заявок с суммой кредита от 10 000 до 50 000 в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие изменения произошли в суммарном объеме кредитов, выданных по различным типам контрактов из таблицы 'previous_application', за последний 365-дневный период?",
    "sql": "SELECT NAME_CONTRACT_TYPE, SUM(AMT_CREDIT) FROM previous_application WHERE DAYS_DECISION >= -365 GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT) для фактических оплат по рассрочке (ip.AMT_PAYMENT > 0) в разрезе по типу кредитного продукта (pa.NAME_CONTRACT_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих платежей по картам для карт без тяжёлых просрочек в разрезе признака «тип поведения по карте» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт, по которым были выборки в текущем периоде (AMT_DRAWINGS_CURRENT > 0) в разрезе по клиенту (SK_ID_CURR) с агрегацией по картам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client) для предыдущих кредитов свыше 50 000 с ненулевым плановым платежом в разрезе по признаку просрочки платежа (delay_days > 0) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.AMT_CREDIT > 50000 AND ip.AMT_INSTALMENT > 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой процент заявок мы одобрили из всех прошлых?",
    "sql": "SELECT (COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 END) * 1.0 / COUNT(SK_ID_PREV)) AS approval_rate FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau_balance рассчитайте долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро для хороших статусов без просрочки (STATUS в ['0','C']) в разрезе по идентификатору кредита в бюро (SK_BUREAU_ID).",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS IN ('0','C') GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Оцените объем кредитного портфеля, сформированного из выданных кредитов за последний годовой период.",
    "sql": "SELECT SUM(AMT_CREDIT) FROM previous_application WHERE DAYS_DECISION >= -365;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для POS-кредитов с DPD_DEF > 0 в разрезе по статусу договора POS-кредита (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов с DPD_DEF > 0 в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Зависит ли средний доход от семейного положения наших заемщиков?",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY AVG(AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов с формально истёкшим сроком погашения для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE <= 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднее значение задержки платежа в днях (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) для первых шести платежей по рассрочке (NUM_INSTALMENT_NUMBER <= 6) в разрезе по каналу продаж (pa.CHANNEL_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT CHANNEL_TYPE AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для записей с активным статусом договора (NAME_CONTRACT_STATUS = 'Active') и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Визуализируйте показатель дефолтности для каждой сформированной возрастной группы клиентов.",
    "sql": "SELECT CASE WHEN ABS(DAYS_BIRTH)/365 < 25 THEN '18-24' WHEN ABS(DAYS_BIRTH)/365 < 35 THEN '25-34' WHEN ABS(DAYS_BIRTH)/365 < 45 THEN '35-44' WHEN ABS(DAYS_BIRTH)/365 < 55 THEN '45-54' WHEN ABS(DAYS_BIRTH)/365 < 65 THEN '55-64' ELSE '65+' END AS age_group, CAST(SUM(CASE WHEN TARGET = 1 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) AS default_rate FROM application_train GROUP BY age_group ORDER BY age_group;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для состояния кредитов в текущем месяце между разными категориями между свежими и старыми записями по кредитам?",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE = 0 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите численность лояльной клиентской базы (повторные заявки) или клиентов с высокой потребностью в кредитовании, имеющих более одной предыдущей заявки.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM previous_application GROUP BY SK_ID_CURR HAVING COUNT(SK_ID_PREV) > 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без серьёзной просрочки по DPD_DEF (SK_DPD_DEF = 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Давай посмотрим на тех клиентов, у кого в БКИ висит большой долг, но при этом они у нас еще не просрочили.",
    "sql": "SELECT at.SK_ID_CURR, SUM(b.AMT_CREDIT_SUM_DEBT) AS total_debt_bureau, at.AMT_CREDIT, at.AMT_INCOME_TOTAL FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE at.TARGET = 0 GROUP BY at.SK_ID_CURR, at.AMT_CREDIT, at.AMT_INCOME_TOTAL HAVING SUM(b.AMT_CREDIT_SUM_DEBT) > 1000000 ORDER BY total_debt_bureau DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каково среднее значение коэффициента Debt-to-Income (PTI) по всему портфелю?",
    "sql": "SELECT AVG(AMT_CREDIT / AMT_INCOME_TOTAL) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Отобразите статистику принятия решений по прошлым кредитным заявкам.",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Интересно, сколько наших клиентов уже перешли в категорию 'плохих долгов' по данным бюро балансов, то есть имеют просрочку 90+ дней?",
    "sql": "SELECT COUNT(DISTINCT b.SK_ID_CURR) FROM bureau_balance bb JOIN bureau b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID WHERE bb.STATUS IN ('4', '5');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется накопленный объём платежей по клиенту для условной половины клиентов по чётности ID между различными сегментами между разными версиями графиков платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для карт с нулевым остатком задолженности для разных групп между картами с высоким лимитом и остальными?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Можешь показать, какой средний заработок у людей с разными профессиями?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_INCOME_TOTAL) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY AVG(AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется долю просроченных платежей по рассрочке для условной половины клиентов по чётности ID между различными сегментами между ранними, средними и поздними платежами в графике в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для отказанных предыдущих кредитов между клиентами между отраслями продавцов, через которых оформлялись кредиты?",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для предыдущих заявок примерно за последний год между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проанализируйте динамику совокупного объема одобренных кредитов (AMT_CREDIT) по предыдущим заявкам, агрегированную по дням недели.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, SUM(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY SUM(AMT_CREDIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Отобразите долевое распределение различных статусов кредитной истории (STATUS) из отчетов БКИ для оценки качества кредитного портфеля.",
    "sql": "SELECT STATUS, COUNT(*) FROM bureau_balance GROUP BY STATUS ORDER BY COUNT(*) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для платежей без просрочки (DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT), покажите среднее количество дней до фактической даты платежа (DAYS_ENTRY_PAYMENT) по каждому значению поля SK_ID_PREV.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY SK_ID_PREV ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется значение MONTHS_BALANCE по кредитам в бюро для месяцев с наибольшей степенью просрочки между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS = '5' GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков средний совокупный доход по каждой категории семейного статуса клиентов?",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(AMT_INCOME_TOTAL) AS AverageIncome FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY AverageIncome DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей без просрочки (STATUS = '0'), покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки SK_BUREAU_ID.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS = '0' GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Предоставьте детализированное распределение числа дефолтных и недефолтных клиентов в разрезе их уровня образования.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FILTER (WHERE TARGET = 1) AS DefaultCount, COUNT(SK_ID_CURR) FILTER (WHERE TARGET = 0) AS NonDefaultCount FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY DefaultCount DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднее значение общего объема задолженности по всем предыдущим кредитам, зарегистрированным в БКИ, для группы клиентов, находящихся в дефолте.",
    "sql": "SELECT AVG(b.AMT_CREDIT_SUM_DEBT) FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE a.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков средний доход клиентов в каждой возрастной категории?",
    "sql": "SELECT CASE WHEN ABS(DAYS_BIRTH) / 365 < 25 THEN '18-24' WHEN ABS(DAYS_BIRTH) / 365 < 35 THEN '25-34' WHEN ABS(DAYS_BIRTH) / 365 < 45 THEN '35-44' WHEN ABS(DAYS_BIRTH) / 365 < 55 THEN '45-54' ELSE '55+' END AS age_group, AVG(AMT_INCOME_TOTAL) FROM application GROUP BY age_group ORDER BY age_group;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как соотносится образование и семейный статус среди наших клиентов? Покажите в таблице.",
    "sql": "SELECT NAME_FAMILY_STATUS, NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS num_clients FROM application_train GROUP BY NAME_FAMILY_STATUS, NAME_EDUCATION_TYPE ORDER BY NAME_FAMILY_STATUS, num_clients DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым известна фактическая дата завершения (DAYS_ENDDATE_FACT IS NOT NULL) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей с максимальной просрочкой (STATUS = '5'), покажите долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро по каждому значению поля группировки SK_BUREAU_ID.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS = '5' GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажи график, как среднее число дней просрочки менялось по годам, когда решения о кредитах принимались.",
    "sql": "SELECT STRFTIME('%Y', DATE(JULIANDAY('now'), p.DAYS_DECISION || ' day')) AS DecisionYear, AVG(b.CREDIT_DAY_OVERDUE) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR JOIN previous_application p ON at.SK_ID_CURR = p.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE IS NOT NULL GROUP BY DecisionYear ORDER BY DecisionYear;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для условной половины клиентов (по чётности ID) между разными категориями между активными и погашенными POS-кредитами?",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для карт с текущей задолженностью для разных групп между картами с высоким лимитом и остальными?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_BALANCE > 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Предоставьте список SK_ID_CURR дефолтных клиентов (TARGET = 1), которые имеют хотя бы одну запись в БКИ.",
    "sql": "SELECT DISTINCT T1.SK_ID_CURR, T1.TARGET FROM application_train AS T1 JOIN bureau AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T1.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется значение MONTHS_BALANCE по кредитам в бюро для месяцев без нарушений условий кредита между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS IN ('0','C') GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') и по каждому значению поля NAME_YIELD_GROUP показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите процент клиентов с детьми и без детей.",
    "sql": "SELECT CASE WHEN CNT_CHILDREN > 0 THEN 'With Children' ELSE 'No Children' END AS Children_Status, COUNT(SK_ID_CURR) FROM application_train GROUP BY Children_Status;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю долю просроченных платежей по рассрочкам для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) по по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 ) SELECT SK_ID_CURR AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднюю продолжительность дефолта по активным кредитным обязательствам в БКИ.",
    "sql": "SELECT AVG(CREDIT_DAY_OVERDUE) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков средний размер кредита для различных комбинаций пола и типа контракта?",
    "sql": "SELECT CODE_GENDER, NAME_CONTRACT_TYPE, AVG(AMT_CREDIT) AS avg_credit FROM application_train GROUP BY CODE_GENDER, NAME_CONTRACT_TYPE ORDER BY CODE_GENDER, NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для POS-операций примерно за последние полгода между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте список всех отклонённых предыдущих заявок для клиента 100002.",
    "sql": "SELECT * FROM previous_application WHERE SK_ID_CURR = 100002 AND NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте график изменения среднего объема дебиторской задолженности ('AMT_TOTAL_RECEIVABLE') по кредитным картам во времени.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_TOTAL_RECEIVABLE) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Кто из наших клиентов получал отказ по кредиту несколько раз?",
    "sql": "SELECT app.SK_ID_CURR, app.NAME_CONTRACT_TYPE, app.TARGET, COUNT(prev.SK_ID_PREV) AS refused_count FROM application_train app JOIN previous_application prev ON app.SK_ID_CURR = prev.SK_ID_CURR WHERE prev.NAME_CONTRACT_STATUS = 'Refused' GROUP BY app.SK_ID_CURR, app.NAME_CONTRACT_TYPE, app.TARGET HAVING refused_count > 1 ORDER BY refused_count DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните размер планового платежа по рассрочке для платежей, внесённых вовремя или раньше срока для разных значений признака «предыдущий кредит» в платёжной истории клиентов.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY SK_ID_PREV ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте отчет по активным займам из БКИ с индикатором просрочки, чтобы оценить качество кредитного портфеля.",
    "sql": "SELECT SK_ID_CURR, SK_BUREAU_ID, CREDIT_ACTIVE, CREDIT_DAY_OVERDUE, AMT_CREDIT_SUM, AMT_CREDIT_SUM_DEBT FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднюю загрузку кредитных карт (utilization) по сегментам для карт с заданным кредитным лимитом (AMT_CREDIT_LIMIT_ACTUAL > 0) в разрезе по месяцу истории по карте (MONTHS_BALANCE).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0 ) SELECT MONTHS_BALANCE AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков процент клиентов в нашей базе данных, которые имеют в собственности недвижимость?",
    "sql": "SELECT CAST(SUM(CASE WHEN FLAG_OWN_REALTY = 'Y' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как там наши целевые показатели распределяются по семейным статусам?",
    "sql": "SELECT NAME_FAMILY_STATUS, TARGET, COUNT(SK_ID_CURR) AS count FROM application_train GROUP BY NAME_FAMILY_STATUS, TARGET ORDER BY NAME_FAMILY_STATUS, TARGET;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для месяцев с небольшими просрочками в разрезе признака «кредит из бюро» по истории кредитов из бюро.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS IN ('1','2') GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Владельцы машин хуже или лучше платят по кредитам, чем те, у кого ее нет?",
    "sql": "SELECT FLAG_OWN_CAR, AVG(TARGET) * 100 AS default_rate FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните кредитный лимит по картам для кредитных карт с небольшим лимитом в разрезе признака «уровень кредитного лимита» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проанализируйте структуру расходов по кредитным картам, в частности, долю снятий наличных через банкоматы, POS-терминалы и прочие операции.",
    "sql": "SELECT 'ATM' AS type, SUM(AMT_DRAWINGS_ATM_CURRENT) AS total_amount FROM credit_card_balance UNION ALL SELECT 'POS' AS type, SUM(AMT_DRAWINGS_POS_CURRENT) AS total_amount FROM credit_card_balance UNION ALL SELECT 'Other' AS type, SUM(AMT_DRAWINGS_OTHER_CURRENT) AS total_amount FROM credit_card_balance;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Предоставьте список десяти клиентов с наибольшей совокупной задолженностью в бюро кредитных историй.",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_CREDIT_SUM_DEBT) AS TotalDebt FROM bureau GROUP BY SK_ID_CURR ORDER BY TotalDebt DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько заемщиков имеют хотя бы один текущий кредитный договор согласно данным БКИ?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как менялось число заявок, которые к нам поступали, за последний год, если смотреть по дням?",
    "sql": "SELECT ABS(DAYS_DECISION) AS days_ago, COUNT(*) AS application_count FROM previous_application WHERE DAYS_DECISION > -366 GROUP BY days_ago ORDER BY days_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Представьте список из десяти клиентов с наибольшим остатком по кредитным картам.",
    "sql": "SELECT SK_ID_CURR, MAX(AMT_BALANCE) AS MaxBalance FROM credit_card_balance GROUP BY SK_ID_CURR ORDER BY MaxBalance DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя разницу между фактическим и плановым платежом для начальных платежей по кредиту для разных групп клиентов между сегментами доходности кредитных продуктов, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT NAME_YIELD_GROUP AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для POS-кредитов без просрочки (SK_DPD = 0) в разрезе по признаку активный/закрытый POS-кредит (по CNT_INSTALMENT_FUTURE).",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково усредненное значение времени, затраченного на принятие решения (DAYS_DECISION) по заявлениям, получившим одобрение?",
    "sql": "SELECT AVG(-DAYS_DECISION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для POS-кредитов с DPD > 0 в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите долю одобренных кредитных заявок от общего количества поданных.",
    "sql": "SELECT CAST(COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 END) AS REAL) * 100 / COUNT(SK_ID_PREV) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как меняется вероятность дефолта, если мы посмотрим на клиентов с разным уровнем дохода, разбив их на 5 групп?",
    "sql": "SELECT NTILE(5) OVER (ORDER BY AMT_INCOME_TOTAL) AS income_quintile, AVG(TARGET) AS default_rate FROM application_train GROUP BY income_quintile ORDER BY income_quintile;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов без просрочки (SK_DPD = 0) и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитов, у которых срок уже должен был закончиться (DAYS_CREDIT_ENDDATE <= 0) в разрезе по статусу кредита (CREDIT_ACTIVE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE <= 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните загрузку кредитных карт (utilization) для карт, по которым клиент сейчас вносит платежи по признаку «уровень кредитного лимита», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какова общая стоимость всех товаров, фигурирующих в одобренных ранее заявках?",
    "sql": "SELECT SUM(AMT_GOODS_PRICE) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для клиентов, которые уже брали кредит ранее между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Идентифицируйте и покажите топ-5 кодов причин отклонения заявок на предыдущие кредиты.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' AND CODE_REJECT_REASON IS NOT NULL AND CODE_REJECT_REASON != 'XAP' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для кредитов с формально истёкшим сроком погашения для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE <= 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднее значение накопленного остатка по карте (cum_balance) для карт с тяжёлой просрочкой по DPD_DEF (SK_DPD_DEF > 0) в разрезе по уровню кредитного лимита (high_limit/low_or_medium_limit).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD_DEF > 0 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие основные причины берут кредит те, кто потом не платит? Покажи топ-5.",
    "sql": "SELECT p.NAME_CASH_LOAN_PURPOSE, COUNT(DISTINCT a.SK_ID_CURR) AS defaulter_count FROM application_train a JOIN previous_application p ON a.SK_ID_CURR = p.SK_ID_CURR WHERE a.TARGET = 1 AND p.NAME_CONTRACT_STATUS = 'Approved' GROUP BY p.NAME_CASH_LOAN_PURPOSE ORDER BY defaulter_count DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется показатель DPD_DEF по POS-кредитам для POS-операций примерно за последние полгода между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите общий уникальный клиентский пул.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей с ненулевым плановым платежом (AMT_INSTALMENT > 0), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_INSTALMENT > 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для второй половины клиентов по нечётности ID в разрезе признака «тип поведения по карте» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для месяцев с тяжёлыми просрочками между разными категориями между свежими и старыми записями по кредитам?",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS IN ('3','4','5') GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Посчитай, сколько в среднем выдают от запрошенной суммы по одобренным кредитам.",
    "sql": "SELECT AVG(CAST(AMT_CREDIT AS REAL) / AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND AMT_APPLICATION > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1), покажите среднее количество дней до фактической даты платежа (DAYS_ENTRY_PAYMENT) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 GROUP BY SK_ID_CURR ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подсчитайте метрику по количеству рефузированных контрактов.",
    "sql": "SELECT COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Отобразите средний фактический кредитный лимит по кредитным картам.",
    "sql": "SELECT AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по каналу продаж (CHANNEL_TYPE).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY CHANNEL_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните долю просроченных платежей по рассрочке для второй половины клиентов по чётности ID по признаку «версия графика платежей», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков средний срок до погашения для текущих активных кредитных продуктов, зафиксированных в БКИ?",
    "sql": "SELECT AVG(ABS(DAYS_CREDIT)) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND DAYS_CREDIT < 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Выведите ТОП причин отказа по предыдущим кредитным заявлениям.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE) для активных кредитов (CREDIT_ACTIVE = 'Active') в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для одобренных предыдущих кредитов для разных категорий по признаку «канал продаж» в прошлых заявках клиентов.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY CHANNEL_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните величина DAYS_DECISION по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подсчитайте общее число выданных микрозаймов.",
    "sql": "SELECT COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_TYPE = 'Cash loans' AND NFLAG_MICRO_CASH = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните среднюю по клиенту задержку платежей для начальных платежей по кредиту между сегментами по признаку «тип кредитного продукта по прошлым заявкам» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните стоимость товара по предыдущим кредитам для предыдущих заявок примерно за последний год для разных категорий по признаку «тип клиента» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля HOUR_APPR_PROCESS_START показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний фактический платёж по рассрочке (AMT_PAYMENT) для первых трёх платежей в графике (NUM_INSTALMENT_NUMBER <= 3) в разрезе по факту платёжной дисциплины (переплата/недоплата).",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте статистику по количеству клиентов, сгруппированных по их семейному положению.",
    "sql": "SELECT NAME_FAMILY_STATUS, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Можем ли мы увидеть топ-10 кредитных карт по текущему балансу?",
    "sql": "SELECT SK_ID_CURR, SK_ID_PREV, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL FROM credit_card_balance ORDER BY AMT_BALANCE DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для пролонгированных кредитов (CNT_CREDIT_PROLONG > 0) в разрезе по размеру кредита (AMT_CREDIT_SUM) с бинингом на крупные и остальные.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково общее количество обработанных кредитных заявок?",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train_test;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Предоставьте полную детализированную информацию о клиенте с идентификатором SK_ID_CURR = 100002.",
    "sql": "SELECT * FROM application_train WHERE SK_ID_CURR = 100002;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитных карт с лимитом (AMT_CREDIT_SUM_LIMIT > 0) в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для новых клиентов (NAME_CLIENT_TYPE = 'New') и по каждому значению поля NAME_CONTRACT_TYPE показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте гистограмму, отображающую распределение клиентской базы по показателю 'количество детей'.",
    "sql": "SELECT CNT_CHILDREN, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каково распределение клиентской базы по типам сопровождения?",
    "sql": "SELECT NAME_TYPE_SUITE, COUNT(*) FROM application_train GROUP BY NAME_TYPE_SUITE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сколько процентов клиентов, у которых уже есть активные кредиты по данным БКИ, в итоге не платят по долгам?",
    "sql": "SELECT AVG(app.TARGET) * 100 FROM application_train_test app JOIN (SELECT DISTINCT SK_ID_CURR FROM bureau WHERE CREDIT_ACTIVE = 'Active') b_active ON app.SK_ID_CURR = b_active.SK_ID_CURR",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Предоставьте перечень клиентов с высокой частотой подачи заявок (более трех) за последний год, включая статусы решений по этим заявкам.",
    "sql": "SELECT t1.SK_ID_CURR, COUNT(t2.SK_ID_PREV) AS applications_count, GROUP_CONCAT(t2.NAME_CONTRACT_STATUS) AS contract_statuses FROM application AS t1 JOIN previous_application AS t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR WHERE t2.DAYS_DECISION BETWEEN -365 AND 0 GROUP BY t1.SK_ID_CURR HAVING applications_count > 3 LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для закрытых кредитов (STATUS = 'C'), покажите долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро по каждому значению поля группировки CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS = 'C' GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Визуализируй распределение кодов причин отказов по предыдущим кредитам для выявления паттернов отклонения.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) AS RejectionCount FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' AND CODE_REJECT_REASON != 'XNA' GROUP BY CODE_REJECT_REASON ORDER BY RejectionCount DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для POS-кредитов с серьёзной просрочкой для разных значений признака «статус POS-договора» по POS-кредитам.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для кредитов, по которым есть долг для разных групп клиентов между типами кредитов, отражённых в бюро?",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без просрочки по DPD (SK_DPD = 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково среднее число транзакций по POS-терминалу в прошлом месяце?",
    "sql": "SELECT AVG(CNT_DRAWINGS_POS_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE = (SELECT MAX(MONTHS_BALANCE) FROM credit_card_balance);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с CTE, где сначала по каждому SK_BUREAU_ID считается bad_month_share, а затем в разрезе по типу кредита (b.CREDIT_TYPE) агрегируется среднюю долю месяцев с просрочкой по кредитам (bad_month_share) для активных кредитов из бюро (b.CREDIT_ACTIVE = 'Active').",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_TYPE AS group_key, AVG(bad_month_share) AS metric_value FROM bb_agg GROUP BY CREDIT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие пять профессий у наших клиентов получают в среднем больше всего?",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_INCOME_TOTAL) AS average_income FROM application_train GROUP BY OCCUPATION_TYPE ORDER BY average_income DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с CTE, где сначала по каждому SK_BUREAU_ID считается bad_month_share, а затем в разрезе по валюте кредита (b.CREDIT_CURRENCY) агрегируется среднее значение максимального месяца наблюдения (max_month) для месяцев без просрочки (bb.STATUS = '0').",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS = '0' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_CURRENCY AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CREDIT_CURRENCY ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выявите три наиболее распространенных типа жилища среди заявителей на кредит.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) AS application_count FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY application_count DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов с просрочкой в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните отношение платежей к объёму выборок по картам для карт, по которым задан лимит по признаку «тип продукта по прошлым кредитам» на уровне клиентов, используя как данные по прошлым кредитам, так и агрегированную статистику по картам.",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.AMT_CREDIT_LIMIT_ACTUAL > 0 GROUP BY cc.SK_ID_CURR ) SELECT pa.NAME_CONTRACT_TYPE AS group_key, AVG(pay_vs_spend_ratio) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте ежемесячную динамику числа поданных заявок на кредитные продукты в банке.",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(JULIANDAY('now') + DAYS_DECISION)) AS ApplicationMonth, COUNT(*) FROM previous_application GROUP BY ApplicationMonth ORDER BY ApplicationMonth;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Отобразите долевое соотношение образовательных групп в клиентском портфеле с помощью круговой диаграммы для оценки демографического состава.",
    "sql": "SELECT NAME_EDUCATION_TYPE, CAST(COUNT(SK_ID_CURR) AS REAL) * 100 / (SELECT COUNT(*) FROM application_train) AS Percentage FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY Percentage DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Представьте табличные данные по изменению статуса кредитного портфеля в БКИ за последние шесть месяцев.",
    "sql": "SELECT MONTHS_BALANCE, STATUS, COUNT(SK_BUREAU_ID) AS StatusCount FROM bureau_balance WHERE MONTHS_BALANCE >= -5 GROUP BY MONTHS_BALANCE, STATUS ORDER BY MONTHS_BALANCE DESC, STATUS;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт, по которым были выборки в текущем периоде (AMT_DRAWINGS_CURRENT > 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов, по которым известна фактическая дата завершения (DAYS_ENDDATE_FACT IS NOT NULL) в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какова суммарная величина дохода клиентов, обладающих собственным недвижимым имуществом?",
    "sql": "SELECT SUM(AMT_INCOME_TOTAL) FROM application_train WHERE FLAG_OWN_REALTY = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля NAME_CONTRACT_STATUS показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова средняя ежемесячная выплата по кредитам?",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM application_train WHERE AMT_ANNUITY IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для предыдущих заявок с суммой кредита более 50 000 в разрезе по дню недели принятия решения (WEEKDAY_APPR_PROCESS_START).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите среднее значение текущей общей суммы платежа по кредитной карте для группы клиентов, классифицированных как дефолтные.",
    "sql": "SELECT AVG(T2.AMT_PAYMENT_TOTAL_CURRENT) FROM application_train T1 JOIN credit_card_balance T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T1.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для прошлых заявок, принятых более года назад для разных категорий по признаку «тип кредитного продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для клиентов, которые уже брали кредит ранее для разных категорий по признаку «тип портфеля» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_PORTFOLIO ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите разбиение причин отклонения кредитных заявок по предыдущим обращениям.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для кредитов, открытых более года назад для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково распределение статусов кредитов в БКИ (CREDIT_ACTIVE) среди клиентов с хорошей и плохой платежной историей?",
    "sql": "SELECT at.TARGET, b.CREDIT_ACTIVE, COUNT(DISTINCT at.SK_ID_CURR) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.TARGET, b.CREDIT_ACTIVE;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с DPD > 0 и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков средний уровень просроченной задолженности из БКИ на клиента, сгруппированный по возрасту?",
    "sql": "SELECT AgeGroup, AVG(OverdueCount) AS AverageOverdueCreditsPerClient FROM (SELECT at.SK_ID_CURR, CASE WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 25 THEN 'До 25' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 35 THEN '26-35' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 45 THEN '36-45' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 55 THEN '46-55' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 65 THEN '56-65' ELSE 'Старше 65' END AS AgeGroup, SUM(CASE WHEN b.CREDIT_DAY_OVERDUE > 0 THEN 1 ELSE 0 END) AS OverdueCount FROM application_train at LEFT JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.SK_ID_CURR, AgeGroup) AS Subquery GROUP BY AgeGroup ORDER BY AgeGroup;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для новых клиентов (pa.NAME_CLIENT_TYPE = 'New') сгруппирует данные по доходности продукта (pa.NAME_YIELD_GROUP) и рассчитает среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT NAME_YIELD_GROUP AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю разницу между фактическим и плановым платежом (payment_diff) для первых 12 платежей в графике по по уровню накопленных платежей cum_payment (low/medium/high).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Проанализируйте распределение уровня образования заемщиков по их семейному положению.",
    "sql": "SELECT NAME_FAMILY_STATUS, NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS num_clients FROM application_train GROUP BY NAME_FAMILY_STATUS, NAME_EDUCATION_TYPE ORDER BY NAME_FAMILY_STATUS, num_clients DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для действующих кредитов клиента в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково распределение числа кредитных заявок в зависимости от уровня образования заемщиков?",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните разницу между фактическим и плановым платежом для клиентов, которые впервые обращаются за кредитом между сегментами по признаку «тип клиента» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для отсутствующих платежей (ip.AMT_PAYMENT = 0) сгруппирует данные по каналу продаж (pa.CHANNEL_TYPE) и рассчитает среднюю долю просроченных платежей (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT = 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля HOUR_APPR_PROCESS_START показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется накопленный объём платежей по клиенту для рассрочек с реальным графиком платежей между различными сегментами между просроченными и своевременными платежами в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для клиентов, обращающихся впервые для разных категорий по признаку «статус прошлой заявки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT) для новых клиентов (pa.NAME_CLIENT_TYPE = 'New') в разрезе по каналу продаж (pa.CHANNEL_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT CHANNEL_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Интересно, как наличие детей влияет на количество заявок на кредит, которые клиент подавал раньше?",
    "sql": "SELECT at.CNT_CHILDREN, COUNT(pa.SK_ID_PREV) AS num_previous_applications FROM application_train at LEFT JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR GROUP BY at.CNT_CHILDREN ORDER BY at.CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков средний возраст клиентов, инициировавших кредитную заявку после 18:00 или до 9:00?",
    "sql": "SELECT AVG(ABS(DAYS_BIRTH) / 365) FROM application_train WHERE HOUR_APPR_PROCESS_START NOT BETWEEN 9 AND 18;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') и по каждому значению поля NAME_CLIENT_TYPE показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков средний возрастной показатель для заемщиков, демонстрирующих дефолтное поведение?",
    "sql": "SELECT AVG(ABS(DAYS_BIRTH) / 365) AS avg_age FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выявите топ-5 наиболее востребованных целей для одобренных кредитных продуктов.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитных карт с лимитом (AMT_CREDIT_SUM_LIMIT > 0) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какие клиенты имеют доход более 1M и кредит более 2M?",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT, NAME_EDUCATION_TYPE FROM application_train WHERE AMT_INCOME_TOTAL > 1000000 AND AMT_CREDIT > 2000000;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер планового платежа по рассрочке для более поздних платежей по рассрочке между разными группами между своевременными и просроченными платежами?",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте график, иллюстрирующий средний кредитный лимит по месяцам для кредитных карт.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Определите средний эффективный кредитный лимит в карточном портфеле.",
    "sql": "SELECT AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество оставшихся платежей по POS-кредитам для POS-операций, которые были от полугода до года назад для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам в бюро для состояния кредитов в прошлом месяце в разрезе признака «кредит из бюро» по истории кредитов из бюро.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE = -1 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для крупных кредитов (свыше 100 000) для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Кто из клиентов имеет общую долговую нагрузку по БКИ более одного миллиона рублей?",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_CREDIT_SUM_DEBT) AS total_bureau_debt FROM bureau GROUP BY SK_ID_CURR HAVING total_bureau_debt > 1000000 ORDER BY total_bureau_debt DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каковы полные сведения о кредитной истории заемщика с SK_ID_CURR 100002, доступные в Бюро?",
    "sql": "SELECT * FROM bureau WHERE SK_ID_CURR = 100002",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля NAME_CONTRACT_TYPE показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Вычислите общий объем текущих непогашенных обязательств по активным кредитам.",
    "sql": "SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для более старых POS-записей (MONTHS_BALANCE < -12) в разрезе по статусу договора POS-кредита (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте детали всех активных кредитных договоров, имеющих текущую просроченную задолженность, согласно данным БКИ.",
    "sql": "SELECT SK_ID_CURR, SK_BUREAU_ID, CREDIT_ACTIVE, CREDIT_DAY_OVERDUE, AMT_CREDIT_SUM, AMT_CREDIT_SUM_DEBT FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов без серьёзной просрочки (SK_DPD_DEF = 0) и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Выведите процент одобрения по всем ранее поданным заявкам.",
    "sql": "SELECT CAST(COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN SK_ID_PREV END) AS REAL) * 100 / COUNT(SK_ID_PREV) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и агрегированных данных credit_card_balance по клиенту рассчитайте среднее отношение платежей к выборкам по картам (AMT_PAYMENT_CURRENT / NULLIF(AMT_DRAWINGS_CURRENT, 0)) для карт с текущими выборками средств (cc.AMT_DRAWINGS_CURRENT > 0) в разрезе по типу предыдущего кредитного продукта (pa.NAME_CONTRACT_TYPE).",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.AMT_DRAWINGS_CURRENT > 0 GROUP BY cc.SK_ID_CURR ) SELECT pa.NAME_CONTRACT_TYPE AS group_key, AVG(pay_vs_spend_ratio) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проанализируйте временную динамику среднего значения общего объема задолженности ('AMT_TOTAL_RECEIVABLE') по кредитным картам.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_TOTAL_RECEIVABLE) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с давними обновлениями (DAYS_CREDIT_UPDATE <= -30) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите средний уровень дефолтности для сегмента заемщиков, владеющих автомобилем.",
    "sql": "SELECT AVG(TARGET) FROM application_train WHERE FLAG_OWN_CAR = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте график среднего показателя кредитной активности (запросов в БКИ) по возрастным интервалам.",
    "sql": "SELECT CAST(ABS(DAYS_BIRTH) / 365 / 10 AS INT) * 10 AS age_group, AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train GROUP BY age_group ORDER BY age_group;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для отказанных предыдущих кредитов между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите структуру клиентов по типам образования, отсортированную по убыванию.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте график изменения усредненного остатка по кредитным картам за последние месяцы.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) AS avg_balance FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как часто дефолтят клиенты с разным числом детей?",
    "sql": "SELECT CNT_CHILDREN, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько всего раз наши клиенты \"косячили\" с платежами по другим кредитам, согласно данным БКИ?",
    "sql": "SELECT COUNT(bb.STATUS) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1', '2', '3', '4', '5');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитных карт с лимитом (AMT_CREDIT_SUM_LIMIT > 0) в разрезе по размеру кредита (AMT_CREDIT_SUM) с бинингом на крупные и остальные.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова структура нашей клиентской базы по семейному статусу?",
    "sql": "SELECT NAME_FAMILY_STATUS, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Проанализируйте еженедельную динамику количества отклоненных заявок, сгруппированных по дням недели их подачи.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите уровень дефолта (дефолт рейт) среди заявителей, которые на момент подачи заявки не имели официальной занятости.",
    "sql": "SELECT AVG(TARGET) FROM application_train WHERE DAYS_EMPLOYED = 365243;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте средний накопленный объём платежей по клиенту (cum_payment) для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) в разрезе по уровню накопленных платежей cum_payment (low/medium/high).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Исследовать корреляцию между количеством иждивенцев (детей) и средней величиной кредита.",
    "sql": "SELECT CNT_CHILDREN, AVG(AMT_CREDIT) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте детальную информацию о клиентах, чьи записи в БКИ содержат кредиты со статусом 'плохой долг' (категория '5' просрочки).",
    "sql": "SELECT at.SK_ID_CURR, at.AMT_INCOME_TOTAL, at.AMT_CREDIT, bb.STATUS, b.CREDIT_ACTIVE FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS = '5' LIMIT 50;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам для новых клиентов (NAME_CLIENT_TYPE = 'New') в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю долю просроченных платежей (delay_days > 0) для платежей по рассрочке за последний год (DAYS_INSTALMENT BETWEEN -365 AND 0) в разрезе по каналу продаж (pa.CHANNEL_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте статистику по отклоненным кредитным заявкам, сгруппированную по кодам причин отказа.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какая была средняя ежегодная выплата по кредитам, которые мы уже одобрили?",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как соотносится количество отказов по заявкам на кредит в зависимости от того, есть ли у клиента собственный автомобиль?",
    "sql": "SELECT at.FLAG_OWN_CAR, COUNT(pa.SK_ID_PREV) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Refused' GROUP BY at.FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя накопленный остаток по карте для карточной истории за последний год для разных сегментов между разными месяцами наблюдения по картам с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE > -12 ) SELECT MONTHS_BALANCE AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Оцените процент клиентов с дефолтом (TARGET = 1) среди пула заемщиков, имеющих активные кредитные обязательства в БКИ.",
    "sql": "SELECT (SUM(CASE WHEN app.TARGET = 1 THEN 1 ELSE 0 END) * 100.0) / COUNT(DISTINCT app.SK_ID_CURR) FROM application_train_test app JOIN bureau b ON app.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На сколько дней в среднем задерживают платежи по действующим кредитам, если просрочка есть?",
    "sql": "SELECT AVG(CREDIT_DAY_OVERDUE) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер первоначального взноса по предыдущим кредитам для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с максимальной просрочкой больше нуля (AMT_CREDIT_MAX_OVERDUE > 0) и по каждому значению группировки (CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-записей от 6 до 12 месяцев назад и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какова средняя сумма одобренного товара по прошлым кредитам для клиентов со статусом 'Married'?",
    "sql": "SELECT AVG(pa.AMT_GOODS_PRICE) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE at.NAME_FAMILY_STATUS = 'Married' AND pa.NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте общее число клиентов, не имеющих кредитной истории, зафиксированной в Бюро кредитных историй.",
    "sql": "SELECT (SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train) - COUNT(DISTINCT SK_ID_CURR) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Предоставьте перечень идентификаторов клиентов, имеющих дефолт по текущим обязательствам (TARGET=1) при отсутствии активных кредитных линий в Бюро кредитных историй или при наличии только закрытых/проблемных.",
    "sql": "SELECT app.SK_ID_CURR FROM application_train_test app LEFT JOIN bureau b ON app.SK_ID_CURR = b.SK_ID_CURR WHERE app.TARGET = 1 AND b.SK_ID_CURR IS NULL OR (b.CREDIT_ACTIVE = 'Closed' OR b.CREDIT_ACTIVE = 'Bad debt');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните средний кредитный лимит по кредитным картам для дефолтных и недефолтных клиентов.",
    "sql": "SELECT a.TARGET, AVG(ccb.AMT_CREDIT_LIMIT_ACTUAL) AS Average_Credit_Limit FROM application_train a JOIN credit_card_balance ccb ON a.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY a.TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова взаимосвязь между фактом владения автомобилем и частотой дефолтов среди заемщиков различных возрастных групп?",
    "sql": "SELECT CASE WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 25 THEN 'До 25' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 35 THEN '26-35' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 45 THEN '36-45' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 55 THEN '46-55' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 65 THEN '56-65' ELSE 'Старше 65' END AS AgeGroup, FLAG_OWN_CAR, AVG(TARGET) AS DefaultRate FROM application_train GROUP BY AgeGroup, FLAG_OWN_CAR ORDER BY AgeGroup, FLAG_OWN_CAR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните размер кредита по данным бюро для кредитов с известной датой закрытия в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с высоким лимитом (AMT_CREDIT_LIMIT_ACTUAL > 50 000), покажите средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) по каждому значению поля CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 50000 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется значение MONTHS_BALANCE по кредитам в бюро для старой кредитной истории между разными категориями между свежими и старыми записями по кредитам?",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Отобразите ежемесячный статус и просрочки по кредиту, связанному с SK_BUREAU_ID 5886650, в хронологическом порядке.",
    "sql": "SELECT MONTHS_BALANCE, STATUS FROM bureau_balance WHERE SK_BUREAU_ID = 5886650 ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт без текущего остатка (AMT_BALANCE = 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте уровень риска (дефолта) в разрезе наличия личного автомобиля у заявителя.",
    "sql": "SELECT FLAG_OWN_CAR, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS default_rate FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите средний карточный баланс клиентов с просрочками в кредитной истории.",
    "sql": "SELECT AVG(ccb.AMT_BALANCE) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE > 0 AND ccb.AMT_BALANCE IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднюю долю месяцев с просрочкой по картам (SK_DPD > 0) для более старой карточной истории (MONTHS_BALANCE <= -12) по по уровню кредитного лимита (high_limit/low_or_medium_limit).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE <= -12 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(CASE WHEN SK_DPD > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для крупных кредитов (свыше 100 000) в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для истории кредитов за последние полгода между разными категориями между разными статусами состояния кредита в разрезе месяцев?",
    "sql": "SELECT STATUS AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE > -6 GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каковы средние показатели частоты запросов в БКИ для мужчин по сравнению с женщинами?",
    "sql": "SELECT CODE_GENDER, AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Интересует средний возраст по портфелю клиентов с револьверными кредитами, не так ли?",
    "sql": "SELECT AVG(ABS(DAYS_BIRTH) / 365) FROM application_train WHERE NAME_CONTRACT_TYPE = 'Revolving loans'",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каково количество клиентов с мульти-кредитным обременением в БКИ?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_credits FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING COUNT(SK_BUREAU_ID) > 1) AS subquery;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для клиентов, которые уже брали кредит ранее между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Вывести текущие данные по кредитным картам (баланс, лимит, платеж) для сегмента клиентов с зафиксированными просрочками в БКИ.",
    "sql": "SELECT ccb.SK_ID_CURR, ccb.AMT_BALANCE, ccb.AMT_CREDIT_LIMIT_ACTUAL, ccb.AMT_PAYMENT_TOTAL_CURRENT FROM credit_card_balance ccb JOIN (SELECT DISTINCT SK_ID_CURR FROM bureau WHERE CREDIT_DAY_OVERDUE > 0) b ON ccb.SK_ID_CURR = b.SK_ID_CURR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер первоначального взноса по предыдущим кредитам для предыдущих заявок с суммой кредита более 50 000 в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какова средняя сумма запрашиваемого финансирования (AMT_APPLICATION) в разрезе семейного статуса потенциальных заемщиков?",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(pa.AMT_APPLICATION) AS avg_application_amount FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY avg_application_amount DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих платежей по картам для карт с нулевым остатком задолженности для разных групп между разными статусами договоров по кредитным картам?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните разницу между фактическим и плановым платёжом по рассрочке для рассрочек с реальным графиком платежей по признаку «уровень накопленных платежей», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT) для повторных клиентов (pa.NAME_CLIENT_TYPE = 'Repeater') в разрезе по типу клиента (pa.NAME_CLIENT_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт, по которым были выборки в текущем периоде (AMT_DRAWINGS_CURRENT > 0) в разрезе по месяцу отчётности по карте (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднее значение показателя LTV (Loan-to-Value), используя отношение суммы кредита к стоимости товара, для активных заявок.",
    "sql": "SELECT AVG(AMT_CREDIT / AMT_GOODS_PRICE) FROM application_train WHERE AMT_GOODS_PRICE IS NOT NULL AND AMT_GOODS_PRICE != 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте график количества обработанных заявок за каждый час суток, разбив по статусу (одобрено/отказано).",
    "sql": "SELECT HOUR_APPR_PROCESS_START, NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY HOUR_APPR_PROCESS_START, NAME_CONTRACT_STATUS ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какие из кредитных целей характеризуются минимальным процентом отказа в одобрении?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) * 100.0 / COUNT(SK_ID_PREV) AS refusal_rate FROM previous_application GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY refusal_rate ASC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Оцените среднюю длительность процесса принятия решения по ранее поданным заявкам.",
    "sql": "SELECT AVG(ABS(DAYS_DECISION)) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с CTE, где сначала по каждому SK_BUREAU_ID считается bad_month_share, а затем в разрезе по типу кредита (b.CREDIT_TYPE) агрегируется среднее значение максимального месяца наблюдения (max_month) для активных кредитов из бюро (b.CREDIT_ACTIVE = 'Active').",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_TYPE AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CREDIT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для клиентов, обращающихся впервые для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите общее число отклоненных кредитных заявок.",
    "sql": "SELECT COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется показатель DPD_DEF по POS-кредитам для условной половины клиентов (по чётности ID) между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Выявите идентификаторы клиентов, у которых зарегистрировано более трех кредитов со статусом просрочки (1 или 2) в БКИ.",
    "sql": "SELECT b.SK_ID_CURR FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1', '2') GROUP BY b.SK_ID_CURR HAVING COUNT(DISTINCT b.SK_BUREAU_ID) > 3;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для одобренных предыдущих кредитов между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Можем ли мы узнать среднее число детей или иждивенцев, указанных в заявках?",
    "sql": "SELECT AVG(CNT_CHILDREN) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите месячную динамику объема кредитных заявок, исходя из даты принятия решения.",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(CURRENT_DATE, '-' || ABS(DAYS_DECISION) || ' day')) AS DecisionMonth, COUNT(SK_ID_PREV) AS ApplicationCount FROM previous_application GROUP BY DecisionMonth ORDER BY DecisionMonth;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов, по которым данные давно не обновлялись в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Можем ли мы идентифицировать высокодоходных клиентов с крупными кредитными обязательствами?",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT, NAME_EDUCATION_TYPE FROM application_train WHERE AMT_INCOME_TOTAL > 1000000 AND AMT_CREDIT > 2000000;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите число заемщиков, классифицированных как 'плохой долг' (просрочка 90+ дней) в данных бюро кредитных историй.",
    "sql": "SELECT COUNT(DISTINCT b.SK_ID_CURR) FROM bureau_balance bb JOIN bureau b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID WHERE bb.STATUS IN ('4', '5');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Идентифицируйте доминирующие факторы, приведшие к отклонению предыдущих кредитных заявок.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Если у клиента дефолт (TARGET = 1), сколько у него в среднем контактов в 'социальном круге'?",
    "sql": "SELECT AVG(OBS_30_CNT_SOCIAL_CIRCLE) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт, по которым были выборки в текущем периоде (AMT_DRAWINGS_CURRENT > 0) в разрезе по клиенту (SK_ID_CURR) с агрегацией по картам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков суммарный объем финансирования, предоставленного в рамках ранее утвержденных кредитных заявок?",
    "sql": "SELECT SUM(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните стоимость товара по предыдущим кредитам для предыдущих заявок примерно за последний год для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Идентифицировать уникальных клиентов, чье число предыдущих обращений превышает три.",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_ID_PREV) AS num_applications FROM previous_application GROUP BY SK_ID_CURR HAVING num_applications > 3 ORDER BY num_applications DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализируйте среднюю сумму кредита для каждой категории занятости клиентов.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_CREDIT) FROM application GROUP BY OCCUPATION_TYPE ORDER BY AVG(AMT_CREDIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для кредитов с нечётным SK_BUREAU_ID, покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE SK_BUREAU_ID % 2 = 1 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков процент клиентов с просроченной задолженностью (PD) более 30 дней в БКИ?",
    "sql": "SELECT CAST(COUNT(DISTINCT T1.SK_ID_CURR) AS REAL) * 100 / (SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau) FROM bureau AS T1 JOIN bureau_balance AS T2 ON T1.SK_BUREAU_ID = T2.SK_BUREAU_ID WHERE T2.STATUS IN ('1', '2', '3', '4', '5');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова взаимосвязь между часом подачи заявления и риском дефолта?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, AVG(TARGET) * 100 FROM application_train_test GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Анализ средней частоты использования банкоматов для снятия наличных по кредитным картам.",
    "sql": "SELECT AVG(CNT_DRAWINGS_ATM_CURRENT) FROM credit_card_balance WHERE CNT_DRAWINGS_ATM_CURRENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для новых клиентов (NAME_CLIENT_TYPE = 'New') и по каждому значению поля CHANNEL_TYPE показывается среднюю стоимость товара по предыдущим кредитам.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY CHANNEL_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для условной половины клиентов по чётности ID для разных групп между разными статусами договоров по кредитным картам?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт с лимитом до 50 000 в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте средний коэффициент суммы кредита к стоимости товара для различных типов договоров.",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_CREDIT / AMT_GOODS_PRICE) AS credit_to_goods_ratio FROM application_train WHERE AMT_GOODS_PRICE IS NOT NULL AND AMT_GOODS_PRICE > 0 GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по картам для истории по картам старше года по признаку «уровень использования лимита», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE <= -12 ) SELECT CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END AS group_key, AVG(CASE WHEN SK_DPD > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM cc GROUP BY CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните значение DAYS_INSTALMENT для платежей, внесённых позже плановой даты для разных значений признака «тип платёжной дисциплины» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для действующих POS-договоров между разными категориями между активными и погашенными POS-кредитами?",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам для предыдущих заявок с суммой кредита от 10 000 до 50 000 в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково количество и основные причины отказа по кредитным заявкам?",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю долю просроченных платежей (delay_days > 0) для фактических оплат по рассрочке (ip.AMT_PAYMENT > 0) в разрезе по типу кредитного продукта (pa.NAME_CONTRACT_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний остаток по кредитным картам (AMT_BALANCE) для карточных записей от полугода до года назад в разрезе по месяцу отчётности по карте (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните показатель DPD по POS-кредитам для старых POS-операций (старше года) для разных значений признака «статус POS-договора» по POS-кредитам.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для новых клиентов (NAME_CLIENT_TYPE = 'New') в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой уровень просрочки наблюдается у самых крупных должников в БКИ (топ-10 по сумме долга)?",
    "sql": "WITH RankedClients AS (SELECT SK_ID_CURR, SUM(AMT_CREDIT_SUM_DEBT) AS Total_Debt FROM bureau GROUP BY SK_ID_CURR ORDER BY Total_Debt DESC), Top10PercentClients AS (SELECT SK_ID_CURR FROM RankedClients LIMIT (SELECT CEIL(COUNT(DISTINCT SK_ID_CURR) * 0.1) FROM bureau)) SELECT AVG(a.TARGET) * 100 FROM application_train a JOIN Top10PercentClients tpc ON a.SK_ID_CURR = tpc.SK_ID_CURR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний фактический платёж по рассрочке (AMT_PAYMENT) для просроченных платежей (DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT) в разрезе по предыдущему кредиту (SK_ID_PREV).",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY SK_ID_PREV ORDER BY avg_amt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE) для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю долю просроченных платежей по рассрочкам для записей с ненулевым плановым платежом по по сегментам номера платежа (early/middle/late).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя накопленный остаток по карте для карт с текущей задолженностью для разных сегментов между разными месяцами наблюдения по картам с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_BALANCE > 0 ) SELECT MONTHS_BALANCE AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте отчет (таблицу) по клиентам с критическим уровнем просрочки (DOD > 30 дней) согласно данным БКИ, включая SK_ID_CURR и сумму кредита.",
    "sql": "SELECT app.SK_ID_CURR, app.AMT_CREDIT, bureau.CREDIT_DAY_OVERDUE FROM application_train app JOIN bureau ON app.SK_ID_CURR = bureau.SK_ID_CURR WHERE bureau.CREDIT_DAY_OVERDUE > 30 ORDER BY bureau.CREDIT_DAY_OVERDUE DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите распределение одобренных и отклоненных заявок по дням недели.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS approved_count, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS refused_count FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY approved_count DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя разницу между фактическим и плановым платежом для тех платежей, которые действительно были внесены для разных групп клиентов между каналами оформления (отделения, партнёры, онлайн), если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте долю дефолтных займов среди работающих клиентов.",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train WHERE NAME_INCOME_TYPE = 'Working';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Отобразите месячную динамику активных кредитов в БКИ за последний год.",
    "sql": "SELECT MONTHS_BALANCE, COUNT(DISTINCT SK_BUREAU_ID) FROM bureau_balance WHERE STATUS IN ('0', '1', 'C') AND MONTHS_BALANCE >= -12 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сколько в среднем зарабатывают клиенты, у которых много проблемных контактов в соцсетях?",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE > 3",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Составьте список из 10 клиентов, имеющих максимальное количество годовых запросов в БКИ.",
    "sql": "SELECT SK_ID_CURR, AMT_REQ_CREDIT_BUREAU_YEAR FROM application_train ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните кредитный лимит по картам для карт с тратами в текущем месяце в разрезе признака «тип поведения по карте» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество оставшихся платежей по POS-кредитам для старых POS-операций (старше года) для разных значений признака «активность POS-кредита» по POS-кредитам.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько в среднем дней просрочено по действующим кредитам в БКИ?",
    "sql": "SELECT AVG(CREDIT_DAY_OVERDUE) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните показатель DPD по POS-кредитам для POS-кредитов с коротким графиком для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите зависимость уровня дефолта от количества запросов в БКИ за год.",
    "sql": "SELECT AMT_REQ_CREDIT_BUREAU_YEAR, AVG(TARGET) AS default_rate FROM application_train GROUP BY AMT_REQ_CREDIT_BUREAU_YEAR ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте гистограмму, показывающую, сколько клиентов имеют 0, 1, 2 и так далее кредитов в БКИ.",
    "sql": "SELECT COUNT(T2.SK_BUREAU_ID) AS num_bureau_credits, COUNT(DISTINCT T1.SK_ID_CURR) AS num_clients FROM application_train T1 LEFT JOIN bureau T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR GROUP BY num_bureau_credits ORDER BY num_bureau_credits;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каково текущее распределение клиентов по статусу их кредитов, зарегистрированных в БКИ?",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(DISTINCT SK_ID_CURR) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Дай мне раскладку по предыдущим заявкам: сколько одобрили, сколько отказали, а сколько сами отменили?",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) в разрезе по статусу договора POS-кредита (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для истории кредитов от года до двух лет назад в разрезе признака «статус кредита по месяцам» по истории кредитов из бюро.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -24 AND -13 GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для клиентов, которые уже брали кредит ранее для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для месяцев с серьёзными просрочками между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS IN ('2','3','4','5') GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажи мне 50 самых свежих отказов по кредитам и почему их завернули.",
    "sql": "SELECT SK_ID_CURR, SK_ID_PREV, CODE_REJECT_REASON, DAYS_DECISION FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' ORDER BY DAYS_DECISION DESC LIMIT 50;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для условной половины клиентов (по чётности ID) между разными категориями по разным месяцам наблюдения POS-кредитов?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подсчитайте количество клиентов, имевших хотя бы одну просрочку (дефолт) по их предшествующим кредитным продуктам.",
    "sql": "SELECT COUNT(DISTINCT b.SK_ID_CURR) FROM bureau b WHERE b.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для более старых кредитов (DAYS_CREDIT <= -365) и по каждому значению группировки (CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с заполненным аннуитетом (AMT_ANNUITY IS NOT NULL) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднюю долю месяцев с просрочкой по картам (SK_DPD > 0) для более старой карточной истории (MONTHS_BALANCE <= -12) по по уровню загрузки лимита utilization (high/medium/low).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE <= -12 ) SELECT CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END AS group_key, AVG(CASE WHEN SK_DPD > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM cc GROUP BY CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для действующих POS-договоров между разными категориями по разным месяцам наблюдения POS-кредитов?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для фактических оплат по рассрочке (ip.AMT_PAYMENT > 0) сгруппирует данные по признаку просрочки платежа (delay_days > 0) и рассчитает средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для кредитных карт с небольшим лимитом для разных групп между разными статусами договоров по кредитным картам?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по дню недели принятия решения (WEEKDAY_APPR_PROCESS_START).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определить количество уникальных клиентов, совершивших операции по снятию наличных через банкоматы с кредитных карт в последний доступный месяц.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM credit_card_balance WHERE MONTHS_BALANCE = (SELECT MAX(MONTHS_BALANCE) FROM credit_card_balance) AND AMT_DRAWINGS_ATM_CURRENT > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте график изменения объемов одобренных и отказанных кредитных заявок в годовом разрезе.",
    "sql": "SELECT CAST(2023 + DAYS_DECISION / 365 AS INT) AS decision_year, NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused') GROUP BY decision_year, NAME_CONTRACT_STATUS ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как наличие своего жилья влияет на вероятность дефолта по кредиту?",
    "sql": "SELECT FLAG_OWN_REALTY, AVG(TARGET) FROM application_train GROUP BY FLAG_OWN_REALTY ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих платежей по картам для активности по картам за последние полгода для разных групп между разными статусами договоров по кредитным картам?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой средний возраст у тех клиентов, кто активно обращался в БКИ больше трех раз за последний год?",
    "sql": "SELECT AVG(ABS(DAYS_BIRTH) / 365) FROM application_train WHERE AMT_REQ_CREDIT_BUREAU_YEAR > 3;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитов в условной валюте 'currency 1' в разрезе по валюте кредита (CREDIT_CURRENCY).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Выявите пять наиболее распространенных сочетаний 'Типа дохода' и 'Уровня образования' среди дефолтных заемщиков.",
    "sql": "SELECT NAME_INCOME_TYPE, NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS client_count FROM application_train WHERE TARGET = 1 GROUP BY NAME_INCOME_TYPE, NAME_EDUCATION_TYPE ORDER BY client_count DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT) для первых шести платежей по рассрочке (NUM_INSTALMENT_NUMBER <= 6) в разрезе по каналу продаж (pa.CHANNEL_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT CHANNEL_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой процент клиентов имеет Revolving loans как основной тип контракта?",
    "sql": "SELECT CAST(SUM(CASE WHEN NAME_CONTRACT_TYPE = 'Revolving loans' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля NAME_SELLER_INDUSTRY показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для более старых кредитов (DAYS_CREDIT <= -365) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество оставшихся платежей по POS-кредитам для POS-кредитов с серьёзной просрочкой для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для новых клиентов (NAME_CLIENT_TYPE = 'New') в разрезе по часу принятия решения (HOUR_APPR_PROCESS_START).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните размер планового платежа по рассрочке для платежей, внесённых позже плановой даты для разных значений признака «тип платёжной дисциплины» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля NAME_CONTRACT_TYPE показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Изучить динамику среднего числа контактов в социальном окружении в зависимости от уровня образования.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(OBS_30_CNT_SOCIAL_CIRCLE) FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE IS NOT NULL GROUP BY NAME_EDUCATION_TYPE ORDER BY AVG(OBS_30_CNT_SOCIAL_CIRCLE) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для активности по картам от полугода до года назад для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля NAME_SELLER_INDUSTRY показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните максимальный месяц наблюдения по кредиту для действующих кредитов по данным бюро в разрезе признака «тип кредита в бюро», если учитывать помесячную историю статусов кредитов из бюро.",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_TYPE AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CREDIT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю долю просроченных платежей (delay_days > 0) для первых шести платежей по рассрочке (NUM_INSTALMENT_NUMBER <= 6) в разрезе по типу клиента (pa.NAME_CLIENT_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для кредитных карт с небольшим лимитом для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита более 50 000 и по каждому значению поля NAME_YIELD_GROUP показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Отобразите количество обработанных заявок по каждому часу дня для оценки пиковых нагрузок.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) AS application_count FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих выборок по картам для карт с текущей задолженностью в разрезе признака «тип поведения по карте» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_BALANCE > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитных карт с лимитом (AMT_CREDIT_SUM_LIMIT > 0) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Процентное отношение заявок, поступивших в нерабочие часы (вне стандартного графика).",
    "sql": "SELECT (SUM(CASE WHEN HOUR_APPR_PROCESS_START < 9 OR HOUR_APPR_PROCESS_START >= 18 THEN 1 ELSE 0 END) * 100.0) / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните долю просроченных платежей по рассрочке для долгих рассрочек с большим количеством платежей по признаку «этап платежа в графике», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 12 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выведите общее число клиентов с активными просрочками в БКИ.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализируйте ежегодную динамику количества поданных заявок на микрокредиты (NFLAG_MICRO_CASH = 1).",
    "sql": "SELECT CAST(2023 + DAYS_DECISION / 365 AS INT) AS decision_year, COUNT(SK_ID_PREV) FROM previous_application WHERE NFLAG_MICRO_CASH = 1 GROUP BY decision_year ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для карт, по которым вносились платежи в разрезе признака «клиент» по кредитным картам клиентов.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для старых POS-операций (старше года) между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой была средняя сумма займа по всем отклоненным ранее кредитным запросам?",
    "sql": "SELECT AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих платежей по картам для старой активности по картам в разрезе признака «тип поведения по карте» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей старше двух лет (MONTHS_BALANCE < -24), покажите долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро по каждому значению поля группировки CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE < -24 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым известна фактическая дата завершения (DAYS_ENDDATE_FACT IS NOT NULL) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для условной половины клиентов (по чётности ID) между разными категориями между клиентами по их POS-истории?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте график изменения количества заявок на кредиты, детализированный по месяцам принятия решения.",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(CURRENT_DATE, '-' || ABS(DAYS_DECISION) || ' day')) AS DecisionMonth, COUNT(SK_ID_PREV) AS ApplicationCount FROM previous_application GROUP BY DecisionMonth ORDER BY DecisionMonth;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сколько наших клиентов уже имели просрочки по кредитам, судя по данным из БКИ?",
    "sql": "SELECT CAST(COUNT(DISTINCT T1.SK_ID_CURR) AS REAL) * 100 / (SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train) FROM application_train T1 JOIN bureau T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T2.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оценка доли клиентов с просрочками в БКИ, сегментированная по типу образования.",
    "sql": "SELECT t1.NAME_EDUCATION_TYPE, CAST(SUM(CASE WHEN t2.CREDIT_DAY_OVERDUE > 0 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(t2.SK_BUREAU_ID) AS OverdueRate FROM application_train t1 JOIN bureau t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR GROUP BY t1.NAME_EDUCATION_TYPE ORDER BY OverdueRate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих платежей по картам для старой активности по картам для разных групп между клиентами по их карточной активности?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих выборок по картам для кредитных карт с небольшим лимитом в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой была динамика уникальных заемщиков, исходя из года вынесения решения по предыдущим кредитным заявкам?",
    "sql": "SELECT CAST(2023 + DAYS_DECISION / 365 AS INT) AS decision_year, COUNT(DISTINCT SK_ID_CURR) FROM previous_application GROUP BY decision_year ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Постройте график зависимости дефолтности от семейного положения.",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Средний период просроченной задолженности по предшествующим кредитным обязательствам, сегментированный по гендерному признаку.",
    "sql": "SELECT at.CODE_GENDER, AVG(b.CREDIT_DAY_OVERDUE) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов в условной валюте 'currency 2' в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 2' GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте среднюю процентную ставку по первичным кредитам в разрезе способов оплаты.",
    "sql": "SELECT NAME_PAYMENT_TYPE, AVG(RATE_INTEREST_PRIMARY) FROM previous_application WHERE RATE_INTEREST_PRIMARY IS NOT NULL GROUP BY NAME_PAYMENT_TYPE ORDER BY AVG(RATE_INTEREST_PRIMARY) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Средний размер кредитного обязательства в бюро кредитных историй для дефолтных заемщиков.",
    "sql": "SELECT AVG(b.AMT_CREDIT_SUM) FROM application_train_test app JOIN bureau b ON app.SK_ID_CURR = b.SK_ID_CURR WHERE app.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова разница в показателях дефолта между клиентами мужского и женского пола?",
    "sql": "SELECT CODE_GENDER, AVG(TARGET) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для POS-записей от 6 до 12 месяцев назад в разрезе по месяцу отчётности (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для POS-кредитов с DPD_DEF > 0 в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова демографическая структура клиентов в разрезе числа детей?",
    "sql": "SELECT CNT_CHILDREN, COUNT(*) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитных карт с лимитом (AMT_CREDIT_SUM_LIMIT > 0) в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каковы основные мотивации заемщиков (топ-5) при оформлении заявок на потребительские кредиты наличными?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_TYPE = 'Cash loans' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client) для новых клиентов (pa.NAME_CLIENT_TYPE = 'New') в разрезе по признаку просрочки платежа (delay_days > 0) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сколько денег в среднем просят по разным типам кредитов, если смотреть прошлые заявки?",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_APPLICATION) FROM previous_application GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для клиентов, обращающихся впервые между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей с просрочкой (STATUS в ['1'..'5']), покажите долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро по каждому значению поля группировки CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS IN ('1','2','3','4','5') GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько в среднем зарабатывают клиенты, имеющие текущие просрочки по кредитам в Бюро кредитных историй?",
    "sql": "SELECT AVG(t1.AMT_INCOME_TOTAL) FROM application AS t1 JOIN bureau AS t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR WHERE t2.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как различается долю месяцев с просрочкой по кредитам для кредитов, которые уже погашены между различными сегментами между типами кредитов по данным бюро по данным бюро кредитных историй?",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Closed' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_TYPE AS group_key, AVG(bad_month_share) AS metric_value FROM bb_agg GROUP BY CREDIT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для самых недавних записей (MONTHS_BALANCE > -3), покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки STATUS.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE > -3 GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер фактического платежа по рассрочке для начальных платежей по рассрочке между разными группами между разными номерами платежей в графике рассрочки?",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Исследуйте корреляцию между количеством иждивенцев (детей) и уровнем дефолтности клиентов.",
    "sql": "SELECT CNT_CHILDREN, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте распределение клиентской базы по семейному статусу с детализацией по показателю дефолта (TARGET).",
    "sql": "SELECT NAME_FAMILY_STATUS, TARGET, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_FAMILY_STATUS, TARGET ORDER BY NAME_FAMILY_STATUS, TARGET;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите показатель уровня дефолта для сегмента клиентов, чьи предыдущие кредитные заявки были отклонены.",
    "sql": "SELECT AVG(app.TARGET) * 100 FROM application_train_test app JOIN (SELECT DISTINCT SK_ID_CURR FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused') pa_refused ON app.SK_ID_CURR = pa_refused.SK_ID_CURR",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем должны платить в год те, кто в итоге \"прогорел\" по кредиту?",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество оставшихся платежей по POS-кредитам для уже погашенных POS-кредитов для разных значений признака «клиент» по POS-кредитам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE = 0 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для закрытых кредитов (CREDIT_ACTIVE = 'Closed') в разрезе по размеру кредита (AMT_CREDIT_SUM) с бинингом на крупные и остальные.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1), покажите средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) по каждому значению поля NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова структура валют, использованных для прошлых кредитов, зарегистрированных в БКИ?",
    "sql": "SELECT CREDIT_CURRENCY, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_CURRENCY;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Кто у нас в десятке самых крупных должников по кредиткам?",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_BALANCE) AS total_debt FROM credit_card_balance GROUP BY SK_ID_CURR ORDER BY total_debt DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведи всех клиентов, у кого сейчас есть активные кредиты в БКИ, и сколько они всего должны.",
    "sql": "SELECT at.SK_ID_CURR, at.AMT_INCOME_TOTAL, SUM(b.AMT_CREDIT_SUM_DEBT) AS TotalBureauDebt FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY at.SK_ID_CURR, at.AMT_INCOME_TOTAL HAVING TotalBureauDebt IS NOT NULL ORDER BY TotalBureauDebt DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько пенсионеров не возвращают свои кредиты?",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train WHERE NAME_INCOME_TYPE = 'Pensioner';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите коэффициент отклонения по кредитным заявкам.",
    "sql": "SELECT CAST(SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «статус прошлой заявки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_PORTFOLIO ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выведите список клиентов с наивысшим показателем \"credit inquiry frequency\" за год.",
    "sql": "SELECT SK_ID_CURR, AMT_REQ_CREDIT_BUREAU_YEAR FROM application_train ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите максимальный размер кредита, который был одобрен для одного клиента.",
    "sql": "SELECT MAX(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для фактических оплат по рассрочке (ip.AMT_PAYMENT > 0) сгруппирует данные по типу кредитного продукта (pa.NAME_CONTRACT_TYPE) и рассчитает средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов, у которых срок уже должен был закончиться (DAYS_CREDIT_ENDDATE <= 0) в разрезе по валюте кредита (CREDIT_CURRENCY).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE <= 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите совокупный объем кредитных средств, выданных по всем активным заявкам.",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Построй график изменения количества активных займов в БКИ помесячно, разбив по статусам.",
    "sql": "SELECT T2.MONTHS_BALANCE, T2.STATUS, COUNT(T1.SK_BUREAU_ID) FROM bureau AS T1 JOIN bureau_balance AS T2 ON T1.SK_BUREAU_ID = T2.SK_BUREAU_ID GROUP BY T2.MONTHS_BALANCE, T2.STATUS ORDER BY T2.MONTHS_BALANCE, T2.STATUS;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей с ненулевым плановым платежом (AMT_INSTALMENT > 0), покажите средний фактический платёж по рассрочке (AMT_PAYMENT) по каждому значению поля CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднее количество дней занятости по всем заявкам.",
    "sql": "SELECT AVG(ABS(DAYS_EMPLOYED)) FROM application_train WHERE DAYS_EMPLOYED < 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите распределение среднего количества открытых кредитов в БКИ по семейным статусам для оценки кредитной нагрузки.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, COUNT(b.SK_BUREAU_ID) AS num_bureau_loans FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY num_bureau_loans DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт с платежами в текущем периоде (AMT_PAYMENT_CURRENT > 0) в разрезе по клиенту (SK_ID_CURR) с агрегацией по картам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова средняя сумма первого платежа (AMT_DOWN_PAYMENT) для одобренных предыдущих заявок?",
    "sql": "SELECT AVG(AMT_DOWN_PAYMENT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND AMT_DOWN_PAYMENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните загрузку кредитных карт (отношение задолженности к лимиту) для карт, по которым клиент вносит платежи по признаку «канал оформления предыдущего кредита» на уровне клиентов, используя как данные по прошлым кредитам, так и агрегированную статистику по картам.",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.AMT_PAYMENT_CURRENT > 0 GROUP BY cc.SK_ID_CURR ) SELECT pa.CHANNEL_TYPE AS group_key, AVG(utilization) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для записей за предыдущий месяц (MONTHS_BALANCE = -1) в разрезе по идентификатору кредита в бюро (SK_BUREAU_ID).",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE = -1 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выведите список идентификаторов клиентов, суммы кредита, общего дохода и количества запросов в БКИ для дефолтеров с более чем 3 запросами в год.",
    "sql": "SELECT SK_ID_CURR, AMT_CREDIT, AMT_INCOME_TOTAL, AMT_REQ_CREDIT_BUREAU_YEAR FROM application_train WHERE TARGET = 1 AND AMT_REQ_CREDIT_BUREAU_YEAR > 3;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните размер фактического платежа по рассрочке для случаев, когда платёж не был внесён для разных значений признака «предыдущий кредит» в платёжной истории клиентов.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_PAYMENT = 0 GROUP BY SK_ID_PREV ORDER BY avg_amt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какие цели чаще всего указывают в заявках, которые мы одобряем?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(*) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(*) DESC LIMIT 10;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова средняя величина кредитных средств, предоставленных клиентам без дефолта?",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train WHERE TARGET = 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для кредитов на дорогие товары дороже 100 000 между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для POS-кредитов с количеством платежей более 6 (CNT_INSTALMENT > 6) в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте долю проблемных кредитов для каждого пола.",
    "sql": "SELECT CODE_GENDER, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS default_rate FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какие клиенты имеют в своей кредитной истории записи о просроченных платежах (статусы '1' до '5') по кредитам, отраженным в БКИ?",
    "sql": "SELECT DISTINCT at.SK_ID_CURR, at.AMT_INCOME_TOTAL, at.AMT_CREDIT FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1', '2', '3', '4', '5');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau_balance рассчитайте долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро для тяжёлых просрочек (STATUS в ['3','4','5']) в разрезе по идентификатору кредита в бюро (SK_BUREAU_ID).",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS IN ('3','4','5') GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Оцените влияние образовательного ценза на вероятность наступления дефолта.",
    "sql": "SELECT NAME_EDUCATION_TYPE, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY 2 DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте распределение клиентской базы по категориям источников дохода.",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(SK_ID_CURR) FROM application_train_test GROUP BY NAME_INCOME_TYPE ORDER BY COUNT(SK_ID_CURR) DESC",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сколько в среднем составляют просроченные долги клиентов в БКИ?",
    "sql": "SELECT AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для клиентов, обращающихся впервые для разных категорий по признаку «день недели решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для первых трёх платежей в графике (NUM_INSTALMENT_NUMBER <= 3), покажите среднее количество дней до фактической даты платежа (DAYS_ENTRY_PAYMENT) по каждому значению поля NUM_INSTALMENT_NUMBER.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) для карт с платежами в текущем периоде (AMT_PAYMENT_CURRENT > 0) в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для месяцев без информации (STATUS = 'X') в разрезе по давности записи (MONTHS_BALANCE, recent/old).",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS = 'X' GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Интересно, мужчины и женщины берут кредиты на одинаковые суммы в среднем?",
    "sql": "SELECT CODE_GENDER, AVG(AMT_CREDIT) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Вычислите средний возраст активных кредитополучателей.",
    "sql": "SELECT ABS(AVG(DAYS_BIRTH) / 365) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подсчитай общее количество уникальных идентификаторов заявок в нашей базе.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Можете показать данные по клиентам, которые имеют историю из более чем трех предыдущих кредитных заявок, и каков их текущий кредитный статус?",
    "sql": "SELECT a.SK_ID_CURR, a.TARGET, COUNT(p.SK_ID_PREV) AS prev_app_count FROM application_train a JOIN previous_application p ON a.SK_ID_CURR = p.SK_ID_CURR GROUP BY a.SK_ID_CURR, a.TARGET HAVING COUNT(p.SK_ID_PREV) > 3 LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите динамику клиентских запросов в БКИ за последний год, разделив их на осуществленные и неосуществленные.",
    "sql": "SELECT CASE WHEN AMT_REQ_CREDIT_BUREAU_YEAR > 0 THEN 'Requested' ELSE 'Not Requested' END AS Bureau_Request_Status, COUNT(SK_ID_CURR) FROM application_train GROUP BY Bureau_Request_Status;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для записей старше двух лет (MONTHS_BALANCE < -24) в разрезе по давности записи (MONTHS_BALANCE, recent/old).",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE < -24 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте частоту встречаемости различных категорий просроченной задолженности (статусы 1-5) в Бюро кредитных историй.",
    "sql": "SELECT STATUS, COUNT(SK_BUREAU_ID) FROM bureau_balance WHERE STATUS IN ('1', '2', '3', '4', '5') GROUP BY STATUS ORDER BY STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для POS-операций, которые были от полугода до года назад между разными категориями между активными и погашенными POS-кредитами?",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как менялся средний баланс по кредиткам в течение последних месяцев?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Мне нужны данные по клиентам-дефолтерам с большим количеством детей, покажи топ-20.",
    "sql": "SELECT SK_ID_CURR, CNT_CHILDREN, AMT_CREDIT FROM application_train WHERE TARGET = 1 AND CNT_CHILDREN >= 3 ORDER BY CNT_CHILDREN DESC, AMT_CREDIT DESC LIMIT 20;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита более 50 000 и по каждому значению поля NAME_PRODUCT_TYPE показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие профессии чаще всего связаны с невыплатой кредитов? Дай мне топ-10.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) * 100 AS Default_Rate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY Default_Rate DESC LIMIT 10;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте диаграмму, демонстрирующую разбиение клиентского портфеля согласно уровню образования для сегментации рисков.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каково текущее распределение кредитных статусов по данным bureau_balance на последний отчетный месяц?",
    "sql": "SELECT bb.STATUS, COUNT(bb.SK_BUREAU_ID) FROM bureau_balance bb JOIN (SELECT SK_BUREAU_ID, MAX(MONTHS_BALANCE) AS max_month FROM bureau_balance GROUP BY SK_BUREAU_ID) AS latest_balance ON bb.SK_BUREAU_ID = latest_balance.SK_BUREAU_ID AND bb.MONTHS_BALANCE = latest_balance.max_month GROUP BY bb.STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля NAME_PRODUCT_TYPE показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажи, как со временем меняется средний процент невозврата для одобренных кредитов.",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(JULIANDAY('now') + T2.DAYS_DECISION)) AS DecisionMonth, AVG(T1.TARGET) FROM application_train AS T1 JOIN previous_application AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T2.NAME_CONTRACT_STATUS = 'Approved' GROUP BY DecisionMonth ORDER BY DecisionMonth;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Определите топ-5 профессиональных групп, демонстрирующих наибольшую частоту подачи кредитных заявок.",
    "sql": "SELECT OCCUPATION_TYPE, COUNT(SK_ID_CURR) AS Total_Applications FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL AND OCCUPATION_TYPE != 'XNA' GROUP BY OCCUPATION_TYPE ORDER BY Total_Applications DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проанализируйте помесячную динамику среднего фактического кредитного лимита по кредитным картам.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Общее количество клиентов, разделенное по наличию дефолта.",
    "sql": "SELECT TARGET, COUNT(SK_ID_CURR) AS Number_of_Clients FROM application_train GROUP BY TARGET;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для действующих кредитов клиента для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер фактического платежа по рассрочке для начальных платежей по рассрочке между разными группами между своевременными и просроченными платежами?",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов без серьёзной просрочки (SK_DPD_DEF = 0) в разрезе по месяцу отчётности (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Визуализируйте распределение количества ATM-операций по снятию наличных средств по кредитным картам.",
    "sql": "SELECT CNT_DRAWINGS_ATM_CURRENT, COUNT(SK_ID_CURR) FROM credit_card_balance WHERE CNT_DRAWINGS_ATM_CURRENT > 0 GROUP BY CNT_DRAWINGS_ATM_CURRENT ORDER BY CNT_DRAWINGS_ATM_CURRENT;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для кредитов на дорогие товары дороже 100 000 между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей без фактического платежа (AMT_PAYMENT = 0), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_PAYMENT = 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей от года до двух лет назад, покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -24 AND -13 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько клиентов имели статус просрочки от 60 до 90 дней в бюро кредитных историй за последний год?",
    "sql": "SELECT COUNT(DISTINCT bb.SK_BUREAU_ID) FROM bureau_balance bb JOIN bureau b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID WHERE bb.STATUS = 'X' AND bb.MONTHS_BALANCE >= -12;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для карт без просрочек в разрезе признака «тип поведения по карте» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для клиентов, обращающихся впервые между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_YIELD_GROUP ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравнить средний показатель дефолта между полами для анализа кредитного риска.",
    "sql": "SELECT CODE_GENDER, AVG(TARGET) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Оцените риск дефолта (TARGET=1) для сегментов заемщиков с FLAG_OWN_REALTY = 'Y' и 'N' для профилирования кредитоспособности.",
    "sql": "SELECT FLAG_OWN_REALTY, CAST(SUM(CASE WHEN TARGET = 1 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(TARGET) FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Отобразите средний уровень дохода для групп клиентов с наличием и отсутствием недвижимости.",
    "sql": "SELECT FLAG_OWN_REALTY, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каково среднее значение суммы заявки (AMT_APPLICATION) для каждого статуса предыдущих контрактов?",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(AMT_APPLICATION) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с суммой до 100 000 и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каковы наиболее распространенные типы жилья у клиентов-дефолтеров?",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(*) FROM application_train WHERE TARGET = 1 GROUP BY NAME_HOUSING_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Идентифицируйте пять наиболее распространенных кодов отклонения для кредитных заявок.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(*) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(*) DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов с количеством платежей более 6 (CNT_INSTALMENT > 6) в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для действующих кредитов клиента для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова информация о клиентах, у которых имеется хотя бы одна отказанная прошлая заявка?",
    "sql": "SELECT DISTINCT a.SK_ID_CURR, a.AMT_INCOME_TOTAL, a.NAME_EDUCATION_TYPE, a.NAME_FAMILY_STATUS FROM application_train a JOIN previous_application pa ON a.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как у нас клиенты распределяются по видам договоров?",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для уже погашенных POS-кредитов для разных значений признака «наличие просрочки по POS» по POS-кредитам.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково общее количество предыдущих заявок, сгруппированных по часу начала процесса их обработки?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карточных записей за последние 6 месяцев (MONTHS_BALANCE > -6), покажите средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Можем ли мы получить список заявителей, у которых отсутствует информация о кредитных обязательствах в БКИ?",
    "sql": "SELECT DISTINCT SK_ID_CURR FROM application_train WHERE SK_ID_CURR NOT IN (SELECT DISTINCT SK_ID_CURR FROM bureau);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для небольших кредитов (до 100 000) в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните показатель DPD_DEF по POS-кредитам для уже погашенных POS-кредитов для разных значений признака «клиент» по POS-кредитам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE = 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля NAME_PORTFOLIO показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Исследуйте взаимосвязь между типом дохода клиентов и их показателем дефолтности.",
    "sql": "SELECT NAME_INCOME_TYPE, AVG(TARGET) FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Анализ показателя дефолта для клиентской группы с численностью семьи более двух человек.",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train WHERE CNT_FAM_MEMBERS > 2;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов с просрочкой в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля HOUR_APPR_PROCESS_START показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково суммарное число полученных кредитных обращений?",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам в бюро для условной половины кредитов по чётности ID в разрезе признака «кредит из бюро» по истории кредитов из бюро.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE SK_BUREAU_ID % 2 = 0 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните стоимость товара по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 для разных категорий по признаку «час принятия решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте уровень дефолта для каждого сегмента клиентов, основываясь на количестве их детей.",
    "sql": "SELECT CNT_CHILDREN, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте список из 50 клиентов с наибольшим объемом просроченной задолженности (AMT_TOTAL_RECEIVABLE) по кредитным картам для риск-анализа.",
    "sql": "SELECT SK_ID_CURR, MONTHS_BALANCE, AMT_BALANCE, AMT_TOTAL_RECEIVABLE FROM credit_card_balance ORDER BY AMT_TOTAL_RECEIVABLE DESC LIMIT 50;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя загрузку кредитных карт (utilization) для карт, по которым клиент сейчас вносит платежи для разных сегментов между активными, закрытыми и другими статусами договоров по картам с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_INSTALMENT для условной половины клиентов по чётности ID между разными группами между разными номерами платежей в графике рассрочки?",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих платежей по картам для карт без просрочек в разрезе признака «уровень кредитного лимита» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково суммарное распределение доходов клиентской базы в зависимости от их образовательного статуса?",
    "sql": "SELECT NAME_EDUCATION_TYPE, SUM(AMT_INCOME_TOTAL) AS TotalIncome FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY TotalIncome DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какой в среднем срок кредитов числится в БКИ?",
    "sql": "SELECT AVG(ABS(DAYS_CREDIT)) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество пролонгаций по кредитам из бюро для кредитов, по которым ещё не наступил конец срока для разных групп клиентов между типами кредитов, отражённых в бюро?",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проанализируйте корреляцию между количеством детей и коэффициентом дефолта.",
    "sql": "SELECT CNT_CHILDREN, AVG(TARGET) * 100 FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Исследуйте корреляцию между типом жилища заемщика и уровнем дефолта.",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(TARGET) * 100 FROM application_train_test GROUP BY NAME_HOUSING_TYPE ORDER BY AVG(TARGET) DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проанализируйте ежемесячную динамику изменений статусов кредитов, зарегистрированных в БКИ, за двенадцать последних месяцев.",
    "sql": "SELECT STRFTIME('%Y-%m', DATE('now', MONTHS_BALANCE || ' months')) AS month_year, STATUS, COUNT(SK_BUREAU_ID) FROM bureau_balance WHERE MONTHS_BALANCE >= -12 GROUP BY month_year, STATUS ORDER BY month_year, STATUS;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каков общий размер текущей кредитной нагрузки (AMT_CREDIT_SUM_DEBT) по активным кредитным продуктам в БКИ?",
    "sql": "SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Машина есть или нет - как это влияет на количество просрочек?",
    "sql": "SELECT FLAG_OWN_CAR, COUNT(SK_ID_CURR) FROM application_train WHERE TARGET = 1 GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Предоставьте перечень клиентов с доходом выше среднего, имеющих статус дефолта.",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT FROM application_train WHERE TARGET = 1 AND AMT_INCOME_TOTAL > (SELECT AVG(AMT_INCOME_TOTAL) FROM application_train) ORDER BY AMT_INCOME_TOTAL DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний плановый платёж по рассрочке (AMT_INSTALMENT) для платежей без просрочки (DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT) в разрезе по номеру платежа в графике (NUM_INSTALMENT_NUMBER).",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Насколько велика доля 'плохих' кредитов среди тех, кто работает меньше года?",
    "sql": "SELECT AVG(TARGET) FROM application_train WHERE DAYS_EMPLOYED > -365 AND DAYS_EMPLOYED < 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без серьёзной просрочки по DPD_DEF (SK_DPD_DEF = 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднее число исторических кредитных обязательств в БКИ, приходящихся на одного клиента.",
    "sql": "SELECT AVG(past_credits_count) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS past_credits_count FROM bureau GROUP BY SK_ID_CURR);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Почему чаще всего мы отказываем в кредитах? Покажи топ-5 причин.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) AS refusal_count FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY refusal_count DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний фактический платёж по рассрочке (AMT_PAYMENT) для записей с фактической оплатой (AMT_PAYMENT > 0) в разрезе по предыдущему кредиту (SK_ID_PREV).",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY SK_ID_PREV ORDER BY avg_amt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя накопленный остаток по карте для карт с текущей задолженностью для разных сегментов между картами с высоким и более низким лимитом с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_BALANCE > 0 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните запрошенный размер кредита по заявке для прошлых заявок, принятых более года назад для разных категорий по признаку «тип клиента» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте совокупную сумму текущих платежей по кредитным картам за последний отчетный период.",
    "sql": "SELECT SUM(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE = (SELECT MAX(MONTHS_BALANCE) FROM credit_card_balance);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для предыдущих заявок примерно за последний год между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний остаток по кредитным картам (AMT_BALANCE) для карт, по которым были выборки в текущем периоде (AMT_DRAWINGS_CURRENT > 0) в разрезе по типу поведения клиента: платёж превышает выборки или нет.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите среднюю сумму ежемесячных платежей по всем активным кредитным картам.",
    "sql": "SELECT AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для закрытых кредитов (CREDIT_ACTIVE = 'Closed') в разрезе по статусу кредита (CREDIT_ACTIVE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобрази долю каждого типа контракта среди всех прошлых заявок.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_TYPE ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для карт без тяжёлых просрочек для разных групп между клиентами по их карточной активности?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните среднюю по клиенту задержку платежей для клиентов, которые уже ранее брали кредит между сегментами по признаку «факт просрочки платежа» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проведите сравнительный анализ уровня дефолтов среди клиентов, владеющих автомобилем, и тех, кто не является автовладельцем.",
    "sql": "SELECT FLAG_OWN_CAR, AVG(TARGET) * 100 FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Есть ли разница в среднем ежемесячном платеже у тех, кто не платит, и тех, кто платит по кредитам?",
    "sql": "SELECT TARGET, AVG(AMT_ANNUITY) AS AverageAnnuity FROM application_train GROUP BY TARGET ORDER BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам в бюро для месяцев с наибольшей степенью просрочки в разрезе признака «кредит из бюро» по истории кредитов из бюро.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS = '5' GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для клиентов, которые уже брали кредит ранее между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY CHANNEL_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определить среднюю стоимость товаров, связанных с успешно одобренными ранее заявками.",
    "sql": "SELECT AVG(AMT_GOODS_PRICE) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Кто у нас больше всего платит по кредиткам? Ну-ка, покажи десятку лидеров.",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_PAYMENT_CURRENT) AS total_payment FROM credit_card_balance GROUP BY SK_ID_CURR ORDER BY total_payment DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие категории кредитных целей демонстрируют наиболее низкий процент отклонений?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) * 100.0 / COUNT(SK_ID_PREV) AS refusal_rate FROM previous_application GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY refusal_rate ASC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова в среднем сумма, которую клиенты снимают наличными с кредиток?",
    "sql": "SELECT AVG(AMT_DRAWINGS_ATM_CURRENT) FROM credit_card_balance WHERE AMT_DRAWINGS_ATM_CURRENT IS NOT NULL AND AMT_DRAWINGS_ATM_CURRENT > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как варьируется средний первоначальный взнос (AMT_DOWN_PAYMENT) по предыдущим кредитам в зависимости от семейного положения?",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(pa.AMT_DOWN_PAYMENT) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY AVG(pa.AMT_DOWN_PAYMENT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между отраслями продавцов, через которых оформлялись кредиты?",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов, по которым задан аннуитетный платёж для разных групп клиентов между типами кредитов, отражённых в бюро?",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по типу продукта (NAME_PRODUCT_TYPE).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните величина DAYS_DECISION по предыдущим кредитам для отказанных предыдущих кредитов для разных категорий по признаку «день недели решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните запрошенный размер кредита по заявке для клиентов, обращающихся впервые для разных категорий по признаку «тип клиента» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется значение MONTHS_BALANCE по кредитам в бюро для состояния кредитов в прошлом месяце между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE = -1 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для новых клиентов (NAME_CLIENT_TYPE = 'New') и по каждому значению поля NAME_YIELD_GROUP показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Оцените среднее число активных кредитов в БКИ для клиентов с разными показателями дефолта.",
    "sql": "SELECT at.TARGET, AVG(b.ActiveCredits) FROM application_train at JOIN (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS ActiveCredits FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR) b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько денег в общей сложности мы выдали по основным кредитам?",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для очень старой кредитной истории в разрезе признака «статус кредита по месяцам» по истории кредитов из бюро.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE < -24 GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте общее число клиентов, имевших статусы '1'-'5' в бюро кредитных историй, и их соответствующий коэффициент дефолтности.",
    "sql": "SELECT COUNT(DISTINCT at.SK_ID_CURR) AS total_clients_with_bad_bki, CAST(SUM(CASE WHEN at.TARGET = 1 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(DISTINCT at.SK_ID_CURR) AS default_rate FROM application_train at WHERE at.SK_ID_CURR IN (SELECT DISTINCT b.SK_ID_CURR FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1', '2', '3', '4', '5'));",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Представьте круговую диаграмму, иллюстрирующую долю различных типов контрактов среди всех клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(*) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля NAME_PRODUCT_TYPE показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каковы пять основных причин, по которым клиенты запрашивали кредиты, исключая неопределенные и прочие категории?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(*) AS applications_count FROM previous_application WHERE NAME_CASH_LOAN_PURPOSE NOT IN ('XNA', 'Other') GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY applications_count DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов, по которым есть долг для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какие клиенты обладают наибольшим общим объемом долговых обязательств в БКИ, и каков их индикатор дефолта?",
    "sql": "SELECT a.SK_ID_CURR, a.TARGET, SUM(b.AMT_CREDIT_SUM_DEBT) AS total_bureau_debt FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR GROUP BY a.SK_ID_CURR, a.TARGET ORDER BY total_bureau_debt DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведите общее число клиентов, являющихся владельцами как транспортного средства, так и жилья.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE FLAG_OWN_CAR = 'Y' AND FLAG_OWN_REALTY = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Анализ соответствия суммы кредита и стоимости приобретаемых товаров.",
    "sql": "SELECT SK_ID_CURR, AMT_CREDIT, AMT_GOODS_PRICE FROM application_train LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам для предыдущих заявок с суммой кредита от 10 000 до 50 000 в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой у нас вообще дефолтрейт по всем клиентам?",
    "sql": "SELECT AVG(TARGET) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведите медианный объем выданного кредита.",
    "sql": "SELECT PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля NAME_CONTRACT_TYPE показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков средний возраст кредитов в БКИ, если смотреть на них по статусу: активные, закрытые и т.д.?",
    "sql": "SELECT CREDIT_ACTIVE, AVG(ABS(DAYS_CREDIT)) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяются наши заемщики по типу полученного образования?",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') и по каждому значению поля NAME_CLIENT_TYPE показывается среднюю стоимость товара по предыдущим кредитам.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_ENTRY_PAYMENT для платежей, которые были действительно внесены между разными группами между разными номерами платежей в графике рассрочки?",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau_balance рассчитайте долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро для кредитов с нечётным SK_BUREAU_ID в разрезе по статусу STATUS в bureau_balance.",
    "sql": "SELECT STATUS AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE SK_BUREAU_ID % 2 = 1 GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Мне нужна таблица клиентов, у которых в кредитной истории числится более одной просрочки.",
    "sql": "SELECT T1.SK_ID_CURR, COUNT(T2.SK_BUREAU_ID) AS OverdueCreditsCount FROM application_train_test T1 JOIN bureau T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T2.CREDIT_DAY_OVERDUE > 0 GROUP BY T1.SK_ID_CURR HAVING COUNT(T2.SK_BUREAU_ID) > 1 ORDER BY OverdueCreditsCount DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какой процент самозанятых клиентов в итоге не выплачивает кредиты?",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train WHERE NAME_INCOME_TYPE = 'Self-employed';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализируйте корреляцию между типом источника дохода и риском дефолта заемщика.",
    "sql": "SELECT NAME_INCOME_TYPE, AVG(TARGET) AS DefaultRate FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY DefaultRate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите 5 образовательных сегментов с наивысшим риском дефолта.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY default_rate DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проанализируйте, как метрика default rate изменяется в зависимости от количества членов семьи заемщика.",
    "sql": "SELECT CNT_FAM_MEMBERS, AVG(TARGET) AS default_rate FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков общий показатель дефолтности по всем клиентам?",
    "sql": "SELECT AVG(TARGET) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднюю разницу между фактическим и плановым платежом (payment_diff) для фактически оплаченных записей (AMT_PAYMENT > 0) в разрезе по факту просрочки платежа (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте усредненный баланс по всем кредитным картам.",
    "sql": "SELECT AVG(AMT_BALANCE) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Идентифицируйте пять наиболее распространенных типов жилищных условий среди клиентской базы.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY COUNT(SK_ID_CURR) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните размер кредита по данным бюро для кредитов с историей просрочек в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю долю просроченных платежей по рассрочкам для поздних платежей (NUM_INSTALMENT_NUMBER > 12) по по уровню накопленных платежей cum_payment (low/medium/high).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 12 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для кредитов, где хотя бы раз была просрочка по сумме для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите метрику среднего TARGET для клиентов с просрочками 60-90 дней по кредитным историям из БКИ.",
    "sql": "SELECT AVG(t1.TARGET) FROM application_train t1 JOIN bureau t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR JOIN bureau_balance t3 ON t2.SK_BUREAU_ID = t3.SK_BUREAU_ID WHERE t3.STATUS = '3';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов, по которым ещё не наступил конец срока для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Кто эти 10 клиентов, которые больше всех должны по кредитным картам?",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_TOTAL_RECEIVABLE) FROM credit_card_balance GROUP BY SK_ID_CURR ORDER BY SUM(AMT_TOTAL_RECEIVABLE) DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова зависимость уровня просрочки от числа обращений в БКИ в течение последнего года?",
    "sql": "SELECT AMT_REQ_CREDIT_BUREAU_YEAR, AVG(TARGET) * 100 AS Default_Rate FROM application_train GROUP BY AMT_REQ_CREDIT_BUREAU_YEAR ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова средняя \"старость\" кредитов для активных и погашенных обязательств в кредитном досье?",
    "sql": "SELECT CREDIT_ACTIVE, AVG(ABS(DAYS_CREDIT)) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выведите таблицу клиентов с критической деликвентностью (120+ дней просрочки) по данным бюро кредитных историй.",
    "sql": "SELECT DISTINCT at.SK_ID_CURR, at.TARGET, bb.STATUS FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('4', '5') LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализируйте зависимость показателя дефолта от числа иждивенцев (детей) у заемщиков.",
    "sql": "SELECT CNT_CHILDREN, AVG(TARGET) AS default_rate FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте сводную таблицу средних значений кредитных лимитов и задолженности по данным БКИ, сегментированную по возрастным категориям.",
    "sql": "SELECT CASE WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 25 THEN 'До 25' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 35 THEN '26-35' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 45 THEN '36-45' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 55 THEN '46-55' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 65 THEN '56-65' ELSE 'Старше 65' END AS AgeGroup, AVG(b.AMT_CREDIT_SUM_LIMIT) AS AvgCreditSumLimit, AVG(b.AMT_CREDIT_SUM_DEBT) AS AvgCreditSumDebt FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY AgeGroup ORDER BY AgeGroup;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для одобренных предыдущих кредитов между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для активных POS-кредитов (CNT_INSTALMENT_FUTURE > 0) и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер планового платежа по рассрочке для платежей, внесённых позже плановой даты между разными группами между клиентами по их платёжной дисциплине?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY SK_ID_CURR ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Требуется рассчитать уровень одобрения кредитных заявок по различным типам контрактов, исходя из данных previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE, CAST(COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN SK_ID_PREV END) AS REAL) * 100 / COUNT(SK_ID_PREV) AS approval_rate FROM previous_application GROUP BY NAME_CONTRACT_TYPE ORDER BY approval_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для клиентов, обращающихся впервые между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как менялось число кредитных запросов от месяца к месяцу по дате принятия по ним решения?",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(CURRENT_DATE, '-' || ABS(DAYS_DECISION) || ' day')) AS DecisionMonth, COUNT(SK_ID_PREV) AS ApplicationCount FROM previous_application GROUP BY DecisionMonth ORDER BY DecisionMonth;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Чему равен средний ежемесячный платеж по кредитным картам за последний завершенный месяц?",
    "sql": "SELECT AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE = 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля NAME_CLIENT_TYPE показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов без серьёзной просрочки (SK_DPD_DEF = 0) в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднюю сумму первоначального взноса для всех одобренных предыдущих заявок.",
    "sql": "SELECT AVG(AMT_DOWN_PAYMENT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND AMT_DOWN_PAYMENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей с фактической оплатой (AMT_PAYMENT > 0), покажите средний плановый платёж по рассрочке (AMT_INSTALMENT) по каждому значению поля CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_INSTALMENT для условной половины клиентов по чётности ID между разными группами между своевременными и просроченными платежами?",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова динамика уровня дефолта в зависимости от численности семьи клиента?",
    "sql": "SELECT CNT_FAM_MEMBERS, AVG(TARGET) FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какой процент наших заемщиков имеет автомобиль, а какой не имеет?",
    "sql": "SELECT FLAG_OWN_CAR, COUNT(SK_ID_CURR) FROM application_train GROUP BY FLAG_OWN_CAR",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний остаток по кредитным картам (AMT_BALANCE) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по месяцу отчётности по карте (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте структуру текущих обязательств клиентов согласно кредитным бюро.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как ведёт себя накопленный остаток по карте для карточной истории за последний год для разных сегментов между клиентами по их карточной активности с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE > -12 ) SELECT SK_ID_CURR AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для старых POS-операций (старше года) для разных значений признака «статус POS-договора» по POS-кредитам.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднюю загрузку кредитных карт (utilization) по сегментам для более старой карточной истории (MONTHS_BALANCE <= -12) по по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE <= -12 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните среднюю по клиенту задержку платежей для случаев, когда клиент не внёс очередной платёж между сегментами по признаку «тип клиента» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT = 0 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для более старых кредитов (DAYS_CREDIT <= -365) в разрезе по размеру кредита (AMT_CREDIT_SUM) с бинингом на крупные и остальные.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько в среднем люди платят по своим кредиткам прямо сейчас?",
    "sql": "SELECT AVG(AMT_PAYMENT_CURRENT) FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "В среднем, сколько наши клиенты платят в месяц по кредиту?",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «час принятия решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проанализируйте корреляцию между числом иждивенцев и уровнем дефолтности клиентов.",
    "sql": "SELECT CNT_CHILDREN, AVG(TARGET) * 100 AS default_rate FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для решений, принятых за последний год (DAYS_DECISION > -365) в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сколько в среднем берут в кредит те, кому раньше уже отказывали?",
    "sql": "SELECT AVG(app.AMT_CREDIT) FROM application_train app JOIN previous_application prev ON app.SK_ID_CURR = prev.SK_ID_CURR WHERE prev.NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для кредитов, по которым недавно обновлялась информация (DAYS_CREDIT_UPDATE > -30) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE > -30 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните размер фактического платежа по рассрочке для условной половины клиентов по чётности ID для разных значений признака «номер платежа» в платёжной истории клиентов.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой процент дефолтов среди тех, кто когда-то отменил свою заявку?",
    "sql": "SELECT CAST(SUM(T1.TARGET) AS REAL) * 100 / COUNT(T1.SK_ID_CURR) FROM application_train T1 JOIN previous_application T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T2.NAME_CONTRACT_STATUS = 'Canceled';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каково фактическое количество проблемных заемщиков в портфеле?",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните накопленный остаток по карте для карт, по которым клиент сейчас тратит средства по признаку «уровень использования лимита», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 ) SELECT CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой процент невозвратов кредитов у нас по разным возрастам?",
    "sql": "SELECT CASE WHEN ABS(DAYS_BIRTH) / 365.25 < 30 THEN '18-29' WHEN ABS(DAYS_BIRTH) / 365.25 < 40 THEN '30-39' WHEN ABS(DAYS_BIRTH) / 365.25 < 50 THEN '40-49' WHEN ABS(DAYS_BIRTH) / 365.25 < 60 THEN '50-59' ELSE '60+' END AS age_group, CAST(SUM(CASE WHEN TARGET = 1 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) AS default_rate FROM application_train GROUP BY age_group ORDER BY age_group;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без серьёзной просрочки по DPD_DEF (SK_DPD_DEF = 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') и по каждому значению поля NAME_CONTRACT_STATUS показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Оценить уровень невозврата кредитов среди заемщиков моложе 30 лет.",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train WHERE ABS(DAYS_BIRTH) / 365 < 30;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализируйте средний размер аннуитетного платежа для каждого типа одобренных предыдущих кредитных заявок.",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_ANNUITY) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каково распределение заемщиков по их жилищным условиям, как фактор оценки надежности?",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_HOUSING_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для закрытых кредитов (CREDIT_ACTIVE = 'Closed') и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с заполненным аннуитетом (AMT_ANNUITY IS NOT NULL) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните кредитный лимит по картам для кредитных карт с высоким лимитом в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 50000 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько денег мы одобряли в кредитах каждый квартал, и как это менялось?",
    "sql": "SELECT STRFTIME('%Y-Q%Q', DATE(JULIANDAY('now') + DAYS_DECISION)) AS DecisionQuarter, SUM(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY DecisionQuarter ORDER BY DecisionQuarter;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какова корреляция между наличием собственного жилья и показателем дефолтности заемщиков?",
    "sql": "SELECT FLAG_OWN_REALTY, AVG(TARGET) AS default_rate FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько у нас клиентов, у которых в кредитной истории больше трёх кредитов?",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS num_credits FROM bureau GROUP BY SK_ID_CURR HAVING num_credits > 3) AS subquery;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем заемщики должны по своим кредитам, согласно данным БКИ?",
    "sql": "SELECT AVG(b.AMT_CREDIT_SUM_DEBT) FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.AMT_CREDIT_SUM_DEBT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым уже была просрочка (CREDIT_DAY_OVERDUE > 0) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_YIELD_GROUP ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для хороших статусов без просрочки (STATUS в ['0','C']) в разрезе по идентификатору кредита в бюро (SK_BUREAU_ID).",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS IN ('0','C') GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте демографический срез клиентов по их семейному положению.",
    "sql": "SELECT NAME_FAMILY_STATUS, COUNT(SK_ID_CURR) AS count FROM application_train GROUP BY NAME_FAMILY_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт, по которым были выборки в текущем периоде (AMT_DRAWINGS_CURRENT > 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для POS-кредитов без тяжёлых просрочек между разными категориями по разным месяцам наблюдения POS-кредитов?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Скажите, сколько наших клиентов уже брали больше одного кредита, судя по данным БКИ?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) as num_bureau_loans FROM bureau GROUP BY SK_ID_CURR HAVING num_bureau_loans > 1) AS subquery;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите количество заемщиков, у которых более двух действующих кредитных обязательств в бюро кредитных историй.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_credits FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING active_credits > 2);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова годовая тенденция изменения среднего количества дней просроченной задолженности (CREDIT_DAY_OVERDUE) относительно даты принятия решения по заявке?",
    "sql": "SELECT STRFTIME('%Y', DATE(JULIANDAY('now'), p.DAYS_DECISION || ' day')) AS DecisionYear, AVG(b.CREDIT_DAY_OVERDUE) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR JOIN previous_application p ON at.SK_ID_CURR = p.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE IS NOT NULL GROUP BY DecisionYear ORDER BY DecisionYear;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Отследите, как средний баланс по кредитным картам менялся по месяцам.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карточных записей за последние 6 месяцев (MONTHS_BALANCE > -6), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_ENTRY_PAYMENT для второй половины клиентов по нечётности ID между разными группами между платежами, где клиент платил полностью или больше, и платежами с недоплатой?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите тренд количества текущих (активных) кредитов в БКИ по месяцам с момента их возникновения.",
    "sql": "SELECT ABS(CAST(b.DAYS_CREDIT / 30 AS INT)) AS Months_Ago_Credit_Opened, COUNT(b.SK_BUREAU_ID) FROM bureau b WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY Months_Ago_Credit_Opened ORDER BY Months_Ago_Credit_Opened DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните кредитный лимит по картам для условной половины клиентов по чётности ID в разрезе признака «статус договора по карте» по кредитным картам клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какова доля клиентской базы, обладающей обоими видами обеспечения - автотранспортом и недвижимостью?",
    "sql": "SELECT CAST(COUNT(SK_ID_CURR) AS REAL) * 100 / (SELECT COUNT(SK_ID_CURR) FROM application_train) FROM application_train WHERE FLAG_OWN_CAR = 'Y' AND FLAG_OWN_REALTY = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова средняя сумма, которую клиенты заплатили по кредитным картам в прошлом месяце?",
    "sql": "SELECT AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE = 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните размер кредита по данным бюро для кредитов, по которым ещё не наступил конец срока в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер фактического платежа по рассрочке для случаев переплаты по рассрочке между разными группами между разными кредитами клиента?",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_PAYMENT > AMT_INSTALMENT GROUP BY SK_ID_PREV ORDER BY avg_amt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов с суммой до 100 000 в разрезе по статусу кредита (CREDIT_ACTIVE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для карт без просрочек для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau_balance рассчитайте долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро для закрытых кредитов (STATUS = 'C') в разрезе по идентификатору кредита в бюро (SK_BUREAU_ID).",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS = 'C' GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каковы лидирующие пять целей, указываемых при оформлении кредитов наличными?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_TYPE = 'Cash loans' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Исследуйте зависимость частоты дефолтов от семейного статуса клиентов.",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Рассчитайте и покажите суммарный процент дефолтов по всем активным кредитам.",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для кредитных карт с установленным лимитом для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для кредитов, по которым данные давно не обновлялись для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте график изменения количества предыдущих кредитных заявок по годам их обработки.",
    "sql": "SELECT CAST(ABS(DAYS_DECISION)/365.25 AS INTEGER) AS years_ago, COUNT(SK_ID_PREV) AS application_count FROM previous_application GROUP BY years_ago ORDER BY years_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для уже погашенных кредитов для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков средний размер запрашиваемого кредита, дифференцированный по виду кредитного продукта?",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_APPLICATION) FROM previous_application GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с суммой до 100 000 и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер фактического платежа по рассрочке для платежей, внесённых позже плановой даты между разными группами между своевременными и просроченными платежами?",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Отобразите усредненный кредитный лимит по карточному портфелю.",
    "sql": "SELECT AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте средний накопленный объём платежей по клиенту (cum_payment) для поздних платежей (NUM_INSTALMENT_NUMBER > 12) по по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 12 ) SELECT SK_ID_CURR AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как изменялось число прошлых заявок с течением лет после их обработки?",
    "sql": "SELECT CAST(ABS(DAYS_DECISION)/365.25 AS INTEGER) AS years_ago, COUNT(SK_ID_PREV) AS application_count FROM previous_application GROUP BY years_ago ORDER BY years_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с давними обновлениями (DAYS_CREDIT_UPDATE <= -30) и по каждому значению группировки (CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните размер кредита по данным бюро для кредитов в основной валюте 'currency 1' в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для POS-операций примерно за последние полгода для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для второй половины клиентов по нечётности ID для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для кредитных карт с высоким лимитом для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 50000 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково процентное соотношение клиентов, использующих различные типы контрактов?",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Определите среднеарифметическое количество членов семьи у заемщиков, имеющих ипотечный кредит.",
    "sql": "SELECT AVG(CNT_FAM_MEMBERS) FROM application_train WHERE NAME_HOUSING_TYPE = 'House / apartment';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте среднее годовое количество запросов в бюро кредитных историй для групп дефолтных и недефолтных заемщиков.",
    "sql": "SELECT TARGET, AVG(AMT_REQ_CREDIT_BUREAU_YEAR) AS avg_bureau_requests FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для сравнительно новых кредитов для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как выглядит отношение платежей к объёму выборок по картам для недавней активности по кредитным картам для разных сегментов клиентов между новыми и повторными клиентами, если объединить историю прошлых кредитов и поведение по кредитным картам?",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.MONTHS_BALANCE > -6 GROUP BY cc.SK_ID_CURR ) SELECT pa.NAME_CLIENT_TYPE AS group_key, AVG(pay_vs_spend_ratio) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 для разных категорий по признаку «группа доходности продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов, по которым ещё не наступил конец срока в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте динамику объема одобренных предварительных кредитных заявок по годам.",
    "sql": "SELECT -CAST(DAYS_DECISION / 365 AS INT) AS YEARS_AGO, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY YEARS_AGO ORDER BY YEARS_AGO DESC",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Рассчитайте показатель дефолтности для сегмента самозанятых для оценки их кредитоспособности.",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train WHERE NAME_INCOME_TYPE = 'Self-employed';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Представьте агрегированное количество записей по каждому статусу кредитного продукта в системе бюро балансов.",
    "sql": "SELECT STATUS, COUNT(*) FROM bureau_balance GROUP BY STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова структура клиентского портфеля в разрезе семейного статуса?",
    "sql": "SELECT NAME_FAMILY_STATUS, COUNT(SK_ID_CURR) * 100.0 / (SELECT COUNT(*) FROM application_train) AS percentage FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY percentage DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Какова средняя сумма кредита у тех, кто не смог вернуть долг, и у тех, кто платит вовремя? Сравни их.",
    "sql": "SELECT TARGET, AVG(AMT_CREDIT) FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните размер фактического платежа по рассрочке для условной половины клиентов по чётности ID для разных значений признака «предыдущий кредит» в платёжной истории клиентов.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_PREV ORDER BY avg_amt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Вычислите средний доход по всем заявкам.",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для кредитов с заполненным аннуитетом (AMT_ANNUITY IS NOT NULL) в разрезе по размеру кредита (AMT_CREDIT_SUM) с бинингом на крупные и остальные.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните количество оставшихся платежей по POS-кредитам для второй условной половины клиентов (по нечётности ID) для разных значений признака «наличие просрочки по POS» по POS-кредитам.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Скажите, какой процент заявок мы одобрили в прошлом?",
    "sql": "SELECT CAST(COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN SK_ID_PREV END) AS REAL) * 100 / COUNT(SK_ID_PREV) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для кредитов, открытых более года назад для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита более 50 000 и по каждому значению поля NAME_PRODUCT_TYPE показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднюю загрузку кредитных карт (utilization) по сегментам для карт с просрочкой по DPD (SK_DPD > 0) по по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля CHANNEL_TYPE показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY CHANNEL_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните долю просроченных платежей для платежей по рассрочкам примерно за последний год между сегментами по признаку «канал оформления кредита» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для кредитов с известной датой закрытия в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Хотелось бы глянуть, кто чаще всего уходит в дефолт в зависимости от того, откуда у них деньги.",
    "sql": "SELECT NAME_INCOME_TYPE, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS default_rate FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков средний срок просрочки (DPO) по кредитному портфелю, представленному в БКИ, исключая добросовестных заемщиков?",
    "sql": "SELECT AVG(CREDIT_DAY_OVERDUE) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для прошлых заявок, принятых более года назад между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется размер планового платежа по рассрочке для платежей, внесённых позже плановой даты между разными группами между платежами, где клиент платил полностью или больше, и платежами с недоплатой?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется долю просроченных платежей по рассрочке для пропущенных платежей между различными сегментами между клиентами с низким, средним и высоким совокупным объёмом платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT = 0 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднее количество активных кредитных обязательств наших текущих заемщиков, согласно данным БКИ.",
    "sql": "SELECT AVG(active_credits_count) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_credits_count FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR) AS subquery;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько наших клиентов владеют своим жильем, а сколько — нет? Покажи в процентах.",
    "sql": "SELECT FLAG_OWN_REALTY, COUNT(SK_ID_CURR) AS client_count FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Отобразите структуру валют кредитного портфеля по данным БКИ.",
    "sql": "SELECT CREDIT_CURRENCY, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_CURRENCY ORDER BY COUNT(SK_BUREAU_ID) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') и по каждому значению поля HOUR_APPR_PROCESS_START показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Анализ дефолтов по категориям жилья.",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проанализируйте помесячную динамику числа активных кредитов, учитывая срок, прошедший с момента их открытия.",
    "sql": "SELECT ABS(CAST(b.DAYS_CREDIT / 30 AS INT)) AS Months_Ago_Credit_Opened, COUNT(b.SK_BUREAU_ID) FROM bureau b WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY Months_Ago_Credit_Opened ORDER BY Months_Ago_Credit_Opened DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Покажите уровень просрочки (дефолта) в зависимости от категорий продолжительности занятости клиентов.",
    "sql": "SELECT CASE WHEN DAYS_EMPLOYED >= 0 THEN 'Неизвестно/Безработный' WHEN ABS(DAYS_EMPLOYED) < 365 THEN 'Менее 1 года' WHEN ABS(DAYS_EMPLOYED) BETWEEN 365 AND 1825 THEN '1-5 лет' WHEN ABS(DAYS_EMPLOYED) BETWEEN 1826 AND 3650 THEN '5-10 лет' ELSE 'Более 10 лет' END AS Employment_Duration, AVG(TARGET) * 100 AS Default_Rate FROM application_train GROUP BY Employment_Duration ORDER BY MIN(ABS(DAYS_EMPLOYED));",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выведите топ-20 клиентов по общей сумме снятий наличных в банкоматах (AMT_DRAWINGS_ATM_CURRENT) для анализа потребительского поведения.",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_DRAWINGS_ATM_CURRENT) AS TotalATMDrawings FROM credit_card_balance GROUP BY SK_ID_CURR ORDER BY TotalATMDrawings DESC LIMIT 20;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') и по каждому значению поля CHANNEL_TYPE показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CHANNEL_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита от 10 000 до 50 000 и по каждому значению поля NAME_PRODUCT_TYPE показывается среднюю стоимость товара по предыдущим кредитам.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю долю просроченных платежей по рассрочкам для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) по по уровню накопленных платежей cum_payment (low/medium/high).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков средний уровень дохода у рисковых клиентов, попавших в дефолт?",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) FROM application_train WHERE TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько клиентов с плохой кредитной историей в итоге не возвращают деньги?",
    "sql": "SELECT AVG(a.TARGET) * 100 FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для условной половины клиентов (по чётности ID) между разными категориями между клиентами по их POS-истории?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей с ненулевым плановым платежом (AMT_INSTALMENT > 0), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_INSTALMENT > 0 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов без просрочки (SK_DPD = 0) и показан среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) по каждому значению SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков средний показатель запросов кредитной истории в БКИ в течение года для одного заемщика?",
    "sql": "SELECT AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какой средний доход у тех, кто просрочил кредиты в БКИ?",
    "sql": "SELECT AVG(a.AMT_INCOME_TOTAL) FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднюю загрузку кредитных карт (utilization) по сегментам для карт с просрочкой по DPD (SK_DPD > 0) по по клиенту (SK_ID_CURR).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD > 0 ) SELECT SK_ID_CURR AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) в разрезе по месяцу отчётности (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для небольших кредитов (до 100 000) в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определить численность заемщиков, столкнувшихся с дефолтом, при наличии ранее оформленных микрозаймов.",
    "sql": "SELECT COUNT(DISTINCT app.SK_ID_CURR) FROM application_train_test app JOIN previous_application prev ON app.SK_ID_CURR = prev.SK_ID_CURR WHERE app.TARGET = 1 AND prev.NFLAG_MICRO_CASH = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для кредитных карт с небольшим лимитом для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Предоставьте данные по заемщикам, находящимся в процессе андеррайтинга, у которых уже есть непогашенные кредиты в БКИ, для оценки их кредитной нагрузки.",
    "sql": "SELECT DISTINCT at.SK_ID_CURR, at.AMT_CREDIT, b.CREDIT_ACTIVE, b.AMT_CREDIT_SUM_DEBT FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active' LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для предыдущих заявок примерно за последний год между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите топ-5 сегментов занятости с максимальным средним уровнем дохода для анализа финансовой стабильности.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_INCOME_TOTAL) AS average_income FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY average_income DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте таблицу, демонстрирующую зависимость уровня дефолта от размера социального круга (OBS_30_CNT_SOCIAL_CIRCLE) для каждой возрастной когорты, для выявления социальных факторов риска.",
    "sql": "SELECT CASE WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 25 THEN 'До 25' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 35 THEN '26-35' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 45 THEN '36-45' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 55 THEN '46-55' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 65 THEN '56-65' ELSE 'Старше 65' END AS AgeGroup, OBS_30_CNT_SOCIAL_CIRCLE, AVG(TARGET) AS DefaultRate FROM application_train GROUP BY AgeGroup, OBS_30_CNT_SOCIAL_CIRCLE ORDER BY AgeGroup, OBS_30_CNT_SOCIAL_CIRCLE;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для POS-кредитов с количеством платежей более 6 (CNT_INSTALMENT > 6) в разрезе по месяцу отчётности (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каковы наиболее популярные цели, указанные клиентами при подаче предыдущих кредитных заявок?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CASH_LOAN_PURPOSE != 'XNA' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Каков коэффициент дефолта среди заемщиков, чьи предыдущие заявки были отклонены?",
    "sql": "SELECT AVG(at.TARGET) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова средняя сумма текущего кредита для клиентов, чьи предыдущие обязательства в БКИ имеют статус \"активный\" или \"закрыт\"?",
    "sql": "SELECT b.CREDIT_ACTIVE, AVG(at.AMT_CREDIT) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY b.CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте гистограмму, показывающую средний объем запрашиваемого финансирования по каждой категории целей кредитования.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, AVG(AMT_APPLICATION) FROM previous_application GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY AVG(AMT_APPLICATION) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажи мне все просрочки по кредитам этого клиента, 100003, из БКИ.",
    "sql": "SELECT SK_BUREAU_ID, CREDIT_DAY_OVERDUE, AMT_CREDIT_SUM_DEBT FROM bureau WHERE SK_ID_CURR = 100003 AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каково количество клиентов для каждого типа источника дохода (NAME_INCOME_TYPE)?",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(*) FROM application_train_test GROUP BY NAME_INCOME_TYPE ORDER BY COUNT(*) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля NAME_SELLER_INDUSTRY показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните разницу между фактическим и плановым платёжом по рассрочке для рассрочек, относящихся к последнему году по признаку «версия графика платежей», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков уровень дефолта в зависимости от числа наблюдаемых лиц в социальном окружении (OBS_30_CNT_SOCIAL_CIRCLE)?",
    "sql": "SELECT OBS_30_CNT_SOCIAL_CIRCLE, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY OBS_30_CNT_SOCIAL_CIRCLE ORDER BY OBS_30_CNT_SOCIAL_CIRCLE ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для кредитов в основной валюте 'currency 1' для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для более старых кредитов (DAYS_CREDIT <= -365) в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сколько наших клиентов водят машину, в процентах?",
    "sql": "SELECT CAST(SUM(CASE WHEN FLAG_OWN_CAR = 'Y' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите совокупное количество уникальных идентификаторов клиентов в системе.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте запрос с подзапросом по credit_card_balance (агрегация по SK_ID_CURR), а затем объедините его с previous_application и получите среднюю загрузку кредитных карт (AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL) среди клиентов для карточной активности за последние 6 месяцев (cc.MONTHS_BALANCE > -6) по по типу предыдущего кредитного продукта (pa.NAME_CONTRACT_TYPE).",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.MONTHS_BALANCE > -6 GROUP BY cc.SK_ID_CURR ) SELECT pa.NAME_CONTRACT_TYPE AS group_key, AVG(utilization) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите тренд среднего баланса по кредитным картам помесячно.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для клиентов, которые уже брали кредит ранее между клиентами между отраслями продавцов, через которых оформлялись кредиты?",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проанализируйте средний фактический кредитный лимит по категориям заемщиков (дефолт/не дефолт).",
    "sql": "SELECT at.TARGET, AVG(ccb.AMT_CREDIT_LIMIT_ACTUAL) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY at.TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите среднюю сумму кредитного лимита в БКИ по категориям семейного положения.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(b.AMT_CREDIT_SUM) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY AVG(b.AMT_CREDIT_SUM) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с CTE, где сначала по каждому SK_BUREAU_ID считается bad_month_share, а затем в разрезе по типу кредита (b.CREDIT_TYPE) агрегируется среднюю долю месяцев с просрочкой по кредитам (bad_month_share) для истории по кредитам за последние 12 месяцев (bb.MONTHS_BALANCE > -12).",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.MONTHS_BALANCE > -12 GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_TYPE AS group_key, AVG(bad_month_share) AS metric_value FROM bb_agg GROUP BY CREDIT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните среднее значение снятия наличных с кредитных карт для дефолтных и добросовестных клиентов.",
    "sql": "SELECT at.TARGET, AVG(ccb.AMT_DRAWINGS_ATM_CURRENT) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE ccb.AMT_DRAWINGS_ATM_CURRENT IS NOT NULL GROUP BY at.TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля NAME_YIELD_GROUP показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_YIELD_GROUP ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как образование влияет на то, платят люди или нет? Покажи процент неплательщиков по каждому уровню образования.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(TARGET) * 100 AS Default_Rate FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY Default_Rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с суммой до 100 000 и по каждому значению группировки (CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для кредитов, по которым данные давно не обновлялись для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для POS-кредитов с коротким графиком для разных значений признака «наличие просрочки по POS» по POS-кредитам.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте график динамики среднего баланса кредитных карт за последние 6 отчетных месяцев.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC LIMIT 6;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сколько в среднем денег мы выдаем в виде кредитов?",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова средняя сумма товара в одобренных против отклоненных предыдущих заявках?",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(AMT_GOODS_PRICE) FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused') GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков показатель просрочки среди заемщиков с высшим образованием и наличием собственного автомобиля?",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train WHERE NAME_EDUCATION_TYPE = 'Higher education' AND FLAG_OWN_CAR = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каково среднее значение ежемесячного аннуитетного платежа для всех активных займов?",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте среднюю агрегированную сумму текущих платежей по кредитным картам для клиентов, сегментированных по типу их жилья.",
    "sql": "SELECT at.NAME_HOUSING_TYPE, AVG(ccb.AMT_PAYMENT_TOTAL_CURRENT) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY at.NAME_HOUSING_TYPE ORDER BY AVG(ccb.AMT_PAYMENT_TOTAL_CURRENT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для предыдущих заявок примерно за последний год между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля CHANNEL_TYPE показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните отношение платежей к объёму выборок по картам для недавней активности по кредитным картам по признаку «канал оформления предыдущего кредита» на уровне клиентов, используя как данные по прошлым кредитам, так и агрегированную статистику по картам.",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.MONTHS_BALANCE > -6 GROUP BY cc.SK_ID_CURR ) SELECT pa.CHANNEL_TYPE AS group_key, AVG(pay_vs_spend_ratio) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для карт с серьёзными просрочками для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD_DEF > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_CURR ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова тенденция изменения среднего значения кредитного лимита, зафиксированного в кредитных бюро, для различных возрастных сегментов заемщиков?",
    "sql": "SELECT CASE WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 25 THEN 'До 25' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 35 THEN '26-35' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 45 THEN '36-45' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 55 THEN '46-55' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 65 THEN '56-65' ELSE 'Старше 65' END AS AgeGroup, AVG(b.AMT_CREDIT_SUM_LIMIT) AS AverageCreditLimit FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY AgeGroup ORDER BY AgeGroup;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Можем ли мы увидеть, как распределяются наши клиенты по числу членов семьи?",
    "sql": "SELECT CNT_FAM_MEMBERS, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для активных POS-кредитов (CNT_INSTALMENT_FUTURE > 0) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя среднюю по клиенту задержку платежей для прошлых крупных кредитов с реальными платежами по графику для разных групп клиентов между просроченными и своевременными платежами, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.AMT_CREDIT > 50000 AND ip.AMT_INSTALMENT > 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для новых клиентов (pa.NAME_CLIENT_TYPE = 'New') сгруппирует данные по признаку просрочки платежа (delay_days > 0) и рассчитает среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните размер фактического платежа по рассрочке для второй половины клиентов по нечётности ID для разных значений признака «тип платёжной дисциплины» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите общее число микрофинансовых займов из истории прошлых обращений.",
    "sql": "SELECT COUNT(SK_ID_PREV) FROM previous_application WHERE NFLAG_MICRO_CASH = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым известна фактическая дата завершения (DAYS_ENDDATE_FACT IS NOT NULL) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) для записей с активным статусом договора (NAME_CONTRACT_STATUS = 'Active') в разрезе по месяцу отчётности (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выведите метрику дефолтности, сгруппированную по видам клиентского дохода.",
    "sql": "SELECT NAME_INCOME_TYPE, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY 2 DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для прошлых заявок, принятых более года назад между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите разбивку предыдущих кредитов в БКИ по их статусам.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов с недавно обновлёнными данными в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE > -30 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD_DEF по POS-кредитам для POS-кредитов без задержек по оплате между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните накопленный остаток по карте для карт, по которым установлен лимит по признаку «месяц истории по карте», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0 ) SELECT MONTHS_BALANCE AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым уже была просрочка (CREDIT_DAY_OVERDUE > 0) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для предыдущих заявок примерно за последний год между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте список потенциально рисковых клиентов, у которых сумма кредита превышает 1 500 000, а ежемесячный доход составляет менее 100 000.",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT FROM application_train WHERE AMT_CREDIT > 1500000 AND AMT_INCOME_TOTAL < 100000 LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте показатель активных кредитных досье в БКИ по нашим клиентам.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для отказанных предыдущих кредитов между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите общий показатель снятий наличных с кредитных карт через банкоматные устройства.",
    "sql": "SELECT SUM(AMT_DRAWINGS_ATM_CURRENT) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Можешь показать, сколько у нас клиентов с активными займами, по которым просрочка в БКИ больше месяца?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 30;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для условной половины клиентов по чётности ID для разных групп между клиентами по их карточной активности?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите количество клиентов, имеющих в своем кредитном досье более двух действующих займов.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING COUNT(SK_BUREAU_ID) > 2;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните разницу между фактическим и плановым платёжом по рассрочке для рассрочек с реальным графиком платежей по признаку «версия графика платежей», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих платежей по картам для карт с тратами в текущем месяце в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднюю сумму выданных товаров по одобренным кредитным заявкам за предыдущий период.",
    "sql": "SELECT AVG(AMT_GOODS_PRICE) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для повторных клиентов (pa.NAME_CLIENT_TYPE = 'Repeater') сгруппирует данные по признаку просрочки платежа (delay_days > 0) и рассчитает среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднюю долю месяцев с просрочкой по картам (SK_DPD > 0) для карт с заданным кредитным лимитом (AMT_CREDIT_LIMIT_ACTUAL > 0) по по клиенту (SK_ID_CURR).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0 ) SELECT SK_ID_CURR AS group_key, AVG(CASE WHEN SK_DPD > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM cc GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для закрытых кредитов (CREDIT_ACTIVE = 'Closed') и по каждому значению группировки (CREDIT_TYPE) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Визуализируйте долю каждого типа транзакций снятия средств по кредитным картам (ATM, POS, Other) для анализа поведенческих паттернов.",
    "sql": "SELECT 'ATM' as DrawingType, SUM(CNT_DRAWINGS_ATM_CURRENT) as TotalDrawings FROM credit_card_balance UNION ALL SELECT 'POS' as DrawingType, SUM(CNT_DRAWINGS_POS_CURRENT) as TotalDrawings FROM credit_card_balance UNION ALL SELECT 'Other' as DrawingType, SUM(CNT_DRAWINGS_OTHER_CURRENT) as TotalDrawings FROM credit_card_balance;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните величина DAYS_DECISION по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «тип кредитного продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково количество отклоненных кредитных запросов?",
    "sql": "SELECT COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для активных POS-кредитов (CNT_INSTALMENT_FUTURE > 0) в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для кредитов на дорогие товары дороже 100 000 между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитов в условной валюте 'currency 1' в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите общее число клиентов, обладающих более чем двумя активными кредитными обязательствами, зарегистрированными в БКИ.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_credits FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING active_credits > 2);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите количество всех уникальных клиентов.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Предоставьте информацию о количестве ранее полученных кредитных продуктов каждым заемщиком.",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_ID_PREV) AS NumberOfPreviousLoans FROM previous_application GROUP BY SK_ID_CURR ORDER BY NumberOfPreviousLoans DESC",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для отказанных предыдущих кредитов для разных категорий по признаку «группа доходности продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_YIELD_GROUP ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам для кредитной истории старше года в разрезе признака «размер кредита», если учитывать помесячную историю статусов кредитов из бюро.",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.MONTHS_BALANCE <= -12 GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(bad_month_share) AS metric_value FROM bb_agg GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажи количество заемщиков, подтвердивших наличие автомобиля и собственности.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE FLAG_OWN_CAR = 'Y' AND FLAG_OWN_REALTY = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Визуализируйте численность клиентов по доходам, используя интервалы в 50 тысяч рублей.",
    "sql": "SELECT (CAST(AMT_INCOME_TOTAL / 50000 AS INT) * 50000) AS income_bin_start, COUNT(*) FROM application GROUP BY income_bin_start ORDER BY income_bin_start;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков годовой тренд по уровню отклонения предыдущих кредитных запросов?",
    "sql": "SELECT CAST(ABS(DAYS_DECISION)/365.25 AS INTEGER) AS years_ago, COUNT(SK_ID_PREV) AS refused_count FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY years_ago ORDER BY years_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для кредитов, открытых более года назад для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для кредитов, открытых более года назад в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для кредитов, по которым задан аннуитетный платёж в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с непогашенной задолженностью (AMT_CREDIT_SUM_DEBT > 0) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определить среднюю сумму задолженности по кредитам, отраженным в БКИ, для всей клиентской базы.",
    "sql": "SELECT AVG(b.AMT_CREDIT_SUM_DEBT) FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.AMT_CREDIT_SUM_DEBT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите клиентов, у которых общий долг в БКИ больше, чем их кредит у нас.",
    "sql": "SELECT a.SK_ID_CURR, a.AMT_CREDIT, b.AMT_CREDIT_SUM_DEBT FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.AMT_CREDIT_SUM_DEBT > a.AMT_CREDIT AND b.CREDIT_ACTIVE = 'Active' LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните средний стаж работы между заемщиками с риском дефолта и без такового.",
    "sql": "SELECT TARGET, AVG(ABS(DAYS_EMPLOYED)) FROM application_train WHERE DAYS_EMPLOYED < 0 GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как текущая долговая нагрузка варьируется в зависимости от статуса кредита (активный/закрытый) по данным БКИ, для оценки кредитного риска?",
    "sql": "SELECT CREDIT_ACTIVE, AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE AMT_CREDIT_SUM_DEBT IS NOT NULL GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по часу принятия решения (HOUR_APPR_PROCESS_START).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков 'default rate' для сегмента клиентов без собственного недвижимого имущества?",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train WHERE FLAG_OWN_REALTY = 'N';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Исследуйте влияние типа сопровождения заявителя при подаче заявки на уровень дефолтности.",
    "sql": "SELECT NAME_TYPE_SUITE, AVG(TARGET) * 100 FROM application_train_test GROUP BY NAME_TYPE_SUITE ORDER BY AVG(TARGET) DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какая была средняя сумма кредита для одобренных и отклоненных заявок в прошлом?",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused') GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова помесячная динамика новых кредитов, появившихся в кредитных историях наших заемщиков за последний год?",
    "sql": "SELECT ABS(CAST(DAYS_CREDIT / 30 AS INT)) AS months_ago, COUNT(SK_BUREAU_ID) FROM bureau WHERE DAYS_CREDIT <= 0 AND DAYS_CREDIT >= -365 GROUP BY months_ago ORDER BY months_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Покажи, как год от года менялось число заявок на микрокредиты (NFLAG_MICRO_CASH = 1).",
    "sql": "SELECT CAST(2023 + DAYS_DECISION / 365 AS INT) AS decision_year, COUNT(SK_ID_PREV) FROM previous_application WHERE NFLAG_MICRO_CASH = 1 GROUP BY decision_year ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните кредитный лимит по картам для условной половины клиентов по чётности ID в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите количество клиентов, у которых совокупная задолженность по данным БКИ превышает половину их годового дохода.",
    "sql": "SELECT COUNT(DISTINCT at.SK_ID_CURR) FROM application_train at JOIN (SELECT SK_ID_CURR, SUM(AMT_CREDIT_SUM_DEBT) AS total_bureau_debt FROM bureau GROUP BY SK_ID_CURR) b_debt ON at.SK_ID_CURR = b_debt.SK_ID_CURR WHERE b_debt.total_bureau_debt > (at.AMT_INCOME_TOTAL * 0.5);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам для действующих кредитов по данным бюро в разрезе признака «тип кредита в бюро», если учитывать помесячную историю статусов кредитов из бюро.",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_TYPE AS group_key, AVG(bad_month_share) AS metric_value FROM bb_agg GROUP BY CREDIT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте общий показатель уровня дефолтов по всем актуальным кредитным заявкам.",
    "sql": "SELECT AVG(TARGET) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова средняя величина основного долга по активным кредитным картам в нашей базе?",
    "sql": "SELECT AVG(AMT_RECEIVABLE_PRINCIPAL) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова усредненная годовая сумма запросов на кредит в БКИ для клиентов с целевым статусом TARGET = 1?",
    "sql": "SELECT AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train WHERE TARGET = 1",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля NAME_PORTFOLIO показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Построй график среднего ежедневного снятия через POS по кредитным картам за каждый месяц.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_DRAWINGS_POS_CURRENT) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Рассчитайте ключевой показатель: долю заявок, рассмотренных в нерабочее время, для оценки эффективности процессов.",
    "sql": "SELECT (SUM(CASE WHEN HOUR_APPR_PROCESS_START < 9 OR HOUR_APPR_PROCESS_START >= 18 THEN 1 ELSE 0 END) * 100.0) / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для первых шести платежей по рассрочке (NUM_INSTALMENT_NUMBER <= 6) сгруппирует данные по каналу продаж (pa.CHANNEL_TYPE) и рассчитает среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT CHANNEL_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте матрицу распределения клиентов по признакам владения автомобилем и недвижимостью.",
    "sql": "SELECT FLAG_OWN_CAR, FLAG_OWN_REALTY, COUNT(SK_ID_CURR) AS ClientCount FROM application_train GROUP BY FLAG_OWN_CAR, FLAG_OWN_REALTY ORDER BY ClientCount DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для крупных кредитов (свыше 100 000) в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт без серьёзной просрочки по DPD_DEF (SK_DPD_DEF = 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется задержку платежа по рассрочкам для пропущенных платежей между различными сегментами между ранними, средними и поздними платежами в графике в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT = 0 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте средний накопленный объём платежей по клиенту (cum_payment) для фактически оплаченных записей (AMT_PAYMENT > 0) в разрезе по факту просрочки платежа (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково среднее соотношение кредитной нагрузки к доходу для различных групп клиентов по стажу работы?",
    "sql": "SELECT CASE WHEN DAYS_EMPLOYED < -3650 THEN '10+ years' WHEN DAYS_EMPLOYED < -1825 THEN '5-10 years' WHEN DAYS_EMPLOYED < -365 THEN '1-5 years' ELSE '<1 year' END AS employment_years, AVG(AMT_CREDIT * 1.0 / AMT_INCOME_TOTAL) AS avg_debt_to_income FROM application WHERE AMT_INCOME_TOTAL > 0 GROUP BY employment_years ORDER BY employment_years DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для кредитной истории средней давности в разрезе признака «статус кредита по месяцам» по истории кредитов из бюро.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -18 AND -6 GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте процент заемщиков без кредитной истории в БКИ от общего портфеля.",
    "sql": "SELECT CAST(COUNT(DISTINCT at.SK_ID_CURR) AS REAL) * 100 / (SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train) FROM application_train at LEFT JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.SK_ID_CURR IS NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля NAME_PORTFOLIO показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD_DEF по POS-кредитам для POS-операций примерно за последние полгода между разными категориями между клиентами по их POS-истории?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по дню недели принятия решения (WEEKDAY_APPR_PROCESS_START).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой процент дефолтов среди тех, у кого много контактов в соцсетях (OBS_30_CNT_SOCIAL_CIRCLE > 2)?",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE > 2;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов с недавно обновлёнными данными для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE > -30 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выведите среднюю сумму долговых обязательств, зафиксированных в БКИ.",
    "sql": "SELECT AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE AMT_CREDIT_SUM_DEBT IS NOT NULL",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте отчет о сегментации клиентской базы по признакам владения движимым и недвижимым имуществом.",
    "sql": "SELECT FLAG_OWN_CAR, FLAG_OWN_REALTY, COUNT(SK_ID_CURR) AS ClientCount FROM application_train GROUP BY FLAG_OWN_CAR, FLAG_OWN_REALTY ORDER BY ClientCount DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните запрошенный размер кредита по заявке для клиентов, которые уже брали кредит ранее для разных категорий по признаку «тип портфеля» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита от 10 000 до 50 000 и по каждому значению поля NAME_YIELD_GROUP показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой процент займов у 'малообразованных' клиентов находится в просрочке?",
    "sql": "SELECT CAST(SUM(CASE WHEN t2.CREDIT_DAY_OVERDUE > 0 THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(t2.SK_BUREAU_ID) FROM application_train t1 JOIN bureau t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR WHERE t1.NAME_EDUCATION_TYPE IN ('Lower secondary', 'Secondary / secondary special');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов без просрочки (SK_DPD = 0) и показан среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) по каждому значению CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проанализируйте среднюю сумму текущих кредитов в разрезе статусов предыдущих кредитов в БКИ (действующие или погашенные).",
    "sql": "SELECT b.CREDIT_ACTIVE, AVG(at.AMT_CREDIT) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY b.CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для старой активности по картам для разных групп между клиентами по их карточной активности?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Визуализируйте средний доход клиентов по семейному статусу для сегментации и анализа платежеспособности.",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY AVG(AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Произвести расчет средней суммы выданного кредита для каждого типа основного контракта.",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_CREDIT) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Идентифицируйте сегмент заемщиков, обладающих высоким платежеспособным потенциалом (топ-20% дохода) при наличии жилищного залога ('House / apartment').",
    "sql": "SELECT SK_ID_CURR, AMT_INCOME_TOTAL, AMT_CREDIT FROM application_train WHERE NAME_HOUSING_TYPE = 'House / apartment' ORDER BY AMT_INCOME_TOTAL DESC LIMIT (SELECT CAST(COUNT(*)*0.2 AS INTEGER) FROM application_train WHERE NAME_HOUSING_TYPE = 'House / apartment');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля HOUR_APPR_PROCESS_START показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните запрошенный размер кредита по заявке для прошлых заявок, принятых более года назад для разных категорий по признаку «канал продаж» в прошлых заявках клиентов.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Чему равна средняя сумма первого взноса по ранее одобренным кредитам?",
    "sql": "SELECT AVG(AMT_DOWN_PAYMENT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND AMT_DOWN_PAYMENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих платежей по картам для карт, по которым есть просрочка в разрезе признака «тип поведения по карте» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните стоимость товара по предыдущим кредитам для одобренных предыдущих кредитов для разных категорий по признаку «статус прошлой заявки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проанализируйте средний уровень дохода заемщиков, сгруппированных по образованию.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY AVG(AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите почасовую статистику по количеству входящих заявок.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько раз в среднем обращались в БКИ за последний год, если смотреть отдельно по тем, кто дефолтил, и по тем, кто нет?",
    "sql": "SELECT TARGET, AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с количеством платежей до 6 (CNT_INSTALMENT <= 6) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для предыдущих заявок с суммой кредита более 50 000 в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажите разбивку прошлых заявок по статусу одобрения: сколько было 'Approved' и сколько 'Refused'.",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) AS count FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused') GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для кредитов с суммой более 100 000 (AMT_CREDIT_SUM > 100000) в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Отобразите среднее время обработки заявки (в днях) для одобренных и отклоненных контрактов.",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(ABS(DAYS_DECISION)) FROM previous_application GROUP BY NAME_CONTRACT_STATUS HAVING NAME_CONTRACT_STATUS IN ('Approved', 'Refused');",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте перечень уникальных идентификаторов клиентов (SK_ID_CURR), имеющих в своей кредитной истории более одного действующего кредитного обязательства согласно данным БКИ.",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS ActiveCreditsCount FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING COUNT(SK_BUREAU_ID) > 1 ORDER BY ActiveCreditsCount DESC LIMIT 50;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для платежей без просрочки (DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT), покажите средний плановый платёж по рассрочке (AMT_INSTALMENT) по каждому значению поля CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей с ненулевым плановым платежом (AMT_INSTALMENT > 0), покажите средний плановый платёж по рассрочке (AMT_INSTALMENT) по каждому значению поля CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_INSTALMENT > 0 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Идентифицируйте пять профессиональных групп с максимальным уровнем кредитного риска (дефолтности).",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) AS default_rate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY default_rate DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько в среднем раз за последний год наши клиенты обращались в БКИ?",
    "sql": "SELECT AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Кто из наших клиентов с высокой вероятностью дефолта также имеет большой долг в БКИ? Покажи топ.",
    "sql": "SELECT a.SK_ID_CURR, a.AMT_CREDIT, b.AMT_CREDIT_SUM_DEBT FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE a.TARGET = 1 AND b.AMT_CREDIT_SUM_DEBT > 0 ORDER BY b.AMT_CREDIT_SUM_DEBT DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните показатель DPD по POS-кредитам для POS-кредитов с длительным графиком платежей для разных значений признака «клиент» по POS-кредитам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите количество клиентов с просроченными кредитами в БКИ.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Предоставьте перечень клиентов с повышенной кредитной нагрузкой, имеющих более двух действующих кредитов по информации из БКИ.",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_credits_count FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING active_credits_count > 2 ORDER BY active_credits_count DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') и по каждому значению поля NAME_YIELD_GROUP показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_YIELD_GROUP ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Анализ структуры активных кредитов в бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с непогашенной задолженностью (AMT_CREDIT_SUM_DEBT > 0) и по каждому значению группировки (CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя долю просроченных платежей по POS-кредитам для платежей с известной датой внесения между различными сегментами между разными статусами POS-договоров по POS-кредитам клиентов?",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_ENTRY_PAYMENT IS NOT NULL ) SELECT pos.NAME_CONTRACT_STATUS AS group_key, AVG(late_flag) AS metric_value FROM pos_inst GROUP BY pos.NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобрази количество заявок, поданных в каждый день недели.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY CASE WHEN WEEKDAY_APPR_PROCESS_START = 'MONDAY' THEN 1 WHEN WEEKDAY_APPR_PROCESS_START = 'TUESDAY' THEN 2 WHEN WEEKDAY_APPR_PROCESS_START = 'WEDNESDAY' THEN 3 WHEN WEEKDAY_APPR_PROCESS_START = 'THURSDAY' THEN 4 WHEN WEEKDAY_APPR_PROCESS_START = 'FRIDAY' THEN 5 WHEN WEEKDAY_APPR_PROCESS_START = 'SATURDAY' THEN 6 ELSE 7 END;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с оставшимся сроком погашения (DAYS_CREDIT_ENDDATE > 0) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сколько в среднем денег запрашивали клиенты по тем заявкам, которые мы отклонили?",
    "sql": "SELECT AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Перечень заемщиков с указанием совокупного объема операций по снятию наличных средств с кредитных карт.",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_DRAWINGS_ATM_CURRENT) AS TotalATMDrawings FROM credit_card_balance GROUP BY SK_ID_CURR ORDER BY TotalATMDrawings DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На джойне POS_CASH_balance и installments_payments рассчитайте среднюю величину просрочки платежа по POS-кредитам в днях (days_late) для платежей по POS-кредитам с ненулевым плановым платежом в разрезе по типу платежного поведения клиента по POS-кредиту.",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_INSTALMENT > 0 ) SELECT CASE WHEN ip.AMT_PAYMENT >= ip.AMT_INSTALMENT THEN 'on_time_or_overpay' ELSE 'underpay_or_missing' END AS group_key, AVG(days_late) AS metric_value FROM pos_inst GROUP BY CASE WHEN ip.AMT_PAYMENT >= ip.AMT_INSTALMENT THEN 'on_time_or_overpay' ELSE 'underpay_or_missing' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Мне нужно увидеть список клиентов, у которых есть просрочки по кредитам в БКИ.",
    "sql": "SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_ACTIVE, b.CREDIT_DAY_OVERDUE, b.AMT_CREDIT_SUM_DEBT FROM bureau b WHERE b.CREDIT_DAY_OVERDUE > 0 ORDER BY b.CREDIT_DAY_OVERDUE DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитов с оставшимся сроком погашения (DAYS_CREDIT_ENDDATE > 0) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков суммарный кредитный лимит для клиентов с активными обязательствами в БКИ?",
    "sql": "SELECT SUM(b.AMT_CREDIT_SUM) FROM application_train AS a JOIN bureau AS b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По объединению bureau и bureau_balance рассчитайте среднее значение максимального месяца наблюдения (max_month) для активных кредитов из бюро (b.CREDIT_ACTIVE = 'Active') в разрезе по размеру кредита (крупный/остальные) на основе AMT_CREDIT_SUM, используя предварительную агрегацию по кредиту.",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Предоставьте перечень клиентов с их суммарными обязательствами по кредитам, зарегистрированным в БКИ.",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_CREDIT_SUM_DEBT) AS total_bureau_debt FROM bureau GROUP BY SK_ID_CURR ORDER BY total_bureau_debt DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с CTE, где сначала по каждому SK_BUREAU_ID считается bad_month_share, а затем в разрезе по валюте кредита (b.CREDIT_CURRENCY) агрегируется среднее значение максимального месяца наблюдения (max_month) для месяцев с любым уровнем просрочки (bb.STATUS в ['1'..'5']).",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1','2','3','4','5') GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_CURRENCY AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CREDIT_CURRENCY ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Дай мне список тех клиентов, у кого были просрочки больше двух месяцев по кредитам, согласно БКИ.",
    "sql": "SELECT DISTINCT SK_ID_CURR FROM bureau WHERE CREDIT_DAY_OVERDUE > 60 LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие профессии чаще всего приводят к просрочкам? Покажи топ-5.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) AS default_rate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY default_rate DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков средний доход по каждой категории семейного статуса?",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(AMT_INCOME_TOTAL) FROM application_train_test GROUP BY NAME_FAMILY_STATUS ORDER BY AVG(AMT_INCOME_TOTAL) DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для карт с нулевым остатком задолженности для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для завершённых POS-кредитов между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Completed' GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Оцените среднюю величину аннуитета для заемщиков с признаком 'дефолт' и без него, для выявления потенциальных индикаторов риска.",
    "sql": "SELECT TARGET, AVG(AMT_ANNUITY) FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для месяцев, относящихся к закрытым кредитам в разрезе признака «давность записи» по истории кредитов из бюро.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS = 'C' GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по дню недели принятия решения (WEEKDAY_APPR_PROCESS_START).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE) для кредитов с непогашенной задолженностью (AMT_CREDIT_SUM_DEBT > 0) в разрезе по валюте кредита (CREDIT_CURRENCY).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте динамику среднего фактического кредитного лимита по карточным продуктам за последний 12-месячный период.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance WHERE MONTHS_BALANCE BETWEEN -11 AND 0 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Выведите метрику, показывающую число клиентов с индикатором просрочек в социальном круге (OBS_30_CNT_SOCIAL_CIRCLE > 0), что может служить риск-фактором.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для клиентов, которые уже брали кредит ранее между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните размер планового платежа по рассрочке для случаев переплаты по рассрочке для разных значений признака «тип платёжной дисциплины» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT > AMT_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих выборок по картам для карт с серьёзными просрочками в разрезе признака «клиент» по кредитным картам клиентов.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD_DEF > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте средний накопленный объём платежей по клиенту (cum_payment) для первых 12 платежей в графике в разрезе по версии графика платежей (NUM_INSTALMENT_VERSION).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите топ-5 профессий, отсортированных по среднему общему доходу клиентов.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_INCOME_TOTAL) FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY AVG(AMT_INCOME_TOTAL) DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 для разных категорий по признаку «канал продаж» в прошлых заявках клиентов.",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выведите метрику: количество клиентов, имеющих просрочки среди социального окружения.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний плановый платёж по рассрочке (AMT_INSTALMENT) для записей с фактической оплатой (AMT_PAYMENT > 0) в разрезе по предыдущему кредиту (SK_ID_PREV).",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY SK_ID_PREV ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните показатель DPD_DEF по POS-кредитам для POS-кредитов с серьёзной просрочкой для разных значений признака «статус POS-договора» по POS-кредитам.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для предыдущих заявок с суммой кредита более 50 000 в разрезе по дню недели принятия решения (WEEKDAY_APPR_PROCESS_START).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для текущих, ещё не погашенных POS-кредитов для разных значений признака «наличие просрочки по POS» по POS-кредитам.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD_DEF по POS-кредитам для действующих POS-договоров между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитов с просроченной задолженностью (AMT_CREDIT_SUM_OVERDUE > 0) в разрезе по статусу кредита (CREDIT_ACTIVE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется количество оставшихся платежей по POS-кредитам для второй условной половины клиентов (по нечётности ID) между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднее значение кредитного лимита для всех одобренных заявок.",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Идентифицируйте топовых клиентов с наибольшими суммами задолженности по кредитным картам.",
    "sql": "SELECT SK_ID_CURR, AMT_TOTAL_RECEIVABLE FROM credit_card_balance ORDER BY AMT_TOTAL_RECEIVABLE DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Интересно, как часто разные профессии обращаются в БКИ в среднем за год? Покажи это.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(AMT_REQ_CREDIT_BUREAU_YEAR) AS avg_bureau_requests FROM application_train GROUP BY OCCUPATION_TYPE ORDER BY avg_bureau_requests DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Назовите пять ключевых причин, приводящих к отклонению кредитных заявок.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(*) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' AND CODE_REJECT_REASON != 'XAP' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(*) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте перечень из пяти самых распространенных причин отказа по ранее поданным кредитным заявкам.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' AND CODE_REJECT_REASON IS NOT NULL AND CODE_REJECT_REASON != 'XAP' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Вывести список ТОП-10 заемщиков, демонстрирующих наибольшие значения показателя DAYS_OVERDUE по данным кредитных бюро.",
    "sql": "SELECT T1.SK_ID_CURR, T2.CREDIT_DAY_OVERDUE, T2.AMT_CREDIT_SUM_DEBT FROM application_train AS T1 JOIN bureau AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T2.CREDIT_DAY_OVERDUE > 0 ORDER BY T2.CREDIT_DAY_OVERDUE DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите долю дефолтных случаев среди заемщиков, имеющих действующие кредитные обязательства согласно БКИ.",
    "sql": "SELECT AVG(app.TARGET) * 100 FROM application_train_test app JOIN (SELECT DISTINCT SK_ID_CURR FROM bureau WHERE CREDIT_ACTIVE = 'Active') b_active ON app.SK_ID_CURR = b_active.SK_ID_CURR",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков уровень дефолта для заемщиков, владеющих автомобилем?",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train WHERE FLAG_OWN_CAR = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте показатель дефолтов для сегмента клиентов 25-35 лет, имеющих доход выше среднего по портфелю.",
    "sql": "SELECT AVG(TARGET) FROM application_train WHERE FLOOR(ABS(DAYS_BIRTH) / 365) BETWEEN 25 AND 35 AND AMT_INCOME_TOTAL > (SELECT AVG(AMT_INCOME_TOTAL) FROM application_train);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов с суммой более 100 000 (AMT_CREDIT_SUM > 100000) в разрезе по валюте кредита (CREDIT_CURRENCY).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для платежей, превышающих плановый размер (AMT_PAYMENT > AMT_INSTALMENT), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_PAYMENT > AMT_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитных карт с установленным лимитом в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для POS-кредитов без тяжёлых просрочек для разных значений признака «наличие просрочки по POS» по POS-кредитам.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') и по каждому значению поля HOUR_APPR_PROCESS_START показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сколько заявок поступает в каждый час суток?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько в сумме долгов по БКИ у каждой категории занятости? Отсортируй по убыванию.",
    "sql": "SELECT at.OCCUPATION_TYPE, SUM(b.AMT_CREDIT_SUM_DEBT) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.OCCUPATION_TYPE ORDER BY SUM(b.AMT_CREDIT_SUM_DEBT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Идентифицируйте топ-10 клиентов с повышенным риском дефолта, обусловленным значительным количеством проблемных контактов в социальном окружении.",
    "sql": "SELECT SK_ID_CURR, OBS_30_CNT_SOCIAL_CIRCLE, TARGET FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE > 5 AND TARGET = 1 LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих платежей по картам для карт без тяжёлых просрочек в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каков средний размер аннуитета для заемщиков, имеющих детей?",
    "sql": "SELECT AVG(AMT_ANNUITY) AS avg_annuity FROM application_train WHERE CNT_CHILDREN > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') и по каждому значению поля NAME_CONTRACT_TYPE показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите среднюю сумму аннуитета по активным кредитам.",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM application_train WHERE AMT_ANNUITY IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какой была средняя стоимость товаров, профинансированных по всем одобренным ранее заявкам?",
    "sql": "SELECT AVG(AMT_GOODS_PRICE) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов с давними обновлениями (DAYS_CREDIT_UPDATE <= -30) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково общее количество предыдущих заявок для каждого из возможных статусов (одобрено, отклонено, отменено)?",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте средний накопленный объём платежей по клиенту (cum_payment) для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) по по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT SK_ID_CURR AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, у которых срок уже должен был закончиться (DAYS_CREDIT_ENDDATE <= 0) и по каждому значению группировки (CREDIT_CURRENCY) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE <= 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Общий объем кредитного портфеля по текущим заявкам.",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов в условной валюте 'currency 2' в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 2' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте агрегированную сумму всех операций по снятию наличных через банкоматы с кредитных карт.",
    "sql": "SELECT SUM(AMT_DRAWINGS_ATM_CURRENT) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова средняя давность кредитных обязательств в БКИ у клиентов, классифицированных как дефолтные?",
    "sql": "SELECT AVG(-t2.DAYS_CREDIT) FROM application_train t1 JOIN bureau t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR WHERE t1.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется разницу между фактическим и плановым платёжом по рассрочке для условной половины клиентов по чётности ID между различными сегментами между клиентами с низким, средним и высоким совокупным объёмом платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте распределение клиентов по наличию собственного автомобиля.",
    "sql": "SELECT FLAG_OWN_CAR, COUNT(SK_ID_CURR) FROM application_train GROUP BY FLAG_OWN_CAR",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без серьёзной просрочки по DPD_DEF (SK_DPD_DEF = 0), покажите средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Визуализируйте 'application status' распределение для всех исторических заявок.",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для лёгких просрочек (STATUS в ['1','2']), покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки STATUS.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS IN ('1','2') GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отслеживайте ежемесячную тенденцию числа уникальных заемщиков с негативной кредитной историей (просрочками) в БКИ.",
    "sql": "SELECT MONTHS_BALANCE, COUNT(DISTINCT SK_BUREAU_ID) FROM bureau_balance WHERE STATUS IN ('1', '2', '3', '4', '5') GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какова доля каждого типа контракта среди наших клиентов?",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) AS ContractCount FROM application_train GROUP BY NAME_CONTRACT_TYPE ORDER BY ContractCount DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Разбей наших клиентов по тому, где они живут.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) AS client_count FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY client_count DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для крупных кредитов (свыше 100 000) в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднее значение задержки платежа в днях (delay_days) по рассрочкам для первых 12 платежей в графике по по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT SK_ID_CURR AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Каково общее количество заемщиков, имеющих хотя бы одну запись о безнадежном долге в бюро кредитных историй?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Bad debt';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько клиентов с разным семейным статусом успешно завершили свои предыдущие кредитные заявки?",
    "sql": "SELECT at.NAME_FAMILY_STATUS, COUNT(pa.SK_ID_PREV) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY at.NAME_FAMILY_STATUS ORDER BY COUNT(pa.SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client) для платежей по рассрочке за последний год (DAYS_INSTALMENT BETWEEN -365 AND 0) в разрезе по признаку просрочки платежа (delay_days > 0) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сколько у нас вообще клиентов, и сколько из них не платят?",
    "sql": "SELECT TARGET, COUNT(SK_ID_CURR) AS Number_of_Clients FROM application_train GROUP BY TARGET;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Каким образом количество запросов клиента в БКИ за год влияет на вероятность дефолта?",
    "sql": "SELECT AMT_REQ_CREDIT_BUREAU_YEAR, AVG(TARGET) AS default_rate FROM application_train WHERE AMT_REQ_CREDIT_BUREAU_YEAR IS NOT NULL GROUP BY AMT_REQ_CREDIT_BUREAU_YEAR ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для кредитных карт с небольшим лимитом в разрезе признака «тип поведения по карте» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните долю просроченных платежей по рассрочке для условной половины клиентов по чётности ID по признаку «клиент», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT SK_ID_CURR AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднюю продолжительность активных кредитов в днях из базы БКИ.",
    "sql": "SELECT AVG(ABS(DAYS_CREDIT)) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя накопленный остаток по карте для карт с тяжёлыми просрочками для разных сегментов между разными месяцами наблюдения по картам с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD_DEF > 0 ) SELECT MONTHS_BALANCE AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для кредитов, где хотя бы раз была просрочка по сумме для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита от 10 000 до 50 000 и по каждому значению поля CHANNEL_TYPE показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните накопленный остаток по карте для карт, по которым установлен лимит по признаку «уровень использования лимита», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0 ) SELECT CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для небольших кредитов (до 100 000) для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите частоту дефолтов по различным типам проживания.",
    "sql": "SELECT NAME_HOUSING_TYPE, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY DefaultRate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для решений, принятых за последний год (DAYS_DECISION > -365) в разрезе по статусу договора (NAME_CONTRACT_STATUS) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Можете посмотреть, сколько клиент с ID 100002 потратил с кредитки через банкоматы, через терминалы и сколько было других трат?",
    "sql": "SELECT SUM(AMT_DRAWINGS_ATM_CURRENT) AS atm_sum, SUM(AMT_DRAWINGS_POS_CURRENT) AS pos_sum, SUM(AMT_DRAWINGS_OTHER_CURRENT) AS other_sum FROM credit_card_balance WHERE SK_ID_CURR = 100002;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте средний накопленный объём платежей по клиенту (cum_payment) для фактически оплаченных записей (AMT_PAYMENT > 0) по по версии графика платежей (NUM_INSTALMENT_VERSION).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для завершённых POS-договоров (NAME_CONTRACT_STATUS = 'Completed') в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Completed' GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD_DEF по POS-кредитам для условной половины клиентов (по чётности ID) между разными категориями между активными и погашенными POS-кредитами?",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с просрочкой по DPD (SK_DPD > 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для закрытых кредитов (CREDIT_ACTIVE = 'Closed') в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажи почасовое количество предыдущих кредитных заявок.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_PREV) AS application_count FROM previous_application GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Оцените тренд среднего карточного баланса по месяцам.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) AS avg_balance FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как ведёт себя текущая задолженность по кредитам из бюро для кредитов с историей просрочек для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с DPD > 0 и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для одобренных предыдущих кредитов между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для POS-кредитов с просрочкой между разными категориями по разным месяцам наблюдения POS-кредитов?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте гистограмму, показывающую количество клиентов для каждого типа образования для анализа сегментации портфеля.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS NumberOfClients FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY NumberOfClients DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Скажите, какая самая долгая просрочка была у клиентов по данным из БКИ?",
    "sql": "SELECT MAX(CREDIT_DAY_OVERDUE) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для клиентов, которые уже брали кредит ранее для разных категорий по признаку «статус прошлой заявки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице installments_payments рассчитайте среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по номеру платежа в графике (NUM_INSTALMENT_NUMBER).",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для фактических оплат по рассрочке (ip.AMT_PAYMENT > 0) сгруппирует данные по признаку просрочки платежа (delay_days > 0) и рассчитает среднюю долю просроченных платежей (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте суммарный общий доход (AMT_INCOME_TOTAL) всех клиентов, владеющих недвижимостью (FLAG_OWN_REALTY = 'Y').",
    "sql": "SELECT SUM(AMT_INCOME_TOTAL) FROM application_train WHERE FLAG_OWN_REALTY = 'Y';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для карт с нулевым остатком задолженности в разрезе признака «уровень кредитного лимита» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «статус прошлой заявки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяются типы занятости среди клиентов, совершивших более трех запросов в БКИ за последний год?",
    "sql": "SELECT OCCUPATION_TYPE, COUNT(SK_ID_CURR) FROM application_train WHERE AMT_REQ_CREDIT_BUREAU_YEAR > 3 GROUP BY OCCUPATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется задержку платежа по рассрочкам для платежей, которые клиент внёс между различными сегментами между клиентами с низким, средним и высоким совокупным объёмом платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как изменялся средний объем текущих платежей по кредитным картам по месяцам?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Проанализируйте структуру заявок по категориям занятости для текущего портфеля.",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_INCOME_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Рассчитайте процентное соотношение кредитных заявок, обработанных в стандартные рабочие часы (с 9:00 до 18:00), относительно общего объема поданных заявок.",
    "sql": "SELECT (SUM(CASE WHEN HOUR_APPR_PROCESS_START BETWEEN 9 AND 18 THEN 1 ELSE 0 END) * 100.0) / COUNT(*) FROM application_train_test;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каковы средние суммы кредитов, выдаваемых заемщикам с высшим образованием в сравнении с заемщиками со средним образованием?",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(AMT_CREDIT) FROM application_train WHERE NAME_EDUCATION_TYPE IN ('Higher education', 'Secondary / secondary special') GROUP BY NAME_EDUCATION_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для полностью выплаченных POS-кредитов (CNT_INSTALMENT_FUTURE = 0) и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какой в среднем был размер выданных кредитов за последние 12 месяцев?",
    "sql": "SELECT AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND DAYS_DECISION >= -365;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните значение DAYS_INSTALMENT для начальных платежей по рассрочке для разных значений признака «предыдущий кредит» в платёжной истории клиентов.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY SK_ID_PREV ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как там у нас с соотношением, сколько вернули денег по кредиткам по сравнению с тем, сколько сняли?",
    "sql": "SELECT SUM(AMT_PAYMENT_TOTAL_CURRENT) / SUM(AMT_DRAWINGS_CURRENT) FROM credit_card_balance WHERE SUM(AMT_DRAWINGS_CURRENT) > 0",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте средний объем платежей, совершенных по кредитным картам за наиболее актуальный отчетный месяц.",
    "sql": "SELECT AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE = (SELECT MAX(MONTHS_BALANCE) FROM credit_card_balance) AND AMT_PAYMENT_TOTAL_CURRENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем дней уходит на то, чтобы одобрить заявку?",
    "sql": "SELECT AVG(-DAYS_DECISION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется значение MONTHS_BALANCE по кредитам в бюро для второй половины кредитов по нечётности ID между разными категориями между разными статусами состояния кредита в разрезе месяцев?",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE SK_BUREAU_ID % 2 = 1 GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для новых клиентов (NAME_CLIENT_TYPE = 'New') в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Представьте структуру распределения клиентской базы по количеству членов семьи.",
    "sql": "SELECT CNT_FAM_MEMBERS, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите мне раскладку по статусам всех предыдущих заявок на кредиты.",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с количеством платежей более 6 (CNT_INSTALMENT > 6) и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сгенерируйте подробный анализ уровня дефолтности клиентов, сгруппированный по типам образования и семейному положению.",
    "sql": "SELECT NAME_EDUCATION_TYPE, NAME_FAMILY_STATUS, AVG(TARGET) AS default_rate, COUNT(SK_ID_CURR) AS client_count FROM application_train GROUP BY NAME_EDUCATION_TYPE, NAME_FAMILY_STATUS ORDER BY default_rate DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков средний первоначальный взнос, агрегированный по различным типам контрактов для одобренных заявок?",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_DOWN_PAYMENT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько у наших заемщиков детей, и как это распределяется?",
    "sql": "SELECT CNT_CHILDREN, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для кредитов, по которым ещё не наступил конец срока в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «тип кредитного продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт без текущего остатка (AMT_BALANCE = 0) в разрезе по месяцу отчётности по карте (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Визуализируйте месячную динамику доли активных кредитов, согласно данным БКИ.",
    "sql": "SELECT MONTHS_BALANCE, CAST(SUM(CASE WHEN STATUS = 'Active' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) FROM bureau_balance AS bb JOIN bureau AS b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каково распределение клиентов по их кредитному статусу согласно данным БКИ?",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(DISTINCT SK_ID_CURR) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните задержку платежа по рассрочкам для платежей, которые клиент внёс по признаку «версия графика платежей», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-записей за последние 6 месяцев (MONTHS_BALANCE > -6) и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково распределение клиентов по типам образования, и какой показатель дефолта наблюдается в каждой образовательной группе?",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS TotalClients, SUM(TARGET) AS DefaultClients, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY DefaultRate DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для записей с активным статусом договора (NAME_CONTRACT_STATUS = 'Active') в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите наиболее рискованные профессии с точки зрения кредитного скоринга, показав топ-5 по уровню дефолтов.",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) * 100 AS Default_Rate, COUNT(SK_ID_CURR) AS Total_Applications FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL AND OCCUPATION_TYPE != 'XNA' GROUP BY OCCUPATION_TYPE HAVING COUNT(SK_ID_CURR) > 100 ORDER BY Default_Rate DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов, по которым есть долг в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте средний накопленный объём платежей по клиенту (cum_payment) для первых 12 платежей в графике по по факту просрочки платежа (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Выведите идентификаторы клиентов с периодом трудоустройства менее одного года.",
    "sql": "SELECT SK_ID_CURR, ABS(DAYS_EMPLOYED) AS Days_Employed FROM application_train WHERE DAYS_EMPLOYED > -365 AND DAYS_EMPLOYED < 0 LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите среднюю сумму первоначального взноса по всем одобренным прошлым заявкам.",
    "sql": "SELECT AVG(AMT_DOWN_PAYMENT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND AMT_DOWN_PAYMENT IS NOT NULL AND AMT_DOWN_PAYMENT > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько в среднем заплатили по кредиткам в прошлом месяце? Покажите цифру.",
    "sql": "SELECT AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE = -1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_INSTALMENT для платежей, которые были действительно внесены между разными группами между платежами, где клиент платил полностью или больше, и платежами с недоплатой?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется значение MONTHS_BALANCE по кредитам в бюро для месяцев, по которым нет детальной информации между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS = 'X' GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих выборок по картам для условной половины клиентов по чётности ID в разрезе признака «статус договора по карте» по кредитным картам клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какой процент клиентов является родителями?",
    "sql": "SELECT (COUNT(CASE WHEN CNT_CHILDREN > 0 THEN 1 END) * 100.0 / COUNT(*)) FROM application;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для кредитов с чётным SK_BUREAU_ID, покажите долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро по каждому значению поля группировки SK_BUREAU_ID.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE SK_BUREAU_ID % 2 = 0 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сколько в среднем зарабатывают наши клиенты, подающие заявки?",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для кредитов, открытых более года назад для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT <= -365 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков общий объем долга, зарегистрированного в БКИ, для нашей когорты дефолтных клиентов?",
    "sql": "SELECT SUM(T2.AMT_CREDIT_SUM_DEBT) FROM application_train AS T1 JOIN bureau AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T1.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний плановый платёж по рассрочке (AMT_INSTALMENT) для записей без фактического платежа (AMT_PAYMENT = 0) в разрезе по признаку своевременности платежа (on_time/late).",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT = 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для карт, по которым вносились платежи для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажи нам уровень дефолта в целом по базе данных.",
    "sql": "SELECT AVG(TARGET) * 100 FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите три типа жилья, демонстрирующие наивысший уровень дефолтов.",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(TARGET) * 100 FROM application GROUP BY NAME_HOUSING_TYPE ORDER BY AVG(TARGET) DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова общая сумма текущих платежей по кредитным картам за последний доступный месяц?",
    "sql": "SELECT SUM(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE MONTHS_BALANCE = (SELECT MAX(MONTHS_BALANCE) FROM credit_card_balance);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните стоимость товара по предыдущим кредитам для одобренных предыдущих кредитов для разных категорий по признаку «тип кредитного продукта» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT) для кредитов с оставшимся сроком погашения (DAYS_CREDIT_ENDDATE > 0) в разрезе по статусу кредита (CREDIT_ACTIVE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_ENDDATE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля NAME_CLIENT_TYPE показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей с ненулевым плановым платежом (AMT_INSTALMENT > 0), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля SK_ID_PREV.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_INSTALMENT > 0 GROUP BY SK_ID_PREV ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт без серьёзной просрочки по DPD_DEF (SK_DPD_DEF = 0) в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проанализировать демографическое распределение типов жилья среди сегмента дефолтных заемщиков.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(*) FROM application_train WHERE TARGET = 1 GROUP BY NAME_HOUSING_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Оцените вероятность дефолта (дефолт-рейт) для сегментов клиентов с детьми и без детей.",
    "sql": "SELECT CASE WHEN CNT_CHILDREN > 0 THEN 'С детьми' ELSE 'Без детей' END AS HasChildren, AVG(TARGET) FROM application_train GROUP BY HasChildren;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для одобренных предыдущих кредитов между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY CHANNEL_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте средний накопленный объём платежей по клиенту (cum_payment) для записей с ненулевым плановым платежом в разрезе по версии графика платежей (NUM_INSTALMENT_VERSION).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите количество клиентов, имеющих на иждивении детей.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE CNT_CHILDREN > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для более старых POS-записей (MONTHS_BALANCE < -12) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется задержку платежа по рассрочкам для долгих рассрочек с большим количеством платежей между различными сегментами между клиентами с низким, средним и высоким совокупным объёмом платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 12 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для второй условной половины клиентов (по нечётности ID) между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт с серьёзной просрочкой по DPD_DEF (SK_DPD_DEF > 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD_DEF > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля NAME_PORTFOLIO показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сколько у нас клиентов с машинами, а сколько без? Покажи это на круговой диаграмме.",
    "sql": "SELECT FLAG_OWN_CAR, COUNT(SK_ID_CURR) AS client_count FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Идентифицируйте топ-3 сегмента клиентов по NAME_TYPE_SUITE с максимальным средним значением общего дохода для оценки их финансовой устойчивости.",
    "sql": "SELECT NAME_TYPE_SUITE, AVG(AMT_INCOME_TOTAL) AS avg_income FROM application_train GROUP BY NAME_TYPE_SUITE ORDER BY avg_income DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для прошлых заявок, принятых более года назад между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт без просрочки по DPD (SK_DPD = 0) в разрезе по уровню кредитного лимита (высокий/низкий).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Перечень 50 клиентов с максимальной общей задолженностью по кредитным картам.",
    "sql": "SELECT SK_ID_CURR, MONTHS_BALANCE, AMT_BALANCE, AMT_TOTAL_RECEIVABLE FROM credit_card_balance ORDER BY AMT_TOTAL_RECEIVABLE DESC LIMIT 50;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер планового платежа по рассрочке для начальных платежей по рассрочке между разными группами между своевременными и просроченными платежами?",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 3 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для активности по картам от полугода до года назад в разрезе признака «уровень кредитного лимита» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт с серьёзной просрочкой по DPD_DEF (SK_DPD_DEF > 0) в разрезе по типу поведения клиента: платёж превышает выборки или нет.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD_DEF > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для кредитов, по которым уже была просрочка (CREDIT_DAY_OVERDUE > 0) в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каков средний дефолт-рейт для сегмента клиентов с непогашенным остатком по кредитным картам?",
    "sql": "SELECT AVG(at.TARGET) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE ccb.AMT_BALANCE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как различается долю месяцев с просрочкой по кредитам для месяцев с просрочками по кредитам между различными сегментами между типами кредитов по данным бюро по данным бюро кредитных историй?",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1','2','3','4','5') GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_TYPE AS group_key, AVG(bad_month_share) AS metric_value FROM bb_agg GROUP BY CREDIT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Давайте посмотрим, как средний доход различается у клиентов с разными видами занятости или источниками дохода.",
    "sql": "SELECT NAME_INCOME_TYPE, AVG(AMT_INCOME_TOTAL) FROM application GROUP BY NAME_INCOME_TYPE ORDER BY AVG(AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по картам для карт, по которым клиент сейчас тратит средства по признаку «статус договора по карте», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CASE WHEN SK_DPD > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM) для кредитов с суммой более 100 000 (AMT_CREDIT_SUM > 100000) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте статистику численности клиентов в разрезе категорий их дохода (NAME_INCOME_TYPE).",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(*) FROM application_train_test GROUP BY NAME_INCOME_TYPE ORDER BY COUNT(*) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "В какое время суток чаще всего подают заявки на кредиты?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) AS ApplicationCount FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для кредитных карт с установленным лимитом для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните разницу между фактическим и плановым платёжом по рассрочке для рассрочек с реальным графиком платежей по признаку «клиент», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_INSTALMENT > 0 ) SELECT SK_ID_CURR AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов в основной валюте 'currency 1' для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY SK_ID_CURR ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя разницу между фактическим и плановым платежом для тех платежей, которые действительно были внесены для разных групп клиентов между новыми, повторными и лояльными клиентами, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля NAME_CONTRACT_TYPE показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется разницу между фактическим и плановым платёжом по рассрочке для платежей, которые клиент внёс между различными сегментами между клиентами по их платёжной истории по рассрочке в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT SK_ID_CURR AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов в основной валюте 'currency 1' в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым недавно обновлялась информация (DAYS_CREDIT_UPDATE > -30) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний размер кредита из бюро кредитных историй (AMT_CREDIT_SUM).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE > -30 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для кредитов с историей просрочек в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните метрику среднего значения AMT_CREDIT для одобренных и отклоненных кредитных заявок из портфеля прошлых обращений.",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS IN ('Approved', 'Refused') GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_ENTRY_PAYMENT для платежей, внесённых позже плановой даты между разными группами между своевременными и просроченными платежами?",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Проанализируйте средний чек аппликаций в разрезе целей потребительского кредитования.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, AVG(AMT_APPLICATION) FROM previous_application GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY AVG(AMT_APPLICATION) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 между клиентами между отраслями продавцов, через которых оформлялись кредиты?",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте график, показывающий среднее количество дней просроченной задолженности по данным БКИ для клиентов, разбив их на дефолтных и не дефолтных.",
    "sql": "SELECT at.TARGET, AVG(b.CREDIT_DAY_OVERDUE) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для условной половины клиентов (по чётности ID) между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для прошлых заявок, принятых более года назад для разных категорий по признаку «отрасль продавца» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте аналитический запрос по POS-рассрочкам с объединением POS_CASH_balance и installments_payments, чтобы для выборки для POS-записей за последний год (pos.MONTHS_BALANCE > -12) получить среднюю долю просроченных платежей по POS-кредитам (late_flag) по по признаку активный/закрытый POS-кредит (по CNT_INSTALMENT_FUTURE).",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE pos.MONTHS_BALANCE > -12 ) SELECT CASE WHEN pos.CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(late_flag) AS metric_value FROM pos_inst GROUP BY CASE WHEN pos.CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество оставшихся платежей по POS-кредитам для условной половины клиентов (по чётности ID) для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для пролонгированных кредитов (CNT_CREDIT_PROLONG > 0) в разрезе по статусу кредита (CREDIT_ACTIVE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какие типы жилья самые популярные среди тех, кто подает заявки?",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY COUNT(SK_ID_CURR) DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните разницу между фактическим и плановым платёжом по рассрочке для рассрочек, относящихся к последнему году по признаку «этап платежа в графике», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднее число запросов в Бюро кредитных историй, сделанных клиентами в течение последнего года.",
    "sql": "SELECT AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов с просрочкой в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Анализ уровня дефолта в разрезе типов жилищных условий клиентов.",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(TARGET) * 100 FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY AVG(TARGET) * 100 DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для карт с тратами в текущем месяце для разных групп между разными статусами договоров по кредитным картам?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните показатель DPD по POS-кредитам для второй условной половины клиентов (по нечётности ID) для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова средняя сумма текущего долга по кредитам из БКИ, разделенная по статусу активности кредита?",
    "sql": "SELECT CREDIT_ACTIVE, AVG(AMT_CREDIT_SUM_DEBT) FROM bureau GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для предыдущих заявок примерно за последний год между клиентами между отраслями продавцов, через которых оформлялись кредиты?",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_credit DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT) для платежей по рассрочке за последний год (DAYS_INSTALMENT BETWEEN -365 AND 0) в разрезе по типу кредитного продукта (pa.NAME_CONTRACT_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для кредитов с давними обновлениями (DAYS_CREDIT_UPDATE <= -30) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов с известной датой закрытия в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков средний остаток по погашенным кредитам клиентов в БКИ?",
    "sql": "SELECT AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Closed' AND AMT_CREDIT_SUM_DEBT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оцените средний остаток по кредитным картам в группе заемщиков с признаками дефолта по данным БКИ.",
    "sql": "SELECT AVG(ccb.AMT_BALANCE) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE > 0 AND ccb.AMT_BALANCE IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для новых клиентов (pa.NAME_CLIENT_TYPE = 'New') сгруппирует данные по типу кредитного продукта (pa.NAME_CONTRACT_TYPE) и рассчитает средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой средний чек по нашим кредитам?",
    "sql": "SELECT AVG(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для новых клиентов (NAME_CLIENT_TYPE = 'New') и по каждому значению поля HOUR_APPR_PROCESS_START показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова трендовая линия уровня NPL (non-performing loans) по данным БКИ, выраженная в процентах, за прошедшие 12 месяцев?",
    "sql": "SELECT MONTHS_BALANCE, CAST(SUM(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) AS overdue_percentage FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -11 AND 0 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каков средний процент дефолтов для каждого типа образования?",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(TARGET) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для кредитов, где хотя бы раз была просрочка по сумме для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Хочу посмотреть, сколько в среднем платят по кредитам разные категории людей, ну, те, кому займ одобрили.",
    "sql": "SELECT T1.NAME_INCOME_TYPE, AVG(T2.AMT_ANNUITY) FROM application_train_test T1 JOIN previous_application T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T2.NAME_CONTRACT_STATUS = 'Approved' GROUP BY T1.NAME_INCOME_TYPE ORDER BY AVG(T2.AMT_ANNUITY) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Идентифицируйте и перечислите 10 ключевых заемщиков с наиболее высоким уровнем активной кредитной задолженности, согласно данным из БКИ.",
    "sql": "SELECT t1.SK_ID_CURR, t1.AMT_INCOME_TOTAL, t2.AMT_CREDIT_SUM_DEBT FROM application AS t1 JOIN bureau AS t2 ON t1.SK_ID_CURR = t2.SK_ID_CURR WHERE t2.CREDIT_ACTIVE = 'Active' ORDER BY t2.AMT_CREDIT_SUM_DEBT DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Выведите среднюю сумму активной задолженности по данным БКИ.",
    "sql": "SELECT AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по часу принятия решения (HOUR_APPR_PROCESS_START).",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для закрытых кредитов (CREDIT_ACTIVE = 'Closed') в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Closed' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для платежей по рассрочке за последний год (DAYS_INSTALMENT BETWEEN -365 AND 0) сгруппирует данные по каналу продаж (pa.CHANNEL_TYPE) и рассчитает среднее значение задержки платежа в днях (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите ключевую метрику: количество клиентов с активными ссудами в БКИ.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как менялось число прошлых заявок каждый день после того, как по ним приняли решение?",
    "sql": "SELECT DAYS_DECISION, COUNT(SK_ID_PREV) FROM previous_application GROUP BY DAYS_DECISION ORDER BY DAYS_DECISION;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Определите коэффициент дефолта для заемщиков, имеющих в своей истории отказы по предыдущим заявлениям, как фактор повышенного риска.",
    "sql": "SELECT AVG(t1.TARGET) * 100 FROM application_train t1 WHERE t1.SK_ID_CURR IN (SELECT SK_ID_CURR FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, открытых за последний год (DAYS_CREDIT > -365) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для крупных кредитов (свыше 100 000) в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Изучите распределение временных интервалов до принятия решения по предыдущим кредитным заявкам.",
    "sql": "SELECT ABS(DAYS_DECISION), COUNT(SK_ID_PREV) FROM previous_application GROUP BY ABS(DAYS_DECISION) ORDER BY ABS(DAYS_DECISION) LIMIT 20;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Рассчитайте суммарный объем операций по снятию наличных в банкоматах с использованием кредитных карт.",
    "sql": "SELECT SUM(AMT_DRAWINGS_ATM_CURRENT) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте тренд среднего показателя AMT_CREDIT_SUM_DEBT для активных кредитов БКИ в разрезе MONTHS_BALANCE.",
    "sql": "SELECT bb.MONTHS_BALANCE, AVG(b.AMT_CREDIT_SUM_DEBT) FROM bureau_balance bb JOIN bureau b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY bb.MONTHS_BALANCE ORDER BY bb.MONTHS_BALANCE ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Проанализируйте средний объем финансирования для одобренных и отклоненных кредитных продуктов.",
    "sql": "SELECT NAME_CONTRACT_STATUS, AVG(AMT_CREDIT) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько в среднем зарабатывают те, кто платит по кредиту, и те, кто нет?",
    "sql": "SELECT TARGET, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте детализированное сопоставление фактической суммы кредита и стоимости приобретаемых товаров для последних 10 заявок.",
    "sql": "SELECT SK_ID_CURR, AMT_CREDIT, AMT_GOODS_PRICE FROM application_train LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте рейтинг из пяти профессий с наибольшей долей заемщиков, не выполнивших свои кредитные обязательства.",
    "sql": "SELECT OCCUPATION_TYPE, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY DefaultRate DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните количество оставшихся платежей по POS-кредитам для уже погашенных POS-кредитов для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для предыдущих заявок с суммой кредита более 50 000 в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажите разбивку кредитов БКИ по валюте.",
    "sql": "SELECT CREDIT_CURRENCY, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_CURRENCY;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как распределены клиенты по типам их доходов?",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для завершённых POS-договоров (NAME_CONTRACT_STATUS = 'Completed') и показан среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Completed' GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Рассчитайте процент клиентов, которые являются безработными.",
    "sql": "SELECT CAST(COUNT(CASE WHEN DAYS_EMPLOYED = 365243 THEN SK_ID_CURR END) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните просроченная задолженность по кредитам из бюро для кредитов во второй типовой валюте в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 2' GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Суммируйте объем снятий наличных средств с кредитных карт, агрегировав данные по гендерному признаку текущих заявителей.",
    "sql": "SELECT at.CODE_GENDER, SUM(ccb.AMT_DRAWINGS_ATM_CURRENT) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY at.CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для активных POS-кредитов (CNT_INSTALMENT_FUTURE > 0) и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Слушай, а в каких валютах кредиты обычно берут, судя по БКИ?",
    "sql": "SELECT CREDIT_CURRENCY, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_CURRENCY;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Представьте средний совокупный объем кредитных обязательств по каждому заемщику, согласно данным Бюро кредитных историй.",
    "sql": "SELECT SK_ID_CURR, AVG(AMT_CREDIT_SUM) FROM bureau GROUP BY SK_ID_CURR ORDER BY AVG(AMT_CREDIT_SUM) DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте круговую диаграмму, показывающую основные причины отказа в кредитовании по предыдущим заявкам.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните размер кредита по данным бюро для кредитов с известной датой закрытия в разрезе признака «валюта кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для сравнительно новых кредитов для разных групп клиентов между крупными кредитами и кредитами меньшего размера?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажи мне клиентов, о которых нет никаких данных в БКИ.",
    "sql": "SELECT a.SK_ID_CURR, a.AMT_INCOME_TOTAL, a.AMT_CREDIT FROM application_train a LEFT JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.SK_ID_CURR IS NULL LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какая в среднем сумма платежей по кредиткам?",
    "sql": "SELECT AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE AMT_PAYMENT_TOTAL_CURRENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для клиентов, которые уже брали кредит ранее для разных категорий по признаку «день недели решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните долю просроченных платежей по рассрочке для рассрочек, относящихся к последнему году по признаку «факт просрочки», используя детальную платёжную историю по рассрочкам и накопленные суммы по клиенту.",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для новых клиентов (NAME_CLIENT_TYPE = 'New') в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отобразите круговую диаграмму, показывающую количество текущих заявок по их типу сопровождения.",
    "sql": "SELECT NAME_TYPE_SUITE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_TYPE_SUITE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните показатель DPD_DEF по POS-кредитам для POS-кредитов без задержек по оплате для разных значений признака «клиент» по POS-кредитам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для очень старой кредитной истории между разными категориями между разными статусами состояния кредита в разрезе месяцев?",
    "sql": "SELECT STATUS AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE < -24 GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Слушай, а как там вообще со статусами по старым заявкам?",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднее значение накопленного остатка по карте (cum_balance) для карт с просрочкой по DPD (SK_DPD > 0) по по месяцу истории по карте (MONTHS_BALANCE).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD > 0 ) SELECT MONTHS_BALANCE AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите коэффициент просрочки (CREDIT_DAY_OVERDUE > 0) по всем записям БКИ.",
    "sql": "SELECT CAST(COUNT(CASE WHEN CREDIT_DAY_OVERDUE > 0 THEN 1 ELSE NULL END) AS REAL) * 100 / COUNT(SK_BUREAU_ID) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита более 50 000 и по каждому значению поля NAME_CONTRACT_TYPE показывается средний размер аннуитетного платежа по предыдущим кредитам.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля NAME_PRODUCT_TYPE показывается среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитов в условной валюте 'currency 1' в разрезе по валюте кредита (CREDIT_CURRENCY).",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для кредитов с чётным SK_BUREAU_ID в разрезе по давности записи (MONTHS_BALANCE, recent/old).",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE SK_BUREAU_ID % 2 = 0 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для кредитов с историей просрочек в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для прошлых заявок, принятых более года назад между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) в разрезе по дню недели принятия решения (WEEKDAY_APPR_PROCESS_START).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как различается максимальный месяц наблюдения по кредиту для месяцев с просрочками по кредитам между различными сегментами между кредитами в разных валютах по данным бюро кредитных историй?",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS IN ('1','2','3','4','5') GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_CURRENCY AS group_key, AVG(max_month) AS metric_value FROM bb_agg GROUP BY CREDIT_CURRENCY ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_INSTALMENT для платежей, внесённых позже плановой даты между разными группами между клиентами по их платёжной дисциплине?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY SK_ID_CURR ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сколько всего денег банк выдал в виде кредитов?",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Вычислите процент отклонений по всем ранее поданным заявкам.",
    "sql": "SELECT CAST(COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 END) AS REAL) * 100 / COUNT(SK_ID_PREV) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие три типа жилья чаще всего указывают наши клиенты в заявках?",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) AS application_count FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY application_count DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) для карт с просрочкой по DPD (SK_DPD > 0) в разрезе по типу поведения клиента: платёж превышает выборки или нет.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выведите SK_ID_CURR и AMT_CREDIT для сегмента заемщиков с CNT_CHILDREN = 0.",
    "sql": "SELECT SK_ID_CURR, AMT_CREDIT FROM application_train WHERE CNT_CHILDREN = 0",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_YIELD_GROUP ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажи, сколько клиентов у нас имеют разное количество членов семьи.",
    "sql": "SELECT CNT_FAM_MEMBERS, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проанализируйте временной тренд среднего количества дней просрочки (CREDIT_DAY_OVERDUE) по кредитным продуктам в БКИ.",
    "sql": "SELECT DAYS_CREDIT, AVG(CREDIT_DAY_OVERDUE) FROM bureau GROUP BY DAYS_CREDIT ORDER BY DAYS_CREDIT DESC LIMIT 365;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните размер планового платежа по рассрочке для более поздних платежей по рассрочке для разных значений признака «номер платежа» в платёжной истории клиентов.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов, по которым данные давно не обновлялись в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Интересно, как меняется отношение кредита к доходу у людей с разным опытом работы?",
    "sql": "SELECT CASE WHEN DAYS_EMPLOYED < -3650 THEN '10+ years' WHEN DAYS_EMPLOYED < -1825 THEN '5-10 years' WHEN DAYS_EMPLOYED < -365 THEN '1-5 years' ELSE '<1 year' END AS employment_years, AVG(AMT_CREDIT * 1.0 / AMT_INCOME_TOTAL) AS avg_debt_to_income FROM application WHERE AMT_INCOME_TOTAL > 0 GROUP BY employment_years ORDER BY employment_years DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для карт с текущей задолженностью в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_BALANCE > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите средний объем кредита (AMT_CREDIT) для сегментов клиентов, владеющих автомобилем (FLAG_OWN_CAR), и без него.",
    "sql": "SELECT FLAG_OWN_CAR, AVG(AMT_CREDIT) FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Проанализируйте корреляцию частоты дефолтов с днями недели, в которые были поданы предыдущие заявки на кредит.",
    "sql": "SELECT T2.WEEKDAY_APPR_PROCESS_START, AVG(T1.TARGET) AS default_rate FROM application_train AS T1 JOIN previous_application AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR GROUP BY T2.WEEKDAY_APPR_PROCESS_START ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для прошлых заявок, принятых более года назад между клиентами между базовыми и дополнительными продуктами?",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется долю просроченных платежей по рассрочке для второй половины клиентов по чётности ID между различными сегментами между разными версиями графиков платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Предоставьте полную историю изменений баланса и фактического кредитного лимита по кредитной карте клиента с SK_ID_CURR 100007.",
    "sql": "SELECT MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL FROM credit_card_balance WHERE SK_ID_CURR = 100007 ORDER BY MONTHS_BALANCE;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определение процентной доли кредитных заявок, обработанных вне стандартного рабочего времени (с 18:00 до 9:00).",
    "sql": "SELECT (SUM(CASE WHEN HOUR_APPR_PROCESS_START < 9 OR HOUR_APPR_PROCESS_START >= 18 THEN 1 ELSE 0 END) * 100.0) / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализируйте востребованность кредитных продуктов: сколько уникальных пользователей запросили кеш-кредиты в сравнении с револьверными.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(DISTINCT SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните размер одобренного кредита по предыдущим заявкам для прошлых заявок, принятых более года назад для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите структуру кредитного портфеля по статусам (действующий, погашенный) в БКИ.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE ORDER BY COUNT(SK_BUREAU_ID) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните размер одобренного кредита по предыдущим заявкам для прошлых кредитов на сумму выше 50 000 для разных категорий по признаку «тип портфеля» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Почему чаще всего отказывали в прошлых кредитах? Покажи топ-5.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 5",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Нам нужно увидеть топ-5 семейных положений у клиентов, которые взяли кредит больше среднего. Сделай это графиком.",
    "sql": "SELECT NAME_FAMILY_STATUS, COUNT(SK_ID_CURR) FROM application_train WHERE AMT_CREDIT > (SELECT AVG(AMT_CREDIT) FROM application_train) GROUP BY NAME_FAMILY_STATUS ORDER BY COUNT(SK_ID_CURR) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для новых клиентов (NAME_CLIENT_TYPE = 'New') в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_YIELD_GROUP ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте совокупный объем текущей задолженности клиентов по всем кредитным продуктам, зафиксированным в БКИ.",
    "sql": "SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Оцените monthly trend среднего credit card payment (AMT_PAYMENT_TOTAL_CURRENT).",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance WHERE AMT_PAYMENT_TOTAL_CURRENT IS NOT NULL GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Покажите среднее количество дней просрочки по закрытым кредитам у клиентов с текущим дефолтом.",
    "sql": "SELECT AVG(b.CREDIT_DAY_OVERDUE) FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE a.TARGET = 1 AND b.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как распределяется долю просроченных платежей по рассрочке для рассрочек, относящихся к последнему году между различными сегментами между ранними, средними и поздними платежами в графике в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN NUM_INSTALMENT_NUMBER <= 3 THEN 'early' WHEN NUM_INSTALMENT_NUMBER <= 6 THEN 'middle' ELSE 'late' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Оцените долю одобренных кредитных заявок из общего числа поданных ранее.",
    "sql": "SELECT CAST(SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(SK_ID_PREV) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как соотносится средний доход заемщиков, обладающих собственным жильем, с доходом тех, кто таковым не владеет?",
    "sql": "SELECT FLAG_OWN_REALTY, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте процентное соотношение заявителей, владеющих автомобилем, к тем, кто им не владеет.",
    "sql": "SELECT FLAG_OWN_CAR, COUNT(*) FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните среднюю по клиенту задержку платежей для начальных платежей по кредиту между сегментами по признаку «тип клиента» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется разницу между фактическим и плановым платёжом по рассрочке для условной половины клиентов по чётности ID между различными сегментами между разными версиями графиков платежей в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Отобразите сегментацию заемщиков по типу их основного дохода.",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(*) FROM application_train GROUP BY NAME_INCOME_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как ведёт себя загрузку кредитных карт (utilization) для карточной истории за последний год для разных сегментов между картами с высоким и более низким лимитом с точки зрения использования кредитных карт?",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE > -12 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний фактический платёж по рассрочке (AMT_PAYMENT) для записей без фактического платежа (AMT_PAYMENT = 0) в разрезе по признаку своевременности платежа (on_time/late).",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_PAYMENT = 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для предыдущих заявок примерно за последний год между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите общую сумму цен товаров для всех успешно одобренных заявок.",
    "sql": "SELECT SUM(AMT_GOODS_PRICE) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для пролонгированных кредитов (CNT_CREDIT_PROLONG > 0) и по каждому значению группировки (CREDIT_ACTIVE) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределены типы образования среди клиентов, у которых зафиксирован дефолт (TARGET = 1)?",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train WHERE TARGET = 1 GROUP BY NAME_EDUCATION_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для карт без просрочек для разных групп между картами с высоким лимитом и остальными?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов с известной датой закрытия в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_ENDDATE_FACT IS NOT NULL GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Анализ среднего размера кредита в зависимости от уровня образования заемщика.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(AMT_CREDIT) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY AVG(AMT_CREDIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Составьте таблицу данных по заемщикам с годовым доходом более 500 тысяч, включив информацию из их кредитных историй БКИ.",
    "sql": "SELECT at.SK_ID_CURR, at.AMT_INCOME_TOTAL, at.OCCUPATION_TYPE, b.CREDIT_ACTIVE, b.AMT_CREDIT_SUM_DEBT FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE at.AMT_INCOME_TOTAL > 500000;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для прошлых заявок, принятых более года назад между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для завершённых POS-договоров (NAME_CONTRACT_STATUS = 'Completed') в разрезе по признаку активный/закрытый POS-кредит (по CNT_INSTALMENT_FUTURE).",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Completed' GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сколько клиентов из разных семейных положений не смогли выплатить кредит?",
    "sql": "SELECT NAME_FAMILY_STATUS, COUNT(*) FROM application_train_test WHERE TARGET = 1 GROUP BY NAME_FAMILY_STATUS ORDER BY COUNT(*) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для кредитов на дорогие товары дороже 100 000 между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Идентифицируйте проблемных заемщиков с признаками кросс-дефолта, имеющих просрочки как у нас, так и в других финансовых учреждениях по данным БКИ.",
    "sql": "SELECT T1.SK_ID_CURR, T1.AMT_CREDIT, T2.CREDIT_DAY_OVERDUE FROM application_train AS T1 JOIN bureau AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T1.TARGET = 1 AND T2.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова процентная доля клиентов с дефолтом (TARGET = 1), у которых есть активные обязательства в БКИ?",
    "sql": "SELECT CAST(COUNT(DISTINCT at.SK_ID_CURR) AS REAL) * 100 / (SELECT COUNT(SK_ID_CURR) FROM application_train WHERE TARGET = 1) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE at.TARGET = 1 AND b.CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова динамика среднего дохода клиентов, распределенных по когортам года рождения?",
    "sql": "SELECT CAST(2023 - (ABS(DAYS_BIRTH) / 365 AS INT) AS birth_year_cohort, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY birth_year_cohort ORDER BY birth_year_cohort;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-записей за последние 6 месяцев (MONTHS_BALANCE > -6) и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для платежей, превышающих плановый размер (AMT_PAYMENT > AMT_INSTALMENT), покажите средний плановый платёж по рассрочке (AMT_INSTALMENT) по каждому значению поля NUM_INSTALMENT_NUMBER.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT > AMT_INSTALMENT GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова общая сумма задолженности по кредитам, зарегистрированным в БКИ, с разбивкой на активные и погашенные обязательства?",
    "sql": "SELECT CREDIT_ACTIVE, SUM(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE AMT_CREDIT_SUM_DEBT IS NOT NULL GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Выделите пять ведущих категорий источников дохода заемщиков, кумулирующих наибольший объем кредитного портфеля.",
    "sql": "SELECT NAME_INCOME_TYPE, SUM(AMT_CREDIT) FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY SUM(AMT_CREDIT) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните разницу между фактическим и плановым платежом для случаев, когда клиент не внёс очередной платёж между сегментами по признаку «тип клиента» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT = 0 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для действующих POS-договоров между разными категориями по разным месяцам наблюдения POS-кредитов?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выведите SK_ID_CURR заемщиков, которые признаны дефолтными (TARGET=1), но их кредитная история в БКИ не содержит активных записей, либо записи имеют статус 'Закрыт' или 'Плохой долг'.",
    "sql": "SELECT app.SK_ID_CURR FROM application_train_test app LEFT JOIN bureau b ON app.SK_ID_CURR = b.SK_ID_CURR WHERE app.TARGET = 1 AND b.SK_ID_CURR IS NULL OR (b.CREDIT_ACTIVE = 'Closed' OR b.CREDIT_ACTIVE = 'Bad debt');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как развивалась средняя долговая нагрузка клиентов (по данным БКИ) в течение 365 дней до обращения за кредитом?",
    "sql": "SELECT DAYS_CREDIT, AVG(AMT_CREDIT_SUM_DEBT) FROM bureau GROUP BY DAYS_CREDIT ORDER BY DAYS_CREDIT DESC LIMIT 365;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните остаток задолженности по кредитным картам для карт без просрочек в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов без просрочки (SK_DPD = 0) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяются статусы у всех прошлых заявок на кредиты?",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) AS status_count FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Проанализируйте средний объем кредитного лимита по карточным продуктам в разрезе сегментов клиентов по уровню образования.",
    "sql": "SELECT a.NAME_EDUCATION_TYPE, AVG(ccb.AMT_CREDIT_LIMIT_ACTUAL) FROM application_train a JOIN credit_card_balance ccb ON a.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY a.NAME_EDUCATION_TYPE ORDER BY AVG(ccb.AMT_CREDIT_LIMIT_ACTUAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов, которые пролонгировались в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с просрочкой по DPD (SK_DPD > 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов, по которым есть долг для разных групп клиентов между типами кредитов, отражённых в бюро?",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт без просрочки по DPD (SK_DPD = 0), покажите средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) по каждому значению поля NAME_CONTRACT_STATUS.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните запрошенный размер кредита по заявке для кредитов на дорогие товары дороже 100 000 для разных категорий по признаку «отрасль продавца» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для истории кредитов от полугода до года назад между разными категориями между разными статусами состояния кредита в разрезе месяцев?",
    "sql": "SELECT STATUS AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для карт, по которым есть просрочка для разных групп между картами с высоким лимитом и остальными?",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднее значение задержки платежа в днях (delay_days) по рассрочкам для случаев отсутствия фактического платежа (AMT_PAYMENT = 0) в разрезе по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT = 0 ) SELECT SK_ID_CURR AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для POS-операций, которые были от полугода до года назад между разными категориями между POS-кредитами с просрочкой и без?",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Чему равен усредненный размер текущей задолженности по кредитам в БКИ?",
    "sql": "SELECT AVG(AMT_CREDIT_SUM_DEBT) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для небольших кредитов (до 100 000) в разрезе признака «тип кредита в бюро» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM <= 100000 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для сравнительно новых кредитов для разных групп клиентов между типами кредитов, отражённых в бюро?",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какова усредненная длительность трудового стажа заемщиков?",
    "sql": "SELECT AVG(ABS(DAYS_EMPLOYED) / 365) FROM application_train WHERE DAYS_EMPLOYED < 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с максимальной просрочкой больше нуля (AMT_CREDIT_MAX_OVERDUE > 0) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для POS-операций примерно за последние полгода между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для карт без просрочек для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Создайте круговую диаграмму, демонстрирующую распределение типов жилья среди наших заемщиков.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните объём текущих платежей по картам для активности по картам от полугода до года назад в разрезе признака «уровень кредитного лимита» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE BETWEEN -12 AND -6 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов без просрочки (SK_DPD = 0) в разрезе по признаку активный/закрытый POS-кредит (по CNT_INSTALMENT_FUTURE).",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните задержка платежа в днях для тех платежей, которые действительно были внесены между сегментами по признаку «канал оформления кредита» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите круговую диаграмму, отображающую распределение клиентов по семейному положению.",
    "sql": "SELECT NAME_FAMILY_STATUS, COUNT(*) FROM application GROUP BY NAME_FAMILY_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните показатель DPD_DEF по POS-кредитам для POS-кредитов с коротким графиком для разных значений признака «клиент» по POS-кредитам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Проанализировать почасовую динамику обрабатываемых кредитных заявок.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Проанализируйте динамику среднего размера задолженности по кредитным обязательствам из Бюро кредитных историй (БКИ) с течением времени.",
    "sql": "SELECT DAYS_CREDIT, AVG(AMT_CREDIT_SUM_DEBT) FROM bureau GROUP BY DAYS_CREDIT ORDER BY DAYS_CREDIT DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какова тенденция изменения числа прошлых кредитных заявок с течением времени (помесячно)?",
    "sql": "SELECT CAST(ABS(DAYS_DECISION) / 30 AS INT) AS months_ago, COUNT(SK_ID_PREV) FROM previous_application GROUP BY months_ago ORDER BY months_ago ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Вычислите количество клиентов с повышенной кредитной нагрузкой, имеющих несколько активных займов в БКИ, для оценки риска.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_credits FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING COUNT(SK_BUREAU_ID) > 1) AS subquery;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Дефолтят ли люди с детьми чаще или реже, чем бездетные? Покажи статистику.",
    "sql": "SELECT CASE WHEN CNT_CHILDREN > 0 THEN 'Has Children' ELSE 'No Children' END AS child_status, AVG(TARGET) AS default_rate FROM application_train GROUP BY child_status;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите средний ежемесячный платеж (аннуитет) по семейному положению.",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(AMT_ANNUITY) AS avg_annuity FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY avg_annuity DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите среднее значение общей задолженности по кредитам в БКИ для клиентов, допустивших дефолт.",
    "sql": "SELECT AVG(T2.AMT_CREDIT_SUM_DEBT) FROM application_train T1 JOIN bureau T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T1.TARGET = 1 AND T2.AMT_CREDIT_SUM_DEBT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие три главные причины, по которым людям отказывали в прошлых кредитах?",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 3;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сколько у нас клиентов, у которых в БКИ записано больше одного активного кредита?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS active_loans FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING COUNT(SK_BUREAU_ID) > 1);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Анализ среднего аннуитетного платежа по уровням образования в разрезе дефолтных и недефолтных заемщиков.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(CASE WHEN TARGET = 1 THEN AMT_ANNUITY END) AS avg_annuity_default, AVG(CASE WHEN TARGET = 0 THEN AMT_ANNUITY END) AS avg_annuity_non_default FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY NAME_EDUCATION_TYPE;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите процент записей в bureau_balance, классифицированных как 'Bad debt'.",
    "sql": "SELECT (COUNT(CASE WHEN STATUS = '5' THEN 1 END) * 100.0) / COUNT(*) FROM bureau_balance",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По объединению bureau и bureau_balance рассчитайте среднюю долю месяцев с просрочкой по кредитам (bad_month_share) для более старой кредитной истории (bb.MONTHS_BALANCE <= -12) в разрезе по валюте кредита (b.CREDIT_CURRENCY), используя предварительную агрегацию по кредиту.",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.MONTHS_BALANCE <= -12 GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_CURRENCY AS group_key, AVG(bad_month_share) AS metric_value FROM bb_agg GROUP BY CREDIT_CURRENCY ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Идентифицируйте десятку клиентов с наибольшим совокупным объемом выданных кредитов по одобренным предыдущим заявкам.",
    "sql": "SELECT at.SK_ID_CURR, SUM(pa.AMT_CREDIT) as total_previous_credit FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY at.SK_ID_CURR ORDER BY total_previous_credit DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните долю месяцев с просрочкой по кредитам для кредитной истории старше года в разрезе признака «тип кредита в бюро», если учитывать помесячную историю статусов кредитов из бюро.",
    "sql": "WITH bb_agg AS ( SELECT b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM, AVG(CASE WHEN bb.STATUS IN ('1','2','3','4','5') THEN 1.0 ELSE 0.0 END) AS bad_month_share, MAX(bb.MONTHS_BALANCE) AS max_month FROM bureau b JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.MONTHS_BALANCE <= -12 GROUP BY b.SK_ID_CURR, b.SK_BUREAU_ID, b.CREDIT_TYPE, b.CREDIT_ACTIVE, b.CREDIT_CURRENCY, b.AMT_CREDIT_SUM ) SELECT CREDIT_TYPE AS group_key, AVG(bad_month_share) AS metric_value FROM bb_agg GROUP BY CREDIT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0), покажите средний остаток по кредитным картам (AMT_BALANCE) по каждому значению поля CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_balance DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните долю просроченных платежей для прошлых крупных кредитов с реальными платежами по графику между сегментами по признаку «доходность продукта» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.AMT_CREDIT > 50000 AND ip.AMT_INSTALMENT > 0 ) SELECT NAME_YIELD_GROUP AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сколько клиентов с самой плохой кредитной историей (статус 5) в бюро попадают в каждую возрастную категорию?",
    "sql": "SELECT CASE WHEN ABS(at.DAYS_BIRTH) / 365.25 < 30 THEN '18-29' WHEN ABS(at.DAYS_BIRTH) / 365.25 < 40 THEN '30-39' WHEN ABS(at.DAYS_BIRTH) / 365.25 < 50 THEN '40-49' WHEN ABS(at.DAYS_BIRTH) / 365.25 < 60 THEN '50-59' ELSE '60+' END AS age_group, COUNT(DISTINCT at.SK_ID_CURR) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR JOIN bureau_balance bb ON b.SK_BUREAU_ID = bb.SK_BUREAU_ID WHERE bb.STATUS = '5' GROUP BY age_group ORDER BY age_group;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сгенерируйте график, показывающий среднюю сумму ATM-транзакций по семейным статусам, для анализа поведенческих паттернов.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(cc.AMT_DRAWINGS_ATM_CURRENT) FROM application_train at JOIN credit_card_balance cc ON at.SK_ID_CURR = cc.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY AVG(cc.AMT_DRAWINGS_ATM_CURRENT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите численность клиентов с дефолтными обязательствами (статус 'C' или 'X') в бюро кредитных историй.",
    "sql": "SELECT COUNT(DISTINCT b.SK_ID_CURR) FROM bureau_balance bb JOIN bureau b ON bb.SK_BUREAU_ID = b.SK_BUREAU_ID WHERE bb.STATUS IN ('C', 'X');",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для прошлых заявок, принятых более года назад между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажи долю одобренных заявок от всех предыдущих.",
    "sql": "SELECT CAST(SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(*) FROM previous_application;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Есть ли связь между тем, где человек живет, и тем, насколько он надежен как заемщик?",
    "sql": "SELECT NAME_HOUSING_TYPE, AVG(TARGET) * 100 AS Default_Rate FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY Default_Rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Определите и визуализируйте пять наиболее частых причин отклонения кредитных заявок для сегмента клиентов, находящихся в дефолте.",
    "sql": "SELECT pa.CODE_REJECT_REASON, COUNT(DISTINCT a.SK_ID_CURR) AS Number_of_Defaulters FROM application_train a JOIN previous_application pa ON a.SK_ID_CURR = pa.SK_ID_CURR WHERE a.TARGET = 1 AND pa.NAME_CONTRACT_STATUS = 'Refused' GROUP BY pa.CODE_REJECT_REASON ORDER BY Number_of_Defaulters DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым уже была просрочка (CREDIT_DAY_OVERDUE > 0) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Хочу увидеть, сколько клиентов имеют записи в БКИ, которые обновлялись X месяцев назад.",
    "sql": "SELECT MONTHS_BALANCE, COUNT(SK_BUREAU_ID) FROM bureau_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для записей с активным статусом договора (NAME_CONTRACT_STATUS = 'Active') и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково общее количество заемщиков с активными кредитными продуктами, согласно информации из БКИ?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Построй график изменения количества предыдущих заявок в зависимости от дней до/после решения.",
    "sql": "SELECT DAYS_DECISION, COUNT(SK_ID_PREV) FROM previous_application GROUP BY DAYS_DECISION ORDER BY DAYS_DECISION;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Отобразите динамику среднего дефолт рейта в зависимости от месяца принятия кредитного решения.",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(JULIANDAY('now') + T2.DAYS_DECISION)) AS DecisionMonth, AVG(T1.TARGET) FROM application_train AS T1 JOIN previous_application AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T2.NAME_CONTRACT_STATUS = 'Approved' GROUP BY DecisionMonth ORDER BY DecisionMonth;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю долю просроченных платежей (delay_days > 0) для платежей по рассрочке за последний год (DAYS_INSTALMENT BETWEEN -365 AND 0) в разрезе по признаку просрочки платежа (delay_days > 0) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каково суммарное число поступивших кредитных запросов?",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Представьте помесячную динамику среднего установленного кредитного лимита по картам.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля HOUR_APPR_PROCESS_START показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов, по которым задан аннуитетный платёж в разрезе признака «размер кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите совокупный объем установленных кредитных лимитов по всем активным кредитным картам.",
    "sql": "SELECT SUM(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется размер одобренного кредита по предыдущим заявкам для клиентов, которые уже брали кредит ранее между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с платежами в текущем периоде (AMT_PAYMENT_CURRENT > 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой средний состав семьи характерен для наших заемщиков, имеющих ипотечные займы?",
    "sql": "SELECT AVG(CNT_FAM_MEMBERS) FROM application_train WHERE NAME_HOUSING_TYPE = 'House / apartment' AND NAME_CONTRACT_TYPE = 'Cash loans';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие виды кредитов принесли нам наибольший объем за прошлый год?",
    "sql": "SELECT NAME_CONTRACT_TYPE, SUM(AMT_CREDIT) FROM previous_application WHERE DAYS_DECISION >= -365 AND NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднюю разницу между фактическим и плановым платежом (payment_diff) для фактически оплаченных записей (AMT_PAYMENT > 0) в разрезе по уровню накопленных платежей cum_payment (low/medium/high).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE AMT_PAYMENT > 0 ) SELECT CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN cum_payment < 20000 THEN 'low' WHEN cum_payment < 100000 THEN 'medium' ELSE 'high' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю долю просроченных платежей (delay_days > 0) для повторных клиентов (pa.NAME_CLIENT_TYPE = 'Repeater') в разрезе по типу клиента (pa.NAME_CLIENT_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для уже погашенных POS-кредитов между разными категориями между клиентами по их POS-истории?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT_FUTURE = 0 GROUP BY SK_ID_CURR ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для прошлых заявок, принятых более года назад между клиентами между разными портфелями продуктов?",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажи, сколько в среднем зарабатывают те, у кого есть машина, и те, у кого нет.",
    "sql": "SELECT FLAG_OWN_CAR, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau_balance рассчитайте долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро для записей старше трёх лет (MONTHS_BALANCE <= -36) в разрезе по давности записи (MONTHS_BALANCE, recent/old).",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE <= -36 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте статистику количества ранее поданных заявок, агрегированную по дням недели начала обработки.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY CASE WHEN WEEKDAY_APPR_PROCESS_START = 'MONDAY' THEN 1 WHEN WEEKDAY_APPR_PROCESS_START = 'TUESDAY' THEN 2 WHEN WEEKDAY_APPR_PROCESS_START = 'WEDNESDAY' THEN 3 WHEN WEEKDAY_APPR_PROCESS_START = 'THURSDAY' THEN 4 WHEN WEEKDAY_APPR_PROCESS_START = 'FRIDAY' THEN 5 WHEN WEEKDAY_APPR_PROCESS_START = 'SATURDAY' THEN 6 WHEN WEEKDAY_APPR_PROCESS_START = 'SUNDAY' THEN 7 END;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какая в среднем сумма денег, которую запрашивают по возобновляемым кредитам?",
    "sql": "SELECT AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_TYPE = 'Revolving loans';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Визуализируйте разбивку по полу (CODE_GENDER) для всех поступивших кредитных заявок.",
    "sql": "SELECT CODE_GENDER, COUNT(SK_ID_CURR) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Проанализировать структуру клиентской базы по видам заключенных кредитных договоров.",
    "sql": "SELECT NAME_CONTRACT_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для предыдущих заявок с суммой кредита более 50 000 в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_PORTFOLIO ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице installments_payments рассчитайте среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) для платежей, превышающих плановый размер (AMT_PAYMENT > AMT_INSTALMENT) в разрезе по факту платёжной дисциплины (переплата/недоплата).",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_PAYMENT > AMT_INSTALMENT GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с непогашенной задолженностью (AMT_CREDIT_SUM_DEBT > 0) и по каждому значению группировки (CREDIT_TYPE) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для повторных клиентов (NAME_CLIENT_TYPE = 'Repeater') в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_YIELD_GROUP ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE) для кредитов с непогашенной задолженностью (AMT_CREDIT_SUM_DEBT > 0) в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Выделите три наиболее распространенных типа жилья среди заявителей на кредит.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY COUNT(SK_ID_CURR) DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для фактических оплат по рассрочке (ip.AMT_PAYMENT > 0) сгруппирует данные по типу кредитного продукта (pa.NAME_CONTRACT_TYPE) и рассчитает среднее значение задержки платежа в днях (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Существуют ли значимые различия в среднем долге по кредитным картам (по данным БКИ) между дефолтными и надежными заемщиками?",
    "sql": "SELECT at.TARGET, AVG(b.AMT_CREDIT_SUM_DEBT) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.AMT_CREDIT_SUM_DEBT IS NOT NULL GROUP BY at.TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько в среднем работают люди с разным образованием?",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(ABS(DAYS_EMPLOYED)) AS AverageEmploymentDays FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY AverageEmploymentDays DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитных карт с лимитом (AMT_CREDIT_SUM_LIMIT > 0) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_PORTFOLIO ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяются наши клиенты по тому, откуда они получают свой доход?",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_INCOME_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните кредитный лимит по картам для активности по картам за последние полгода в разрезе признака «клиент» по кредитным картам клиентов.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как число детей влияет на вероятность дефолта?",
    "sql": "SELECT CNT_CHILDREN, AVG(TARGET) * 100 FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для предыдущих заявок с суммой кредита от 10 000 до 50 000 в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Проведите сегментацию клиентской базы по категориям источников дохода.",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(*) FROM application_train GROUP BY NAME_INCOME_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните просрочку платежа по POS-кредитам в днях для реальных графиков платежей по POS-кредитам по признаку «статус POS-договора» для POS-рассрочек на основе объединённых данных о графике и фактических платежах.",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_INSTALMENT > 0 ) SELECT pos.NAME_CONTRACT_STATUS AS group_key, AVG(days_late) AS metric_value FROM pos_inst GROUP BY pos.NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "А сколько у нас клиентов, у кого больше пяти контактов в соцсетях?",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train WHERE OBS_30_CNT_SOCIAL_CIRCLE > 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-записей за последние 6 месяцев (MONTHS_BALANCE > -6) и показан среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) по каждому значению MONTHS_BALANCE.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для прошлых заявок, принятых более года назад между клиентами между различными типами кредитных продуктов в прошлых заявках?",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните размер планового платежа по рассрочке для условной половины клиентов по чётности ID для разных значений признака «своевременность платежей» в платёжной истории клиентов.",
    "sql": "SELECT CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 GROUP BY CASE WHEN DAYS_ENTRY_PAYMENT <= DAYS_INSTALMENT THEN 'on_time' ELSE 'late' END ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте усредненный LTV (Loan-to-Value) для всех действующих кредитных заявок.",
    "sql": "SELECT AVG(AMT_CREDIT / AMT_GOODS_PRICE) FROM application_train WHERE AMT_GOODS_PRICE IS NOT NULL AND AMT_GOODS_PRICE != 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько наших клиентов-заемщиков имеют свою недвижимость в собственности?",
    "sql": "SELECT (SUM(CASE WHEN FLAG_OWN_REALTY = 'Y' THEN 1 ELSE 0 END) * 100.0) / COUNT(*) FROM application_train_test;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) для карт с платежами в текущем периоде (AMT_PAYMENT_CURRENT > 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните количество пролонгаций по кредитам из бюро для кредитов, по которым задан аннуитетный платёж в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов с историей просрочек для разных групп клиентов между кредитами в разных валютах?",
    "sql": "SELECT CREDIT_CURRENCY AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_CURRENCY ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Анализ корреляции между частотой запросов в БКИ за год и уровнем дефолта.",
    "sql": "SELECT AMT_REQ_CREDIT_BUREAU_YEAR, AVG(TARGET) AS default_rate FROM application_train WHERE AMT_REQ_CREDIT_BUREAU_YEAR IS NOT NULL GROUP BY AMT_REQ_CREDIT_BUREAU_YEAR ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для предыдущих заявок с суммой кредита от 10 000 до 50 000 в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по типу портфеля (NAME_PORTFOLIO).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PORTFOLIO ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется величина DAYS_DECISION по предыдущим кредитам для одобренных предыдущих кредитов между клиентами между группами доходности кредитных продуктов?",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_YIELD_GROUP ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит объём текущих платежей по картам для карт без просрочек для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Анализ средней суммы текущей задолженности по данным Бюро кредитных историй (БКИ) с учетом статуса активности кредитного договора.",
    "sql": "SELECT CREDIT_ACTIVE, AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE AMT_CREDIT_SUM_DEBT IS NOT NULL GROUP BY CREDIT_ACTIVE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для последующих платежей (NUM_INSTALMENT_NUMBER > 3), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Интересно, как количество детей влияет на вероятность невозврата кредита, если смотреть по семейным статусам?",
    "sql": "SELECT NAME_FAMILY_STATUS, CNT_CHILDREN, AVG(TARGET) AS default_rate FROM application_train GROUP BY NAME_FAMILY_STATUS, CNT_CHILDREN ORDER BY NAME_FAMILY_STATUS, CNT_CHILDREN;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните средние значения кредитных лимитов по карточным продуктам, категоризированные по образовательному уровню клиентов.",
    "sql": "SELECT at.NAME_EDUCATION_TYPE, AVG(ccb.AMT_CREDIT_LIMIT_ACTUAL) FROM application_train at JOIN credit_card_balance ccb ON at.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY at.NAME_EDUCATION_TYPE ORDER BY AVG(ccb.AMT_CREDIT_LIMIT_ACTUAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните стоимость товара по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какие основные причины, по которым мы отказывали клиентам раньше?",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 10;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_INSTALMENT для второй половины клиентов по нечётности ID между разными группами между платежами, где клиент платил полностью или больше, и платежами с недоплатой?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 GROUP BY CASE WHEN AMT_PAYMENT >= AMT_INSTALMENT THEN 'on_time_or_ahead' ELSE 'underpayment' END ORDER BY avg_days_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD_DEF по POS-кредитам для второй условной половины клиентов (по нечётности ID) между разными категориями между клиентами по их POS-истории?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Извлечь все сведения из БКИ по клиенту с идентификатором 100005.",
    "sql": "SELECT * FROM bureau WHERE SK_ID_CURR = 100005;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карточных записей за последние 6 месяцев (MONTHS_BALANCE > -6), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_payment_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите ключевые профессии-драйверы кредитного риска (топ-3).",
    "sql": "SELECT OCCUPATION_TYPE, AVG(TARGET) AS DefaultRate FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL GROUP BY OCCUPATION_TYPE ORDER BY DefaultRate DESC LIMIT 3;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между часами дня, когда принималось решение по заявке?",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните накопленный остаток по карте для истории по картам старше года по признаку «месяц истории по карте», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE <= -12 ) SELECT MONTHS_BALANCE AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY MONTHS_BALANCE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднее значение задержки платежа в днях (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) для повторных клиентов (pa.NAME_CLIENT_TYPE = 'Repeater') в разрезе по каналу продаж (pa.CHANNEL_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT CHANNEL_TYPE AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажите процент заемщиков, у которых есть автомобиль.",
    "sql": "SELECT AVG(CASE WHEN FLAG_OWN_CAR = 'Y' THEN 1 ELSE 0 END) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сколько всего денег мы выдали в кредит по всем нашим основным заявкам?",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каков средний срок просрочки по активным и закрытым кредитам, зарегистрированным в бюро кредитных историй?",
    "sql": "SELECT AVG(CREDIT_DAY_OVERDUE) FROM bureau WHERE CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для последующих платежей (NUM_INSTALMENT_NUMBER > 3), покажите средний фактический платёж по рассрочке (AMT_PAYMENT) по каждому значению поля SK_ID_PREV.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY SK_ID_PREV ORDER BY avg_amt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний запрошенный размер кредита (AMT_APPLICATION) для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по типу клиента (NAME_CLIENT_TYPE).",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните запрошенный размер кредита по заявке для прошлых кредитов на сумму выше 50 000 для разных категорий по признаку «день недели решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Влияет ли время, когда подают заявку, на то, вернут ли кредит?",
    "sql": "SELECT HOUR_APPR_PROCESS_START, AVG(TARGET) * 100 FROM application_train_test GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каков средний возрастной показатель для каждой группы заемщиков, исходя из их образовательного уровня?",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(ABS(DAYS_BIRTH) / 365) AS AverageAge FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY AverageAge DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каково общее количество предыдущих заявок в разрезе их финальных статусов (одобрено, отказано, отменено)?",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(SK_ID_PREV) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для карт, по которым вносились платежи для разных групп между клиентами по их карточной активности?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Проанализируйте почасовое распределение количества поступивших кредитных заявок.",
    "sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY HOUR_APPR_PROCESS_START;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какие пять видов занятости являются самыми распространенными среди наших клиентов?",
    "sql": "SELECT OCCUPATION_TYPE, COUNT(SK_ID_CURR) AS ClientCount FROM application_train WHERE OCCUPATION_TYPE IS NOT NULL AND OCCUPATION_TYPE != 'XNA' GROUP BY OCCUPATION_TYPE ORDER BY ClientCount DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько наших клиентов из разных семейных групп получали отказ по предыдущим кредитным заявкам?",
    "sql": "SELECT at.NAME_FAMILY_STATUS, (COUNT(DISTINCT CASE WHEN pa.NAME_CONTRACT_STATUS = 'Refused' THEN at.SK_ID_CURR END) * 100.0 / COUNT(DISTINCT at.SK_ID_CURR)) AS refused_percentage FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY refused_percentage DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте табличный отчет по коэффициенту долговой нагрузки (DTI) для каждого клиента, используя отношение суммы кредита к доходу.",
    "sql": "SELECT SK_ID_CURR, AMT_CREDIT / AMT_INCOME_TOTAL AS CREDIT_TO_INCOME_RATIO FROM application_train_test WHERE AMT_INCOME_TOTAL > 0",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажи мне, пожалуйста, клиентов, у которых сейчас открыто хотя бы два кредита в БКИ.",
    "sql": "SELECT at.SK_ID_CURR, at.AMT_INCOME_TOTAL, at.AMT_CREDIT, COUNT(b.SK_BUREAU_ID) AS num_active_bureau_loans FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active' GROUP BY at.SK_ID_CURR, at.AMT_INCOME_TOTAL, at.AMT_CREDIT HAVING COUNT(b.SK_BUREAU_ID) >= 2 LIMIT 50;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Отобразите метрику, показывающую общее количество уникальных клиентов в клиентской базе.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните ставка первоначального взноса по предыдущим кредитам для прошлых заявок, принятых более года назад для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение RATE_DOWN_PAYMENT по предыдущим кредитам для предыдущих заявок с суммой кредита более 50 000 в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднее значение накопленного остатка по карте (cum_balance) для карт с текущими выборками средств (AMT_DRAWINGS_CURRENT > 0) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_DRAWINGS_CURRENT > 0 ) SELECT NAME_CONTRACT_STATUS AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определение численности заемщиков с отсутствием зафиксированной кредитной истории в БКИ.",
    "sql": "SELECT (SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train) - COUNT(DISTINCT SK_ID_CURR) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей без фактического платежа (AMT_PAYMENT = 0), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля SK_ID_PREV.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_PAYMENT = 0 GROUP BY SK_ID_PREV ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для старых POS-операций (старше года) для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE < -12 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля NAME_PORTFOLIO показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PORTFOLIO ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите распределение кредитных статусов (например, \"активный\", \"закрыт\") по всем записям в БКИ.",
    "sql": "SELECT CREDIT_ACTIVE, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY CREDIT_ACTIVE ORDER BY COUNT(SK_BUREAU_ID) DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество пролонгаций по кредитам из бюро для кредитов, где хотя бы раз была просрочка по сумме для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Покажите сравнительный анализ доли невозвратов по наличию автомобиля.",
    "sql": "SELECT FLAG_OWN_CAR, AVG(TARGET) FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяются наши клиенты с недвижимостью по семейному статусу?",
    "sql": "SELECT NAME_FAMILY_STATUS, COUNT(SK_ID_CURR) * 100.0 / (SELECT COUNT(*) FROM application_train WHERE FLAG_OWN_REALTY = 'Y') AS percentage FROM application_train WHERE FLAG_OWN_REALTY = 'Y' GROUP BY NAME_FAMILY_STATUS ORDER BY percentage DESC;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для первых шести платежей по рассрочке (NUM_INSTALMENT_NUMBER <= 6) сгруппирует данные по типу клиента (pa.NAME_CLIENT_TYPE) и рассчитает среднюю долю просроченных платежей (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите уровень дефолта в разрезе наличия/отсутствия автомобиля у клиента.",
    "sql": "SELECT FLAG_OWN_CAR, AVG(TARGET) FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитных карт с лимитом (AMT_CREDIT_SUM_LIMIT > 0) и по каждому значению группировки (CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END) рассчитывается среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Какова средняя вероятность дефолта клиентов для каждой категории семейного положения?",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(TARGET) * 100 FROM application_train GROUP BY NAME_FAMILY_STATUS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какие клиенты входят в топ-10 по общему объему задолженности, согласно данным БКИ?",
    "sql": "SELECT SK_ID_CURR, SUM(AMT_CREDIT_SUM_DEBT) AS total_debt FROM bureau GROUP BY SK_ID_CURR ORDER BY total_debt DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните просрочку платежа по POS-кредитам в днях для платежей с известной датой внесения по признаку «тип платежного поведения по POS» для POS-рассрочек на основе объединённых данных о графике и фактических платежах.",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_ENTRY_PAYMENT IS NOT NULL ) SELECT CASE WHEN ip.AMT_PAYMENT >= ip.AMT_INSTALMENT THEN 'on_time_or_overpay' ELSE 'underpay_or_missing' END AS group_key, AVG(days_late) AS metric_value FROM pos_inst GROUP BY CASE WHEN ip.AMT_PAYMENT >= ip.AMT_INSTALMENT THEN 'on_time_or_overpay' ELSE 'underpay_or_missing' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как распределяется разницу между фактическим и плановым платёжом по рассрочке для второй половины клиентов по чётности ID между различными сегментами между просроченными и своевременными платежами в истории рассрочек клиентов?",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) и по каждому значению поля NAME_CONTRACT_STATUS показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте табличный отчет, содержащий данные о количестве одобренных и отклоненных заявок, сгруппированных по типу кредитного продукта.",
    "sql": "SELECT NAME_CONTRACT_TYPE, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS approved_count, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS refused_count FROM previous_application GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднее значение накопленного остатка по карте (cum_balance) для карт с просрочкой по DPD (SK_DPD > 0) в разрезе по клиенту (SK_ID_CURR).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD > 0 ) SELECT SK_ID_CURR AS group_key, AVG(cum_balance) AS metric_value FROM cc GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Составьте таблицу из пяти самых популярных связок 'доход/образование' для клиентов, допустивших дефолт.",
    "sql": "SELECT NAME_INCOME_TYPE, NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) AS client_count FROM application_train WHERE TARGET = 1 GROUP BY NAME_INCOME_TYPE, NAME_EDUCATION_TYPE ORDER BY client_count DESC LIMIT 5;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Представьте перечень 10 клиентов с наивысшим годовым количеством запросов в Бюро кредитных историй.",
    "sql": "SELECT SK_ID_CURR, AMT_REQ_CREDIT_BUREAU_YEAR FROM application_train ORDER BY AMT_REQ_CREDIT_BUREAU_YEAR DESC LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для карт без просрочек для разных групп между клиентами по их карточной активности?",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE SK_DPD = 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какие коды причин отказа преобладают среди отклоненных ранее заявок?",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для новых клиентов (NAME_CLIENT_TYPE = 'New') и по каждому значению поля NAME_CLIENT_TYPE показывается среднюю стоимость товара по предыдущим кредитам.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для карт, по которым есть просрочка для разных групп между разными статусами договоров по кредитным картам?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_balance DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте среднюю сумму кредита из БКИ, сгруппированную по типу жилья заемщика.",
    "sql": "SELECT at.NAME_HOUSING_TYPE, AVG(b.AMT_CREDIT_SUM) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.NAME_HOUSING_TYPE ORDER BY AVG(b.AMT_CREDIT_SUM) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова структура клиентского портфеля по количеству иждивенцев или членов семьи?",
    "sql": "SELECT CNT_FAM_MEMBERS, COUNT(*) FROM application GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Мне нужно знать общее число заявок, которые мы рассмотрели.",
    "sql": "SELECT COUNT(SK_ID_CURR) FROM application_train_test;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднюю стоимость товара по предыдущим кредитам для новых клиентов (NAME_CLIENT_TYPE = 'New') в разрезе по дню недели принятия решения (WEEKDAY_APPR_PROCESS_START).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CLIENT_TYPE = 'New' GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните задержка платежа в днях для платежей по рассрочкам примерно за последний год между сегментами по признаку «канал оформления кредита» на основе джойна прошлых заявок и фактических платежей по ним.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Вычислите общее количество уникальных клиентов, у которых зафиксированы активные кредитные обязательства в Бюро кредитных историй.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') и по каждому значению поля NAME_CLIENT_TYPE показывается средний размер первоначального взноса по предыдущим кредитам.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «статус прошлой заявки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажите метрику по числу уникальных клиентов, у которых открыто более двух кредитов в БКИ.",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS ActiveCreditCount FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING ActiveCreditCount > 2) AS T;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов с DPD_DEF > 0 в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD_DEF > 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "На основе таблицы credit_card_balance и оконных функций рассчитайте среднюю загрузку кредитных карт (utilization) по сегментам для записей за последний год (MONTHS_BALANCE > -12) в разрезе по уровню загрузки лимита utilization (high/medium/low).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE MONTHS_BALANCE > -12 ) SELECT CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY CASE WHEN utilization > 0.8 THEN 'high_utilization' WHEN utilization > 0.3 THEN 'medium_utilization' ELSE 'low_utilization' END ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD по POS-кредитам для условной половины клиентов (по чётности ID) между разными категориями по разным месяцам наблюдения POS-кредитов?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Отобразите помесячное сравнение среднего фактически уплаченного долга по кредитным картам и среднего минимального платежа.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_PAYMENT_CURRENT) AS avg_payment, AVG(AMT_INST_MIN_REGULARITY) AS avg_min_payment FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитов с недавно обновлёнными данными в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE > -30 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для кредитных карт с лимитом (AMT_CREDIT_SUM_LIMIT > 0) в разрезе по статусу кредита (CREDIT_ACTIVE).",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY CHANNEL_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для клиентов, которые уже брали кредит ранее между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с максимальной просрочкой больше нуля (AMT_CREDIT_MAX_OVERDUE > 0) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается среднее количество дней просрочки по кредитам из бюро (CREDIT_DAY_OVERDUE).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE AMT_CREDIT_MAX_OVERDUE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова структура нашей клиентской базы по признаку наличия детей?",
    "sql": "SELECT CNT_CHILDREN, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как распределяется долю месяцев с просрочкой по кредитам в бюро для месяцев, по которым статус кредита известен между разными категориями между отдельными кредитами из бюро?",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS <> 'X' GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите среднюю сумму заявки на кредит (AMT_APPLICATION) для каждой категории семейного положения.",
    "sql": "SELECT at.NAME_FAMILY_STATUS, AVG(pa.AMT_APPLICATION) AS avg_application_amount FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR GROUP BY at.NAME_FAMILY_STATUS ORDER BY avg_application_amount DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит объём текущих выборок по картам для кредитных карт с высоким лимитом для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 50000 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Почему мы чаще всего отказывали в кредитах в прошлом? Покажи самые частые причины.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля NAME_SELLER_INDUSTRY показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте гистограмму, показывающую процент дефолтных заемщиков по группам в зависимости от числа детей.",
    "sql": "SELECT CNT_CHILDREN, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Предоставьте детализированный отчет о статусе баланса по месяцам для записи в бюро кредитных историй с идентификатором 5886650, включая информацию о просрочках.",
    "sql": "SELECT MONTHS_BALANCE, STATUS FROM bureau_balance WHERE SK_BUREAU_ID = 5886650 ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Визуализируйте структуру доходной базы заемщиков.",
    "sql": "SELECT NAME_INCOME_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_INCOME_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 для разных категорий по признаку «статус прошлой заявки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков размер сегмента заемщиков, демонстрирующих более одного активного кредита в кредитной истории?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM (SELECT SK_ID_CURR FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY SK_ID_CURR HAVING COUNT(SK_BUREAU_ID) > 1);",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Правда ли, что чем больше детей, тем больше берут в кредит?",
    "sql": "SELECT CNT_CHILDREN, AVG(AMT_CREDIT) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для недавней, но не самой свежей кредитной истории в разрезе признака «давность записи» по истории кредитов из бюро.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -9 AND -4 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с просрочкой по DPD (SK_DPD > 0), покажите средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE SK_DPD > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Используя только installments_payments и оконные функции, рассчитайте среднее значение задержки платежа в днях (delay_days) по рассрочкам для клиентов с чётным идентификатором (SK_ID_CURR % 2 = 0) в разрезе по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE SK_ID_CURR % 2 = 0 ) SELECT SK_ID_CURR AS group_key, AVG(delay_days) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Определите процент уникальных клиентов, которые имеют активные кредиты и одновременно фиксируют просрочку в бюро кредитных историй.",
    "sql": "SELECT CAST(COUNT(DISTINCT SK_ID_CURR) AS REAL) * 100 / (SELECT COUNT(DISTINCT SK_ID_CURR) FROM bureau) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте среднее количество дней до фактической даты платежа (DAYS_ENTRY_PAYMENT) для просроченных платежей (DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT) в разрезе по номеру платежа в графике (NUM_INSTALMENT_NUMBER).",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE DAYS_ENTRY_PAYMENT > DAYS_INSTALMENT GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько в среднем денег остается на кредитках у тех, кто не платит по кредитам?",
    "sql": "SELECT AVG(ccb.AMT_BALANCE) FROM application_train a JOIN credit_card_balance ccb ON a.SK_ID_CURR = ccb.SK_ID_CURR WHERE a.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Отобразите распределение численности детей у заемщиков.",
    "sql": "SELECT CNT_CHILDREN, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Из тех, у кого сейчас есть активные кредиты в БКИ, сколько в итоге не выплатили свой?",
    "sql": "SELECT (SUM(CASE WHEN a.TARGET = 1 THEN 1 ELSE 0 END) * 1.0 / COUNT(a.SK_ID_CURR)) * 100 FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для отказанных предыдущих кредитов для разных категорий по признаку «отрасль продавца» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Покажите мне, как средний возраст одобренных заемщиков менялся с течением времени, по годам принятия решения.",
    "sql": "SELECT ABS(CAST(DAYS_DECISION / 365 AS INT)) AS decision_year, AVG(ABS(a.DAYS_BIRTH / 365)) AS average_age FROM previous_application pa JOIN application_train a ON pa.SK_ID_CURR = a.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY decision_year ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сравните количество оставшихся платежей по POS-кредитам для POS-кредитов без задержек по оплате для разных значений признака «месяц наблюдения по POS» по POS-кредитам.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните загрузку кредитных карт (отношение задолженности к лимиту) для недавней активности по кредитным картам по признаку «канал оформления предыдущего кредита» на уровне клиентов, используя как данные по прошлым кредитам, так и агрегированную статистику по картам.",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.MONTHS_BALANCE > -6 GROUP BY cc.SK_ID_CURR ) SELECT pa.CHANNEL_TYPE AS group_key, AVG(utilization) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков средний показатель общего дохода у заемщиков, ранее пользовавшихся услугами микрофинансирования?",
    "sql": "SELECT AVG(at.AMT_INCOME_TOTAL) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NFLAG_MICRO_CASH = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте таблицу: сколько клиентов имеют X иждивенцев, и каков их средний годовой доход?",
    "sql": "SELECT CNT_CHILDREN, COUNT(SK_ID_CURR), AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN ASC;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Представьте распределение активных кредитов в БКИ по количеству дней просроченной задолженности.",
    "sql": "SELECT CREDIT_DAY_OVERDUE, COUNT(SK_BUREAU_ID) AS OverdueCount FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_DAY_OVERDUE ORDER BY CREDIT_DAY_OVERDUE DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Каков средний доход у клиентов, которые ранее имели опыт получения микрофинансовых займов?",
    "sql": "SELECT AVG(at.AMT_INCOME_TOTAL) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NFLAG_MICRO_CASH = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Отобразите тренд средних ежемесячных платежей по активным кредитным картам.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_PAYMENT_TOTAL_CURRENT) AS avg_payment FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Какой общий уровень просроченной задолженности (default rate) по всему пулу заемщиков?",
    "sql": "SELECT CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте среднюю сумму кредита, сгруппировав данные по типу источника дохода заявителей.",
    "sql": "SELECT t1.NAME_INCOME_TYPE, AVG(t1.AMT_CREDIT) FROM application_train_test t1 GROUP BY t1.NAME_INCOME_TYPE ORDER BY AVG(t1.AMT_CREDIT) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как соотносятся средний размер кредита и цена покупки для разных видов договоров?",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_CREDIT) AS avg_credit, AVG(AMT_GOODS_PRICE) AS avg_goods_price FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для отказанных предыдущих кредитов для разных категорий по признаку «статус прошлой заявки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Представьте демографическую структуру клиентской базы по гендерному признаку.",
    "sql": "SELECT CODE_GENDER, COUNT(SK_ID_CURR) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Покажите средний возраст брачующихся клиентов для оценки демографических показателей.",
    "sql": "SELECT ABS(AVG(DAYS_BIRTH) / 365.25) AS avg_age_married FROM application_train WHERE NAME_FAMILY_STATUS = 'Married';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Отследите динамику демографического профиля одобренных заемщиков, представив изменение среднего возраста клиентов по годам выдачи кредита.",
    "sql": "SELECT ABS(CAST(DAYS_DECISION / 365 AS INT)) AS decision_year, AVG(ABS(a.DAYS_BIRTH / 365)) AS average_age FROM previous_application pa JOIN application_train a ON pa.SK_ID_CURR = a.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY decision_year ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для заявок с дорогими товарами (AMT_GOODS_PRICE > 100 000) и по каждому значению поля NAME_PRODUCT_TYPE показывается среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT).",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните первоначальный взнос по предыдущим кредитам для случаев, когда клиент запрашивал больше, чем было одобрено для разных категорий по признаку «тип клиента» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Выведите топ-5 категорий жилья, в которых проживают заявители.",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_HOUSING_TYPE ORDER BY COUNT(SK_ID_CURR) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько наших заемщиков без детей, в процентном выражении?",
    "sql": "SELECT CAST(COUNT(SK_ID_CURR) AS REAL) * 100 / (SELECT COUNT(SK_ID_CURR) FROM application_train) FROM application_train WHERE CNT_CHILDREN = 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните значение DAYS_INSTALMENT для рассрочек, по которым есть плановый платёж для разных значений признака «номер платежа» в платёжной истории клиентов.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE AMT_INSTALMENT > 0 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется количество плановых платежей по предыдущим кредитам для прошлых кредитов на сумму выше 50 000 между клиентами между новыми и возвращающимися клиентами?",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT > 50000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков текущий сводный коэффициент дефолтности по портфелю заявок?",
    "sql": "SELECT AVG(TARGET) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Рассчитайте средний аннуитетный платеж по успешно одобренным предыдущим кредитным заявкам.",
    "sql": "SELECT AVG(AMT_ANNUITY) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Анализ средней суммы выданного кредита по различным типам основных контрактов.",
    "sql": "SELECT NAME_CONTRACT_TYPE, AVG(AMT_CREDIT) FROM application_train GROUP BY NAME_CONTRACT_TYPE;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько у нас всего разных клиентов?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каково соотношение мужчин и женщин среди всех подавших кредитные заявки?",
    "sql": "SELECT CODE_GENDER, COUNT(SK_ID_CURR) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее количество плановых платежей по предыдущим кредитам (CNT_PAYMENT) для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний остаток по кредитным картам (AMT_BALANCE) для клиентов с нечётным идентификатором (SK_ID_CURR % 2 = 1) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE SK_ID_CURR % 2 = 1 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Покажи, в какой день недели чаще всего дефолтят клиенты, исходя из их прошлых заявок.",
    "sql": "SELECT T2.WEEKDAY_APPR_PROCESS_START, AVG(T1.TARGET) AS default_rate FROM application_train AS T1 JOIN previous_application AS T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR GROUP BY T2.WEEKDAY_APPR_PROCESS_START ORDER BY default_rate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "На джойне POS_CASH_balance и installments_payments рассчитайте среднюю величину просрочки платежа по POS-кредитам в днях (days_late) для платежей, по которым известна дата фактической оплаты в разрезе по статусу POS-договора (pos.NAME_CONTRACT_STATUS).",
    "sql": "WITH pos_inst AS ( SELECT pos.SK_ID_CURR, pos.SK_ID_PREV, pos.NAME_CONTRACT_STATUS, pos.CNT_INSTALMENT, pos.CNT_INSTALMENT_FUTURE, pos.MONTHS_BALANCE, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN 1.0 ELSE 0.0 END AS late_flag, CASE WHEN ip.DAYS_ENTRY_PAYMENT > ip.DAYS_INSTALMENT THEN (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) ELSE 0 END AS days_late FROM POS_CASH_balance pos JOIN installments_payments ip ON pos.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.DAYS_ENTRY_PAYMENT IS NOT NULL ) SELECT pos.NAME_CONTRACT_STATUS AS group_key, AVG(days_late) AS metric_value FROM pos_inst GROUP BY pos.NAME_CONTRACT_STATUS ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Рассчитайте показатель отношения кредитной суммы к общему доходу для каждого заемщика.",
    "sql": "SELECT SK_ID_CURR, AMT_CREDIT / AMT_INCOME_TOTAL AS CREDIT_TO_INCOME_RATIO FROM application_train_test WHERE AMT_INCOME_TOTAL > 0",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице bureau_balance рассчитайте долю месяцев с просрочкой (STATUS в ['1'..'5']) по кредитам в бюро для закрытых кредитов (STATUS = 'C') в разрезе по давности записи (MONTHS_BALANCE, recent/old).",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(CASE WHEN STATUS IN ('1','2','3','4','5') THEN 1 ELSE 0 END) AS avg_metric FROM bureau_balance WHERE STATUS = 'C' GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для записей с просрочкой (STATUS в ['1'..'5']) в разрезе по статусу STATUS в bureau_balance.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS IN ('1','2','3','4','5') GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните текущая задолженность по кредитам из бюро для кредитных карт с установленным лимитом в разрезе признака «давность кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_LIMIT > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте график ежемесячного изменения среднего объема выданных (одобренных) кредитов за последний год.",
    "sql": "SELECT STRFTIME('%Y-%m', DATE(JULIANDAY('now'), DAYS_DECISION || ' days')) AS decision_month, AVG(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND DAYS_DECISION BETWEEN -365 AND 0 GROUP BY decision_month ORDER BY decision_month;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT) для предыдущих кредитов свыше 50 000 с ненулевым плановым платежом в разрезе по каналу продаж (pa.CHANNEL_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.AMT_CREDIT > 50000 AND ip.AMT_INSTALMENT > 0 ) SELECT CHANNEL_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY CHANNEL_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова структура клиентского портфеля по критериям наличия автомобиля и недвижимости?",
    "sql": "SELECT FLAG_OWN_CAR, FLAG_OWN_REALTY, COUNT(*) FROM application GROUP BY FLAG_OWN_CAR, FLAG_OWN_REALTY ORDER BY FLAG_OWN_CAR, FLAG_OWN_REALTY;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представь дефолт рейт, сгруппированный по гендерному признаку.",
    "sql": "SELECT CODE_GENDER, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Рассчитайте средний уровень дохода у дефолтных заемщиков, которые ранее получали одобрение по кредитам.",
    "sql": "SELECT AVG(at.AMT_INCOME_TOTAL) FROM application_train at JOIN (SELECT DISTINCT SK_ID_CURR FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved') pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE at.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова доля дефолтов в зависимости от типа образования клиента?",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(TARGET) * 100 FROM application_train_test GROUP BY NAME_EDUCATION_TYPE ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Оцените объем кредитного портфеля по возрастным когортам клиентов, получивших одобрение.",
    "sql": "SELECT CASE WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 25 THEN 'До 25' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 35 THEN '26-35' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 45 THEN '36-45' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 55 THEN '46-55' WHEN FLOOR(ABS(at.DAYS_BIRTH) / 365) <= 65 THEN '56-65' ELSE 'Старше 65' END AS AgeGroup, SUM(pa.AMT_CREDIT) AS TotalApprovedCredit FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY AgeGroup ORDER BY AgeGroup;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя просроченная задолженность по кредитам из бюро для кредитов с историей просрочек для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля NAME_SELLER_INDUSTRY показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте средний размер одобренного кредита по предыдущим обращениям для отклонённых предыдущих заявок (NAME_CONTRACT_STATUS = 'Refused') в разрезе по доходности продукта (NAME_YIELD_GROUP).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для записей с активным статусом договора (NAME_CONTRACT_STATUS = 'Active') в разрезе по статусу договора POS-кредита (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE NAME_CONTRACT_STATUS = 'Active' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется количество запланированных платежей по POS-кредитам для POS-кредитов с коротким графиком между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для записей без фактического платежа (AMT_PAYMENT = 0), покажите средний плановый платёж по рассрочке (AMT_INSTALMENT) по каждому значению поля SK_ID_PREV.",
    "sql": "SELECT SK_ID_PREV AS group_key, AVG(AMT_INSTALMENT) AS avg_amt_instalment FROM installments_payments WHERE AMT_PAYMENT = 0 GROUP BY SK_ID_PREV ORDER BY avg_amt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Представьте временной ряд среднего баланса по счетам кредитных карт за недавние отчетные периоды.",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_BALANCE) AS avg_balance FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Визуализируйте сегментацию клиентского портфеля по типам образования.",
    "sql": "SELECT NAME_EDUCATION_TYPE, COUNT(SK_ID_CURR) FROM application_train GROUP BY NAME_EDUCATION_TYPE;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Требуется анализ годовой динамики суммарного объема выданных кредитных средств по одобренным договорам.",
    "sql": "SELECT ABS(CAST(DAYS_DECISION / 365 AS INT)) AS decision_year, SUM(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY decision_year ORDER BY decision_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Если у клиента есть машина, он чаще или реже дефолтит? Покажи процент.",
    "sql": "SELECT FLAG_OWN_CAR, CAST(SUM(TARGET) AS REAL) * 100 / COUNT(SK_ID_CURR) AS DefaultRate FROM application_train GROUP BY FLAG_OWN_CAR;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-записей за последние 6 месяцев (MONTHS_BALANCE > -6) и показан среднее количество запланированных платежей по POS-кредитам (CNT_INSTALMENT) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE MONTHS_BALANCE > -6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какой процент от всех клиентов, у которых есть кредитка, при этом не вернули основной кредит?",
    "sql": "SELECT CAST(SUM(CASE WHEN app.TARGET = 1 AND cc.SK_ID_CURR IS NOT NULL THEN 1 ELSE 0 END) AS REAL) * 100 / COUNT(app.SK_ID_CURR) FROM application_train app LEFT JOIN credit_card_balance cc ON app.SK_ID_CURR = cc.SK_ID_CURR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "На объединении previous_application и installments_payments оцените среднюю долю просроченных платежей (delay_days > 0) для первых шести платежей по рассрочке (NUM_INSTALMENT_NUMBER <= 6) в разрезе по типу кредитного продукта (pa.NAME_CONTRACT_TYPE) с использованием CTE и оконных функций.",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте среднее арифметическое количество снятий наличных через банкоматы по кредитным картам.",
    "sql": "SELECT AVG(CNT_DRAWINGS_ATM_CURRENT) FROM credit_card_balance WHERE CNT_DRAWINGS_ATM_CURRENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов с DPD > 0 в разрезе по статусу договора POS-кредита (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется стоимость товара по предыдущим кредитам для клиентов, которые уже брали кредит ранее между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
    "sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY CHANNEL_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для карт с нулевым остатком задолженности для разных групп между клиентами, которые больше погашают долг, и теми, кто больше тратит?",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Выведите средний уровень дохода для клиентского сегмента без детей.",
    "sql": "SELECT AVG(AMT_INCOME_TOTAL) FROM application_train WHERE CNT_CHILDREN = 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для последующих платежей (NUM_INSTALMENT_NUMBER > 3), покажите среднее количество дней до фактической даты платежа (DAYS_ENTRY_PAYMENT) по каждому значению поля NUM_INSTALMENT_NUMBER.",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_ENTRY_PAYMENT) AS avg_days_entry_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_entry_payment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сколько у нас вообще разных клиентов?",
    "sql": "SELECT COUNT(DISTINCT SK_ID_CURR) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Как ведёт себя количество дней просрочки по кредитам из бюро для действующих кредитов клиента для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_ACTIVE = 'Active' GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) для карточных записей за последние 6 месяцев (MONTHS_BALANCE > -6) в разрезе по месяцу отчётности по карте (MONTHS_BALANCE).",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для фактических оплат по рассрочке (ip.AMT_PAYMENT > 0) сгруппирует данные по типу клиента (pa.NAME_CLIENT_TYPE) и рассчитает среднюю разницу между фактическим и плановым платежом (AMT_PAYMENT - AMT_INSTALMENT).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.AMT_PAYMENT > 0 ) SELECT NAME_CLIENT_TYPE AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для POS-кредитов с DPD > 0 в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Постройте столбчатую диаграмму, демонстрирующую Probability of Default (PD) по сегментам образовательного уровня клиентов, отсортированную по убыванию.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(TARGET) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какие заемщики демонстрируют несоблюдение минимального платежа по кредитным картам, и каков их текущий баланс?",
    "sql": "SELECT DISTINCT SK_ID_CURR, AMT_BALANCE FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT < AMT_INST_MIN_REGULARITY AND AMT_INST_MIN_REGULARITY > 0",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Представьте гистограмму топ-5 причин отказа по прошлым кредитным заявкам.",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) AS RefusalCount FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY RefusalCount DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Покажите метрику, отражающую среднюю сумму активной задолженности в БКИ для оценки кредитной нагрузки.",
    "sql": "SELECT AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте запрос с подзапросом по credit_card_balance (агрегация по SK_ID_CURR), а затем объедините его с previous_application и получите среднее отношение платежей к выборкам по картам (AMT_PAYMENT_CURRENT / NULLIF(AMT_DRAWINGS_CURRENT, 0)) для карточной активности за последние 6 месяцев (cc.MONTHS_BALANCE > -6) по по типу клиента (pa.NAME_CLIENT_TYPE).",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.MONTHS_BALANCE > -6 GROUP BY cc.SK_ID_CURR ) SELECT pa.NAME_CLIENT_TYPE AS group_key, AVG(pay_vs_spend_ratio) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.NAME_CLIENT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для кредитной истории за последние три месяца в разрезе признака «кредит из бюро» по истории кредитов из бюро.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE BETWEEN -3 AND 0 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов с давними обновлениями (DAYS_CREDIT_UPDATE <= -30) и по каждому значению группировки (CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT_UPDATE <= -30 GROUP BY CASE WHEN AMT_CREDIT_SUM > 200000 THEN 'large' ELSE 'small_or_medium' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя долю просроченных платежей для начальных платежей по кредиту для разных групп клиентов между типами кредитных продуктов по предыдущим заявкам, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE ip.NUM_INSTALMENT_NUMBER <= 6 ) SELECT NAME_CONTRACT_TYPE AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Можешь показать, сколько сейчас на балансе, какой лимит и сколько платят по кредиткам те клиенты, у кого были просрочки в БКИ?",
    "sql": "SELECT ccb.SK_ID_CURR, ccb.AMT_BALANCE, ccb.AMT_CREDIT_LIMIT_ACTUAL, ccb.AMT_PAYMENT_TOTAL_CURRENT FROM credit_card_balance ccb JOIN (SELECT DISTINCT SK_ID_CURR FROM bureau WHERE CREDIT_DAY_OVERDUE > 0) b ON ccb.SK_ID_CURR = b.SK_ID_CURR;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажите среднее значение первичной процентной ставки для кредитов со статусом 'Approved'.",
    "sql": "SELECT AVG(RATE_INTEREST_PRIMARY) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' AND RATE_INTEREST_PRIMARY IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какова средняя сумма кредитного лимита по кредитным картам для каждой группы клиентов, сгруппированных по их образованию?",
    "sql": "SELECT a.NAME_EDUCATION_TYPE, AVG(ccb.AMT_CREDIT_LIMIT_ACTUAL) FROM application_train a JOIN credit_card_balance ccb ON a.SK_ID_CURR = ccb.SK_ID_CURR GROUP BY a.NAME_EDUCATION_TYPE ORDER BY AVG(ccb.AMT_CREDIT_LIMIT_ACTUAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Когда чаще всего люди подавали заявки на прошлые кредиты? В какой день недели?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START, COUNT(SK_ID_PREV) FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY COUNT(SK_ID_PREV) DESC",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Представьте временной ряд, отражающий ежегодное изменение числа ранее открытых кредитов клиентами.",
    "sql": "SELECT CAST(2023 + DAYS_CREDIT / 365 AS INT) AS credit_year, COUNT(SK_BUREAU_ID) FROM bureau GROUP BY credit_year ORDER BY credit_year;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Можешь показать, сколько у нас кредитов в разных категориях: маленьких, средних и больших?",
    "sql": "SELECT CASE WHEN AMT_CREDIT < 100000 THEN 'До 100k' WHEN AMT_CREDIT >= 100000 AND AMT_CREDIT < 300000 THEN '100k-300k' ELSE 'Более 300k' END AS CreditRange, COUNT(SK_ID_CURR) FROM application_train GROUP BY CreditRange ORDER BY MIN(AMT_CREDIT);",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Какова помесячная динамика средних сумм погашения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_PAYMENT_TOTAL_CURRENT) FROM credit_card_balance GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для решений, принятых за последний год (DAYS_DECISION > -365) в разрезе по отрасли продавца (NAME_SELLER_INDUSTRY).",
    "sql": "SELECT NAME_SELLER_INDUSTRY AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_SELLER_INDUSTRY ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Оцените процент одобренных кредитов по различным категориям 'NAME_CASH_LOAN_PURPOSE' и ранжируйте их.",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, CAST(COUNT(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 END) AS REAL) * 100 / COUNT(*) AS ApprovalRate FROM previous_application GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY ApprovalRate DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько у наших клиентов в среднем членов семьи? Покажи разбивку.",
    "sql": "SELECT CNT_FAM_MEMBERS, COUNT(SK_ID_CURR) FROM application_train GROUP BY CNT_FAM_MEMBERS ORDER BY CNT_FAM_MEMBERS ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для пролонгированных кредитов (CNT_CREDIT_PROLONG > 0) в разрезе по типу кредита (CREDIT_TYPE) в таблице bureau.",
    "sql": "SELECT CREDIT_TYPE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для клиентов, которые уже брали кредит ранее между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Требуется детализация баланса и актуального кредитного лимита по карте клиента 100007 за весь период.",
    "sql": "SELECT MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL FROM credit_card_balance WHERE SK_ID_CURR = 100007 ORDER BY MONTHS_BALANCE;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для более старых решений по предыдущим кредитам (DAYS_DECISION <= -365) и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам).",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов без серьёзной просрочки (SK_DPD_DEF = 0) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END.",
    "sql": "SELECT CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN CNT_INSTALMENT_FUTURE = 0 THEN 'closed' ELSE 'active' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по installments_payments: для последующих платежей (NUM_INSTALMENT_NUMBER > 3), покажите среднее количество дней до плановой даты платежа (DAYS_INSTALMENT) по каждому значению поля SK_ID_CURR.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 3 GROUP BY SK_ID_CURR ORDER BY avg_days_instalment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните кредитный лимит по картам для активности по картам за последние полгода в разрезе признака «месяц наблюдения по карте» по кредитным картам клиентов.",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для предыдущих заявок с суммой кредита от 10 000 до 50 000 и по каждому значению поля WEEKDAY_APPR_PROCESS_START показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_credit DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Требуется полный список заявок для заемщика с SK_ID_CURR 100006.",
    "sql": "SELECT * FROM application_train_test WHERE SK_ID_CURR = 100006;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице credit_card_balance рассчитайте средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) для более старых карточных записей (MONTHS_BALANCE < -12) в разрезе по статусу карточного договора (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE MONTHS_BALANCE < -12 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как семейное положение влияет на средний годовой доход клиентов?",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(AMT_INCOME_TOTAL) AS avg_income FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY avg_income DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Постройте гистограмму, показывающую уровень дефолтности по группам с разным количеством детей.",
    "sql": "SELECT CNT_CHILDREN, AVG(TARGET) FROM application_train GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN ASC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сколько в среднем зарабатывают клиенты с разным семейным положением?",
    "sql": "SELECT NAME_FAMILY_STATUS, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY NAME_FAMILY_STATUS ORDER BY AVG(AMT_INCOME_TOTAL) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля NAME_YIELD_GROUP показывается средний запрошенный размер кредита (AMT_APPLICATION).",
    "sql": "SELECT NAME_YIELD_GROUP AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_YIELD_GROUP ORDER BY avg_amt_application DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как менялся средний лимит по кредиткам за последние шесть месяцев?",
    "sql": "SELECT MONTHS_BALANCE, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_credit_limit FROM credit_card_balance WHERE MONTHS_BALANCE >= -6 GROUP BY MONTHS_BALANCE ORDER BY MONTHS_BALANCE DESC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Каков общий кредитный портфель (по сумме выданных кредитов)?",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Какие 5 причин чаще всего приводили к отказам, если заявка была на сумму больше, чем обычно?",
    "sql": "SELECT CODE_REJECT_REASON, COUNT(SK_ID_PREV) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' AND AMT_APPLICATION > (SELECT AVG(AMT_APPLICATION) FROM previous_application) GROUP BY CODE_REJECT_REASON ORDER BY COUNT(SK_ID_PREV) DESC LIMIT 5;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните количество плановых платежей по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «тип продуктовой линейки» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(CNT_PAYMENT) AS avg_cnt_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_cnt_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните значение MONTHS_BALANCE по кредитам в бюро для очень старой истории кредитов (старше трёх лет) в разрезе признака «кредит из бюро» по истории кредитов из бюро.",
    "sql": "SELECT SK_BUREAU_ID AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE <= -36 GROUP BY SK_BUREAU_ID ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется ставка первоначального взноса по предыдущим кредитам для кредитов на дорогие товары дороже 100 000 между клиентами между статусами прошлых кредитных договоров (одобрен, отказан и т.д.)?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(RATE_DOWN_PAYMENT) AS avg_rate_down_payment FROM previous_application WHERE AMT_GOODS_PRICE > 100000 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_rate_down_payment DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов с количеством платежей более 6 (CNT_INSTALMENT > 6) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE CNT_INSTALMENT > 6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте отчёт по bureau_balance: для записей за предыдущий месяц (MONTHS_BALANCE = -1), покажите среднее значение MONTHS_BALANCE по записям bureau_balance по каждому значению поля группировки CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END.",
    "sql": "SELECT CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE MONTHS_BALANCE = -1 GROUP BY CASE WHEN MONTHS_BALANCE > -6 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сколько в среднем лет тем клиентам, у кого есть просрочки по кредитам в бюро?",
    "sql": "SELECT AVG(ABS(at.DAYS_BIRTH) / 365) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_DAY_OVERDUE > 0;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Определите среднерыночную сумму кредита по заявкам, получившим отказ в выдаче.",
    "sql": "SELECT AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Проанализируйте динамику средней суммы задолженности по активным кредитам, отраженным в БКИ, за последний год.",
    "sql": "SELECT ABS(DAYS_CREDIT) AS DaysAgo, AVG(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Active' AND ABS(DAYS_CREDIT) <= 365 GROUP BY ABS(DAYS_CREDIT) ORDER BY DaysAgo;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Постройте запрос с вычислением utilization и cum_balance по кредитным картам клиента, а затем агрегируйте среднюю загрузку кредитных карт (utilization) по сегментам для карт с заданным кредитным лимитом (AMT_CREDIT_LIMIT_ACTUAL > 0) по по уровню кредитного лимита (high_limit/low_or_medium_limit).",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Оцените корреляцию между образовательным цензом клиента и вероятностью дефолта, отобразив это распределение.",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(TARGET) * 100 FROM application GROUP BY NAME_EDUCATION_TYPE ORDER BY AVG(TARGET) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте среднюю долю просроченных платежей по рассрочкам для поздних платежей (NUM_INSTALMENT_NUMBER > 12) по по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER > 12 ) SELECT SK_ID_CURR AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как распределяется показатель DPD_DEF по POS-кредитам для условной половины клиентов (по чётности ID) между разными категориями между статусами POS-договоров?",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_ID_CURR % 2 = 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd_def DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какой средний лимит по всем кредиткам?",
    "sql": "SELECT AVG(AMT_CREDIT_LIMIT_ACTUAL) FROM credit_card_balance;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните количество запланированных платежей по POS-кредитам для POS-кредитов с коротким графиком для разных значений признака «статус POS-договора» по POS-кредитам.",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(CNT_INSTALMENT) AS avg_cnt_instalment FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_cnt_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Определите среднюю метрику суммы одобренных кредитных лимитов в предыдущих циклах скоринга.",
    "sql": "SELECT AVG(AMT_CREDIT) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Постройте агрегированный отчёт по bureau, где для кредитов, по которым уже была просрочка (CREDIT_DAY_OVERDUE > 0) и по каждому значению группировки (CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END) рассчитывается средний объём просроченной задолженности по кредитам из бюро (AMT_CREDIT_SUM_OVERDUE).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM_OVERDUE) AS avg_metric FROM bureau WHERE CREDIT_DAY_OVERDUE > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице previous_application рассчитайте среднее значение DAYS_DECISION (сколько дней прошло с даты решения по предыдущим кредитам) для одобренных предыдущих заявок (NAME_CONTRACT_STATUS = 'Approved') в разрезе по типу продукта (NAME_CONTRACT_TYPE) в previous_application.",
    "sql": "SELECT NAME_CONTRACT_TYPE AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CONTRACT_TYPE ORDER BY avg_days_decision DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните стоимость товара по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) для разных категорий по признаку «тип клиента» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_CLIENT_TYPE AS group_key, AVG(AMT_GOODS_PRICE) AS avg_amt_goods_price FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY NAME_CLIENT_TYPE ORDER BY avg_amt_goods_price DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя количество пролонгаций по кредитам из бюро для кредитов, по которым есть долг для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM_DEBT > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Каково соотношение клиентов мужского и женского пола?",
    "sql": "SELECT CODE_GENDER, COUNT(SK_ID_CURR) FROM application_train GROUP BY CODE_GENDER;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD по POS-кредитам (SK_DPD) для POS-кредитов с DPD > 0 в разрезе по статусу договора POS-кредита (NAME_CONTRACT_STATUS).",
    "sql": "SELECT NAME_CONTRACT_STATUS AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY NAME_CONTRACT_STATUS ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с непогашенным остатком (AMT_BALANCE > 0), покажите средний действующий кредитный лимит по картам (AMT_CREDIT_LIMIT_ACTUAL) по каждому значению поля CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE AMT_BALANCE > 0 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какова тенденция изменения среднего баланса по нашим кредитным картам за последние шесть месяцев?",
    "sql": "SELECT STRFTIME('%Y-%m', DATE('now', MONTHS_BALANCE || ' months')) AS month_year, AVG(AMT_BALANCE) FROM credit_card_balance WHERE MONTHS_BALANCE >= -6 GROUP BY month_year ORDER BY month_year ASC;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Как в среднем выглядит кредитный лимит по картам для активности по картам за последние полгода для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_CREDIT_LIMIT_ACTUAL) AS avg_amt_credit_limit_actual FROM credit_card_balance WHERE MONTHS_BALANCE > -6 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_credit_limit_actual DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Сравните отношение платежей к объёму выборок по картам для карт, по которым клиент сейчас пользуется кредитным лимитом по признаку «тип продукта по прошлым кредитам» на уровне клиентов, используя как данные по прошлым кредитам, так и агрегированную статистику по картам.",
    "sql": "WITH cc_client AS ( SELECT cc.SK_ID_CURR, AVG(CASE WHEN cc.AMT_CREDIT_LIMIT_ACTUAL > 0 THEN cc.AMT_BALANCE / cc.AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END) AS utilization, AVG(CASE WHEN cc.AMT_DRAWINGS_CURRENT > 0 THEN cc.AMT_PAYMENT_CURRENT / cc.AMT_DRAWINGS_CURRENT ELSE NULL END) AS pay_vs_spend_ratio FROM credit_card_balance cc WHERE cc.AMT_DRAWINGS_CURRENT > 0 GROUP BY cc.SK_ID_CURR ) SELECT pa.NAME_CONTRACT_TYPE AS group_key, AVG(pay_vs_spend_ratio) AS metric_value FROM previous_application pa JOIN cc_client ON pa.SK_ID_CURR = cc_client.SK_ID_CURR GROUP BY pa.NAME_CONTRACT_TYPE ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Рассчитайте метрику просроченной задолженности по пулу клиентов, имевших ранее отказанные аппликации.",
    "sql": "SELECT AVG(app.TARGET) * 100 FROM application_train_test app JOIN (SELECT DISTINCT SK_ID_CURR FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused') pa_refused ON app.SK_ID_CURR = pa_refused.SK_ID_CURR",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Представьте временной ряд среднего объема выданных кредитов, сгруппированный по датам принятия решения.",
    "sql": "SELECT DAYS_DECISION, AVG(AMT_CREDIT) FROM previous_application GROUP BY DAYS_DECISION ORDER BY DAYS_DECISION DESC LIMIT 50;",
    "visualization_type": "line",
    "source": "json"
  },
  {
    "question": "Сформируйте запрос с оконной суммой cum_payment по клиенту и номеру платежа, а затем агрегируйте средний накопленный объём платежей по клиенту (cum_payment) для первых 12 платежей в графике по по клиенту (SK_ID_CURR).",
    "sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE NUM_INSTALMENT_NUMBER <= 12 ) SELECT SK_ID_CURR AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY SK_ID_CURR ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя разницу между фактическим и плановым платежом для прошлых крупных кредитов с реальными платежами по графику для разных групп клиентов между сегментами доходности кредитных продуктов, если учитывать детальную историю платежей по рассрочке?",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.AMT_CREDIT > 50000 AND ip.AMT_INSTALMENT > 0 ) SELECT NAME_YIELD_GROUP AS group_key, AVG(payment_diff) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Отобразите общую номинальную стоимость активных кредитных обязательств.",
    "sql": "SELECT SUM(AMT_CREDIT) FROM application_train;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "По таблице installments_payments рассчитайте средний фактический платёж по рассрочке (AMT_PAYMENT) для записей с фактической оплатой (AMT_PAYMENT > 0) в разрезе по клиенту (SK_ID_CURR) с агрегацией по его рассрочкам.",
    "sql": "SELECT SK_ID_CURR AS group_key, AVG(AMT_PAYMENT) AS avg_amt_payment FROM installments_payments WHERE AMT_PAYMENT > 0 GROUP BY SK_ID_CURR ORDER BY avg_amt_payment DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Какая структура жилищного фонда характерна для клиентов с высокой вероятностью кредитного дефолта?",
    "sql": "SELECT NAME_HOUSING_TYPE, COUNT(SK_ID_CURR) FROM application_train WHERE TARGET = 1 GROUP BY NAME_HOUSING_TYPE ORDER BY COUNT(SK_ID_CURR) DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Интересно, сколько в среднем берут в кредит люди с разным уровнем образования?",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(AMT_CREDIT) FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY 2 DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как часто дефолтные и недефолтные клиенты запрашивают свою кредитную историю в БКИ за год?",
    "sql": "SELECT TARGET, AVG(AMT_REQ_CREDIT_BUREAU_YEAR) FROM application_train GROUP BY TARGET;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Как ведёт себя размер кредита по данным бюро для кредитов, которые пролонгировались для разных групп клиентов между более свежими и старыми кредитами?",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(AMT_CREDIT_SUM) AS avg_metric FROM bureau WHERE CNT_CREDIT_PROLONG > 0 GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как в среднем выглядит остаток задолженности по кредитным картам для карт, по которым вносились платежи для разных групп по месяцам наблюдения по кредитным картам?",
    "sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_BALANCE) AS avg_amt_balance FROM credit_card_balance WHERE AMT_PAYMENT_CURRENT > 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_balance DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется значение DAYS_INSTALMENT для второй половины клиентов по нечётности ID между разными группами между разными номерами платежей в графике рассрочки?",
    "sql": "SELECT NUM_INSTALMENT_NUMBER AS group_key, AVG(DAYS_INSTALMENT) AS avg_days_instalment FROM installments_payments WHERE SK_ID_CURR % 2 = 1 GROUP BY NUM_INSTALMENT_NUMBER ORDER BY avg_days_instalment DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Как там по старым заявкам? Много одобренных, отклоненных или отмененных?",
    "sql": "SELECT NAME_CONTRACT_STATUS, COUNT(*) FROM previous_application GROUP BY NAME_CONTRACT_STATUS;",
    "visualization_type": "pie",
    "source": "json"
  },
  {
    "question": "Определите среднее количество иждивенцев у заемщиков, допустивших дефолт, с разбивкой по возрастным когортам.",
    "sql": "SELECT CASE WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 25 THEN 'До 25' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 35 THEN '26-35' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 45 THEN '36-45' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 55 THEN '46-55' WHEN FLOOR(ABS(DAYS_BIRTH) / 365) <= 65 THEN '56-65' ELSE 'Старше 65' END AS AgeGroup, AVG(CNT_CHILDREN) AS AverageChildren FROM application_train WHERE TARGET = 1 GROUP BY AgeGroup ORDER BY AgeGroup;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сравните загрузку кредитных карт (utilization) для карт с просроченной задолженностью по признаку «уровень кредитного лимита», используя помесячную историю по кредитным картам и оконные агрегаты.",
    "sql": "WITH cc AS ( SELECT SK_ID_CURR, NAME_CONTRACT_STATUS, MONTHS_BALANCE, AMT_BALANCE, AMT_CREDIT_LIMIT_ACTUAL, AMT_DRAWINGS_CURRENT, AMT_PAYMENT_CURRENT, SK_DPD, SK_DPD_DEF, CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 0 THEN AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL ELSE NULL END AS utilization, SUM(AMT_BALANCE) OVER (PARTITION BY SK_ID_CURR ORDER BY MONTHS_BALANCE ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_balance FROM credit_card_balance WHERE SK_DPD > 0 ) SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(utilization) AS metric_value FROM cc GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY metric_value DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "А какая средняя сумма платежа по кредитке у тех, кто в итоге дефолтит?",
    "sql": "SELECT AVG(T2.AMT_PAYMENT_TOTAL_CURRENT) FROM application_train T1 JOIN credit_card_balance T2 ON T1.SK_ID_CURR = T2.SK_ID_CURR WHERE T1.TARGET = 1;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Каковы основные цели кредитования по одобренным контрактам?",
    "sql": "SELECT NAME_CASH_LOAN_PURPOSE, COUNT(*) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Approved' GROUP BY NAME_CASH_LOAN_PURPOSE ORDER BY COUNT(*) DESC LIMIT 10;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "По таблице bureau рассчитайте среднее количество пролонгаций по кредитам из бюро (CNT_CREDIT_PROLONG) для кредитов в условной валюте 'currency 1' в разрезе по давности открытия кредита (группировка по DAYS_CREDIT: recent/old).",
    "sql": "SELECT CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE CREDIT_CURRENCY = 'currency 1' GROUP BY CASE WHEN DAYS_CREDIT > -365 THEN 'recent' ELSE 'old' END ORDER BY avg_metric DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для новых клиентов (pa.NAME_CLIENT_TYPE = 'New') сгруппирует данные по доходности продукта (pa.NAME_YIELD_GROUP) и рассчитает среднюю долю просроченных платежей (delay_days > 0).",
    "sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'New' ) SELECT NAME_YIELD_GROUP AS group_key, AVG(CASE WHEN delay_days > 0 THEN 1.0 ELSE 0.0 END) AS metric_value FROM inst GROUP BY NAME_YIELD_GROUP ORDER BY metric_value DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните количество дней просрочки по кредитам из бюро для сравнительно новых кредитов в разрезе признака «статус кредита» по данным бюро кредитных историй.",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CREDIT_DAY_OVERDUE) AS avg_metric FROM bureau WHERE DAYS_CREDIT > -365 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Определите число действующих кредитных обязательств в бюро кредитных историй (БКИ) для заемщиков, классифицированных как дефолтные.",
    "sql": "SELECT COUNT(b.SK_BUREAU_ID) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR WHERE at.TARGET = 1 AND b.CREDIT_ACTIVE = 'Active';",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Подготовьте отчёт по POS_CASH_balance, где для POS-кредитов без серьёзной просрочки (SK_DPD_DEF = 0) и показан среднее значение показателя DPD по POS-кредитам (SK_DPD) по каждому значению CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(SK_DPD) AS avg_sk_dpd FROM POS_CASH_balance WHERE SK_DPD_DEF = 0 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_sk_dpd DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сравните объём текущих выборок по картам для карт с текущей задолженностью в разрезе признака «уровень кредитного лимита» по кредитным картам клиентов.",
    "sql": "SELECT CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_BALANCE > 0 GROUP BY CASE WHEN AMT_CREDIT_LIMIT_ACTUAL > 50000 THEN 'high_limit' ELSE 'low_or_medium_limit' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Как ведёт себя количество пролонгаций по кредитам из бюро для крупных кредитов (свыше 100 000) для разных групп клиентов между активными и закрытыми кредитами?",
    "sql": "SELECT CREDIT_ACTIVE AS group_key, AVG(CNT_CREDIT_PROLONG) AS avg_metric FROM bureau WHERE AMT_CREDIT_SUM > 100000 GROUP BY CREDIT_ACTIVE ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Хочу знать, сколько каждый наш клиент брал кредитов в БКИ до этого?",
    "sql": "SELECT SK_ID_CURR, COUNT(SK_BUREAU_ID) AS past_credit_count FROM bureau GROUP BY SK_ID_CURR ORDER BY past_credit_count DESC LIMIT 100;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Предоставьте перечень клиентов с активными просроченными обязательствами в Бюро кредитных историй.",
    "sql": "SELECT DISTINCT a.SK_ID_CURR, a.AMT_CREDIT, b.CREDIT_ACTIVE, b.CREDIT_DAY_OVERDUE FROM application_train a JOIN bureau b ON a.SK_ID_CURR = b.SK_ID_CURR WHERE b.CREDIT_ACTIVE = 'Active' AND b.CREDIT_DAY_OVERDUE > 0 LIMIT 10;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Сравните величина DAYS_DECISION по предыдущим кредитам для отказанных предыдущих кредитов для разных категорий по признаку «тип портфеля» в прошлых заявках клиентов.",
    "sql": "SELECT NAME_PORTFOLIO AS group_key, AVG(DAYS_DECISION) AS avg_days_decision FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY NAME_PORTFOLIO ORDER BY avg_days_decision DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Сравните аннуитетный платёж по предыдущим кредитам для клиентов, которые уже брали кредит ранее для разных категорий по признаку «час принятия решения по заявке» в прошлых заявках клиентов.",
    "sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE NAME_CLIENT_TYPE = 'Repeater' GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_annuity DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "Каков средний возраст клиентов, сегментированный по уровню их образования?",
    "sql": "SELECT NAME_EDUCATION_TYPE, AVG(ABS(DAYS_BIRTH)/365.25) AS average_age FROM application_train GROUP BY NAME_EDUCATION_TYPE ORDER BY average_age DESC;",
    "visualization_type": "bar",
    "source": "json"
  },
  {
    "question": "Сформируйте витрину по previous_application, где для решений, принятых за последний год (DAYS_DECISION > -365) и по каждому значению поля NAME_PRODUCT_TYPE показывается средний размер одобренного кредита по предыдущим обращениям.",
    "sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_CREDIT) AS avg_amt_credit FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_credit DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Как в среднем изменяется запрошенный размер кредита по заявке для прошлых заявок, принятых более года назад между клиентами между днями недели, когда принималось решение по заявке?",
    "sql": "SELECT WEEKDAY_APPR_PROCESS_START AS group_key, AVG(AMT_APPLICATION) AS avg_amt_application FROM previous_application WHERE DAYS_DECISION <= -365 GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY avg_amt_application DESC;",
    "visualization_type": "pie",
    "source": "csv"
  },
  {
    "question": "Сделайте агрегированный срез по credit_card_balance: для карт с лимитом до 50 000, покажите средний объём текущих выборок по картам (AMT_DRAWINGS_CURRENT) по каждому значению поля CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END.",
    "sql": "SELECT CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END AS group_key, AVG(AMT_DRAWINGS_CURRENT) AS avg_amt_drawings_current FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL <= 50000 GROUP BY CASE WHEN AMT_PAYMENT_CURRENT > AMT_DRAWINGS_CURRENT THEN 'net_repayment' ELSE 'net_spender' END ORDER BY avg_amt_drawings_current DESC;",
    "visualization_type": "table",
    "source": "csv"
  },
  {
    "question": "По таблице POS_CASH_balance рассчитайте среднее количество оставшихся платежей по POS-кредитам (CNT_INSTALMENT_FUTURE) для POS-кредитов с количеством платежей до 6 (CNT_INSTALMENT <= 6) в разрезе по наличию просрочки DPD по POS-кредиту.",
    "sql": "SELECT CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END AS group_key, AVG(CNT_INSTALMENT_FUTURE) AS avg_cnt_instalment_future FROM POS_CASH_balance WHERE CNT_INSTALMENT <= 6 GROUP BY CASE WHEN SK_DPD > 0 THEN 'with_dpd' ELSE 'no_dpd' END ORDER BY avg_cnt_instalment_future DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "По таблице bureau_balance рассчитайте среднее значение MONTHS_BALANCE по записям bureau_balance для месяцев без информации (STATUS = 'X') в разрезе по статусу STATUS в bureau_balance.",
    "sql": "SELECT STATUS AS group_key, AVG(MONTHS_BALANCE) AS avg_metric FROM bureau_balance WHERE STATUS = 'X' GROUP BY STATUS ORDER BY avg_metric DESC;",
    "visualization_type": "bar",
    "source": "csv"
  },
  {
    "question": "Какова средняя длительность кредитов, информация о которых содержится в БКИ?",
    "sql": "SELECT AVG(ABS(DAYS_CREDIT)) FROM bureau;",
    "visualization_type": "table",
    "source": "json"
  },
  {
    "question": "Покажи средний коэффициент погашения кредитной карты (AMT_PAYMENT_TOTAL_CURRENT / AMT_BALANCE) для клиентов.",
    "sql": "SELECT AVG(AMT_PAYMENT_TOTAL_CURRENT / AMT_BALANCE) FROM credit_card_balance WHERE AMT_BALANCE > 0 AND AMT_PAYMENT_TOTAL_CURRENT IS NOT NULL;",
    "visualization_type": "table",
    "source": "json"
  }
]