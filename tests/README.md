# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SQL Agent

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL –∑–∞–ø—Ä–æ—Å–æ–≤.

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (`quick_test.py`)

–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä–∫–µ (10 —Ç–µ—Å—Ç–æ–≤ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞):

```bash
python tests/quick_test.py
```

### 2. –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (`test_accuracy.py`)

–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö:

```bash
python tests/test_accuracy.py
```

## üìä –î–∞—Ç–∞—Å–µ—Ç—ã

### 1. CSV –¥–∞—Ç–∞—Å–µ—Ç (`home_credit_qa_11000_with_hard_joins.csv`)

- **–§–æ—Ä–º–∞—Ç:** CSV —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ `Question`, `SQL Query`, `Visualization Type`
- **–†–∞–∑–º–µ—Ä:** ~11,000 –≤–æ–ø—Ä–æ—Å–æ–≤
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:** –°–ª–æ–∂–Ω—ã–µ JOIN –∑–∞–ø—Ä–æ—Å—ã

### 2. JSON –¥–∞—Ç–∞—Å–µ—Ç (`result10000.json`)

- **–§–æ—Ä–º–∞—Ç:** JSON –º–∞—Å—Å–∏–≤ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ `natural_language_query`, `sql_query`, `visualization_type`
- **–†–∞–∑–º–µ—Ä:** ~10,000 –≤–æ–ø—Ä–æ—Å–æ–≤
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:** –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ü–µ–Ω–∫–∏

–¢–µ—Å—Ç—ã –≤—ã—á–∏—Å–ª—è—é—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:

1. **Success Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **Exact Match Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π SQL
3. **Average Similarity** - —Å—Ä–µ–¥–Ω—è—è —Å—Ö–æ–∂–µ—Å—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ SQL —Å –æ–∂–∏–¥–∞–µ–º—ã–º
4. **Tables Match Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ç–∞–±–ª–∏—Ü
5. **Semantic Correctness** - –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–ø—Ä–æ—Å–æ–≤, –¥–∞—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
6. **Generation Time** - —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
7. **Retry Count** - —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏
2. –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)
3. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`pip install -r requirements.txt`)

### –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)

```bash
cd /home/dark/Documents/GitHub/SQL_Agent_proj
python tests/quick_test.py
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç —Ç–µ—Å—Ç—ã –Ω–∞ –ø–µ—Ä–≤—ã—Ö 10 –ø—Ä–∏–º–µ—Ä–∞—Ö –∏–∑ –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.

### –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç

```bash
python tests/test_accuracy.py
```

**–í–Ω–∏–º–∞–Ω–∏–µ:** –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –¥–ª—è 10,000+ —Ç–µ—Å—Ç–æ–≤).

## üìÅ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `tests/results/`:

- `quick_csv_test.json` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞ CSV
- `quick_json_test.json` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞ JSON
- `csv_test_results.json` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ CSV
- `json_test_results.json` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ JSON

–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –ü–æ–ª–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ SQL

## üîç –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
================================================================================
üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø - CSV Dataset
================================================================================

üìà –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
   –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 10
   –£—Å–ø–µ—à–Ω—ã—Ö: 9 (90.0%)
   –ù–µ—É–¥–∞—á–Ω—ã—Ö: 1 (10.0%)

üéØ –¢–æ—á–Ω–æ—Å—Ç—å SQL:
   –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: 3 (33.3%)
   –°—Ä–µ–¥–Ω—è—è —Å—Ö–æ–∂–µ—Å—Ç—å: 78.5%
   –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü: 88.9%
   –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å: 77.8%

‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
   –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: 3.45s
   –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ retry: 0.2
   –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 82.3%
   –û–±—â–µ–µ –≤—Ä–µ–º—è: 34.5s
   –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: 0.29 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫

================================================================================
```

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤

–í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ:

```python
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤
num_tests = 50  # –í–º–µ—Å—Ç–æ 10

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ retry
max_retries = 3  # –í–º–µ—Å—Ç–æ 2

# –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∞–Ω–∞–ª–∏–∑
enable_analysis = True
```

## üìù –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –•–æ—Ä–æ—à–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- Success Rate > 90%
- Exact Match Rate > 30%
- Average Similarity > 75%
- Semantic Correctness > 70%

### –ß—Ç–æ —É–ª—É—á—à–∏—Ç—å:
- –ï—Å–ª–∏ Success Rate –Ω–∏–∑–∫–∏–π - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏ LLM
- –ï—Å–ª–∏ Exact Match –Ω–∏–∑–∫–∏–π, –Ω–æ Similarity –≤—ã—Å–æ–∫–∏–π - SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ï—Å–ª–∏ Semantic Correctness –Ω–∏–∑–∫–∏–π - –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –Ω–æ –¥–∞—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ó–∞–ø—É—â–µ–Ω–∞ –ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (docker compose up -d)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã –ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env
- –î–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```

### –û—à–∏–±–∫–∞ LLM API
```
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞ –≤ .env
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API (–∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ)
- –õ–∏–º–∏—Ç—ã API (rate limits)
```

### –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
```
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ (num_tests)
- –û—Ç–∫–ª—é—á–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ (enable_analysis=False)
- –£–º–µ–Ω—å—à–∏—Ç–µ retry (max_retries=1)
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –°–º. `docs/UNIVERSAL_SQL_AGENT.md` –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
- –°–º. `docs/MIGRATION_GUIDE.md` –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∏–≥—Ä–∞—Ü–∏–∏

