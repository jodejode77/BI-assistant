{
  "stats": {
    "total": 10,
    "worked": 0,
    "executed": 0,
    "similar_result": 0,
    "errors": 10,
    "total_time": 62.10880374908447,
    "avg_time_per_example": 6.210880374908447,
    "success_rate": {
      "worked": 0.0,
      "executed": 0.0,
      "similar_result": 0.0
    }
  },
  "results": [
    {
      "index": 1,
      "question": "Проанализируйте средний размер одобренного кредита по семейным статусам для сегмента клиентов с высшим образованием для оптимизации кредитных предложений.",
      "expected_sql": "SELECT at.NAME_FAMILY_STATUS, AVG(pa.AMT_CREDIT) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE at.NAME_EDUCATION_TYPE = 'Higher education' AND pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY at.NAME_FAMILY_STATUS ORDER BY AVG(pa.AMT_CREDIT) DESC;",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "[Errno 32] Broken pipe",
      "execution_time": 38.30736541748047,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 2,
      "question": "Сравнительный анализ среднего совокупного дохода для групп клиентов, обладающих автомобилем и не имеющих его.",
      "expected_sql": "SELECT FLAG_OWN_CAR, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY FLAG_OWN_CAR;",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "[Errno 32] Broken pipe",
      "execution_time": 1.4845309257507324,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 3,
      "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов с DPD > 0 в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
      "expected_sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "[Errno 32] Broken pipe",
      "execution_time": 2.0545103549957275,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 4,
      "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для повторных клиентов (pa.NAME_CLIENT_TYPE = 'Repeater') сгруппирует данные по признаку просрочки платежа (delay_days > 0) и рассчитает средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client).",
      "expected_sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "[Errno 32] Broken pipe",
      "execution_time": 8.854198455810547,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 5,
      "question": "Когда к нам чаще всего обращаются за кредитами в течение дня?",
      "expected_sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY COUNT(SK_ID_CURR) DESC;",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "[Errno 32] Broken pipe",
      "execution_time": 0.8802189826965332,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 6,
      "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
      "expected_sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_down_payment DESC;",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "[Errno 32] Broken pipe",
      "execution_time": 2.128278970718384,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 7,
      "question": "Сделайте агрегированный срез по credit_card_balance: для карт без текущего остатка (AMT_BALANCE = 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля MONTHS_BALANCE.",
      "expected_sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "[Errno 32] Broken pipe",
      "execution_time": 3.1304562091827393,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 8,
      "question": "В среднем, насколько сильно люди используют свои кредитные лимиты по картам?",
      "expected_sql": "SELECT AVG(AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL) * 100 FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "[Errno 32] Broken pipe",
      "execution_time": 2.108574628829956,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 9,
      "question": "Какой день недели демонстрирует наибольшую/наименьшую частоту одобрения или отказа по кредитным заявкам?",
      "expected_sql": "SELECT WEEKDAY_APPR_PROCESS_START, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS approved_count, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS refused_count FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY approved_count DESC;",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "[Errno 32] Broken pipe",
      "execution_time": 1.717810869216919,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 10,
      "question": "Какова разница в среднем уровне дохода (AMT_INCOME_TOTAL) между клиентами, склонными к дефолту, и теми, кто таковым не является?",
      "expected_sql": "SELECT TARGET, AVG(AMT_INCOME_TOTAL) FROM application_train_test GROUP BY TARGET;",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "[Errno 32] Broken pipe",
      "execution_time": 1.4415547847747803,
      "rows_returned": 0,
      "comparison": {}
    }
  ],
  "timestamp": "2025-11-19T23:10:18.977535",
  "benchmark_file": "/home/dark/Documents/GitHub/SQL_Agent_proj/tests/benchmark_3000.json"
}