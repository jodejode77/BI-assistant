{
  "stats": {
    "total": 20,
    "worked": 18,
    "executed": 18,
    "similar_result": 0,
    "errors": 2,
    "total_time": 395.6796295642853,
    "avg_time_per_example": 19.783981478214265,
    "success_rate": {
      "worked": 90.0,
      "executed": 90.0,
      "similar_result": 0.0
    }
  },
  "results": [
    {
      "index": 1,
      "question": "Проанализируйте средний размер одобренного кредита по семейным статусам для сегмента клиентов с высшим образованием для оптимизации кредитных предложений.",
      "expected_sql": "SELECT at.NAME_FAMILY_STATUS, AVG(pa.AMT_CREDIT) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE at.NAME_EDUCATION_TYPE = 'Higher education' AND pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY at.NAME_FAMILY_STATUS ORDER BY AVG(pa.AMT_CREDIT) DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT T1.name_family_status, AVG(CAST(T2.amt_credit AS numeric)) AS avg_approved_loan_size FROM application_train AS T2 INNER JOIN application_train AS T1 ON T2.sk_id_curr = T1.sk_id_curr WHERE T2.target = 0 AND T1.name_education_type = 'Higher education' GROUP BY T1.name_family_status LIMIT 100",
      "error": null,
      "execution_time": 23.249105215072632,
      "rows_returned": 6,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 6,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...ME_FAMILY_STATUS ORDER BY AVG(pa.AMT_CREDIT) DESC; LIMIT 100\n                                                              ^\n\n[SQL: SELECT at.NAME_FAMILY_STATUS, AVG(pa.AMT_CREDIT) FROM application_train at JOIN previous_application pa ON at.SK_ID_CURR = pa.SK_ID_CURR WHERE at.NAME_EDUCATION_TYPE = 'Higher education' AND pa.NAME_CONTRACT_STATUS = 'Approved' GROUP BY at.NAME_FAMILY_STATUS ORDER BY AVG(pa.AMT_CREDIT) DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 2,
      "question": "Сравнительный анализ среднего совокупного дохода для групп клиентов, обладающих автомобилем и не имеющих его.",
      "expected_sql": "SELECT FLAG_OWN_CAR, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY FLAG_OWN_CAR;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT flag_own_car, AVG(CAST(amt_income_total AS numeric)) AS average_income FROM application_train GROUP BY flag_own_car LIMIT 100",
      "error": null,
      "execution_time": 15.2225182056427,
      "rows_returned": 2,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 2,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...TAL) FROM application_train GROUP BY FLAG_OWN_CAR; LIMIT 100\n                                                              ^\n\n[SQL: SELECT FLAG_OWN_CAR, AVG(AMT_INCOME_TOTAL) FROM application_train GROUP BY FLAG_OWN_CAR; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 3,
      "question": "По таблице POS_CASH_balance рассчитайте среднее значение показателя DPD_DEF по POS-кредитам (SK_DPD_DEF) для POS-кредитов с DPD > 0 в разрезе по клиенту (SK_ID_CURR) с агрегацией по POS-записям.",
      "expected_sql": "SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT sk_id_curr, AVG(sk_dpd_def) AS avg_sk_dpd_def FROM pos_cash_balance WHERE sk_dpd > 0 GROUP BY sk_id_curr LIMIT 100",
      "error": null,
      "execution_time": 44.75260543823242,
      "rows_returned": 100,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 100,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ... GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC; LIMIT 100\n                                                              ^\n\n[SQL: SELECT SK_ID_CURR AS group_key, AVG(SK_DPD_DEF) AS avg_sk_dpd_def FROM POS_CASH_balance WHERE SK_DPD > 0 GROUP BY SK_ID_CURR ORDER BY avg_sk_dpd_def DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 4,
      "question": "Постройте сложный SQL-запрос (WITH + JOIN) по previous_application и installments_payments, который для выборки для повторных клиентов (pa.NAME_CLIENT_TYPE = 'Repeater') сгруппирует данные по признаку просрочки платежа (delay_days > 0) и рассчитает средний по сегменту показатель средней задержки платежей на клиента (avg_delay_per_client).",
      "expected_sql": "WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "WITH PaymentDelay AS ( SELECT ip.sk_id_curr, (ip.days_entry_payment - ip.days_instalment) AS delay_days FROM installments_payments AS ip WHERE ip.days_entry_payment > ip.days_instalment ) SELECT AVG(pd.delay_days) AS avg_delay_per_client FROM PaymentDelay AS pd WHERE pd.delay_days > 0 GROUP BY pd.sk_id_curr LIMIT 100",
      "error": null,
      "execution_time": 62.83863544464111,
      "rows_returned": 100,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 100,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...te' ELSE 'on_time' END ORDER BY metric_value DESC; LIMIT 100\n                                                              ^\n\n[SQL: WITH inst AS ( SELECT pa.SK_ID_CURR, pa.NAME_CONTRACT_TYPE, pa.NAME_CLIENT_TYPE, pa.CHANNEL_TYPE, pa.NAME_YIELD_GROUP, ip.NUM_INSTALMENT_NUMBER, ip.DAYS_INSTALMENT, ip.DAYS_ENTRY_PAYMENT, ip.AMT_INSTALMENT, ip.AMT_PAYMENT, (ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) AS delay_days, (ip.AMT_PAYMENT - ip.AMT_INSTALMENT) AS payment_diff, AVG(ip.DAYS_ENTRY_PAYMENT - ip.DAYS_INSTALMENT) OVER (PARTITION BY pa.SK_ID_CURR) AS avg_delay_per_client FROM previous_application pa JOIN installments_payments ip ON pa.SK_ID_PREV = ip.SK_ID_PREV WHERE pa.NAME_CLIENT_TYPE = 'Repeater' ) SELECT CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END AS group_key, AVG(avg_delay_per_client) AS metric_value FROM inst GROUP BY CASE WHEN delay_days > 0 THEN 'late' ELSE 'on_time' END ORDER BY metric_value DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 5,
      "question": "Когда к нам чаще всего обращаются за кредитами в течение дня?",
      "expected_sql": "SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY COUNT(SK_ID_CURR) DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT hour_appr_process_start, COUNT(sk_id_prev) AS loan_count FROM previous_application GROUP BY hour_appr_process_start ORDER BY hour_appr_process_start LIMIT 100",
      "error": null,
      "execution_time": 32.55974340438843,
      "rows_returned": 24,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 24,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...PPR_PROCESS_START ORDER BY COUNT(SK_ID_CURR) DESC; LIMIT 100\n                                                              ^\n\n[SQL: SELECT HOUR_APPR_PROCESS_START, COUNT(SK_ID_CURR) FROM application_train GROUP BY HOUR_APPR_PROCESS_START ORDER BY COUNT(SK_ID_CURR) DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 6,
      "question": "Как в среднем изменяется первоначальный взнос по предыдущим кредитам для прошлых кредитов среднего размера (10 000–50 000) между клиентами между разными каналами продаж (отделение, интернет, партнер и т.д.)?",
      "expected_sql": "SELECT CHANNEL_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_down_payment DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT AVG(CAST(T1.amt_down_payment AS numeric)) AS average_down_payment, T1.channel_type FROM previous_application AS T1 WHERE T1.amt_credit BETWEEN 10000 AND 50000 GROUP BY T1.channel_type LIMIT 100",
      "error": null,
      "execution_time": 16.145490646362305,
      "rows_returned": 7,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 7,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...Y CHANNEL_TYPE ORDER BY avg_amt_down_payment DESC; LIMIT 100\n                                                              ^\n\n[SQL: SELECT CHANNEL_TYPE AS group_key, AVG(AMT_DOWN_PAYMENT) AS avg_amt_down_payment FROM previous_application WHERE AMT_CREDIT BETWEEN 10000 AND 50000 GROUP BY CHANNEL_TYPE ORDER BY avg_amt_down_payment DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 7,
      "question": "Сделайте агрегированный срез по credit_card_balance: для карт без текущего остатка (AMT_BALANCE = 0), покажите средний объём текущих платежей по картам (AMT_PAYMENT_CURRENT) по каждому значению поля MONTHS_BALANCE.",
      "expected_sql": "SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT MONTHS_BALANCE, AVG(CAST(AMT_PAYMENT_CURRENT AS NUMERIC)) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY MONTHS_BALANCE LIMIT 100",
      "error": null,
      "execution_time": 24.69850516319275,
      "rows_returned": 96,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 96,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...THS_BALANCE ORDER BY avg_amt_payment_current DESC; LIMIT 100\n                                                              ^\n\n[SQL: SELECT MONTHS_BALANCE AS group_key, AVG(AMT_PAYMENT_CURRENT) AS avg_amt_payment_current FROM credit_card_balance WHERE AMT_BALANCE = 0 GROUP BY MONTHS_BALANCE ORDER BY avg_amt_payment_current DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 8,
      "question": "В среднем, насколько сильно люди используют свои кредитные лимиты по картам?",
      "expected_sql": "SELECT AVG(AMT_BALANCE / AMT_CREDIT_LIMIT_ACTUAL) * 100 FROM credit_card_balance WHERE AMT_CREDIT_LIMIT_ACTUAL > 0",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "(psycopg2.errors.DivisionByZero) division by zero\n\n[SQL: SELECT AVG(CAST(amt_balance AS numeric) / CAST(amt_credit_limit_actual AS numeric)) AS avg_utilization_rate FROM credit_card_balance WHERE amt_credit_limit_actual IS NOT NULL AND amt_balance IS NOT NULL LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/9h9h)",
      "execution_time": 2.1392433643341064,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 9,
      "question": "Какой день недели демонстрирует наибольшую/наименьшую частоту одобрения или отказа по кредитным заявкам?",
      "expected_sql": "SELECT WEEKDAY_APPR_PROCESS_START, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS approved_count, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS refused_count FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY approved_count DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "WITH DailyApplicationStatus AS ( SELECT CASE WHEN weekday_appr_process_start = 'Monday' THEN 1 WHEN weekday_appr_process_start = 'Tuesday' THEN 2 WHEN weekday_appr_process_start = 'Wednesday' THEN 3 WHEN weekday_appr_process_start = 'Thursday' THEN 4 WHEN weekday_appr_process_start = 'Friday' THEN 5 WHEN weekday_appr_process_start = 'Saturday' THEN 6 WHEN weekday_appr_process_start = 'Sunday' THEN 7 ELSE 0 END AS weekday_num, weekday_appr_process_start, SUM(CASE WHEN name_contract_status = 'APPROVED' THEN 1 ELSE 0 END) AS approved_count, SUM(CASE WHEN name_contract_status = 'REFUSED' THEN 1 ELSE 0 END) AS rejected_count FROM previous_application GROUP BY weekday_num, weekday_appr_process_start ), RankedApplications AS ( SELECT weekday_appr_process_start, approved_count, rejected_count, ROW_NUMBER() OVER (ORDER BY approved_count DESC) AS rn_approved_desc, ROW_NUMBER() OVER (ORDER BY approved_count ASC) AS rn_approved_asc, ROW_NUMBER() OVER (ORDER BY rejected_count DESC) AS rn_rejected_desc, ROW_NUMBER() OVER (ORDER BY rejected_count ASC) AS rn_rejected_asc FROM DailyApplicationStatus ) SELECT 'Highest Approved' AS category, weekday_appr_process_start, approved_count AS count FROM RankedApplications WHERE rn_approved_desc = 1 UNION ALL SELECT 'Lowest Approved' AS category, weekday_appr_process_start, approved_count AS count FROM RankedApplications WHERE rn_approved_asc = 1 UNION ALL SELECT 'Highest Rejected' AS category, weekday_appr_process_start, rejected_count AS count FROM RankedApplications WHERE rn_rejected_desc = 1 UNION ALL SELECT 'Lowest Rejected' AS category, weekday_appr_process_start, rejected_count AS count FROM RankedApplications WHERE rn_rejected_asc = 1 LIMIT 100",
      "error": null,
      "execution_time": 17.43835997581482,
      "rows_returned": 4,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 4,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...Y_APPR_PROCESS_START ORDER BY approved_count DESC; LIMIT 100\n                                                              ^\n\n[SQL: SELECT WEEKDAY_APPR_PROCESS_START, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Approved' THEN 1 ELSE 0 END) AS approved_count, SUM(CASE WHEN NAME_CONTRACT_STATUS = 'Refused' THEN 1 ELSE 0 END) AS refused_count FROM previous_application GROUP BY WEEKDAY_APPR_PROCESS_START ORDER BY approved_count DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 10,
      "question": "Какова разница в среднем уровне дохода (AMT_INCOME_TOTAL) между клиентами, склонными к дефолту, и теми, кто таковым не является?",
      "expected_sql": "SELECT TARGET, AVG(AMT_INCOME_TOTAL) FROM application_train_test GROUP BY TARGET;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT CASE WHEN TARGET = 1 THEN 'Prone to Default' ELSE 'Not Prone to Default' END AS default_category, AVG(CAST(AMT_INCOME_TOTAL AS numeric)) AS average_income FROM application_train GROUP BY TARGET LIMIT 100",
      "error": null,
      "execution_time": 13.835843086242676,
      "rows_returned": 2,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 2,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...OTAL) FROM application_train_test GROUP BY TARGET; LIMIT 100\n                                                              ^\n\n[SQL: SELECT TARGET, AVG(AMT_INCOME_TOTAL) FROM application_train_test GROUP BY TARGET; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 11,
      "question": "По таблице previous_application рассчитайте средний размер аннуитетного платежа по предыдущим кредитам для заявок, где запрошенная сумма больше одобренной (AMT_APPLICATION > AMT_CREDIT) в разрезе по типу продукта (NAME_PRODUCT_TYPE).",
      "expected_sql": "SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_annuity DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT name_product_type, AVG(CAST(amt_annuity AS numeric)) AS avg_amt_annuity FROM previous_application WHERE amt_application > amt_credit GROUP BY name_product_type LIMIT 100",
      "error": null,
      "execution_time": 22.025392532348633,
      "rows_returned": 2,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 2,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...Y NAME_PRODUCT_TYPE ORDER BY avg_amt_annuity DESC; LIMIT 100\n                                                              ^\n\n[SQL: SELECT NAME_PRODUCT_TYPE AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE AMT_APPLICATION > AMT_CREDIT GROUP BY NAME_PRODUCT_TYPE ORDER BY avg_amt_annuity DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 12,
      "question": "Как в среднем изменяется аннуитетный платёж по предыдущим кредитам для предыдущих заявок примерно за последний год между клиентами между часами дня, когда принималось решение по заявке?",
      "expected_sql": "SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_annuity DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT hour_appr_process_start, AVG(CAST(amt_annuity AS numeric)) AS avg_annuity FROM previous_application GROUP BY hour_appr_process_start ORDER BY hour_appr_process_start LIMIT 100",
      "error": null,
      "execution_time": 17.221632957458496,
      "rows_returned": 24,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 24,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ..._APPR_PROCESS_START ORDER BY avg_amt_annuity DESC; LIMIT 100\n                                                              ^\n\n[SQL: SELECT HOUR_APPR_PROCESS_START AS group_key, AVG(AMT_ANNUITY) AS avg_amt_annuity FROM previous_application WHERE DAYS_DECISION > -365 GROUP BY HOUR_APPR_PROCESS_START ORDER BY avg_amt_annuity DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 13,
      "question": "Представьте анализ распределения активных и закрытых кредитов из БКИ в разрезе гендерного состава заемщиков.",
      "expected_sql": "SELECT at.CODE_GENDER, b.CREDIT_ACTIVE, COUNT(b.SK_BUREAU_ID) FROM application_train at JOIN bureau b ON at.SK_ID_CURR = b.SK_ID_CURR GROUP BY at.CODE_GENDER, b.CREDIT_ACTIVE;",
      "worked": false,
      "executed": false,
      "similar_result": false,
      "generated_sql": null,
      "error": "SQL generation failed after 3 attempts. Last error: (psycopg2.errors.UndefinedTable) relation \"credit_bureau_data\" does not exist\nLINE 1: ...tatus = 'closed' THEN 1 END) AS closed_loans FROM credit_bur...\n                                                             ^\n\n[SQL: EXPLAIN SELECT borrower_gender, COUNT(CASE WHEN loan_status = 'active' THEN 1 END) AS active_loans, COUNT(CASE WHEN loan_status = 'closed' THEN 1 END) AS closed_loans FROM credit_bureau_data GROUP BY borrower_gender LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)",
      "execution_time": 6.663619756698608,
      "rows_returned": 0,
      "comparison": {}
    },
    {
      "index": 14,
      "question": "Как распределяется накопленный объём платежей по клиенту для рассрочек, относящихся к последнему году между различными сегментами между разными версиями графиков платежей в истории рассрочек клиентов?",
      "expected_sql": "WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT sk_id_curr, num_instalment_version, SUM(CAST(amt_payment AS numeric)) AS total_payment_volume FROM installments_payments WHERE days_entry_payment >= -365 GROUP BY sk_id_curr, num_instalment_version LIMIT 100",
      "error": null,
      "execution_time": 31.50578212738037,
      "rows_returned": 100,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 100,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...NUM_INSTALMENT_VERSION ORDER BY metric_value DESC; LIMIT 100\n                                                              ^\n\n[SQL: WITH inst AS ( SELECT SK_ID_CURR, SK_ID_PREV, NUM_INSTALMENT_VERSION, NUM_INSTALMENT_NUMBER, DAYS_INSTALMENT, DAYS_ENTRY_PAYMENT, AMT_INSTALMENT, AMT_PAYMENT, (AMT_PAYMENT - AMT_INSTALMENT) AS payment_diff, (DAYS_ENTRY_PAYMENT - DAYS_INSTALMENT) AS delay_days, SUM(AMT_PAYMENT) OVER (PARTITION BY SK_ID_CURR ORDER BY NUM_INSTALMENT_NUMBER ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cum_payment FROM installments_payments WHERE DAYS_INSTALMENT BETWEEN -365 AND 0 ) SELECT NUM_INSTALMENT_VERSION AS group_key, AVG(cum_payment) AS metric_value FROM inst GROUP BY NUM_INSTALMENT_VERSION ORDER BY metric_value DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 15,
      "question": "Определить ключевые факторы, ведущие к негативным решениям по предыдущим обращениям.",
      "expected_sql": "SELECT CODE_REJECT_REASON, COUNT(*) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused' GROUP BY CODE_REJECT_REASON ORDER BY COUNT(*) DESC LIMIT 10;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT code_reject_reason FROM previous_application WHERE name_contract_status = 'XNA' LIMIT 100",
      "error": null,
      "execution_time": 5.759368181228638,
      "rows_returned": 0,
      "comparison": {
        "error": "No data returned"
      }
    },
    {
      "index": 16,
      "question": "Какова доля клиентских обращений, поступивших в течение рабочего дня (с 9 утра до 6 вечера), от общего числа всех поданных заявлений?",
      "expected_sql": "SELECT (SUM(CASE WHEN HOUR_APPR_PROCESS_START BETWEEN 9 AND 18 THEN 1 ELSE 0 END) * 100.0) / COUNT(*) FROM application_train_test;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT CAST(SUM(CASE WHEN T1.hour_appr_process_start BETWEEN 9 AND 18 THEN 1 ELSE NULL END) AS REAL) * 100.0 / COUNT(T1.sk_id_prev) FROM previous_application AS T1 LIMIT 100",
      "error": null,
      "execution_time": 7.948017120361328,
      "rows_returned": 1,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 1,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...) * 100.0) / COUNT(*) FROM application_train_test; LIMIT 100\n                                                              ^\n\n[SQL: SELECT (SUM(CASE WHEN HOUR_APPR_PROCESS_START BETWEEN 9 AND 18 THEN 1 ELSE 0 END) * 100.0) / COUNT(*) FROM application_train_test; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 17,
      "question": "Какова общая сумма задолженности, которая была зафиксирована по кредитам, ныне классифицированным как 'закрытые' в БКИ?",
      "expected_sql": "SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Closed';",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT SUM(CAST(T1.amt_credit_sum_debt AS numeric)) AS sum_debt_closed FROM bureau AS T1 WHERE T1.credit_active = 'Closed' LIMIT 100",
      "error": null,
      "execution_time": 7.563525676727295,
      "rows_returned": 1,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 1,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ..._DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Closed'; LIMIT 100\n                                                              ^\n\n[SQL: SELECT SUM(AMT_CREDIT_SUM_DEBT) FROM bureau WHERE CREDIT_ACTIVE = 'Closed'; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 18,
      "question": "Сколько в среднем просили те, кому мы отказали в прошлый раз?",
      "expected_sql": "SELECT AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused';",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT AVG(CAST(T1.AMT_APPLICATION AS NUMERIC)) AS avg_amount_requested FROM previous_application AS T1 WHERE T1.NAME_CONTRACT_STATUS = 'rejected' LIMIT 100",
      "error": null,
      "execution_time": 8.479310750961304,
      "rows_returned": 1,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 1,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...pplication WHERE NAME_CONTRACT_STATUS = 'Refused'; LIMIT 100\n                                                              ^\n\n[SQL: SELECT AVG(AMT_APPLICATION) FROM previous_application WHERE NAME_CONTRACT_STATUS = 'Refused'; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 19,
      "question": "Постройте агрегированный отчёт по bureau, где для кредитов с заполненным аннуитетом (AMT_ANNUITY IS NOT NULL) и по каждому значению группировки (CREDIT_TYPE) рассчитывается средний объём текущей задолженности по кредитам из бюро (AMT_CREDIT_SUM_DEBT).",
      "expected_sql": "SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC;",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT T1.AMT_CREDIT FROM application_train AS T1 WHERE T1.TARGET = 0 LIMIT 100",
      "error": null,
      "execution_time": 13.678601264953613,
      "rows_returned": 100,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 100,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.SyntaxError) syntax error at or near \"LIMIT\"\nLINE 1: ...ULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC; LIMIT 100\n                                                              ^\n\n[SQL: SELECT CREDIT_TYPE AS group_key, AVG(AMT_CREDIT_SUM_DEBT) AS avg_metric FROM bureau WHERE AMT_ANNUITY IS NOT NULL GROUP BY CREDIT_TYPE ORDER BY avg_metric DESC; LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    },
    {
      "index": 20,
      "question": "Есть ли зависимость между количеством детей у человека и тем, как он платит по кредитам?",
      "expected_sql": "SELECT CNT_CHILDREN, AVG(TARGET) * 100 FROM application_train_test GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN",
      "worked": true,
      "executed": true,
      "similar_result": false,
      "generated_sql": "SELECT T1.cnt_children, CASE WHEN T2.target = 0 THEN 'On-Time' WHEN T2.target = 1 THEN 'Defaulted' ELSE 'Unknown' END AS repayment_status, COUNT(T2.sk_id_curr) AS loan_count FROM application_train AS T2 LEFT JOIN application_train AS T1 ON T2.sk_id_curr = T1.sk_id_curr GROUP BY T1.cnt_children, repayment_status ORDER BY T1.cnt_children, loan_count DESC LIMIT 100",
      "error": null,
      "execution_time": 21.89026689529419,
      "rows_returned": 22,
      "comparison": {
        "similar": false,
        "rows_match": false,
        "columns_match": false,
        "values_similar": false,
        "expected_rows": 0,
        "generated_rows": 22,
        "similarity_score": 0.0,
        "error": "(psycopg2.errors.UndefinedTable) relation \"application_train_test\" does not exist\nLINE 1: SELECT CNT_CHILDREN, AVG(TARGET) * 100 FROM application_trai...\n                                                    ^\n\n[SQL: SELECT CNT_CHILDREN, AVG(TARGET) * 100 FROM application_train_test GROUP BY CNT_CHILDREN ORDER BY CNT_CHILDREN LIMIT 100]\n(Background on this error at: https://sqlalche.me/e/20/f405)"
      }
    }
  ],
  "timestamp": "2025-11-19T23:17:55.587995",
  "benchmark_file": "/home/dark/Documents/GitHub/SQL_Agent_proj/tests/benchmark_3000.json"
}